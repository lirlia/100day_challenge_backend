# Day60 - Mini OS Implementation Progress

## プロジェクト概要
QEMUで動作する独自OSを実装する。スケジューラ、仮想メモリ、独自シェル（echo/ls対応）を含む。

## 技術スタック
- **言語**: C言語 + inline assembly (x86-64)
- **エミュレータ**: QEMU
- **ビルド**: Makefile + GCC cross-compiler
- **確認方法**: QEMUシリアル出力をファイル保存 → read_file で確認

## 作業工程

### Phase 1: 開発環境構築 ✅
- [x] プロジェクト初期化
- [x] クロスコンパイラ確認・設定
- [x] Makefile 作成
- [x] 基本ディレクトリ構造作成

### Phase 2: ブートローダー & 基本カーネル ✅
- [x] 最小限ブートローダー実装 (boot.asm)
- [x] カーネルエントリポイント実装 (kernel.c)
- [x] シリアルポート出力機能実装
- [x] 初回ビルド & QEMU起動テスト
- [x] "Hello, OS!" 出力確認 (シンプルブートローダーで成功)

### Phase 3: メモリ管理 (物理)
- [ ] メモリマップ取得・解析
- [ ] 物理メモリ管理機構実装
- [ ] ヒープ管理（基本的なmalloc/free）
- [ ] メモリ情報デバッグ出力
- [ ] メモリ確保/解放テスト

### Phase 4: 仮想メモリ (ページング)
- [ ] ページテーブル構造体定義
- [ ] ページディレクトリ初期化
- [ ] 仮想アドレス → 物理アドレス変換
- [ ] ページフォルト処理（基本）
- [ ] 仮想メモリマッピング確認

### Phase 5: 割り込み処理
- [ ] IDT（割り込み記述子テーブル）設定
- [ ] タイマー割り込み設定
- [ ] キーボード割り込み処理
- [ ] システムコール割り込み（int 0x80）
- [ ] 割り込みハンドラテスト

### Phase 6: プロセス管理
- [ ] プロセス制御ブロック（PCB）定義
- [ ] プロセス作成機能（fork的機能）
- [ ] コンテキストスイッチ実装
- [ ] プロセススケジューラ（Round Robin）
- [ ] マルチプロセス動作確認

### Phase 7: システムコール
- [ ] システムコールインターフェース設計
- [ ] 基本システムコール実装：
  - [ ] sys_write（コンソール出力）
  - [ ] sys_read（キーボード入力）
  - [ ] sys_fork（プロセス生成）
  - [ ] sys_exec（プログラム実行）
  - [ ] sys_exit（プロセス終了）
- [ ] システムコール動作テスト

### Phase 8: ユーザーランド基盤
- [ ] ユーザー空間プロセス実行環境
- [ ] ELF形式プログラム読み込み（簡易版）
- [ ] ユーザープロセス起動テスト
- [ ] 権限分離確認（kernel space / user space）

### Phase 9: 基本ファイルシステム
- [ ] 仮想ファイルシステム設計
- [ ] ルートディレクトリ構造作成
- [ ] 基本ファイル操作API
- [ ] ディレクトリリスト機能
- [ ] ファイル操作テスト

### Phase 10: シェル実装
- [ ] シェルプロセス実装
- [ ] コマンドライン解析
- [ ] プロセス起動機能
- [ ] 入出力リダイレクト（基本）
- [ ] シェル対話テスト

### Phase 11: 基本コマンド実装
- [ ] echo コマンド実装
- [ ] ls コマンド実装
- [ ] cat コマンド実装（ボーナス）
- [ ] ps コマンド実装（プロセス一覧）
- [ ] 全コマンド動作確認

### Phase 12: 統合テスト & 最適化
- [ ] 全機能統合テスト
- [ ] パフォーマンステスト
- [ ] メモリリーク検証
- [ ] エラーハンドリング強化
- [ ] ドキュメント作成

## ファイル構成予定

```
day60_mini_os/
├── src/
│   ├── boot/
│   │   ├── boot.asm          # ブートローダー
│   │   └── multiboot.asm     # Multiboot準拠ヘッダ
│   ├── kernel/
│   │   ├── main.c            # カーネルメイン
│   │   ├── memory.c          # メモリ管理
│   │   ├── process.c         # プロセス管理
│   │   ├── interrupt.c       # 割り込み処理
│   │   ├── syscall.c         # システムコール
│   │   └── scheduler.c       # スケジューラ
│   ├── drivers/
│   │   ├── serial.c          # シリアルドライバ
│   │   ├── keyboard.c        # キーボードドライバ
│   │   └── timer.c           # タイマードライバ
│   ├── fs/
│   │   ├── vfs.c             # 仮想ファイルシステム
│   │   └── simple_fs.c       # 簡易ファイルシステム
│   ├── user/
│   │   ├── shell.c           # シェル
│   │   ├── echo.c            # echo コマンド
│   │   └── ls.c              # ls コマンド
│   └── include/
│       ├── kernel.h          # カーネル共通ヘッダ
│       ├── memory.h          # メモリ管理
│       ├── process.h         # プロセス管理
│       └── syscall.h         # システムコール
├── build/                    # ビルド出力
├── Makefile                  # ビルド設定
├── linker.ld                 # リンカスクリプト
└── run.sh                    # QEMU実行スクリプト
```

## 各フェーズのテスト方法

1. **ビルドテスト**: `make clean && make`
2. **実行テスト**: `make run` (QEMUでシリアル出力)
3. **出力確認**: `cat output.log` でOS出力確認
4. **機能テスト**: 各フェーズごとに特定機能の動作確認

## 学習ポイント

- **低レベルプログラミング**: アセンブリ、メモリ直接操作
- **OS理論実践**: プロセス、メモリ、スケジューリング
- **ハードウェア制御**: 割り込み、デバイスドライバ
- **システムプログラミング**: カーネル空間とユーザー空間の分離
- **デバッグ技術**: QEMUデバッガ、シリアル出力ログ
