# Day62: Rust JIT コンパイラ with Web Dashboard

## 概要

Rustで実装されたJIT（Just-In-Time）コンパイラと、リアルタイム可視化を行うWebダッシュボードのシステムです。簡易数式言語をターゲットとし、実行時の最適化とパフォーマンス分析を体験できます。

## 主な機能

### JITエンジン (Rust)
- **簡易数式言語の解釈実行**: 算術演算、変数、条件分岐、組み込み関数
- **x86-64マシンコード生成**: 動的なネイティブコード生成
- **ホットスポット検出**: 10回実行閾値での自動JITコンパイル
- **実行統計収集**: コンパイル時間、実行時間、キャッシュ効率の計測

### Web Dashboard (Next.js)
- **リアルタイム監視**: JIT動作状況の2秒間隔ライブ更新
- **パフォーマンス可視化**: Chart.jsによる実行時間推移グラフ
- **JITキャッシュ監視**: ハッシュベースキャッシュエントリの詳細表示
- **インタラクティブエディタ**: 式入力・実行・結果表示インターフェース

## 技術スタック

- **バックエンド**: Rust 1.57.0 + 標準ライブラリHTTPサーバー
- **フロントエンド**: Next.js 15 (App Router) + TypeScript
- **スタイリング**: Tailwind CSS v4 (サイバーパンク風デザイン)
- **グラフ描画**: Chart.js + react-chartjs-2
- **JIT**: x86-64 アセンブリ生成 + 実行可能メモリ管理

## アーキテクチャ

```
┌─────────────────┐    REST API    ┌─────────────────┐
│   Web Frontend  │ ◄──────────── │ Rust JIT Engine │
│   (Next.js)     │   Port 3002    │  (HTTP Server)  │
│                 │               │   Port 3001     │
└─────────────────┘               └─────────────────┘
         │                                  │
         │                                  │
         ▼                                  ▼
┌─────────────────┐               ┌─────────────────┐
│  Dashboard UI   │               │  JIT Compiler   │
│  - 実行パネル   │               │  - Lexer/Parser │
│  - 統計表示     │               │  - x86-64 Gen   │
│  - グラフ描画   │               │  - Cache Mgmt   │
│  - キャッシュ監視│               │  - Hotspot Det  │
└─────────────────┘               └─────────────────┘
```

## 対応言語仕様

### 基本演算
```
1 + 2 * 3 - 4 / 2    # 算術演算: +, -, *, /, %
x = 42               # 変数代入
y = x + 10           # 変数参照
x == 42              # 比較演算: ==, !=, <, >, <=, >=
```

### 組み込み関数
```
fib(10)              # フィボナッチ数列
fact(5)              # 階乗計算
pow(2, 8)            # べき乗計算
```

### 条件分岐
```
if(x > 10, x * 2, x + 1)  # if(条件, true時, false時)
```

## JIT最適化

1. **実行回数閾値**: 10回実行でJITコンパイル開始
2. **ハッシュベースキャッシュ**: 式内容でユニーク識別・管理
3. **x86-64コード生成**: レジスタ割り当て・スタック管理
4. **統計収集**: 実行時間・コンパイル時間・キャッシュヒット率

## 起動方法

### 1. バックエンド (Rust JIT Server)
```bash
cd backend
cargo run server
# http://localhost:3001 でAPI起動
```

### 2. フロントエンド (Next.js Dashboard)
```bash
cd frontend
npm install
npm run dev
# http://localhost:3002 でダッシュボード起動
```

### 3. 動作確認
```bash
# API直接テスト
curl -X POST http://localhost:3001/api/execute \
  -H "Content-Type: application/json" \
  -d '{"code":"x = 42; x * 2"}'

# 統計情報取得
curl http://localhost:3001/api/stats
```

## API エンドポイント

- `POST /api/execute` - 式実行 + JIT統計更新
- `GET /api/stats` - JIT統計情報 (実行回数、コンパイル回数、平均時間)
- `GET /api/cache` - JITキャッシュ情報 (ハッシュ、実行回数、コンパイル状態)
- `POST /api/reset` - 統計・キャッシュリセット
- `GET /api/health` - サーバーヘルスチェック

## 学習ポイント

- **JITコンパイラの内部構造理解**
- **x86-64アセンブリ生成技術**
- **ホットスポット検出アルゴリズム**
- **実行時システムの設計**
- **パフォーマンス分析・可視化手法**
- **Rust低レベルプログラミング**
- **フルスタック統合開発**

## パフォーマンス例

```
📊 JIT統計例:
- 総実行回数: 33回
- JITコンパイル: 2回 (6.1%)
- 平均実行時間: 1,363ns
- 平均コンパイル時間: 6,000ns
- キャッシュエントリ: 5個

🔥 ホットスポット検出例:
式 "x = 42; x * 2" が10回実行 → JITコンパイル開始
→ 34バイトのx86-64マシンコード生成 (5,041ns)
→ 以降の実行で高速化を実現
```

---

**Day62 Challenge**: 本格的なJITコンパイラシステムの実装により、動的最適化とコンパイラ技術の深い理解を目指します。
