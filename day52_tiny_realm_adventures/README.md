# Day52 - タイニーレルム冒険譚 (Tiny Realm Adventures)

これは、100日チャレンジのDay52で作成した、シンプルな2Dタイルベースの小規模MMORPGです。
ポーリングベースで擬似的なリアルタイム同期を行い、基本的な移動、チャット、NPCとのインタラクション、シンプルなモンスターとの戦闘、アイテム使用などの機能を実装しています。

https://github.com/user-attachments/assets/88c96a9a-b3af-4ff6-97f6-743227b3faf7

[100日チャレンジ day52](https://zenn.dev/gin_nazo/scraps/6691efe1addd36)

## コンセプト

- **テーマ:** 小規模2DタイルベースMMORPG (ポーリングベース同期)
- **コア機能:**
    - プレイヤー管理 (名前、HP、位置情報、インベントリ)
    - マップ移動 (2Dグリッド、衝突判定あり)
    - 他プレイヤー、NPC、モンスターのマップ表示 (ポーリングによる同期)
    - NPCとのインタラクション (固定メッセージ表示)
    - モンスターとの簡易戦闘 (クリック攻撃、HP減少、アイテムドロップ、リスポーン)
    - グローバルチャット機能 (ポーリングによる同期)
    - 簡易アイテムシステム (回復ポーションなど) とインベントリ管理
- **デザインテーマ:** レトロピクセルアート風 (Tailwind CSS)。フォントには `VT323` を使用。

## 技術スタック

- Next.js (App Router, Route Handlers for API)
- TypeScript
- SQLite (better-sqlite3 で直接操作、`db/dev.db` にデータ保存)
- Tailwind CSS
- Playwright (E2Eテスト用)

## 起動方法

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動 (ポート3001)
npm run dev -- --port 3001
```

アプリケーションは `http://localhost:3001` で起動します。
初回起動時、または `db/dev.db` が存在しない場合は、データベーススキーマと初期データが自動的に作成されます。

## 主な機能と操作

- **ゲーム参加:** トップページでプレイヤー名を入力し、「ゲーム開始」ボタンをクリックするとゲームワールドに参加します。
- **移動:** ゲーム画面でキーボードの矢印キーまたはWASDキーを使用して、マップ上を移動します。
- **NPCとの会話:** マップ上のNPCキャラクターをクリックすると、NPCからのメッセージがモーダルウィンドウで表示されます。
- **モンスターとの戦闘:** マップ上のモンスターをクリックすると戦闘オプションが表示され、「攻撃」を選択すると戦闘が開始されます。モンスターを倒すと経験値は得られませんが、アイテムをドロップすることがあります。
- **チャット:** 画面右下のチャットウィンドウでメッセージを入力し、「送信」ボタンまたはEnterキーで他のプレイヤーとリアルタイムにチャットができます。
- **アイテム使用:** 画面右側のプレイヤーHUDに表示されるインベントリから、「回復ポーション」などのアイテムを選択し、「使う」ボタンで使用できます。
- **ゲーム終了:** ヘッダーの「タイトルへ」ボタンでゲームを終了し、トップページに戻ります。

## 実装詳細メモ（開発者向け）

- **データ同期:** 各クライアントは定期的にサーバーへポーリングを行い、ワールド全体の最新状態（マップ、他プレイヤー、NPC、モンスター）、チャットメッセージ、自身の詳細情報を取得・更新しています。
- **状態管理:** プレイヤー自身のクライアントデータは `sessionStorage` にも保持し、ページリロード時の状態復元やAPIリクエスト時のプレイヤー特定に利用しています。
- **データベース:** `lib/db.ts` がデータベース接続とスキーマ初期化を管理します。開発サーバーのホットリロード時に意図せずDBがリセットされることを防ぐため、スキーマ初期化はDBファイル内の特定テーブル（例: `players`）が存在しない場合にのみ実行されます。

## 今後の課題 (例)

- よりスムーズなリアルタイム同期 (WebSocketなどへの移行)
- 戦闘システムの深化 (スキル、ターン制など)
- アイテム種類の拡充と装備システム
- クエストやストーリー要素の追加
- マップの広域化とエリア間の移動
