{{define "content"}}
<div class="container">
  {{with $router := index .Routers .SelectedRouter}}
  <h2>ルーター詳細: {{$router.Name}} (ID: {{$.SelectedRouter}})</h2>

  <div class="router-details">
    <div class="router-info-card">
      <h3>基本情報</h3>
      <div class="info-item">
        <label>ID:</label>
        <span>{{$.SelectedRouter}}</span>
      </div>
      <div class="info-item">
        <label>名前:</label>
        <span>{{$router.Name}}</span>
      </div>
      <div class="info-item">
        <label>RIP:</label>
        <span>{{if $router.RIPEnabled}}有効{{else}}無効{{end}}</span>
      </div>
    </div>

    <div class="router-interfaces">
      <h3>インターフェース</h3>
      <table>
        <thead>
          <tr>
            <th>名前</th>
            <th>IPアドレス</th>
            <th>サブネットマスク</th>
            <th>状態</th>
            <th>接続先</th>
          </tr>
        </thead>
        <tbody>
          {{range $ifName, $iface := $router.Interfaces}}
          <tr>
            <td>{{$ifName}}</td>
            <td>{{$iface.IPAddress}}</td>
            <td>{{$iface.SubnetMask}}</td>
            <td class="if-status {{if $iface.IsUp}}up{{else}}down{{end}}">
              {{if $iface.IsUp}}UP{{else}}DOWN{{end}}
            </td>
            <td>
              {{if $iface.RemoteLink}}
              {{if eq $iface.RemoteLink.Endpoint1.RouterID $.SelectedRouter}}
              {{with $remoteRouter := index $.Routers $iface.RemoteLink.Endpoint2.RouterID}}
              {{$remoteRouter.Name}} ({{$iface.RemoteLink.Endpoint2.InterfaceName}})
              {{end}}
              {{else}}
              {{with $remoteRouter := index $.Routers $iface.RemoteLink.Endpoint1.RouterID}}
              {{$remoteRouter.Name}} ({{$iface.RemoteLink.Endpoint1.InterfaceName}})
              {{end}}
              {{end}}
              -
              {{if $iface.RemoteLink.IsUp}}
              <span class="link-status up">接続中</span>
              {{else}}
              <span class="link-status down">切断中</span>
              {{end}}
              {{else}}
              未接続
              {{end}}
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>

    <div class="router-statistics">
      <h3>パケット統計</h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value">{{$router.PacketStatistics.Received}}</div>
          <div class="stat-label">受信</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{$router.PacketStatistics.Sent}}</div>
          <div class="stat-label">送信</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{$router.PacketStatistics.Forwarded}}</div>
          <div class="stat-label">転送</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{$router.PacketStatistics.Dropped}}</div>
          <div class="stat-label">破棄</div>
        </div>
      </div>
    </div>
  </div>

  <div class="routing-table">
    <h3>ルーティングテーブル</h3>
    <table>
      <thead>
        <tr>
          <th>ネットワーク</th>
          <th>サブネットマスク</th>
          <th>NextHop</th>
          <th>インターフェース</th>
          <th>メトリック</th>
          <th>ソース</th>
          <th>アクション</th>
        </tr>
      </thead>
      <tbody>
        {{range $route := $router.RoutingTable.GetRoutes}}
        <tr>
          <td>{{$route.Network}}</td>
          <td>{{$route.SubnetMask}}</td>
          <td>{{if $route.NextHop}}{{$route.NextHop}}{{else}}直接接続{{end}}</td>
          <td>{{$route.Interface}}</td>
          <td>{{$route.Metric}}</td>
          <td>
            {{if eq $route.Source 0}}直接接続
            {{else if eq $route.Source 1}}静的
            {{else if eq $route.Source 2}}RIP
            {{end}}
          </td>
          <td>
            {{if ne $route.Source 0}}
            <form action="/api/route/delete" method="post">
              <input type="hidden" name="router_id" value="{{$.SelectedRouter}}">
              <input type="hidden" name="network" value="{{$route.Network}}">
              <input type="hidden" name="subnet_mask" value="{{$route.SubnetMask}}">
              <button type="submit" class="btn-small btn-danger">削除</button>
            </form>
            {{end}}
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>

  <div class="action-panel">
    <h3>ルート追加</h3>
    <form action="/api/route/add" method="post" class="route-form">
      <input type="hidden" name="router_id" value="{{$.SelectedRouter}}">

      <div class="form-group">
        <label for="network">ネットワーク:</label>
        <input type="text" id="network" name="network" placeholder="例: 192.168.3.0" required>
      </div>

      <div class="form-group">
        <label for="subnet_mask">サブネットマスク:</label>
        <input type="text" id="subnet_mask" name="subnet_mask" placeholder="例: 255.255.255.0" required>
      </div>

      <div class="form-group">
        <label for="next_hop">NextHop:</label>
        <input type="text" id="next_hop" name="next_hop" placeholder="例: 10.0.0.2" required>
      </div>

      <div class="form-group">
        <label for="metric">メトリック:</label>
        <input type="number" id="metric" name="metric" value="1" min="1" max="15">
      </div>

      <button type="submit" class="btn btn-primary">ルート追加</button>
    </form>
  </div>

  <div class="action-panel">
    <h3>Ping送信</h3>
    <form action="/api/ping" method="post" class="ping-form">
      <input type="hidden" name="source_router" value="{{$.SelectedRouter}}">

      <div class="form-group">
        <label for="destination_ip">宛先IPアドレス:</label>
        <input type="text" id="destination_ip" name="destination_ip" placeholder="例: 192.168.2.10" required>
      </div>

      <button type="submit" class="btn btn-primary">Ping送信</button>
    </form>
  </div>
  {{end}}
</div>
{{end}}
