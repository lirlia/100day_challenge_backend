# Day39 - インタラクティブCoWストレージシミュレーター

## 概要

このアプリケーションは、ストレージ技術における Copy-on-Write (CoW) の動作原理をインタラクティブかつ視覚的に理解するためのシミュレーターです。
ユーザーは仮想ディスク上でファイル操作（作成、編集、削除）やスナップショット作成・復元を行い、その際のデータブロックの割り当て、共有、CoWによる新規コピーの発生などをグラフィカルに確認できます。

https://github.com/user-attachments/assets/cf29cb96-d60c-4975-b065-b8e348e5d91f

[100日チャレンジ day39](https://zenn.dev/gin_nazo/scraps/e2cb8a9ef4f1eb)

## 目的

- Copy-on-Write (CoW) の概念とそのメリット（ストレージ効率、スナップショットの高速作成）を視覚的に学ぶ。
- スナップショットがどのようにデータの一貫性を保ちつつ、過去の時点を記録・復元できるかを理解する。
- データブロックレベルでのファイルシステムの挙動を抽象的に捉える。

## 主な機能

- **仮想ディスク表示:**
    - ブロックの状態（未使用、ファイル使用中、スナップショット保護されたオリジナルブロック(🔒)、スナップショット保護されたコピーブロック、共有ブロック）を色分け表示。
    - CoWによりコピーされた未保護のブロックを黄色い破線枠で表示。
    - ブロック内にファイル名（または過去のファイル名のヒント）を表示し、折り返し対応。
    - 選択中のスナップショットが参照するブロックをハイライト表示。
    - 凡例表示。
- **ファイル操作:**
    - ファイルの新規作成（内容指定可能）。
    - 既存ファイルの編集（CoWをシミュレート）。
    - ファイルの削除。
- **スナップショット操作 (ローカル):**
    - 現在のファイルシステム状態でスナップショットを作成。
    - 作成したスナップショットを選択し、当時のファイルリストを表示 (プレビュー)。
    - 選択したスナップショットの状態にファイルシステム全体を復元。
    - 不要になったスナップショットを削除（確認なしで直接削除、関連ブロックの参照カウント更新）。
- **イベントログ表示:**
    - ファイル操作、スナップショット操作、復元操作などのイベント履歴を時系列で表示。
- **情報パネル:**
    - ディスク統計（総ブロック数、空きブロック数など）表示。
    - 選択中のファイルやスナップショットの詳細情報表示。

## デザインテーマ

- ミニマリズムとデータビジュアライゼーションの融合
- ダークモード基調

## データモデル (クライアントサイド状態)

- `Block`: ブロックID、データ、参照カウント、スナップショット保護フラグ、オリジナルブロックID（CoW時）を持つ。
- `FileEntry`: ファイルID、名前、構成ブロックIDリスト、サイズ、作成/更新日時を持つ。
- `VirtualDisk`: 全ブロックの配列、総ブロック数、空きブロック数、ブロックサイズを持つ。
- `Snapshot`: スナップショットID、名前、作成日時、当時のファイルエントリリスト、参照ブロックIDセットを持つ。

## 画面構成

- **ランディングページ (`/`):** アプリケーションの簡単な紹介とシミュレーターへのリンク。
- **シミュレーターページ (`/simulator`):**
    - **左カラム:** ファイル操作UI（作成/編集フォーム、ファイルリスト）、スナップショット操作UI（作成フォーム、スナップショットリスト、復元/削除ボタン）。
    - **右カラム (上段):** 仮想ディスク表示（グリッド表示、凡例）。
    - **右カラム (下段):** イベントログ表示、情報パネル（統計、詳細など）。

## 使用技術スタック

- フレームワーク: Next.js (App Router)
- 言語: TypeScript
- 状態管理: Zustand
- スタイリング: Tailwind CSS
- パッケージ管理: npm
- コード品質: Biome (Lint & Format)

## 開始方法

1. **依存パッケージをインストール**
   ```bash
   cd day39_interactive_cow_simulator
   npm install
   ```

2. **開発サーバーを起動**
   ```bash
   npm run dev
   ```
   ブラウザで [http://localhost:3001](http://localhost:3001) を開くとランディングページが表示されます。
   シミュレーターは [http://localhost:3001/simulator](http://localhost:3001/simulator) です。
   (DBは使用しないため、初期化処理はありません)

## 注意事項

- これはCoWの概念を理解するための簡易的なシミュレーターです。
- 実際のファイルシステムやストレージの実装とは異なります（特に差分管理の粒度など）。
- エラーハンドリングは最小限です。
