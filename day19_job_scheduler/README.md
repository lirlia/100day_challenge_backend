# Day19 - ジョブスケジューラ

このアプリケーションは、定期的なタスク実行を管理するためのジョブスケジューラシステムです。バックエンドのメンテナンスやデータ処理などの定期的なタスクを自動化するのに役立ちます。

https://github.com/user-attachments/assets/064ef09e-0cb2-4986-a946-e8e05530945f

[100日チャレンジ day19 (ジョブスケジューラー)](https://zenn.dev/gin_nazo/scraps/0b7c4232cf4a15)

## 主な機能

- **ジョブ作成・管理**: コマンド、実行スケジュール、説明などを含むジョブを作成・管理
- **さまざまなスケジュールタイプ**:
  - 一度だけ実行（once）
  - 間隔実行（interval）- 秒、分、時間、日単位で設定可能
  - （将来拡張）クロン式（cron）- より複雑なスケジュール設定が可能
- **ジョブの有効化・無効化**: 任意のタイミングでジョブを一時停止/再開
- **手動実行**: スケジュールとは別に、必要に応じてジョブを手動で即時実行
- **実行履歴**: 各ジョブの実行履歴（開始・終了時間、成功/失敗のステータス、出力/エラーメッセージ）を記録
- **スケジューラエンジン**: 実行時間が到来したジョブを自動的に検知して実行

## 技術スタック

- **フレームワーク**: Next.js (App Router)
- **言語**: TypeScript
- **データベース**: SQLite（Prisma ORM経由でアクセス）
- **UIフレームワーク**: Tailwind CSS
- **ジョブ実行**: Node.js の child_process モジュールを使用

## データモデル

### Job（ジョブ）

- `id`: ジョブの一意識別子
- `name`: ジョブの名前
- `description`: ジョブの説明
- `command`: 実行するコマンド
- `scheduleType`: スケジュールタイプ（'once', 'interval', 'cron'）
- `scheduledAt`: 一度だけ実行の場合の実行予定時間
- `interval`: 間隔実行の場合の間隔値
- `intervalUnit`: 間隔の単位（'seconds', 'minutes', 'hours', 'days'）
- `isActive`: ジョブの有効/無効状態
- `lastRunAt`: 最後に実行された時間
- `nextRunAt`: 次回の実行予定時間
- `createdAt`: 作成日時
- `updatedAt`: 更新日時

### JobHistory（ジョブ実行履歴）

- `id`: 履歴の一意識別子
- `jobId`: 関連するジョブのID
- `startedAt`: 実行開始時間
- `finishedAt`: 実行終了時間
- `status`: 実行ステータス（'running', 'success', 'failed'）
- `output`: 実行時の標準出力
- `error`: 実行時のエラー出力
- `createdAt`: 作成日時

## API エンドポイント

- `GET /api/jobs`: すべてのジョブを取得
- `POST /api/jobs`: 新しいジョブを作成
- `GET /api/jobs/:id`: 特定のジョブの詳細を取得
- `PUT /api/jobs/:id`: ジョブを更新
- `DELETE /api/jobs/:id`: ジョブを削除
- `GET /api/jobs/:id/history`: ジョブの実行履歴を取得
- `POST /api/jobs/:id/run`: ジョブを手動で実行
- `POST /api/jobs/:id/toggle`: ジョブの有効/無効を切り替え
- `GET /api/scheduler/check`: スケジューラをチェックして実行すべきジョブを実行

## 使用方法

1. ホームページでジョブの一覧を確認
2. 「新規ジョブ作成」ボタンからジョブを作成
3. ジョブの詳細ページでジョブの情報や実行履歴を確認
4. ジョブの有効/無効を切り替えたり、手動実行したりすることが可能
5. 実行履歴から過去の実行結果を確認可能

## 将来の拡張可能性

- クロン式によるより柔軟なスケジュール設定
- ジョブ間の依存関係の設定
- 通知機能（失敗時にメール/Slack通知など）
- より詳細なモニタリングダッシュボード
- 分散環境でのジョブ実行
