/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/sharedb";
exports.ids = ["vendor-chunks/sharedb"];
exports.modules = {

/***/ "(ssr)/./node_modules/sharedb/lib/client/connection.js":
/*!*******************************************************!*\
  !*** ./node_modules/sharedb/lib/client/connection.js ***!
  \*******************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var Doc = __webpack_require__(/*! ./doc */ \"(ssr)/./node_modules/sharedb/lib/client/doc.js\");\nvar Query = __webpack_require__(/*! ./query */ \"(ssr)/./node_modules/sharedb/lib/client/query.js\");\nvar Presence = __webpack_require__(/*! ./presence/presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/presence.js\");\nvar DocPresence = __webpack_require__(/*! ./presence/doc-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/doc-presence.js\");\nvar SnapshotVersionRequest = __webpack_require__(/*! ./snapshot-request/snapshot-version-request */ \"(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-version-request.js\");\nvar SnapshotTimestampRequest = __webpack_require__(/*! ./snapshot-request/snapshot-timestamp-request */ \"(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-timestamp-request.js\");\nvar emitter = __webpack_require__(/*! ../emitter */ \"(ssr)/./node_modules/sharedb/lib/emitter.js\");\nvar ShareDBError = __webpack_require__(/*! ../error */ \"(ssr)/./node_modules/sharedb/lib/error.js\");\nvar ACTIONS = (__webpack_require__(/*! ../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\nvar types = __webpack_require__(/*! ../types */ \"(ssr)/./node_modules/sharedb/lib/types.js\");\nvar util = __webpack_require__(/*! ../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar logger = __webpack_require__(/*! ../logger */ \"(ssr)/./node_modules/sharedb/lib/logger/index.js\");\nvar DocPresenceEmitter = __webpack_require__(/*! ./presence/doc-presence-emitter */ \"(ssr)/./node_modules/sharedb/lib/client/presence/doc-presence-emitter.js\");\nvar protocol = __webpack_require__(/*! ../protocol */ \"(ssr)/./node_modules/sharedb/lib/protocol.js\");\n\nvar ERROR_CODE = ShareDBError.CODES;\n\nfunction connectionState(socket) {\n  if (socket.readyState === 0 || socket.readyState === 1) return 'connecting';\n  return 'disconnected';\n}\n\n/**\n * Handles communication with the sharejs server and provides queries and\n * documents.\n *\n * We create a connection with a socket object\n *   connection = new sharejs.Connection(sockset)\n * The socket may be any object handling the websocket protocol. See the\n * documentation of bindToSocket() for details. We then wait for the connection\n * to connect\n *   connection.on('connected', ...)\n * and are finally able to work with shared documents\n *   connection.get('food', 'steak') // Doc\n *\n * @param socket @see bindToSocket\n */\nmodule.exports = Connection;\nfunction Connection(socket) {\n  emitter.EventEmitter.call(this);\n\n  // Map of collection -> id -> doc object for created documents.\n  // (created documents MUST BE UNIQUE)\n  this.collections = Object.create(null);\n\n  // Each query and snapshot request is created with an id that the server uses when it sends us\n  // info about the request (updates, etc)\n  this.nextQueryId = 1;\n  this.nextSnapshotRequestId = 1;\n\n  // Map from query ID -> query object.\n  this.queries = Object.create(null);\n\n  // Maps from channel -> presence objects\n  this._presences = Object.create(null);\n  this._docPresenceEmitter = new DocPresenceEmitter();\n\n  // Map from snapshot request ID -> snapshot request\n  this._snapshotRequests = Object.create(null);\n\n  // A unique message number for the given id\n  this.seq = 1;\n\n  // A unique message number for presence\n  this._presenceSeq = 1;\n\n  // Equals agent.src on the server\n  this.id = null;\n\n  // This direct reference from connection to agent is not used internal to\n  // ShareDB, but it is handy for server-side only user code that may cache\n  // state on the agent and read it in middleware\n  this.agent = null;\n\n  this.debug = false;\n\n  this.state = connectionState(socket);\n\n  this.bindToSocket(socket);\n}\nemitter.mixin(Connection);\n\n\n/**\n * Use socket to communicate with server\n *\n * Socket is an object that can handle the websocket protocol. This method\n * installs the onopen, onclose, onmessage and onerror handlers on the socket to\n * handle communication and sends messages by calling socket.send(message). The\n * sockets `readyState` property is used to determine the initaial state.\n *\n * @param socket Handles the websocket protocol\n * @param socket.readyState\n * @param socket.close\n * @param socket.send\n * @param socket.onopen\n * @param socket.onclose\n * @param socket.onmessage\n * @param socket.onerror\n */\nConnection.prototype.bindToSocket = function(socket) {\n  if (this.socket) {\n    this.socket.close();\n    this.socket.onmessage = null;\n    this.socket.onopen = null;\n    this.socket.onerror = null;\n    this.socket.onclose = null;\n  }\n\n  this.socket = socket;\n\n  // State of the connection. The corresponding events are emitted when this changes\n  //\n  // - 'connecting'   The connection is still being established, or we are still\n  //                    waiting on the server to send us the initialization message\n  // - 'connected'    The connection is open and we have connected to a server\n  //                    and recieved the initialization message\n  // - 'disconnected' Connection is closed, but it will reconnect automatically\n  // - 'closed'       The connection was closed by the client, and will not reconnect\n  // - 'stopped'      The connection was closed by the server, and will not reconnect\n  var newState = connectionState(socket);\n  this._setState(newState);\n\n  // This is a helper variable the document uses to see whether we're\n  // currently in a 'live' state. It is true if and only if we're connected\n  this.canSend = false;\n\n  var connection = this;\n\n  socket.onmessage = function(event) {\n    try {\n      var data = (typeof event.data === 'string') ?\n        JSON.parse(event.data) : event.data;\n    } catch (err) {\n      logger.warn('Failed to parse message', event);\n      return;\n    }\n\n    if (connection.debug) logger.info('RECV', JSON.stringify(data));\n\n    var request = {data: data};\n    connection.emit('receive', request);\n    if (!request.data) return;\n\n    try {\n      connection.handleMessage(request.data);\n    } catch (err) {\n      util.nextTick(function() {\n        connection.emit('error', err);\n      });\n    }\n  };\n\n  // If socket is already open, do handshake immediately.\n  if (socket.readyState === 1) {\n    connection._initializeHandshake();\n  }\n  socket.onopen = function() {\n    connection._setState('connecting');\n    connection._initializeHandshake();\n  };\n\n  socket.onerror = function(err) {\n    // This isn't the same as a regular error, because it will happen normally\n    // from time to time. Your connection should probably automatically\n    // reconnect anyway, but that should be triggered off onclose not onerror.\n    // (onclose happens when onerror gets called anyway).\n    connection.emit('connection error', err);\n  };\n\n  socket.onclose = function(reason) {\n    // node-browserchannel reason values:\n    //   'Closed' - The socket was manually closed by calling socket.close()\n    //   'Stopped by server' - The server sent the stop message to tell the client not to try connecting\n    //   'Request failed' - Server didn't respond to request (temporary, usually offline)\n    //   'Unknown session ID' - Server session for client is missing (temporary, will immediately reestablish)\n\n    if (reason === 'closed' || reason === 'Closed') {\n      connection._setState('closed', reason);\n    } else if (reason === 'stopped' || reason === 'Stopped by server') {\n      connection._setState('stopped', reason);\n    } else {\n      connection._setState('disconnected', reason);\n    }\n  };\n};\n\n/**\n * @param {object} message\n * @param {string} message.a action\n */\nConnection.prototype.handleMessage = function(message) {\n  var err = null;\n  if (message.error) {\n    err = wrapErrorData(message.error, message);\n    delete message.error;\n  }\n  // Switch on the message action. Most messages are for documents and are\n  // handled in the doc class.\n  switch (message.a) {\n    case ACTIONS.initLegacy:\n      // Client initialization packet\n      return this._handleLegacyInit(message);\n    case ACTIONS.handshake:\n      return this._handleHandshake(err, message);\n    case ACTIONS.queryFetch:\n      var query = this.queries[message.id];\n      if (query) query._handleFetch(err, message.data, message.extra);\n      return;\n    case ACTIONS.querySubscribe:\n      var query = this.queries[message.id];\n      if (query) query._handleSubscribe(err, message.data, message.extra);\n      return;\n    case ACTIONS.queryUnsubscribe:\n      // Queries are removed immediately on calls to destroy, so we ignore\n      // replies to query unsubscribes. Perhaps there should be a callback for\n      // destroy, but this is currently unimplemented\n      return;\n    case ACTIONS.queryUpdate:\n      // Query message. Pass this to the appropriate query object.\n      var query = this.queries[message.id];\n      if (!query) return;\n      if (err) return query._handleError(err);\n      if (message.diff) query._handleDiff(message.diff);\n      if (util.hasOwn(message, 'extra')) query._handleExtra(message.extra);\n      return;\n\n    case ACTIONS.bulkFetch:\n      return this._handleBulkMessage(err, message, '_handleFetch');\n    case ACTIONS.bulkSubscribe:\n    case ACTIONS.bulkUnsubscribe:\n      return this._handleBulkMessage(err, message, '_handleSubscribe');\n\n    case ACTIONS.snapshotFetch:\n    case ACTIONS.snapshotFetchByTimestamp:\n      return this._handleSnapshotFetch(err, message);\n\n    case ACTIONS.fetch:\n      var doc = this.getExisting(message.c, message.d);\n      if (doc) doc._handleFetch(err, message.data);\n      return;\n    case ACTIONS.subscribe:\n    case ACTIONS.unsubscribe:\n      var doc = this.getExisting(message.c, message.d);\n      if (doc) doc._handleSubscribe(err, message.data);\n      return;\n    case ACTIONS.op:\n      var doc = this.getExisting(message.c, message.d);\n      if (doc) doc._handleOp(err, message);\n      return;\n    case ACTIONS.presence:\n      return this._handlePresence(err, message);\n    case ACTIONS.presenceSubscribe:\n      return this._handlePresenceSubscribe(err, message);\n    case ACTIONS.presenceUnsubscribe:\n      return this._handlePresenceUnsubscribe(err, message);\n    case ACTIONS.presenceRequest:\n      return this._handlePresenceRequest(err, message);\n    case ACTIONS.pingPong:\n      return this._handlePingPong(err);\n\n    default:\n      logger.warn('Ignoring unrecognized message', message);\n  }\n};\n\nfunction wrapErrorData(errorData, fullMessage) {\n  // wrap in Error object so can be passed through event emitters\n  var err = new Error(errorData.message);\n  err.code = errorData.code;\n  if (fullMessage) {\n    // Add the message data to the error object for more context\n    err.data = fullMessage;\n  }\n  return err;\n}\n\nConnection.prototype._handleBulkMessage = function(err, message, method) {\n  if (message.data) {\n    for (var id in message.data) {\n      var dataForId = message.data[id];\n      var doc = this.getExisting(message.c, id);\n      if (doc) {\n        if (err) {\n          doc[method](err);\n        } else if (dataForId.error) {\n          // Bulk reply snapshot-specific errorr - see agent.js getMapResult\n          doc[method](wrapErrorData(dataForId.error));\n        } else {\n          doc[method](null, dataForId);\n        }\n      }\n    }\n  } else if (Array.isArray(message.b)) {\n    for (var i = 0; i < message.b.length; i++) {\n      var id = message.b[i];\n      var doc = this.getExisting(message.c, id);\n      if (doc) doc[method](err);\n    }\n  } else if (message.b) {\n    for (var id in message.b) {\n      var doc = this.getExisting(message.c, id);\n      if (doc) doc[method](err);\n    }\n  } else {\n    logger.error('Invalid bulk message', message);\n  }\n};\n\nConnection.prototype._reset = function() {\n  this.agent = null;\n};\n\n// Set the connection's state. The connection is basically a state machine.\nConnection.prototype._setState = function(newState, reason) {\n  if (this.state === newState) return;\n\n  // I made a state diagram. The only invalid transitions are getting to\n  // 'connecting' from anywhere other than 'disconnected' and getting to\n  // 'connected' from anywhere other than 'connecting'.\n  if (\n    (\n      newState === 'connecting' &&\n      this.state !== 'disconnected' &&\n      this.state !== 'stopped' &&\n      this.state !== 'closed'\n    ) || (\n      newState === 'connected' &&\n      this.state !== 'connecting'\n    )\n  ) {\n    var err = new ShareDBError(\n      ERROR_CODE.ERR_CONNECTION_STATE_TRANSITION_INVALID,\n      'Cannot transition directly from ' + this.state + ' to ' + newState\n    );\n    return this.emit('error', err);\n  }\n\n  this.state = newState;\n  this.canSend = (newState === 'connected');\n\n  if (\n    newState === 'disconnected' ||\n    newState === 'stopped' ||\n    newState === 'closed'\n  ) {\n    this._reset();\n  }\n\n  // Group subscribes together to help server make more efficient calls\n  this.startBulk();\n  // Emit the event to all queries\n  for (var id in this.queries) {\n    var query = this.queries[id];\n    query._onConnectionStateChanged();\n  }\n  // Emit the event to all documents\n  for (var collection in this.collections) {\n    var docs = this.collections[collection];\n    for (var id in docs) {\n      docs[id]._onConnectionStateChanged();\n    }\n  }\n  // Emit the event to all Presences\n  for (var channel in this._presences) {\n    this._presences[channel]._onConnectionStateChanged();\n  }\n  // Emit the event to all snapshots\n  for (var id in this._snapshotRequests) {\n    var snapshotRequest = this._snapshotRequests[id];\n    snapshotRequest._onConnectionStateChanged();\n  }\n  this.endBulk();\n\n  this.emit(newState, reason);\n  this.emit('state', newState, reason);\n};\n\nConnection.prototype.startBulk = function() {\n  if (!this.bulk) this.bulk = Object.create(null);\n};\n\nConnection.prototype.endBulk = function() {\n  if (this.bulk) {\n    for (var collection in this.bulk) {\n      var actions = this.bulk[collection];\n      this._sendBulk('f', collection, actions.f);\n      this._sendBulk('s', collection, actions.s);\n      this._sendBulk('u', collection, actions.u);\n    }\n  }\n  this.bulk = null;\n};\n\nConnection.prototype._sendBulk = function(action, collection, values) {\n  if (!values) return;\n  var ids = [];\n  var versions = Object.create(null);\n  var versionsCount = 0;\n  var versionId;\n  for (var id in values) {\n    var value = values[id];\n    if (value == null) {\n      ids.push(id);\n    } else {\n      versions[id] = value;\n      versionId = id;\n      versionsCount++;\n    }\n  }\n  if (ids.length === 1) {\n    var id = ids[0];\n    this.send({a: action, c: collection, d: id});\n  } else if (ids.length) {\n    this.send({a: 'b' + action, c: collection, b: ids});\n  }\n  if (versionsCount === 1) {\n    var version = versions[versionId];\n    this.send({a: action, c: collection, d: versionId, v: version});\n  } else if (versionsCount) {\n    this.send({a: 'b' + action, c: collection, b: versions});\n  }\n};\n\nConnection.prototype._sendActions = function(action, doc, version) {\n  // Ensure the doc is registered so that it receives the reply message\n  this._addDoc(doc);\n  if (this.bulk) {\n    // Bulk subscribe\n    var actions = this.bulk[doc.collection] || (this.bulk[doc.collection] = Object.create(null));\n    var versions = actions[action] || (actions[action] = Object.create(null));\n    var isDuplicate = util.hasOwn(versions, doc.id);\n    versions[doc.id] = version;\n    return isDuplicate;\n  } else {\n    // Send single doc subscribe message\n    var message = {a: action, c: doc.collection, d: doc.id, v: version};\n    this.send(message);\n  }\n};\n\nConnection.prototype.sendFetch = function(doc) {\n  return this._sendActions(ACTIONS.fetch, doc, doc.version);\n};\n\nConnection.prototype.sendSubscribe = function(doc) {\n  return this._sendActions(ACTIONS.subscribe, doc, doc.version);\n};\n\nConnection.prototype.sendUnsubscribe = function(doc) {\n  return this._sendActions(ACTIONS.unsubscribe, doc);\n};\n\nConnection.prototype.sendOp = function(doc, op) {\n  // Ensure the doc is registered so that it receives the reply message\n  this._addDoc(doc);\n  var message = {\n    a: ACTIONS.op,\n    c: doc.collection,\n    d: doc.id,\n    v: doc.version,\n    src: op.src,\n    seq: op.seq,\n    x: {}\n  };\n  if ('op' in op) message.op = op.op;\n  if (op.create) message.create = op.create;\n  if (op.del) message.del = op.del;\n  if (doc.submitSource) message.x.source = op.source;\n  this.send(message);\n};\n\n\n/**\n * Sends a message down the socket\n */\nConnection.prototype.send = function(message) {\n  if (this.debug) logger.info('SEND', JSON.stringify(message));\n\n  this.emit('send', message);\n  this.socket.send(JSON.stringify(message));\n};\n\nConnection.prototype.ping = function() {\n  if (!this.canSend) {\n    throw new ShareDBError(\n      ERROR_CODE.ERR_CANNOT_PING_OFFLINE,\n      'Socket must be CONNECTED to ping'\n    );\n  }\n\n  var message = {\n    a: ACTIONS.pingPong\n  };\n  this.send(message);\n};\n\n/**\n * Closes the socket and emits 'closed'\n */\nConnection.prototype.close = function() {\n  this.socket.close();\n};\n\nConnection.prototype.getExisting = function(collection, id) {\n  if (this.collections[collection]) return this.collections[collection][id];\n};\n\n\n/**\n * Get or create a document.\n *\n * @param collection\n * @param id\n * @return {Doc}\n */\nConnection.prototype.get = function(collection, id) {\n  var docs = this.collections[collection] ||\n    (this.collections[collection] = Object.create(null));\n\n  var doc = docs[id];\n  if (!doc) {\n    doc = docs[id] = new Doc(this, collection, id);\n    this.emit('doc', doc);\n  }\n\n  doc._wantsDestroy = false;\n  return doc;\n};\n\n\n/**\n * Remove document from this.collections\n *\n * @private\n */\nConnection.prototype._destroyDoc = function(doc) {\n  if (!doc._wantsDestroy) return;\n  util.digAndRemove(this.collections, doc.collection, doc.id);\n  doc.emit('destroy');\n};\n\nConnection.prototype._addDoc = function(doc) {\n  var docs = this.collections[doc.collection];\n  if (!docs) {\n    docs = this.collections[doc.collection] = Object.create(null);\n  }\n  if (docs[doc.id] !== doc) {\n    docs[doc.id] = doc;\n  }\n};\n\n// Helper for createFetchQuery and createSubscribeQuery, below.\nConnection.prototype._createQuery = function(action, collection, q, options, callback) {\n  var id = this.nextQueryId++;\n  var query = new Query(action, this, id, collection, q, options, callback);\n  this.queries[id] = query;\n  query.send();\n  return query;\n};\n\n// Internal function. Use query.destroy() to remove queries.\nConnection.prototype._destroyQuery = function(query) {\n  delete this.queries[query.id];\n};\n\n// The query options object can contain the following fields:\n//\n// db: Name of the db for the query. You can attach extraDbs to ShareDB and\n//   pick which one the query should hit using this parameter.\n\n// Create a fetch query. Fetch queries are only issued once, returning the\n// results directly into the callback.\n//\n// The callback should have the signature function(error, results, extra)\n// where results is a list of Doc objects.\nConnection.prototype.createFetchQuery = function(collection, q, options, callback) {\n  return this._createQuery(ACTIONS.queryFetch, collection, q, options, callback);\n};\n\n// Create a subscribe query. Subscribe queries return with the initial data\n// through the callback, then update themselves whenever the query result set\n// changes via their own event emitter.\n//\n// If present, the callback should have the signature function(error, results, extra)\n// where results is a list of Doc objects.\nConnection.prototype.createSubscribeQuery = function(collection, q, options, callback) {\n  return this._createQuery(ACTIONS.querySubscribe, collection, q, options, callback);\n};\n\nConnection.prototype.hasPending = function() {\n  return !!(\n    this._firstDoc(hasPending) ||\n    this._firstQuery(hasPending) ||\n    this._firstSnapshotRequest()\n  );\n};\nfunction hasPending(object) {\n  return object.hasPending();\n}\n\nConnection.prototype.hasWritePending = function() {\n  return !!this._firstDoc(hasWritePending);\n};\nfunction hasWritePending(object) {\n  return object.hasWritePending();\n}\n\nConnection.prototype.whenNothingPending = function(callback) {\n  var doc = this._firstDoc(hasPending);\n  if (doc) {\n    // If a document is found with a pending operation, wait for it to emit\n    // that nothing is pending anymore, and then recheck all documents again.\n    // We have to recheck all documents, just in case another mutation has\n    // been made in the meantime as a result of an event callback\n    doc.once('nothing pending', this._nothingPendingRetry(callback));\n    return;\n  }\n  var query = this._firstQuery(hasPending);\n  if (query) {\n    query.once('ready', this._nothingPendingRetry(callback));\n    return;\n  }\n  var snapshotRequest = this._firstSnapshotRequest();\n  if (snapshotRequest) {\n    snapshotRequest.once('ready', this._nothingPendingRetry(callback));\n    return;\n  }\n  // Call back when no pending operations\n  util.nextTick(callback);\n};\nConnection.prototype._nothingPendingRetry = function(callback) {\n  var connection = this;\n  return function() {\n    util.nextTick(function() {\n      connection.whenNothingPending(callback);\n    });\n  };\n};\n\nConnection.prototype._firstDoc = function(fn) {\n  for (var collection in this.collections) {\n    var docs = this.collections[collection];\n    for (var id in docs) {\n      var doc = docs[id];\n      if (fn(doc)) {\n        return doc;\n      }\n    }\n  }\n};\n\nConnection.prototype._firstQuery = function(fn) {\n  for (var id in this.queries) {\n    var query = this.queries[id];\n    if (fn(query)) {\n      return query;\n    }\n  }\n};\n\nConnection.prototype._firstSnapshotRequest = function() {\n  for (var id in this._snapshotRequests) {\n    return this._snapshotRequests[id];\n  }\n};\n\n/**\n * Fetch a read-only snapshot at a given version\n *\n * @param collection - the collection name of the snapshot\n * @param id - the ID of the snapshot\n * @param version (optional) - the version number to fetch. If null, the latest version is fetched.\n * @param callback - (error, snapshot) => void, where snapshot takes the following schema:\n *\n * {\n *   id: string;         // ID of the snapshot\n *   v: number;          // version number of the snapshot\n *   type: string;       // the OT type of the snapshot, or null if it doesn't exist or is deleted\n *   data: any;          // the snapshot\n * }\n *\n */\nConnection.prototype.fetchSnapshot = function(collection, id, version, callback) {\n  if (typeof version === 'function') {\n    callback = version;\n    version = null;\n  }\n\n  var requestId = this.nextSnapshotRequestId++;\n  var snapshotRequest = new SnapshotVersionRequest(this, requestId, collection, id, version, callback);\n  this._snapshotRequests[snapshotRequest.requestId] = snapshotRequest;\n  snapshotRequest.send();\n};\n\n/**\n * Fetch a read-only snapshot at a given timestamp\n *\n * @param collection - the collection name of the snapshot\n * @param id - the ID of the snapshot\n * @param timestamp (optional) - the timestamp to fetch. If null, the latest version is fetched.\n * @param callback - (error, snapshot) => void, where snapshot takes the following schema:\n *\n * {\n *   id: string;         // ID of the snapshot\n *   v: number;          // version number of the snapshot\n *   type: string;       // the OT type of the snapshot, or null if it doesn't exist or is deleted\n *   data: any;          // the snapshot\n * }\n *\n */\nConnection.prototype.fetchSnapshotByTimestamp = function(collection, id, timestamp, callback) {\n  if (typeof timestamp === 'function') {\n    callback = timestamp;\n    timestamp = null;\n  }\n\n  var requestId = this.nextSnapshotRequestId++;\n  var snapshotRequest = new SnapshotTimestampRequest(this, requestId, collection, id, timestamp, callback);\n  this._snapshotRequests[snapshotRequest.requestId] = snapshotRequest;\n  snapshotRequest.send();\n};\n\nConnection.prototype._handleSnapshotFetch = function(error, message) {\n  var snapshotRequest = this._snapshotRequests[message.id];\n  if (!snapshotRequest) return;\n  delete this._snapshotRequests[message.id];\n  snapshotRequest._handleResponse(error, message);\n};\n\nConnection.prototype._handleLegacyInit = function(message) {\n  // If the protocol is at least 1.1, we want to use the\n  // new handshake protocol. Let's send a handshake initialize, because\n  // we now know the server is ready. If we've already sent it, we'll\n  // just ignore the response anyway.\n  if (protocol.checkAtLeast(message, '1.1')) return this._initializeHandshake();\n  this._initialize(message);\n};\n\nConnection.prototype._initializeHandshake = function() {\n  this.send({\n    a: ACTIONS.handshake,\n    id: this.id,\n    protocol: protocol.major,\n    protocolMinor: protocol.minor\n  });\n};\n\nConnection.prototype._handleHandshake = function(error, message) {\n  if (error) return this.emit('error', error);\n  this._initialize(message);\n};\n\nConnection.prototype._handlePingPong = function(error) {\n  if (error) return this.emit('error', error);\n  this.emit('pong');\n};\n\nConnection.prototype._initialize = function(message) {\n  if (this.state !== 'connecting') return;\n\n  if (message.protocol !== protocol.major) {\n    return this.emit('error', new ShareDBError(\n      ERROR_CODE.ERR_PROTOCOL_VERSION_NOT_SUPPORTED,\n      'Unsupported protocol version: ' + message.protocol\n    ));\n  }\n  if (types.map[message.type] !== types.defaultType) {\n    return this.emit('error', new ShareDBError(\n      ERROR_CODE.ERR_DEFAULT_TYPE_MISMATCH,\n      message.type + ' does not match the server default type'\n    ));\n  }\n  if (typeof message.id !== 'string') {\n    return this.emit('error', new ShareDBError(\n      ERROR_CODE.ERR_CLIENT_ID_BADLY_FORMED,\n      'Client id must be a string'\n    ));\n  }\n  this.id = message.id;\n\n  this._setState('connected');\n};\n\nConnection.prototype.getPresence = function(channel) {\n  var connection = this;\n  var presence = util.digOrCreate(this._presences, channel, function() {\n    return new Presence(connection, channel);\n  });\n  presence._wantsDestroy = false;\n  return presence;\n};\n\nConnection.prototype.getDocPresence = function(collection, id) {\n  var channel = DocPresence.channel(collection, id);\n  var connection = this;\n  var presence = util.digOrCreate(this._presences, channel, function() {\n    return new DocPresence(connection, collection, id);\n  });\n  presence._wantsDestroy = false;\n  return presence;\n};\n\nConnection.prototype._sendPresenceAction = function(action, seq, presence) {\n  // Ensure the presence is registered so that it receives the reply message\n  this._addPresence(presence);\n  var message = {a: action, ch: presence.channel, seq: seq};\n  this.send(message);\n  return message.seq;\n};\n\nConnection.prototype._addPresence = function(presence) {\n  util.digOrCreate(this._presences, presence.channel, function() {\n    return presence;\n  });\n};\n\nConnection.prototype._requestRemotePresence = function(channel) {\n  this.send({a: ACTIONS.presenceRequest, ch: channel});\n};\n\nConnection.prototype._handlePresenceSubscribe = function(error, message) {\n  var presence = util.dig(this._presences, message.ch);\n  if (presence) presence._handleSubscribe(error, message.seq);\n};\n\nConnection.prototype._handlePresenceUnsubscribe = function(error, message) {\n  var presence = util.dig(this._presences, message.ch);\n  if (presence) presence._handleUnsubscribe(error, message.seq);\n};\n\nConnection.prototype._handlePresence = function(error, message) {\n  var presence = util.dig(this._presences, message.ch);\n  if (presence) presence._receiveUpdate(error, message);\n};\n\nConnection.prototype._handlePresenceRequest = function(error, message) {\n  var presence = util.dig(this._presences, message.ch);\n  if (presence) presence._broadcastAllLocalPresence(error, message);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L2Nvbm5lY3Rpb24uanMiLCJtYXBwaW5ncyI6IkFBQUEsVUFBVSxtQkFBTyxDQUFDLDZEQUFPO0FBQ3pCLFlBQVksbUJBQU8sQ0FBQyxpRUFBUztBQUM3QixlQUFlLG1CQUFPLENBQUMseUZBQXFCO0FBQzVDLGtCQUFrQixtQkFBTyxDQUFDLGlHQUF5QjtBQUNuRCw2QkFBNkIsbUJBQU8sQ0FBQyx5SUFBNkM7QUFDbEYsK0JBQStCLG1CQUFPLENBQUMsNklBQStDO0FBQ3RGLGNBQWMsbUJBQU8sQ0FBQywrREFBWTtBQUNsQyxtQkFBbUIsbUJBQU8sQ0FBQywyREFBVTtBQUNyQyxjQUFjLDhHQUFxQztBQUNuRCxZQUFZLG1CQUFPLENBQUMsMkRBQVU7QUFDOUIsV0FBVyxtQkFBTyxDQUFDLHlEQUFTO0FBQzVCLGFBQWEsbUJBQU8sQ0FBQyxtRUFBVztBQUNoQyx5QkFBeUIsbUJBQU8sQ0FBQyxpSEFBaUM7QUFDbEUsZUFBZSxtQkFBTyxDQUFDLGlFQUFhOztBQUVwQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsbUJBQW1CO0FBQ25CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLG9CQUFvQixzQkFBc0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLGdDQUFnQztBQUMvQyxJQUFJO0FBQ0osZUFBZSx1Q0FBdUM7QUFDdEQ7QUFDQTtBQUNBO0FBQ0EsZUFBZSxtREFBbUQ7QUFDbEUsSUFBSTtBQUNKLGVBQWUsNENBQTRDO0FBQzNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIseUJBQXlCO0FBQ3pCLHlCQUF5QjtBQUN6Qix5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6Qix5QkFBeUI7QUFDekIseUJBQXlCO0FBQ3pCLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQSxhQUFhLHdDQUF3QztBQUNyRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2RheTlfY29sbGFib3JhdGl2ZV9lZGl0b3IvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L2Nvbm5lY3Rpb24uanM/ZWFmYyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRG9jID0gcmVxdWlyZSgnLi9kb2MnKTtcbnZhciBRdWVyeSA9IHJlcXVpcmUoJy4vcXVlcnknKTtcbnZhciBQcmVzZW5jZSA9IHJlcXVpcmUoJy4vcHJlc2VuY2UvcHJlc2VuY2UnKTtcbnZhciBEb2NQcmVzZW5jZSA9IHJlcXVpcmUoJy4vcHJlc2VuY2UvZG9jLXByZXNlbmNlJyk7XG52YXIgU25hcHNob3RWZXJzaW9uUmVxdWVzdCA9IHJlcXVpcmUoJy4vc25hcHNob3QtcmVxdWVzdC9zbmFwc2hvdC12ZXJzaW9uLXJlcXVlc3QnKTtcbnZhciBTbmFwc2hvdFRpbWVzdGFtcFJlcXVlc3QgPSByZXF1aXJlKCcuL3NuYXBzaG90LXJlcXVlc3Qvc25hcHNob3QtdGltZXN0YW1wLXJlcXVlc3QnKTtcbnZhciBlbWl0dGVyID0gcmVxdWlyZSgnLi4vZW1pdHRlcicpO1xudmFyIFNoYXJlREJFcnJvciA9IHJlcXVpcmUoJy4uL2Vycm9yJyk7XG52YXIgQUNUSU9OUyA9IHJlcXVpcmUoJy4uL21lc3NhZ2UtYWN0aW9ucycpLkFDVElPTlM7XG52YXIgdHlwZXMgPSByZXF1aXJlKCcuLi90eXBlcycpO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuLi91dGlsJyk7XG52YXIgbG9nZ2VyID0gcmVxdWlyZSgnLi4vbG9nZ2VyJyk7XG52YXIgRG9jUHJlc2VuY2VFbWl0dGVyID0gcmVxdWlyZSgnLi9wcmVzZW5jZS9kb2MtcHJlc2VuY2UtZW1pdHRlcicpO1xudmFyIHByb3RvY29sID0gcmVxdWlyZSgnLi4vcHJvdG9jb2wnKTtcblxudmFyIEVSUk9SX0NPREUgPSBTaGFyZURCRXJyb3IuQ09ERVM7XG5cbmZ1bmN0aW9uIGNvbm5lY3Rpb25TdGF0ZShzb2NrZXQpIHtcbiAgaWYgKHNvY2tldC5yZWFkeVN0YXRlID09PSAwIHx8IHNvY2tldC5yZWFkeVN0YXRlID09PSAxKSByZXR1cm4gJ2Nvbm5lY3RpbmcnO1xuICByZXR1cm4gJ2Rpc2Nvbm5lY3RlZCc7XG59XG5cbi8qKlxuICogSGFuZGxlcyBjb21tdW5pY2F0aW9uIHdpdGggdGhlIHNoYXJlanMgc2VydmVyIGFuZCBwcm92aWRlcyBxdWVyaWVzIGFuZFxuICogZG9jdW1lbnRzLlxuICpcbiAqIFdlIGNyZWF0ZSBhIGNvbm5lY3Rpb24gd2l0aCBhIHNvY2tldCBvYmplY3RcbiAqICAgY29ubmVjdGlvbiA9IG5ldyBzaGFyZWpzLkNvbm5lY3Rpb24oc29ja3NldClcbiAqIFRoZSBzb2NrZXQgbWF5IGJlIGFueSBvYmplY3QgaGFuZGxpbmcgdGhlIHdlYnNvY2tldCBwcm90b2NvbC4gU2VlIHRoZVxuICogZG9jdW1lbnRhdGlvbiBvZiBiaW5kVG9Tb2NrZXQoKSBmb3IgZGV0YWlscy4gV2UgdGhlbiB3YWl0IGZvciB0aGUgY29ubmVjdGlvblxuICogdG8gY29ubmVjdFxuICogICBjb25uZWN0aW9uLm9uKCdjb25uZWN0ZWQnLCAuLi4pXG4gKiBhbmQgYXJlIGZpbmFsbHkgYWJsZSB0byB3b3JrIHdpdGggc2hhcmVkIGRvY3VtZW50c1xuICogICBjb25uZWN0aW9uLmdldCgnZm9vZCcsICdzdGVhaycpIC8vIERvY1xuICpcbiAqIEBwYXJhbSBzb2NrZXQgQHNlZSBiaW5kVG9Tb2NrZXRcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBDb25uZWN0aW9uO1xuZnVuY3Rpb24gQ29ubmVjdGlvbihzb2NrZXQpIHtcbiAgZW1pdHRlci5FdmVudEVtaXR0ZXIuY2FsbCh0aGlzKTtcblxuICAvLyBNYXAgb2YgY29sbGVjdGlvbiAtPiBpZCAtPiBkb2Mgb2JqZWN0IGZvciBjcmVhdGVkIGRvY3VtZW50cy5cbiAgLy8gKGNyZWF0ZWQgZG9jdW1lbnRzIE1VU1QgQkUgVU5JUVVFKVxuICB0aGlzLmNvbGxlY3Rpb25zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAvLyBFYWNoIHF1ZXJ5IGFuZCBzbmFwc2hvdCByZXF1ZXN0IGlzIGNyZWF0ZWQgd2l0aCBhbiBpZCB0aGF0IHRoZSBzZXJ2ZXIgdXNlcyB3aGVuIGl0IHNlbmRzIHVzXG4gIC8vIGluZm8gYWJvdXQgdGhlIHJlcXVlc3QgKHVwZGF0ZXMsIGV0YylcbiAgdGhpcy5uZXh0UXVlcnlJZCA9IDE7XG4gIHRoaXMubmV4dFNuYXBzaG90UmVxdWVzdElkID0gMTtcblxuICAvLyBNYXAgZnJvbSBxdWVyeSBJRCAtPiBxdWVyeSBvYmplY3QuXG4gIHRoaXMucXVlcmllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgLy8gTWFwcyBmcm9tIGNoYW5uZWwgLT4gcHJlc2VuY2Ugb2JqZWN0c1xuICB0aGlzLl9wcmVzZW5jZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB0aGlzLl9kb2NQcmVzZW5jZUVtaXR0ZXIgPSBuZXcgRG9jUHJlc2VuY2VFbWl0dGVyKCk7XG5cbiAgLy8gTWFwIGZyb20gc25hcHNob3QgcmVxdWVzdCBJRCAtPiBzbmFwc2hvdCByZXF1ZXN0XG4gIHRoaXMuX3NuYXBzaG90UmVxdWVzdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gIC8vIEEgdW5pcXVlIG1lc3NhZ2UgbnVtYmVyIGZvciB0aGUgZ2l2ZW4gaWRcbiAgdGhpcy5zZXEgPSAxO1xuXG4gIC8vIEEgdW5pcXVlIG1lc3NhZ2UgbnVtYmVyIGZvciBwcmVzZW5jZVxuICB0aGlzLl9wcmVzZW5jZVNlcSA9IDE7XG5cbiAgLy8gRXF1YWxzIGFnZW50LnNyYyBvbiB0aGUgc2VydmVyXG4gIHRoaXMuaWQgPSBudWxsO1xuXG4gIC8vIFRoaXMgZGlyZWN0IHJlZmVyZW5jZSBmcm9tIGNvbm5lY3Rpb24gdG8gYWdlbnQgaXMgbm90IHVzZWQgaW50ZXJuYWwgdG9cbiAgLy8gU2hhcmVEQiwgYnV0IGl0IGlzIGhhbmR5IGZvciBzZXJ2ZXItc2lkZSBvbmx5IHVzZXIgY29kZSB0aGF0IG1heSBjYWNoZVxuICAvLyBzdGF0ZSBvbiB0aGUgYWdlbnQgYW5kIHJlYWQgaXQgaW4gbWlkZGxld2FyZVxuICB0aGlzLmFnZW50ID0gbnVsbDtcblxuICB0aGlzLmRlYnVnID0gZmFsc2U7XG5cbiAgdGhpcy5zdGF0ZSA9IGNvbm5lY3Rpb25TdGF0ZShzb2NrZXQpO1xuXG4gIHRoaXMuYmluZFRvU29ja2V0KHNvY2tldCk7XG59XG5lbWl0dGVyLm1peGluKENvbm5lY3Rpb24pO1xuXG5cbi8qKlxuICogVXNlIHNvY2tldCB0byBjb21tdW5pY2F0ZSB3aXRoIHNlcnZlclxuICpcbiAqIFNvY2tldCBpcyBhbiBvYmplY3QgdGhhdCBjYW4gaGFuZGxlIHRoZSB3ZWJzb2NrZXQgcHJvdG9jb2wuIFRoaXMgbWV0aG9kXG4gKiBpbnN0YWxscyB0aGUgb25vcGVuLCBvbmNsb3NlLCBvbm1lc3NhZ2UgYW5kIG9uZXJyb3IgaGFuZGxlcnMgb24gdGhlIHNvY2tldCB0b1xuICogaGFuZGxlIGNvbW11bmljYXRpb24gYW5kIHNlbmRzIG1lc3NhZ2VzIGJ5IGNhbGxpbmcgc29ja2V0LnNlbmQobWVzc2FnZSkuIFRoZVxuICogc29ja2V0cyBgcmVhZHlTdGF0ZWAgcHJvcGVydHkgaXMgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRhaWFsIHN0YXRlLlxuICpcbiAqIEBwYXJhbSBzb2NrZXQgSGFuZGxlcyB0aGUgd2Vic29ja2V0IHByb3RvY29sXG4gKiBAcGFyYW0gc29ja2V0LnJlYWR5U3RhdGVcbiAqIEBwYXJhbSBzb2NrZXQuY2xvc2VcbiAqIEBwYXJhbSBzb2NrZXQuc2VuZFxuICogQHBhcmFtIHNvY2tldC5vbm9wZW5cbiAqIEBwYXJhbSBzb2NrZXQub25jbG9zZVxuICogQHBhcmFtIHNvY2tldC5vbm1lc3NhZ2VcbiAqIEBwYXJhbSBzb2NrZXQub25lcnJvclxuICovXG5Db25uZWN0aW9uLnByb3RvdHlwZS5iaW5kVG9Tb2NrZXQgPSBmdW5jdGlvbihzb2NrZXQpIHtcbiAgaWYgKHRoaXMuc29ja2V0KSB7XG4gICAgdGhpcy5zb2NrZXQuY2xvc2UoKTtcbiAgICB0aGlzLnNvY2tldC5vbm1lc3NhZ2UgPSBudWxsO1xuICAgIHRoaXMuc29ja2V0Lm9ub3BlbiA9IG51bGw7XG4gICAgdGhpcy5zb2NrZXQub25lcnJvciA9IG51bGw7XG4gICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IG51bGw7XG4gIH1cblxuICB0aGlzLnNvY2tldCA9IHNvY2tldDtcblxuICAvLyBTdGF0ZSBvZiB0aGUgY29ubmVjdGlvbi4gVGhlIGNvcnJlc3BvbmRpbmcgZXZlbnRzIGFyZSBlbWl0dGVkIHdoZW4gdGhpcyBjaGFuZ2VzXG4gIC8vXG4gIC8vIC0gJ2Nvbm5lY3RpbmcnICAgVGhlIGNvbm5lY3Rpb24gaXMgc3RpbGwgYmVpbmcgZXN0YWJsaXNoZWQsIG9yIHdlIGFyZSBzdGlsbFxuICAvLyAgICAgICAgICAgICAgICAgICAgd2FpdGluZyBvbiB0aGUgc2VydmVyIHRvIHNlbmQgdXMgdGhlIGluaXRpYWxpemF0aW9uIG1lc3NhZ2VcbiAgLy8gLSAnY29ubmVjdGVkJyAgICBUaGUgY29ubmVjdGlvbiBpcyBvcGVuIGFuZCB3ZSBoYXZlIGNvbm5lY3RlZCB0byBhIHNlcnZlclxuICAvLyAgICAgICAgICAgICAgICAgICAgYW5kIHJlY2lldmVkIHRoZSBpbml0aWFsaXphdGlvbiBtZXNzYWdlXG4gIC8vIC0gJ2Rpc2Nvbm5lY3RlZCcgQ29ubmVjdGlvbiBpcyBjbG9zZWQsIGJ1dCBpdCB3aWxsIHJlY29ubmVjdCBhdXRvbWF0aWNhbGx5XG4gIC8vIC0gJ2Nsb3NlZCcgICAgICAgVGhlIGNvbm5lY3Rpb24gd2FzIGNsb3NlZCBieSB0aGUgY2xpZW50LCBhbmQgd2lsbCBub3QgcmVjb25uZWN0XG4gIC8vIC0gJ3N0b3BwZWQnICAgICAgVGhlIGNvbm5lY3Rpb24gd2FzIGNsb3NlZCBieSB0aGUgc2VydmVyLCBhbmQgd2lsbCBub3QgcmVjb25uZWN0XG4gIHZhciBuZXdTdGF0ZSA9IGNvbm5lY3Rpb25TdGF0ZShzb2NrZXQpO1xuICB0aGlzLl9zZXRTdGF0ZShuZXdTdGF0ZSk7XG5cbiAgLy8gVGhpcyBpcyBhIGhlbHBlciB2YXJpYWJsZSB0aGUgZG9jdW1lbnQgdXNlcyB0byBzZWUgd2hldGhlciB3ZSdyZVxuICAvLyBjdXJyZW50bHkgaW4gYSAnbGl2ZScgc3RhdGUuIEl0IGlzIHRydWUgaWYgYW5kIG9ubHkgaWYgd2UncmUgY29ubmVjdGVkXG4gIHRoaXMuY2FuU2VuZCA9IGZhbHNlO1xuXG4gIHZhciBjb25uZWN0aW9uID0gdGhpcztcblxuICBzb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIGRhdGEgPSAodHlwZW9mIGV2ZW50LmRhdGEgPT09ICdzdHJpbmcnKSA/XG4gICAgICAgIEpTT04ucGFyc2UoZXZlbnQuZGF0YSkgOiBldmVudC5kYXRhO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0ZhaWxlZCB0byBwYXJzZSBtZXNzYWdlJywgZXZlbnQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjb25uZWN0aW9uLmRlYnVnKSBsb2dnZXIuaW5mbygnUkVDVicsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcblxuICAgIHZhciByZXF1ZXN0ID0ge2RhdGE6IGRhdGF9O1xuICAgIGNvbm5lY3Rpb24uZW1pdCgncmVjZWl2ZScsIHJlcXVlc3QpO1xuICAgIGlmICghcmVxdWVzdC5kYXRhKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgY29ubmVjdGlvbi5oYW5kbGVNZXNzYWdlKHJlcXVlc3QuZGF0YSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB1dGlsLm5leHRUaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25uZWN0aW9uLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICAvLyBJZiBzb2NrZXQgaXMgYWxyZWFkeSBvcGVuLCBkbyBoYW5kc2hha2UgaW1tZWRpYXRlbHkuXG4gIGlmIChzb2NrZXQucmVhZHlTdGF0ZSA9PT0gMSkge1xuICAgIGNvbm5lY3Rpb24uX2luaXRpYWxpemVIYW5kc2hha2UoKTtcbiAgfVxuICBzb2NrZXQub25vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgY29ubmVjdGlvbi5fc2V0U3RhdGUoJ2Nvbm5lY3RpbmcnKTtcbiAgICBjb25uZWN0aW9uLl9pbml0aWFsaXplSGFuZHNoYWtlKCk7XG4gIH07XG5cbiAgc29ja2V0Lm9uZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgICAvLyBUaGlzIGlzbid0IHRoZSBzYW1lIGFzIGEgcmVndWxhciBlcnJvciwgYmVjYXVzZSBpdCB3aWxsIGhhcHBlbiBub3JtYWxseVxuICAgIC8vIGZyb20gdGltZSB0byB0aW1lLiBZb3VyIGNvbm5lY3Rpb24gc2hvdWxkIHByb2JhYmx5IGF1dG9tYXRpY2FsbHlcbiAgICAvLyByZWNvbm5lY3QgYW55d2F5LCBidXQgdGhhdCBzaG91bGQgYmUgdHJpZ2dlcmVkIG9mZiBvbmNsb3NlIG5vdCBvbmVycm9yLlxuICAgIC8vIChvbmNsb3NlIGhhcHBlbnMgd2hlbiBvbmVycm9yIGdldHMgY2FsbGVkIGFueXdheSkuXG4gICAgY29ubmVjdGlvbi5lbWl0KCdjb25uZWN0aW9uIGVycm9yJywgZXJyKTtcbiAgfTtcblxuICBzb2NrZXQub25jbG9zZSA9IGZ1bmN0aW9uKHJlYXNvbikge1xuICAgIC8vIG5vZGUtYnJvd3NlcmNoYW5uZWwgcmVhc29uIHZhbHVlczpcbiAgICAvLyAgICdDbG9zZWQnIC0gVGhlIHNvY2tldCB3YXMgbWFudWFsbHkgY2xvc2VkIGJ5IGNhbGxpbmcgc29ja2V0LmNsb3NlKClcbiAgICAvLyAgICdTdG9wcGVkIGJ5IHNlcnZlcicgLSBUaGUgc2VydmVyIHNlbnQgdGhlIHN0b3AgbWVzc2FnZSB0byB0ZWxsIHRoZSBjbGllbnQgbm90IHRvIHRyeSBjb25uZWN0aW5nXG4gICAgLy8gICAnUmVxdWVzdCBmYWlsZWQnIC0gU2VydmVyIGRpZG4ndCByZXNwb25kIHRvIHJlcXVlc3QgKHRlbXBvcmFyeSwgdXN1YWxseSBvZmZsaW5lKVxuICAgIC8vICAgJ1Vua25vd24gc2Vzc2lvbiBJRCcgLSBTZXJ2ZXIgc2Vzc2lvbiBmb3IgY2xpZW50IGlzIG1pc3NpbmcgKHRlbXBvcmFyeSwgd2lsbCBpbW1lZGlhdGVseSByZWVzdGFibGlzaClcblxuICAgIGlmIChyZWFzb24gPT09ICdjbG9zZWQnIHx8IHJlYXNvbiA9PT0gJ0Nsb3NlZCcpIHtcbiAgICAgIGNvbm5lY3Rpb24uX3NldFN0YXRlKCdjbG9zZWQnLCByZWFzb24pO1xuICAgIH0gZWxzZSBpZiAocmVhc29uID09PSAnc3RvcHBlZCcgfHwgcmVhc29uID09PSAnU3RvcHBlZCBieSBzZXJ2ZXInKSB7XG4gICAgICBjb25uZWN0aW9uLl9zZXRTdGF0ZSgnc3RvcHBlZCcsIHJlYXNvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbm5lY3Rpb24uX3NldFN0YXRlKCdkaXNjb25uZWN0ZWQnLCByZWFzb24pO1xuICAgIH1cbiAgfTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtvYmplY3R9IG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlLmEgYWN0aW9uXG4gKi9cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmhhbmRsZU1lc3NhZ2UgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gIHZhciBlcnIgPSBudWxsO1xuICBpZiAobWVzc2FnZS5lcnJvcikge1xuICAgIGVyciA9IHdyYXBFcnJvckRhdGEobWVzc2FnZS5lcnJvciwgbWVzc2FnZSk7XG4gICAgZGVsZXRlIG1lc3NhZ2UuZXJyb3I7XG4gIH1cbiAgLy8gU3dpdGNoIG9uIHRoZSBtZXNzYWdlIGFjdGlvbi4gTW9zdCBtZXNzYWdlcyBhcmUgZm9yIGRvY3VtZW50cyBhbmQgYXJlXG4gIC8vIGhhbmRsZWQgaW4gdGhlIGRvYyBjbGFzcy5cbiAgc3dpdGNoIChtZXNzYWdlLmEpIHtcbiAgICBjYXNlIEFDVElPTlMuaW5pdExlZ2FjeTpcbiAgICAgIC8vIENsaWVudCBpbml0aWFsaXphdGlvbiBwYWNrZXRcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVMZWdhY3lJbml0KG1lc3NhZ2UpO1xuICAgIGNhc2UgQUNUSU9OUy5oYW5kc2hha2U6XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlSGFuZHNoYWtlKGVyciwgbWVzc2FnZSk7XG4gICAgY2FzZSBBQ1RJT05TLnF1ZXJ5RmV0Y2g6XG4gICAgICB2YXIgcXVlcnkgPSB0aGlzLnF1ZXJpZXNbbWVzc2FnZS5pZF07XG4gICAgICBpZiAocXVlcnkpIHF1ZXJ5Ll9oYW5kbGVGZXRjaChlcnIsIG1lc3NhZ2UuZGF0YSwgbWVzc2FnZS5leHRyYSk7XG4gICAgICByZXR1cm47XG4gICAgY2FzZSBBQ1RJT05TLnF1ZXJ5U3Vic2NyaWJlOlxuICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5xdWVyaWVzW21lc3NhZ2UuaWRdO1xuICAgICAgaWYgKHF1ZXJ5KSBxdWVyeS5faGFuZGxlU3Vic2NyaWJlKGVyciwgbWVzc2FnZS5kYXRhLCBtZXNzYWdlLmV4dHJhKTtcbiAgICAgIHJldHVybjtcbiAgICBjYXNlIEFDVElPTlMucXVlcnlVbnN1YnNjcmliZTpcbiAgICAgIC8vIFF1ZXJpZXMgYXJlIHJlbW92ZWQgaW1tZWRpYXRlbHkgb24gY2FsbHMgdG8gZGVzdHJveSwgc28gd2UgaWdub3JlXG4gICAgICAvLyByZXBsaWVzIHRvIHF1ZXJ5IHVuc3Vic2NyaWJlcy4gUGVyaGFwcyB0aGVyZSBzaG91bGQgYmUgYSBjYWxsYmFjayBmb3JcbiAgICAgIC8vIGRlc3Ryb3ksIGJ1dCB0aGlzIGlzIGN1cnJlbnRseSB1bmltcGxlbWVudGVkXG4gICAgICByZXR1cm47XG4gICAgY2FzZSBBQ1RJT05TLnF1ZXJ5VXBkYXRlOlxuICAgICAgLy8gUXVlcnkgbWVzc2FnZS4gUGFzcyB0aGlzIHRvIHRoZSBhcHByb3ByaWF0ZSBxdWVyeSBvYmplY3QuXG4gICAgICB2YXIgcXVlcnkgPSB0aGlzLnF1ZXJpZXNbbWVzc2FnZS5pZF07XG4gICAgICBpZiAoIXF1ZXJ5KSByZXR1cm47XG4gICAgICBpZiAoZXJyKSByZXR1cm4gcXVlcnkuX2hhbmRsZUVycm9yKGVycik7XG4gICAgICBpZiAobWVzc2FnZS5kaWZmKSBxdWVyeS5faGFuZGxlRGlmZihtZXNzYWdlLmRpZmYpO1xuICAgICAgaWYgKHV0aWwuaGFzT3duKG1lc3NhZ2UsICdleHRyYScpKSBxdWVyeS5faGFuZGxlRXh0cmEobWVzc2FnZS5leHRyYSk7XG4gICAgICByZXR1cm47XG5cbiAgICBjYXNlIEFDVElPTlMuYnVsa0ZldGNoOlxuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZUJ1bGtNZXNzYWdlKGVyciwgbWVzc2FnZSwgJ19oYW5kbGVGZXRjaCcpO1xuICAgIGNhc2UgQUNUSU9OUy5idWxrU3Vic2NyaWJlOlxuICAgIGNhc2UgQUNUSU9OUy5idWxrVW5zdWJzY3JpYmU6XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlQnVsa01lc3NhZ2UoZXJyLCBtZXNzYWdlLCAnX2hhbmRsZVN1YnNjcmliZScpO1xuXG4gICAgY2FzZSBBQ1RJT05TLnNuYXBzaG90RmV0Y2g6XG4gICAgY2FzZSBBQ1RJT05TLnNuYXBzaG90RmV0Y2hCeVRpbWVzdGFtcDpcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVTbmFwc2hvdEZldGNoKGVyciwgbWVzc2FnZSk7XG5cbiAgICBjYXNlIEFDVElPTlMuZmV0Y2g6XG4gICAgICB2YXIgZG9jID0gdGhpcy5nZXRFeGlzdGluZyhtZXNzYWdlLmMsIG1lc3NhZ2UuZCk7XG4gICAgICBpZiAoZG9jKSBkb2MuX2hhbmRsZUZldGNoKGVyciwgbWVzc2FnZS5kYXRhKTtcbiAgICAgIHJldHVybjtcbiAgICBjYXNlIEFDVElPTlMuc3Vic2NyaWJlOlxuICAgIGNhc2UgQUNUSU9OUy51bnN1YnNjcmliZTpcbiAgICAgIHZhciBkb2MgPSB0aGlzLmdldEV4aXN0aW5nKG1lc3NhZ2UuYywgbWVzc2FnZS5kKTtcbiAgICAgIGlmIChkb2MpIGRvYy5faGFuZGxlU3Vic2NyaWJlKGVyciwgbWVzc2FnZS5kYXRhKTtcbiAgICAgIHJldHVybjtcbiAgICBjYXNlIEFDVElPTlMub3A6XG4gICAgICB2YXIgZG9jID0gdGhpcy5nZXRFeGlzdGluZyhtZXNzYWdlLmMsIG1lc3NhZ2UuZCk7XG4gICAgICBpZiAoZG9jKSBkb2MuX2hhbmRsZU9wKGVyciwgbWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgY2FzZSBBQ1RJT05TLnByZXNlbmNlOlxuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVByZXNlbmNlKGVyciwgbWVzc2FnZSk7XG4gICAgY2FzZSBBQ1RJT05TLnByZXNlbmNlU3Vic2NyaWJlOlxuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVByZXNlbmNlU3Vic2NyaWJlKGVyciwgbWVzc2FnZSk7XG4gICAgY2FzZSBBQ1RJT05TLnByZXNlbmNlVW5zdWJzY3JpYmU6XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlUHJlc2VuY2VVbnN1YnNjcmliZShlcnIsIG1lc3NhZ2UpO1xuICAgIGNhc2UgQUNUSU9OUy5wcmVzZW5jZVJlcXVlc3Q6XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlUHJlc2VuY2VSZXF1ZXN0KGVyciwgbWVzc2FnZSk7XG4gICAgY2FzZSBBQ1RJT05TLnBpbmdQb25nOlxuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVBpbmdQb25nKGVycik7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgbG9nZ2VyLndhcm4oJ0lnbm9yaW5nIHVucmVjb2duaXplZCBtZXNzYWdlJywgbWVzc2FnZSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHdyYXBFcnJvckRhdGEoZXJyb3JEYXRhLCBmdWxsTWVzc2FnZSkge1xuICAvLyB3cmFwIGluIEVycm9yIG9iamVjdCBzbyBjYW4gYmUgcGFzc2VkIHRocm91Z2ggZXZlbnQgZW1pdHRlcnNcbiAgdmFyIGVyciA9IG5ldyBFcnJvcihlcnJvckRhdGEubWVzc2FnZSk7XG4gIGVyci5jb2RlID0gZXJyb3JEYXRhLmNvZGU7XG4gIGlmIChmdWxsTWVzc2FnZSkge1xuICAgIC8vIEFkZCB0aGUgbWVzc2FnZSBkYXRhIHRvIHRoZSBlcnJvciBvYmplY3QgZm9yIG1vcmUgY29udGV4dFxuICAgIGVyci5kYXRhID0gZnVsbE1lc3NhZ2U7XG4gIH1cbiAgcmV0dXJuIGVycjtcbn1cblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2hhbmRsZUJ1bGtNZXNzYWdlID0gZnVuY3Rpb24oZXJyLCBtZXNzYWdlLCBtZXRob2QpIHtcbiAgaWYgKG1lc3NhZ2UuZGF0YSkge1xuICAgIGZvciAodmFyIGlkIGluIG1lc3NhZ2UuZGF0YSkge1xuICAgICAgdmFyIGRhdGFGb3JJZCA9IG1lc3NhZ2UuZGF0YVtpZF07XG4gICAgICB2YXIgZG9jID0gdGhpcy5nZXRFeGlzdGluZyhtZXNzYWdlLmMsIGlkKTtcbiAgICAgIGlmIChkb2MpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGRvY1ttZXRob2RdKGVycik7XG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YUZvcklkLmVycm9yKSB7XG4gICAgICAgICAgLy8gQnVsayByZXBseSBzbmFwc2hvdC1zcGVjaWZpYyBlcnJvcnIgLSBzZWUgYWdlbnQuanMgZ2V0TWFwUmVzdWx0XG4gICAgICAgICAgZG9jW21ldGhvZF0od3JhcEVycm9yRGF0YShkYXRhRm9ySWQuZXJyb3IpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkb2NbbWV0aG9kXShudWxsLCBkYXRhRm9ySWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkobWVzc2FnZS5iKSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5iLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaWQgPSBtZXNzYWdlLmJbaV07XG4gICAgICB2YXIgZG9jID0gdGhpcy5nZXRFeGlzdGluZyhtZXNzYWdlLmMsIGlkKTtcbiAgICAgIGlmIChkb2MpIGRvY1ttZXRob2RdKGVycik7XG4gICAgfVxuICB9IGVsc2UgaWYgKG1lc3NhZ2UuYikge1xuICAgIGZvciAodmFyIGlkIGluIG1lc3NhZ2UuYikge1xuICAgICAgdmFyIGRvYyA9IHRoaXMuZ2V0RXhpc3RpbmcobWVzc2FnZS5jLCBpZCk7XG4gICAgICBpZiAoZG9jKSBkb2NbbWV0aG9kXShlcnIpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0ludmFsaWQgYnVsayBtZXNzYWdlJywgbWVzc2FnZSk7XG4gIH1cbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9yZXNldCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmFnZW50ID0gbnVsbDtcbn07XG5cbi8vIFNldCB0aGUgY29ubmVjdGlvbidzIHN0YXRlLiBUaGUgY29ubmVjdGlvbiBpcyBiYXNpY2FsbHkgYSBzdGF0ZSBtYWNoaW5lLlxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX3NldFN0YXRlID0gZnVuY3Rpb24obmV3U3RhdGUsIHJlYXNvbikge1xuICBpZiAodGhpcy5zdGF0ZSA9PT0gbmV3U3RhdGUpIHJldHVybjtcblxuICAvLyBJIG1hZGUgYSBzdGF0ZSBkaWFncmFtLiBUaGUgb25seSBpbnZhbGlkIHRyYW5zaXRpb25zIGFyZSBnZXR0aW5nIHRvXG4gIC8vICdjb25uZWN0aW5nJyBmcm9tIGFueXdoZXJlIG90aGVyIHRoYW4gJ2Rpc2Nvbm5lY3RlZCcgYW5kIGdldHRpbmcgdG9cbiAgLy8gJ2Nvbm5lY3RlZCcgZnJvbSBhbnl3aGVyZSBvdGhlciB0aGFuICdjb25uZWN0aW5nJy5cbiAgaWYgKFxuICAgIChcbiAgICAgIG5ld1N0YXRlID09PSAnY29ubmVjdGluZycgJiZcbiAgICAgIHRoaXMuc3RhdGUgIT09ICdkaXNjb25uZWN0ZWQnICYmXG4gICAgICB0aGlzLnN0YXRlICE9PSAnc3RvcHBlZCcgJiZcbiAgICAgIHRoaXMuc3RhdGUgIT09ICdjbG9zZWQnXG4gICAgKSB8fCAoXG4gICAgICBuZXdTdGF0ZSA9PT0gJ2Nvbm5lY3RlZCcgJiZcbiAgICAgIHRoaXMuc3RhdGUgIT09ICdjb25uZWN0aW5nJ1xuICAgIClcbiAgKSB7XG4gICAgdmFyIGVyciA9IG5ldyBTaGFyZURCRXJyb3IoXG4gICAgICBFUlJPUl9DT0RFLkVSUl9DT05ORUNUSU9OX1NUQVRFX1RSQU5TSVRJT05fSU5WQUxJRCxcbiAgICAgICdDYW5ub3QgdHJhbnNpdGlvbiBkaXJlY3RseSBmcm9tICcgKyB0aGlzLnN0YXRlICsgJyB0byAnICsgbmV3U3RhdGVcbiAgICApO1xuICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgfVxuXG4gIHRoaXMuc3RhdGUgPSBuZXdTdGF0ZTtcbiAgdGhpcy5jYW5TZW5kID0gKG5ld1N0YXRlID09PSAnY29ubmVjdGVkJyk7XG5cbiAgaWYgKFxuICAgIG5ld1N0YXRlID09PSAnZGlzY29ubmVjdGVkJyB8fFxuICAgIG5ld1N0YXRlID09PSAnc3RvcHBlZCcgfHxcbiAgICBuZXdTdGF0ZSA9PT0gJ2Nsb3NlZCdcbiAgKSB7XG4gICAgdGhpcy5fcmVzZXQoKTtcbiAgfVxuXG4gIC8vIEdyb3VwIHN1YnNjcmliZXMgdG9nZXRoZXIgdG8gaGVscCBzZXJ2ZXIgbWFrZSBtb3JlIGVmZmljaWVudCBjYWxsc1xuICB0aGlzLnN0YXJ0QnVsaygpO1xuICAvLyBFbWl0IHRoZSBldmVudCB0byBhbGwgcXVlcmllc1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLnF1ZXJpZXMpIHtcbiAgICB2YXIgcXVlcnkgPSB0aGlzLnF1ZXJpZXNbaWRdO1xuICAgIHF1ZXJ5Ll9vbkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQoKTtcbiAgfVxuICAvLyBFbWl0IHRoZSBldmVudCB0byBhbGwgZG9jdW1lbnRzXG4gIGZvciAodmFyIGNvbGxlY3Rpb24gaW4gdGhpcy5jb2xsZWN0aW9ucykge1xuICAgIHZhciBkb2NzID0gdGhpcy5jb2xsZWN0aW9uc1tjb2xsZWN0aW9uXTtcbiAgICBmb3IgKHZhciBpZCBpbiBkb2NzKSB7XG4gICAgICBkb2NzW2lkXS5fb25Db25uZWN0aW9uU3RhdGVDaGFuZ2VkKCk7XG4gICAgfVxuICB9XG4gIC8vIEVtaXQgdGhlIGV2ZW50IHRvIGFsbCBQcmVzZW5jZXNcbiAgZm9yICh2YXIgY2hhbm5lbCBpbiB0aGlzLl9wcmVzZW5jZXMpIHtcbiAgICB0aGlzLl9wcmVzZW5jZXNbY2hhbm5lbF0uX29uQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCgpO1xuICB9XG4gIC8vIEVtaXQgdGhlIGV2ZW50IHRvIGFsbCBzbmFwc2hvdHNcbiAgZm9yICh2YXIgaWQgaW4gdGhpcy5fc25hcHNob3RSZXF1ZXN0cykge1xuICAgIHZhciBzbmFwc2hvdFJlcXVlc3QgPSB0aGlzLl9zbmFwc2hvdFJlcXVlc3RzW2lkXTtcbiAgICBzbmFwc2hvdFJlcXVlc3QuX29uQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCgpO1xuICB9XG4gIHRoaXMuZW5kQnVsaygpO1xuXG4gIHRoaXMuZW1pdChuZXdTdGF0ZSwgcmVhc29uKTtcbiAgdGhpcy5lbWl0KCdzdGF0ZScsIG5ld1N0YXRlLCByZWFzb24pO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuc3RhcnRCdWxrID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5idWxrKSB0aGlzLmJ1bGsgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuZW5kQnVsayA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5idWxrKSB7XG4gICAgZm9yICh2YXIgY29sbGVjdGlvbiBpbiB0aGlzLmJ1bGspIHtcbiAgICAgIHZhciBhY3Rpb25zID0gdGhpcy5idWxrW2NvbGxlY3Rpb25dO1xuICAgICAgdGhpcy5fc2VuZEJ1bGsoJ2YnLCBjb2xsZWN0aW9uLCBhY3Rpb25zLmYpO1xuICAgICAgdGhpcy5fc2VuZEJ1bGsoJ3MnLCBjb2xsZWN0aW9uLCBhY3Rpb25zLnMpO1xuICAgICAgdGhpcy5fc2VuZEJ1bGsoJ3UnLCBjb2xsZWN0aW9uLCBhY3Rpb25zLnUpO1xuICAgIH1cbiAgfVxuICB0aGlzLmJ1bGsgPSBudWxsO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX3NlbmRCdWxrID0gZnVuY3Rpb24oYWN0aW9uLCBjb2xsZWN0aW9uLCB2YWx1ZXMpIHtcbiAgaWYgKCF2YWx1ZXMpIHJldHVybjtcbiAgdmFyIGlkcyA9IFtdO1xuICB2YXIgdmVyc2lvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB2YXIgdmVyc2lvbnNDb3VudCA9IDA7XG4gIHZhciB2ZXJzaW9uSWQ7XG4gIGZvciAodmFyIGlkIGluIHZhbHVlcykge1xuICAgIHZhciB2YWx1ZSA9IHZhbHVlc1tpZF07XG4gICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgIGlkcy5wdXNoKGlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmVyc2lvbnNbaWRdID0gdmFsdWU7XG4gICAgICB2ZXJzaW9uSWQgPSBpZDtcbiAgICAgIHZlcnNpb25zQ291bnQrKztcbiAgICB9XG4gIH1cbiAgaWYgKGlkcy5sZW5ndGggPT09IDEpIHtcbiAgICB2YXIgaWQgPSBpZHNbMF07XG4gICAgdGhpcy5zZW5kKHthOiBhY3Rpb24sIGM6IGNvbGxlY3Rpb24sIGQ6IGlkfSk7XG4gIH0gZWxzZSBpZiAoaWRzLmxlbmd0aCkge1xuICAgIHRoaXMuc2VuZCh7YTogJ2InICsgYWN0aW9uLCBjOiBjb2xsZWN0aW9uLCBiOiBpZHN9KTtcbiAgfVxuICBpZiAodmVyc2lvbnNDb3VudCA9PT0gMSkge1xuICAgIHZhciB2ZXJzaW9uID0gdmVyc2lvbnNbdmVyc2lvbklkXTtcbiAgICB0aGlzLnNlbmQoe2E6IGFjdGlvbiwgYzogY29sbGVjdGlvbiwgZDogdmVyc2lvbklkLCB2OiB2ZXJzaW9ufSk7XG4gIH0gZWxzZSBpZiAodmVyc2lvbnNDb3VudCkge1xuICAgIHRoaXMuc2VuZCh7YTogJ2InICsgYWN0aW9uLCBjOiBjb2xsZWN0aW9uLCBiOiB2ZXJzaW9uc30pO1xuICB9XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5fc2VuZEFjdGlvbnMgPSBmdW5jdGlvbihhY3Rpb24sIGRvYywgdmVyc2lvbikge1xuICAvLyBFbnN1cmUgdGhlIGRvYyBpcyByZWdpc3RlcmVkIHNvIHRoYXQgaXQgcmVjZWl2ZXMgdGhlIHJlcGx5IG1lc3NhZ2VcbiAgdGhpcy5fYWRkRG9jKGRvYyk7XG4gIGlmICh0aGlzLmJ1bGspIHtcbiAgICAvLyBCdWxrIHN1YnNjcmliZVxuICAgIHZhciBhY3Rpb25zID0gdGhpcy5idWxrW2RvYy5jb2xsZWN0aW9uXSB8fCAodGhpcy5idWxrW2RvYy5jb2xsZWN0aW9uXSA9IE9iamVjdC5jcmVhdGUobnVsbCkpO1xuICAgIHZhciB2ZXJzaW9ucyA9IGFjdGlvbnNbYWN0aW9uXSB8fCAoYWN0aW9uc1thY3Rpb25dID0gT2JqZWN0LmNyZWF0ZShudWxsKSk7XG4gICAgdmFyIGlzRHVwbGljYXRlID0gdXRpbC5oYXNPd24odmVyc2lvbnMsIGRvYy5pZCk7XG4gICAgdmVyc2lvbnNbZG9jLmlkXSA9IHZlcnNpb247XG4gICAgcmV0dXJuIGlzRHVwbGljYXRlO1xuICB9IGVsc2Uge1xuICAgIC8vIFNlbmQgc2luZ2xlIGRvYyBzdWJzY3JpYmUgbWVzc2FnZVxuICAgIHZhciBtZXNzYWdlID0ge2E6IGFjdGlvbiwgYzogZG9jLmNvbGxlY3Rpb24sIGQ6IGRvYy5pZCwgdjogdmVyc2lvbn07XG4gICAgdGhpcy5zZW5kKG1lc3NhZ2UpO1xuICB9XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5zZW5kRmV0Y2ggPSBmdW5jdGlvbihkb2MpIHtcbiAgcmV0dXJuIHRoaXMuX3NlbmRBY3Rpb25zKEFDVElPTlMuZmV0Y2gsIGRvYywgZG9jLnZlcnNpb24pO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuc2VuZFN1YnNjcmliZSA9IGZ1bmN0aW9uKGRvYykge1xuICByZXR1cm4gdGhpcy5fc2VuZEFjdGlvbnMoQUNUSU9OUy5zdWJzY3JpYmUsIGRvYywgZG9jLnZlcnNpb24pO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuc2VuZFVuc3Vic2NyaWJlID0gZnVuY3Rpb24oZG9jKSB7XG4gIHJldHVybiB0aGlzLl9zZW5kQWN0aW9ucyhBQ1RJT05TLnVuc3Vic2NyaWJlLCBkb2MpO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuc2VuZE9wID0gZnVuY3Rpb24oZG9jLCBvcCkge1xuICAvLyBFbnN1cmUgdGhlIGRvYyBpcyByZWdpc3RlcmVkIHNvIHRoYXQgaXQgcmVjZWl2ZXMgdGhlIHJlcGx5IG1lc3NhZ2VcbiAgdGhpcy5fYWRkRG9jKGRvYyk7XG4gIHZhciBtZXNzYWdlID0ge1xuICAgIGE6IEFDVElPTlMub3AsXG4gICAgYzogZG9jLmNvbGxlY3Rpb24sXG4gICAgZDogZG9jLmlkLFxuICAgIHY6IGRvYy52ZXJzaW9uLFxuICAgIHNyYzogb3Auc3JjLFxuICAgIHNlcTogb3Auc2VxLFxuICAgIHg6IHt9XG4gIH07XG4gIGlmICgnb3AnIGluIG9wKSBtZXNzYWdlLm9wID0gb3Aub3A7XG4gIGlmIChvcC5jcmVhdGUpIG1lc3NhZ2UuY3JlYXRlID0gb3AuY3JlYXRlO1xuICBpZiAob3AuZGVsKSBtZXNzYWdlLmRlbCA9IG9wLmRlbDtcbiAgaWYgKGRvYy5zdWJtaXRTb3VyY2UpIG1lc3NhZ2UueC5zb3VyY2UgPSBvcC5zb3VyY2U7XG4gIHRoaXMuc2VuZChtZXNzYWdlKTtcbn07XG5cblxuLyoqXG4gKiBTZW5kcyBhIG1lc3NhZ2UgZG93biB0aGUgc29ja2V0XG4gKi9cbkNvbm5lY3Rpb24ucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gIGlmICh0aGlzLmRlYnVnKSBsb2dnZXIuaW5mbygnU0VORCcsIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcblxuICB0aGlzLmVtaXQoJ3NlbmQnLCBtZXNzYWdlKTtcbiAgdGhpcy5zb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5waW5nID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5jYW5TZW5kKSB7XG4gICAgdGhyb3cgbmV3IFNoYXJlREJFcnJvcihcbiAgICAgIEVSUk9SX0NPREUuRVJSX0NBTk5PVF9QSU5HX09GRkxJTkUsXG4gICAgICAnU29ja2V0IG11c3QgYmUgQ09OTkVDVEVEIHRvIHBpbmcnXG4gICAgKTtcbiAgfVxuXG4gIHZhciBtZXNzYWdlID0ge1xuICAgIGE6IEFDVElPTlMucGluZ1BvbmdcbiAgfTtcbiAgdGhpcy5zZW5kKG1lc3NhZ2UpO1xufTtcblxuLyoqXG4gKiBDbG9zZXMgdGhlIHNvY2tldCBhbmQgZW1pdHMgJ2Nsb3NlZCdcbiAqL1xuQ29ubmVjdGlvbi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5zb2NrZXQuY2xvc2UoKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmdldEV4aXN0aW5nID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgaWQpIHtcbiAgaWYgKHRoaXMuY29sbGVjdGlvbnNbY29sbGVjdGlvbl0pIHJldHVybiB0aGlzLmNvbGxlY3Rpb25zW2NvbGxlY3Rpb25dW2lkXTtcbn07XG5cblxuLyoqXG4gKiBHZXQgb3IgY3JlYXRlIGEgZG9jdW1lbnQuXG4gKlxuICogQHBhcmFtIGNvbGxlY3Rpb25cbiAqIEBwYXJhbSBpZFxuICogQHJldHVybiB7RG9jfVxuICovXG5Db25uZWN0aW9uLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBpZCkge1xuICB2YXIgZG9jcyA9IHRoaXMuY29sbGVjdGlvbnNbY29sbGVjdGlvbl0gfHxcbiAgICAodGhpcy5jb2xsZWN0aW9uc1tjb2xsZWN0aW9uXSA9IE9iamVjdC5jcmVhdGUobnVsbCkpO1xuXG4gIHZhciBkb2MgPSBkb2NzW2lkXTtcbiAgaWYgKCFkb2MpIHtcbiAgICBkb2MgPSBkb2NzW2lkXSA9IG5ldyBEb2ModGhpcywgY29sbGVjdGlvbiwgaWQpO1xuICAgIHRoaXMuZW1pdCgnZG9jJywgZG9jKTtcbiAgfVxuXG4gIGRvYy5fd2FudHNEZXN0cm95ID0gZmFsc2U7XG4gIHJldHVybiBkb2M7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlIGRvY3VtZW50IGZyb20gdGhpcy5jb2xsZWN0aW9uc1xuICpcbiAqIEBwcml2YXRlXG4gKi9cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9kZXN0cm95RG9jID0gZnVuY3Rpb24oZG9jKSB7XG4gIGlmICghZG9jLl93YW50c0Rlc3Ryb3kpIHJldHVybjtcbiAgdXRpbC5kaWdBbmRSZW1vdmUodGhpcy5jb2xsZWN0aW9ucywgZG9jLmNvbGxlY3Rpb24sIGRvYy5pZCk7XG4gIGRvYy5lbWl0KCdkZXN0cm95Jyk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5fYWRkRG9jID0gZnVuY3Rpb24oZG9jKSB7XG4gIHZhciBkb2NzID0gdGhpcy5jb2xsZWN0aW9uc1tkb2MuY29sbGVjdGlvbl07XG4gIGlmICghZG9jcykge1xuICAgIGRvY3MgPSB0aGlzLmNvbGxlY3Rpb25zW2RvYy5jb2xsZWN0aW9uXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIH1cbiAgaWYgKGRvY3NbZG9jLmlkXSAhPT0gZG9jKSB7XG4gICAgZG9jc1tkb2MuaWRdID0gZG9jO1xuICB9XG59O1xuXG4vLyBIZWxwZXIgZm9yIGNyZWF0ZUZldGNoUXVlcnkgYW5kIGNyZWF0ZVN1YnNjcmliZVF1ZXJ5LCBiZWxvdy5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9jcmVhdGVRdWVyeSA9IGZ1bmN0aW9uKGFjdGlvbiwgY29sbGVjdGlvbiwgcSwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgdmFyIGlkID0gdGhpcy5uZXh0UXVlcnlJZCsrO1xuICB2YXIgcXVlcnkgPSBuZXcgUXVlcnkoYWN0aW9uLCB0aGlzLCBpZCwgY29sbGVjdGlvbiwgcSwgb3B0aW9ucywgY2FsbGJhY2spO1xuICB0aGlzLnF1ZXJpZXNbaWRdID0gcXVlcnk7XG4gIHF1ZXJ5LnNlbmQoKTtcbiAgcmV0dXJuIHF1ZXJ5O1xufTtcblxuLy8gSW50ZXJuYWwgZnVuY3Rpb24uIFVzZSBxdWVyeS5kZXN0cm95KCkgdG8gcmVtb3ZlIHF1ZXJpZXMuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5fZGVzdHJveVF1ZXJ5ID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgZGVsZXRlIHRoaXMucXVlcmllc1txdWVyeS5pZF07XG59O1xuXG4vLyBUaGUgcXVlcnkgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBmaWVsZHM6XG4vL1xuLy8gZGI6IE5hbWUgb2YgdGhlIGRiIGZvciB0aGUgcXVlcnkuIFlvdSBjYW4gYXR0YWNoIGV4dHJhRGJzIHRvIFNoYXJlREIgYW5kXG4vLyAgIHBpY2sgd2hpY2ggb25lIHRoZSBxdWVyeSBzaG91bGQgaGl0IHVzaW5nIHRoaXMgcGFyYW1ldGVyLlxuXG4vLyBDcmVhdGUgYSBmZXRjaCBxdWVyeS4gRmV0Y2ggcXVlcmllcyBhcmUgb25seSBpc3N1ZWQgb25jZSwgcmV0dXJuaW5nIHRoZVxuLy8gcmVzdWx0cyBkaXJlY3RseSBpbnRvIHRoZSBjYWxsYmFjay5cbi8vXG4vLyBUaGUgY2FsbGJhY2sgc2hvdWxkIGhhdmUgdGhlIHNpZ25hdHVyZSBmdW5jdGlvbihlcnJvciwgcmVzdWx0cywgZXh0cmEpXG4vLyB3aGVyZSByZXN1bHRzIGlzIGEgbGlzdCBvZiBEb2Mgb2JqZWN0cy5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZUZldGNoUXVlcnkgPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBxLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICByZXR1cm4gdGhpcy5fY3JlYXRlUXVlcnkoQUNUSU9OUy5xdWVyeUZldGNoLCBjb2xsZWN0aW9uLCBxLCBvcHRpb25zLCBjYWxsYmFjayk7XG59O1xuXG4vLyBDcmVhdGUgYSBzdWJzY3JpYmUgcXVlcnkuIFN1YnNjcmliZSBxdWVyaWVzIHJldHVybiB3aXRoIHRoZSBpbml0aWFsIGRhdGFcbi8vIHRocm91Z2ggdGhlIGNhbGxiYWNrLCB0aGVuIHVwZGF0ZSB0aGVtc2VsdmVzIHdoZW5ldmVyIHRoZSBxdWVyeSByZXN1bHQgc2V0XG4vLyBjaGFuZ2VzIHZpYSB0aGVpciBvd24gZXZlbnQgZW1pdHRlci5cbi8vXG4vLyBJZiBwcmVzZW50LCB0aGUgY2FsbGJhY2sgc2hvdWxkIGhhdmUgdGhlIHNpZ25hdHVyZSBmdW5jdGlvbihlcnJvciwgcmVzdWx0cywgZXh0cmEpXG4vLyB3aGVyZSByZXN1bHRzIGlzIGEgbGlzdCBvZiBEb2Mgb2JqZWN0cy5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZVN1YnNjcmliZVF1ZXJ5ID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgcSwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgcmV0dXJuIHRoaXMuX2NyZWF0ZVF1ZXJ5KEFDVElPTlMucXVlcnlTdWJzY3JpYmUsIGNvbGxlY3Rpb24sIHEsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmhhc1BlbmRpbmcgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuICEhKFxuICAgIHRoaXMuX2ZpcnN0RG9jKGhhc1BlbmRpbmcpIHx8XG4gICAgdGhpcy5fZmlyc3RRdWVyeShoYXNQZW5kaW5nKSB8fFxuICAgIHRoaXMuX2ZpcnN0U25hcHNob3RSZXF1ZXN0KClcbiAgKTtcbn07XG5mdW5jdGlvbiBoYXNQZW5kaW5nKG9iamVjdCkge1xuICByZXR1cm4gb2JqZWN0Lmhhc1BlbmRpbmcoKTtcbn1cblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuaGFzV3JpdGVQZW5kaW5nID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAhIXRoaXMuX2ZpcnN0RG9jKGhhc1dyaXRlUGVuZGluZyk7XG59O1xuZnVuY3Rpb24gaGFzV3JpdGVQZW5kaW5nKG9iamVjdCkge1xuICByZXR1cm4gb2JqZWN0Lmhhc1dyaXRlUGVuZGluZygpO1xufVxuXG5Db25uZWN0aW9uLnByb3RvdHlwZS53aGVuTm90aGluZ1BlbmRpbmcgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB2YXIgZG9jID0gdGhpcy5fZmlyc3REb2MoaGFzUGVuZGluZyk7XG4gIGlmIChkb2MpIHtcbiAgICAvLyBJZiBhIGRvY3VtZW50IGlzIGZvdW5kIHdpdGggYSBwZW5kaW5nIG9wZXJhdGlvbiwgd2FpdCBmb3IgaXQgdG8gZW1pdFxuICAgIC8vIHRoYXQgbm90aGluZyBpcyBwZW5kaW5nIGFueW1vcmUsIGFuZCB0aGVuIHJlY2hlY2sgYWxsIGRvY3VtZW50cyBhZ2Fpbi5cbiAgICAvLyBXZSBoYXZlIHRvIHJlY2hlY2sgYWxsIGRvY3VtZW50cywganVzdCBpbiBjYXNlIGFub3RoZXIgbXV0YXRpb24gaGFzXG4gICAgLy8gYmVlbiBtYWRlIGluIHRoZSBtZWFudGltZSBhcyBhIHJlc3VsdCBvZiBhbiBldmVudCBjYWxsYmFja1xuICAgIGRvYy5vbmNlKCdub3RoaW5nIHBlbmRpbmcnLCB0aGlzLl9ub3RoaW5nUGVuZGluZ1JldHJ5KGNhbGxiYWNrKSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBxdWVyeSA9IHRoaXMuX2ZpcnN0UXVlcnkoaGFzUGVuZGluZyk7XG4gIGlmIChxdWVyeSkge1xuICAgIHF1ZXJ5Lm9uY2UoJ3JlYWR5JywgdGhpcy5fbm90aGluZ1BlbmRpbmdSZXRyeShjYWxsYmFjaykpO1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgc25hcHNob3RSZXF1ZXN0ID0gdGhpcy5fZmlyc3RTbmFwc2hvdFJlcXVlc3QoKTtcbiAgaWYgKHNuYXBzaG90UmVxdWVzdCkge1xuICAgIHNuYXBzaG90UmVxdWVzdC5vbmNlKCdyZWFkeScsIHRoaXMuX25vdGhpbmdQZW5kaW5nUmV0cnkoY2FsbGJhY2spKTtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gQ2FsbCBiYWNrIHdoZW4gbm8gcGVuZGluZyBvcGVyYXRpb25zXG4gIHV0aWwubmV4dFRpY2soY2FsbGJhY2spO1xufTtcbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9ub3RoaW5nUGVuZGluZ1JldHJ5ID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgdmFyIGNvbm5lY3Rpb24gPSB0aGlzO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgdXRpbC5uZXh0VGljayhmdW5jdGlvbigpIHtcbiAgICAgIGNvbm5lY3Rpb24ud2hlbk5vdGhpbmdQZW5kaW5nKGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgfTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9maXJzdERvYyA9IGZ1bmN0aW9uKGZuKSB7XG4gIGZvciAodmFyIGNvbGxlY3Rpb24gaW4gdGhpcy5jb2xsZWN0aW9ucykge1xuICAgIHZhciBkb2NzID0gdGhpcy5jb2xsZWN0aW9uc1tjb2xsZWN0aW9uXTtcbiAgICBmb3IgKHZhciBpZCBpbiBkb2NzKSB7XG4gICAgICB2YXIgZG9jID0gZG9jc1tpZF07XG4gICAgICBpZiAoZm4oZG9jKSkge1xuICAgICAgICByZXR1cm4gZG9jO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2ZpcnN0UXVlcnkgPSBmdW5jdGlvbihmbikge1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLnF1ZXJpZXMpIHtcbiAgICB2YXIgcXVlcnkgPSB0aGlzLnF1ZXJpZXNbaWRdO1xuICAgIGlmIChmbihxdWVyeSkpIHtcbiAgICAgIHJldHVybiBxdWVyeTtcbiAgICB9XG4gIH1cbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9maXJzdFNuYXBzaG90UmVxdWVzdCA9IGZ1bmN0aW9uKCkge1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLl9zbmFwc2hvdFJlcXVlc3RzKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90UmVxdWVzdHNbaWRdO1xuICB9XG59O1xuXG4vKipcbiAqIEZldGNoIGEgcmVhZC1vbmx5IHNuYXBzaG90IGF0IGEgZ2l2ZW4gdmVyc2lvblxuICpcbiAqIEBwYXJhbSBjb2xsZWN0aW9uIC0gdGhlIGNvbGxlY3Rpb24gbmFtZSBvZiB0aGUgc25hcHNob3RcbiAqIEBwYXJhbSBpZCAtIHRoZSBJRCBvZiB0aGUgc25hcHNob3RcbiAqIEBwYXJhbSB2ZXJzaW9uIChvcHRpb25hbCkgLSB0aGUgdmVyc2lvbiBudW1iZXIgdG8gZmV0Y2guIElmIG51bGwsIHRoZSBsYXRlc3QgdmVyc2lvbiBpcyBmZXRjaGVkLlxuICogQHBhcmFtIGNhbGxiYWNrIC0gKGVycm9yLCBzbmFwc2hvdCkgPT4gdm9pZCwgd2hlcmUgc25hcHNob3QgdGFrZXMgdGhlIGZvbGxvd2luZyBzY2hlbWE6XG4gKlxuICoge1xuICogICBpZDogc3RyaW5nOyAgICAgICAgIC8vIElEIG9mIHRoZSBzbmFwc2hvdFxuICogICB2OiBudW1iZXI7ICAgICAgICAgIC8vIHZlcnNpb24gbnVtYmVyIG9mIHRoZSBzbmFwc2hvdFxuICogICB0eXBlOiBzdHJpbmc7ICAgICAgIC8vIHRoZSBPVCB0eXBlIG9mIHRoZSBzbmFwc2hvdCwgb3IgbnVsbCBpZiBpdCBkb2Vzbid0IGV4aXN0IG9yIGlzIGRlbGV0ZWRcbiAqICAgZGF0YTogYW55OyAgICAgICAgICAvLyB0aGUgc25hcHNob3RcbiAqIH1cbiAqXG4gKi9cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmZldGNoU25hcHNob3QgPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBpZCwgdmVyc2lvbiwgY2FsbGJhY2spIHtcbiAgaWYgKHR5cGVvZiB2ZXJzaW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY2FsbGJhY2sgPSB2ZXJzaW9uO1xuICAgIHZlcnNpb24gPSBudWxsO1xuICB9XG5cbiAgdmFyIHJlcXVlc3RJZCA9IHRoaXMubmV4dFNuYXBzaG90UmVxdWVzdElkKys7XG4gIHZhciBzbmFwc2hvdFJlcXVlc3QgPSBuZXcgU25hcHNob3RWZXJzaW9uUmVxdWVzdCh0aGlzLCByZXF1ZXN0SWQsIGNvbGxlY3Rpb24sIGlkLCB2ZXJzaW9uLCBjYWxsYmFjayk7XG4gIHRoaXMuX3NuYXBzaG90UmVxdWVzdHNbc25hcHNob3RSZXF1ZXN0LnJlcXVlc3RJZF0gPSBzbmFwc2hvdFJlcXVlc3Q7XG4gIHNuYXBzaG90UmVxdWVzdC5zZW5kKCk7XG59O1xuXG4vKipcbiAqIEZldGNoIGEgcmVhZC1vbmx5IHNuYXBzaG90IGF0IGEgZ2l2ZW4gdGltZXN0YW1wXG4gKlxuICogQHBhcmFtIGNvbGxlY3Rpb24gLSB0aGUgY29sbGVjdGlvbiBuYW1lIG9mIHRoZSBzbmFwc2hvdFxuICogQHBhcmFtIGlkIC0gdGhlIElEIG9mIHRoZSBzbmFwc2hvdFxuICogQHBhcmFtIHRpbWVzdGFtcCAob3B0aW9uYWwpIC0gdGhlIHRpbWVzdGFtcCB0byBmZXRjaC4gSWYgbnVsbCwgdGhlIGxhdGVzdCB2ZXJzaW9uIGlzIGZldGNoZWQuXG4gKiBAcGFyYW0gY2FsbGJhY2sgLSAoZXJyb3IsIHNuYXBzaG90KSA9PiB2b2lkLCB3aGVyZSBzbmFwc2hvdCB0YWtlcyB0aGUgZm9sbG93aW5nIHNjaGVtYTpcbiAqXG4gKiB7XG4gKiAgIGlkOiBzdHJpbmc7ICAgICAgICAgLy8gSUQgb2YgdGhlIHNuYXBzaG90XG4gKiAgIHY6IG51bWJlcjsgICAgICAgICAgLy8gdmVyc2lvbiBudW1iZXIgb2YgdGhlIHNuYXBzaG90XG4gKiAgIHR5cGU6IHN0cmluZzsgICAgICAgLy8gdGhlIE9UIHR5cGUgb2YgdGhlIHNuYXBzaG90LCBvciBudWxsIGlmIGl0IGRvZXNuJ3QgZXhpc3Qgb3IgaXMgZGVsZXRlZFxuICogICBkYXRhOiBhbnk7ICAgICAgICAgIC8vIHRoZSBzbmFwc2hvdFxuICogfVxuICpcbiAqL1xuQ29ubmVjdGlvbi5wcm90b3R5cGUuZmV0Y2hTbmFwc2hvdEJ5VGltZXN0YW1wID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgaWQsIHRpbWVzdGFtcCwgY2FsbGJhY2spIHtcbiAgaWYgKHR5cGVvZiB0aW1lc3RhbXAgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayA9IHRpbWVzdGFtcDtcbiAgICB0aW1lc3RhbXAgPSBudWxsO1xuICB9XG5cbiAgdmFyIHJlcXVlc3RJZCA9IHRoaXMubmV4dFNuYXBzaG90UmVxdWVzdElkKys7XG4gIHZhciBzbmFwc2hvdFJlcXVlc3QgPSBuZXcgU25hcHNob3RUaW1lc3RhbXBSZXF1ZXN0KHRoaXMsIHJlcXVlc3RJZCwgY29sbGVjdGlvbiwgaWQsIHRpbWVzdGFtcCwgY2FsbGJhY2spO1xuICB0aGlzLl9zbmFwc2hvdFJlcXVlc3RzW3NuYXBzaG90UmVxdWVzdC5yZXF1ZXN0SWRdID0gc25hcHNob3RSZXF1ZXN0O1xuICBzbmFwc2hvdFJlcXVlc3Quc2VuZCgpO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2hhbmRsZVNuYXBzaG90RmV0Y2ggPSBmdW5jdGlvbihlcnJvciwgbWVzc2FnZSkge1xuICB2YXIgc25hcHNob3RSZXF1ZXN0ID0gdGhpcy5fc25hcHNob3RSZXF1ZXN0c1ttZXNzYWdlLmlkXTtcbiAgaWYgKCFzbmFwc2hvdFJlcXVlc3QpIHJldHVybjtcbiAgZGVsZXRlIHRoaXMuX3NuYXBzaG90UmVxdWVzdHNbbWVzc2FnZS5pZF07XG4gIHNuYXBzaG90UmVxdWVzdC5faGFuZGxlUmVzcG9uc2UoZXJyb3IsIG1lc3NhZ2UpO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2hhbmRsZUxlZ2FjeUluaXQgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gIC8vIElmIHRoZSBwcm90b2NvbCBpcyBhdCBsZWFzdCAxLjEsIHdlIHdhbnQgdG8gdXNlIHRoZVxuICAvLyBuZXcgaGFuZHNoYWtlIHByb3RvY29sLiBMZXQncyBzZW5kIGEgaGFuZHNoYWtlIGluaXRpYWxpemUsIGJlY2F1c2VcbiAgLy8gd2Ugbm93IGtub3cgdGhlIHNlcnZlciBpcyByZWFkeS4gSWYgd2UndmUgYWxyZWFkeSBzZW50IGl0LCB3ZSdsbFxuICAvLyBqdXN0IGlnbm9yZSB0aGUgcmVzcG9uc2UgYW55d2F5LlxuICBpZiAocHJvdG9jb2wuY2hlY2tBdExlYXN0KG1lc3NhZ2UsICcxLjEnKSkgcmV0dXJuIHRoaXMuX2luaXRpYWxpemVIYW5kc2hha2UoKTtcbiAgdGhpcy5faW5pdGlhbGl6ZShtZXNzYWdlKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9pbml0aWFsaXplSGFuZHNoYWtlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuc2VuZCh7XG4gICAgYTogQUNUSU9OUy5oYW5kc2hha2UsXG4gICAgaWQ6IHRoaXMuaWQsXG4gICAgcHJvdG9jb2w6IHByb3RvY29sLm1ham9yLFxuICAgIHByb3RvY29sTWlub3I6IHByb3RvY29sLm1pbm9yXG4gIH0pO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2hhbmRsZUhhbmRzaGFrZSA9IGZ1bmN0aW9uKGVycm9yLCBtZXNzYWdlKSB7XG4gIGlmIChlcnJvcikgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBlcnJvcik7XG4gIHRoaXMuX2luaXRpYWxpemUobWVzc2FnZSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5faGFuZGxlUGluZ1BvbmcgPSBmdW5jdGlvbihlcnJvcikge1xuICBpZiAoZXJyb3IpIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyb3IpO1xuICB0aGlzLmVtaXQoJ3BvbmcnKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9pbml0aWFsaXplID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2Nvbm5lY3RpbmcnKSByZXR1cm47XG5cbiAgaWYgKG1lc3NhZ2UucHJvdG9jb2wgIT09IHByb3RvY29sLm1ham9yKSB7XG4gICAgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBuZXcgU2hhcmVEQkVycm9yKFxuICAgICAgRVJST1JfQ09ERS5FUlJfUFJPVE9DT0xfVkVSU0lPTl9OT1RfU1VQUE9SVEVELFxuICAgICAgJ1Vuc3VwcG9ydGVkIHByb3RvY29sIHZlcnNpb246ICcgKyBtZXNzYWdlLnByb3RvY29sXG4gICAgKSk7XG4gIH1cbiAgaWYgKHR5cGVzLm1hcFttZXNzYWdlLnR5cGVdICE9PSB0eXBlcy5kZWZhdWx0VHlwZSkge1xuICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgbmV3IFNoYXJlREJFcnJvcihcbiAgICAgIEVSUk9SX0NPREUuRVJSX0RFRkFVTFRfVFlQRV9NSVNNQVRDSCxcbiAgICAgIG1lc3NhZ2UudHlwZSArICcgZG9lcyBub3QgbWF0Y2ggdGhlIHNlcnZlciBkZWZhdWx0IHR5cGUnXG4gICAgKSk7XG4gIH1cbiAgaWYgKHR5cGVvZiBtZXNzYWdlLmlkICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgbmV3IFNoYXJlREJFcnJvcihcbiAgICAgIEVSUk9SX0NPREUuRVJSX0NMSUVOVF9JRF9CQURMWV9GT1JNRUQsXG4gICAgICAnQ2xpZW50IGlkIG11c3QgYmUgYSBzdHJpbmcnXG4gICAgKSk7XG4gIH1cbiAgdGhpcy5pZCA9IG1lc3NhZ2UuaWQ7XG5cbiAgdGhpcy5fc2V0U3RhdGUoJ2Nvbm5lY3RlZCcpO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UHJlc2VuY2UgPSBmdW5jdGlvbihjaGFubmVsKSB7XG4gIHZhciBjb25uZWN0aW9uID0gdGhpcztcbiAgdmFyIHByZXNlbmNlID0gdXRpbC5kaWdPckNyZWF0ZSh0aGlzLl9wcmVzZW5jZXMsIGNoYW5uZWwsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgUHJlc2VuY2UoY29ubmVjdGlvbiwgY2hhbm5lbCk7XG4gIH0pO1xuICBwcmVzZW5jZS5fd2FudHNEZXN0cm95ID0gZmFsc2U7XG4gIHJldHVybiBwcmVzZW5jZTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmdldERvY1ByZXNlbmNlID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgaWQpIHtcbiAgdmFyIGNoYW5uZWwgPSBEb2NQcmVzZW5jZS5jaGFubmVsKGNvbGxlY3Rpb24sIGlkKTtcbiAgdmFyIGNvbm5lY3Rpb24gPSB0aGlzO1xuICB2YXIgcHJlc2VuY2UgPSB1dGlsLmRpZ09yQ3JlYXRlKHRoaXMuX3ByZXNlbmNlcywgY2hhbm5lbCwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBEb2NQcmVzZW5jZShjb25uZWN0aW9uLCBjb2xsZWN0aW9uLCBpZCk7XG4gIH0pO1xuICBwcmVzZW5jZS5fd2FudHNEZXN0cm95ID0gZmFsc2U7XG4gIHJldHVybiBwcmVzZW5jZTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9zZW5kUHJlc2VuY2VBY3Rpb24gPSBmdW5jdGlvbihhY3Rpb24sIHNlcSwgcHJlc2VuY2UpIHtcbiAgLy8gRW5zdXJlIHRoZSBwcmVzZW5jZSBpcyByZWdpc3RlcmVkIHNvIHRoYXQgaXQgcmVjZWl2ZXMgdGhlIHJlcGx5IG1lc3NhZ2VcbiAgdGhpcy5fYWRkUHJlc2VuY2UocHJlc2VuY2UpO1xuICB2YXIgbWVzc2FnZSA9IHthOiBhY3Rpb24sIGNoOiBwcmVzZW5jZS5jaGFubmVsLCBzZXE6IHNlcX07XG4gIHRoaXMuc2VuZChtZXNzYWdlKTtcbiAgcmV0dXJuIG1lc3NhZ2Uuc2VxO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2FkZFByZXNlbmNlID0gZnVuY3Rpb24ocHJlc2VuY2UpIHtcbiAgdXRpbC5kaWdPckNyZWF0ZSh0aGlzLl9wcmVzZW5jZXMsIHByZXNlbmNlLmNoYW5uZWwsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBwcmVzZW5jZTtcbiAgfSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5fcmVxdWVzdFJlbW90ZVByZXNlbmNlID0gZnVuY3Rpb24oY2hhbm5lbCkge1xuICB0aGlzLnNlbmQoe2E6IEFDVElPTlMucHJlc2VuY2VSZXF1ZXN0LCBjaDogY2hhbm5lbH0pO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuX2hhbmRsZVByZXNlbmNlU3Vic2NyaWJlID0gZnVuY3Rpb24oZXJyb3IsIG1lc3NhZ2UpIHtcbiAgdmFyIHByZXNlbmNlID0gdXRpbC5kaWcodGhpcy5fcHJlc2VuY2VzLCBtZXNzYWdlLmNoKTtcbiAgaWYgKHByZXNlbmNlKSBwcmVzZW5jZS5faGFuZGxlU3Vic2NyaWJlKGVycm9yLCBtZXNzYWdlLnNlcSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5faGFuZGxlUHJlc2VuY2VVbnN1YnNjcmliZSA9IGZ1bmN0aW9uKGVycm9yLCBtZXNzYWdlKSB7XG4gIHZhciBwcmVzZW5jZSA9IHV0aWwuZGlnKHRoaXMuX3ByZXNlbmNlcywgbWVzc2FnZS5jaCk7XG4gIGlmIChwcmVzZW5jZSkgcHJlc2VuY2UuX2hhbmRsZVVuc3Vic2NyaWJlKGVycm9yLCBtZXNzYWdlLnNlcSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5faGFuZGxlUHJlc2VuY2UgPSBmdW5jdGlvbihlcnJvciwgbWVzc2FnZSkge1xuICB2YXIgcHJlc2VuY2UgPSB1dGlsLmRpZyh0aGlzLl9wcmVzZW5jZXMsIG1lc3NhZ2UuY2gpO1xuICBpZiAocHJlc2VuY2UpIHByZXNlbmNlLl9yZWNlaXZlVXBkYXRlKGVycm9yLCBtZXNzYWdlKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLl9oYW5kbGVQcmVzZW5jZVJlcXVlc3QgPSBmdW5jdGlvbihlcnJvciwgbWVzc2FnZSkge1xuICB2YXIgcHJlc2VuY2UgPSB1dGlsLmRpZyh0aGlzLl9wcmVzZW5jZXMsIG1lc3NhZ2UuY2gpO1xuICBpZiAocHJlc2VuY2UpIHByZXNlbmNlLl9icm9hZGNhc3RBbGxMb2NhbFByZXNlbmNlKGVycm9yLCBtZXNzYWdlKTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/connection.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/doc.js":
/*!************************************************!*\
  !*** ./node_modules/sharedb/lib/client/doc.js ***!
  \************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var emitter = __webpack_require__(/*! ../emitter */ \"(ssr)/./node_modules/sharedb/lib/emitter.js\");\nvar logger = __webpack_require__(/*! ../logger */ \"(ssr)/./node_modules/sharedb/lib/logger/index.js\");\nvar ShareDBError = __webpack_require__(/*! ../error */ \"(ssr)/./node_modules/sharedb/lib/error.js\");\nvar types = __webpack_require__(/*! ../types */ \"(ssr)/./node_modules/sharedb/lib/types.js\");\nvar util = __webpack_require__(/*! ../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar clone = util.clone;\nvar deepEqual = __webpack_require__(/*! fast-deep-equal */ \"(ssr)/./node_modules/fast-deep-equal/index.js\");\nvar ACTIONS = (__webpack_require__(/*! ../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\n\nvar ERROR_CODE = ShareDBError.CODES;\n\n/**\n * A Doc is a client's view on a sharejs document.\n *\n * It is is uniquely identified by its `id` and `collection`.  Documents\n * should not be created directly. Create them with connection.get()\n *\n *\n * Subscriptions\n * -------------\n *\n * We can subscribe a document to stay in sync with the server.\n *   doc.subscribe(function(error) {\n *     doc.subscribed // = true\n *   })\n * The server now sends us all changes concerning this document and these are\n * applied to our data. If the subscription was successful the initial\n * data and version sent by the server are loaded into the document.\n *\n * To stop listening to the changes we call `doc.unsubscribe()`.\n *\n * If we just want to load the data but not stay up-to-date, we call\n *   doc.fetch(function(error) {\n *     doc.data // sent by server\n *   })\n *\n *\n * Events\n * ------\n *\n * You can use doc.on(eventName, callback) to subscribe to the following events:\n * - `before op (op, source)` Fired before a partial operation is applied to the data.\n *   It may be used to read the old data just before applying an operation\n * - `op (op, source)` Fired after every partial operation with this operation as the\n *   first argument\n * - `create (source)` The document was created. That means its type was\n *   set and it has some initial data.\n * - `del (data, source)` Fired after the document is deleted, that is\n *   the data is null. It is passed the data before deletion as an\n *   argument\n * - `load ()` Fired when a new snapshot is ingested from a fetch, subscribe, or query\n */\n\nmodule.exports = Doc;\nfunction Doc(connection, collection, id) {\n  emitter.EventEmitter.call(this);\n\n  this.connection = connection;\n\n  this.collection = collection;\n  this.id = id;\n\n  this.version = null;\n  // The OT type of this document. An uncreated document has type `null`\n  this.type = null;\n  this.data = undefined;\n\n  // Array of callbacks or nulls as placeholders\n  this.inflightFetch = [];\n  this.inflightSubscribe = null;\n  this.pendingFetch = [];\n  this.pendingSubscribe = [];\n\n  this._isInHardRollback = false;\n\n  // Whether we think we are subscribed on the server. Synchronously set to\n  // false on calls to unsubscribe and disconnect. Should never be true when\n  // this.wantSubscribe is false\n  this.subscribed = false;\n  // Whether to re-establish the subscription on reconnect\n  this.wantSubscribe = false;\n\n  this._wantsDestroy = false;\n\n  // The op that is currently roundtripping to the server, or null.\n  //\n  // When the connection reconnects, the inflight op is resubmitted.\n  //\n  // This has the same format as an entry in pendingOps\n  this.inflightOp = null;\n\n  // All ops that are waiting for the server to acknowledge this.inflightOp\n  // This used to just be a single operation, but creates & deletes can't be\n  // composed with regular operations.\n  //\n  // This is a list of {[create:{...}], [del:true], [op:...], callbacks:[...]}\n  this.pendingOps = [];\n\n  // The applyStack enables us to track any ops submitted while we are\n  // applying an op incrementally. This value is an array when we are\n  // performing an incremental apply and null otherwise. When it is an array,\n  // all submitted ops should be pushed onto it. The `_otApply` method will\n  // reset it back to null when all incremental apply loops are complete.\n  this.applyStack = null;\n\n  // Disable the default behavior of composing submitted ops. This is read at\n  // the time of op submit, so it may be toggled on before submitting a\n  // specifc op and toggled off afterward\n  this.preventCompose = false;\n\n  // If set to true, the source will be submitted over the connection. This\n  // will also have the side-effect of only composing ops whose sources are\n  // equal\n  this.submitSource = false;\n\n  // Prevent own ops being submitted to the server. If subscribed, remote\n  // ops are still received. Should be toggled through the pause() and\n  // resume() methods to correctly flush on resume.\n  this.paused = false;\n\n  // Internal counter that gets incremented every time doc.data is updated.\n  // Used as a cheap way to check if doc.data has changed.\n  this._dataStateVersion = 0;\n}\nemitter.mixin(Doc);\n\nDoc.prototype.destroy = function(callback) {\n  this._wantsDestroy = true;\n  var doc = this;\n  doc.whenNothingPending(function() {\n    if (doc.wantSubscribe) {\n      doc.unsubscribe(function(err) {\n        if (err) {\n          if (callback) return callback(err);\n          return doc.emit('error', err);\n        }\n        doc.connection._destroyDoc(doc);\n        if (callback) callback();\n      });\n    } else {\n      doc.connection._destroyDoc(doc);\n      if (callback) callback();\n    }\n  });\n};\n\n\n// ****** Manipulating the document data, version and type.\n\n// Set the document's type, and associated properties. Most of the logic in\n// this function exists to update the document based on any added & removed API\n// methods.\n//\n// @param newType OT type provided by the ottypes library or its name or uri\nDoc.prototype._setType = function(newType) {\n  if (typeof newType === 'string') {\n    newType = types.map[newType];\n  }\n\n  if (newType) {\n    this.type = newType;\n  } else if (newType === null) {\n    this.type = newType;\n    // If we removed the type from the object, also remove its data\n    this._setData(undefined);\n  } else {\n    var err = new ShareDBError(ERROR_CODE.ERR_DOC_TYPE_NOT_RECOGNIZED, 'Missing type ' + newType);\n    return this.emit('error', err);\n  }\n};\n\nDoc.prototype._setData = function(data) {\n  this.data = data;\n  this._dataStateVersion++;\n};\n\n// Ingest snapshot data. This data must include a version, snapshot and type.\n// This is used both to ingest data that was exported with a webpage and data\n// that was received from the server during a fetch.\n//\n// @param snapshot.v    version\n// @param snapshot.data\n// @param snapshot.type\n// @param callback\nDoc.prototype.ingestSnapshot = function(snapshot, callback) {\n  if (!snapshot) return callback && callback();\n\n  if (typeof snapshot.v !== 'number') {\n    var err = new ShareDBError(\n      ERROR_CODE.ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION,\n      'Missing version in ingested snapshot. ' + this.collection + '.' + this.id\n    );\n    if (callback) return callback(err);\n    return this.emit('error', err);\n  }\n\n  // If the doc is already created or there are ops pending, we cannot use the\n  // ingested snapshot and need ops in order to update the document\n  if (this.type || this.hasWritePending()) {\n    // The version should only be null on a created document when it was\n    // created locally without fetching\n    if (this.version == null) {\n      if (this.hasWritePending()) {\n        // If we have pending ops and we get a snapshot for a locally created\n        // document, we have to wait for the pending ops to complete, because\n        // we don't know what version to fetch ops from. It is possible that\n        // the snapshot came from our local op, but it is also possible that\n        // the doc was created remotely (which would conflict and be an error)\n        return callback && this.once('no write pending', callback);\n      }\n      // Otherwise, we've encounted an error state\n      var err = new ShareDBError(\n        ERROR_CODE.ERR_DOC_MISSING_VERSION,\n        'Cannot ingest snapshot in doc with null version. ' + this.collection + '.' + this.id\n      );\n      if (callback) return callback(err);\n      return this.emit('error', err);\n    }\n    // If we got a snapshot for a version further along than the document is\n    // currently, issue a fetch to get the latest ops and catch us up\n    if (snapshot.v > this.version) return this.fetch(callback);\n    return callback && callback();\n  }\n\n  // Ignore the snapshot if we are already at a newer version. Under no\n  // circumstance should we ever set the current version backward\n  if (this.version > snapshot.v) return callback && callback();\n\n  this.version = snapshot.v;\n  var type = (snapshot.type === undefined) ? types.defaultType : snapshot.type;\n  this._setType(type);\n  this._setData(\n    (this.type && this.type.deserialize) ?\n      this.type.deserialize(snapshot.data) :\n      snapshot.data\n  );\n  this.emit('load');\n  callback && callback();\n};\n\nDoc.prototype.whenNothingPending = function(callback) {\n  var doc = this;\n  util.nextTick(function() {\n    if (doc.hasPending()) {\n      doc.once('nothing pending', callback);\n      return;\n    }\n    callback();\n  });\n};\n\nDoc.prototype.hasPending = function() {\n  return !!(\n    this.inflightOp ||\n    this.pendingOps.length ||\n    this.inflightFetch.length ||\n    this.inflightSubscribe ||\n    this.pendingFetch.length ||\n    this.pendingSubscribe.length\n  );\n};\n\nDoc.prototype.hasWritePending = function() {\n  return !!(this.inflightOp || this.pendingOps.length);\n};\n\nDoc.prototype._emitNothingPending = function() {\n  if (this.hasWritePending()) return;\n  this.emit('no write pending');\n  if (this.hasPending()) return;\n  this.emit('nothing pending');\n};\n\n// **** Helpers for network messages\n\nDoc.prototype._emitResponseError = function(err, callback) {\n  if (err && err.code === ERROR_CODE.ERR_SNAPSHOT_READ_SILENT_REJECTION) {\n    this.wantSubscribe = false;\n    if (callback) {\n      callback();\n    }\n    this._emitNothingPending();\n    return;\n  }\n  if (callback) {\n    callback(err);\n    this._emitNothingPending();\n    return;\n  }\n  this._emitNothingPending();\n  this.emit('error', err);\n};\n\nDoc.prototype._handleFetch = function(error, snapshot) {\n  var callbacks = this.pendingFetch;\n  this.pendingFetch = [];\n  var callback = this.inflightFetch.shift();\n  if (callback) callbacks.unshift(callback);\n  if (callbacks.length) {\n    callback = function(error) {\n      util.callEach(callbacks, error);\n    };\n  }\n  if (error) return this._emitResponseError(error, callback);\n  this.ingestSnapshot(snapshot, callback);\n  this._emitNothingPending();\n};\n\nDoc.prototype._handleSubscribe = function(error, snapshot) {\n  var request = this.inflightSubscribe;\n  this.inflightSubscribe = null;\n  var callbacks = this.pendingFetch;\n  this.pendingFetch = [];\n  if (request.callback) callbacks.push(request.callback);\n  var callback;\n  if (callbacks.length) {\n    callback = function(error) {\n      util.callEach(callbacks, error);\n    };\n  }\n  if (error) return this._emitResponseError(error, callback);\n  this.subscribed = request.wantSubscribe;\n  if (this.subscribed) this.ingestSnapshot(snapshot, callback);\n  else if (callback) callback();\n  this._emitNothingPending();\n  this._flushSubscribe();\n};\n\nDoc.prototype._handleOp = function(err, message) {\n  if (err) {\n    if (err.code === ERROR_CODE.ERR_NO_OP && message.seq === this.inflightOp.seq) {\n      // Our op was a no-op, either because we submitted a no-op, or - more\n      // likely - because our op was transformed into a no-op by the server\n      // because of a similar remote op. In this case, the server has avoided\n      // committing the op to the database, and we should just clear the in-flight\n      // op and call the callbacks. However, let's first catch ourselves up to\n      // the remote, so that we're in a nice consistent state\n      return this.fetch(this._clearInflightOp.bind(this));\n    }\n    if (this.inflightOp) {\n      return this._rollback(err);\n    }\n    return this.emit('error', err);\n  }\n\n  if (this.inflightOp &&\n      message.src === this.inflightOp.src &&\n      message.seq === this.inflightOp.seq) {\n    // The op has already been applied locally. Just update the version\n    // and pending state appropriately\n    this._opAcknowledged(message);\n    return;\n  }\n\n  if (this.version == null || message.v > this.version) {\n    // This will happen in normal operation if we become subscribed to a\n    // new document via a query. It can also happen if we get an op for\n    // a future version beyond the version we are expecting next. This\n    // could happen if the server doesn't publish an op for whatever reason\n    // or because of a race condition. In any case, we can send a fetch\n    // command to catch back up.\n    //\n    // Fetch only sends a new fetch command if no fetches are inflight, which\n    // will act as a natural debouncing so we don't send multiple fetch\n    // requests for many ops received at once.\n    this.fetch();\n    return;\n  }\n\n  if (message.v < this.version) {\n    // We can safely ignore the old (duplicate) operation.\n    return;\n  }\n\n  if (this.inflightOp) {\n    var transformErr = transformX(this.inflightOp, message);\n    if (transformErr) return this._hardRollback(transformErr);\n  }\n\n  for (var i = 0; i < this.pendingOps.length; i++) {\n    var transformErr = transformX(this.pendingOps[i], message);\n    if (transformErr) return this._hardRollback(transformErr);\n  }\n\n  this.version++;\n  try {\n    this._otApply(message, false);\n  } catch (error) {\n    return this._hardRollback(error);\n  }\n};\n\n// Called whenever (you guessed it!) the connection state changes. This will\n// happen when we get disconnected & reconnect.\nDoc.prototype._onConnectionStateChanged = function() {\n  if (this.connection.canSend) {\n    this.flush();\n    this._resubscribe();\n  } else {\n    if (this.inflightOp) {\n      this.pendingOps.unshift(this.inflightOp);\n      this.inflightOp = null;\n    }\n    this.subscribed = false;\n    if (this.inflightSubscribe) {\n      if (this.inflightSubscribe.wantSubscribe) {\n        this.pendingSubscribe.unshift(this.inflightSubscribe);\n        this.inflightSubscribe = null;\n      } else {\n        this._handleSubscribe();\n      }\n    }\n    if (this.inflightFetch.length) {\n      this.pendingFetch = this.pendingFetch.concat(this.inflightFetch);\n      this.inflightFetch.length = 0;\n    }\n  }\n};\n\nDoc.prototype._resubscribe = function() {\n  if (!this.pendingSubscribe.length && this.wantSubscribe) {\n    return this.subscribe();\n  }\n  var willFetch = this.pendingSubscribe.some(function(request) {\n    return request.wantSubscribe;\n  });\n  if (!willFetch && this.pendingFetch.length) this.fetch();\n  this._flushSubscribe();\n};\n\n// Request the current document snapshot or ops that bring us up to date\nDoc.prototype.fetch = function(callback) {\n  this._fetch({}, callback);\n};\n\nDoc.prototype._fetch = function(options, callback) {\n  this.pendingFetch.push(callback);\n  var shouldSend = this.connection.canSend && (\n    options.force || !this.inflightFetch.length\n  );\n  if (!shouldSend) return;\n  this.inflightFetch.push(this.pendingFetch.shift());\n  this.connection.sendFetch(this);\n};\n\n// Fetch the initial document and keep receiving updates\nDoc.prototype.subscribe = function(callback) {\n  var wantSubscribe = true;\n  this._queueSubscribe(wantSubscribe, callback);\n};\n\n// Unsubscribe. The data will stay around in local memory, but we'll stop\n// receiving updates\nDoc.prototype.unsubscribe = function(callback) {\n  var wantSubscribe = false;\n  this._queueSubscribe(wantSubscribe, callback);\n};\n\nDoc.prototype._queueSubscribe = function(wantSubscribe, callback) {\n  var lastRequest = this.pendingSubscribe[this.pendingSubscribe.length - 1] || this.inflightSubscribe;\n  var isDuplicateRequest = lastRequest && lastRequest.wantSubscribe === wantSubscribe;\n  if (isDuplicateRequest) {\n    lastRequest.callback = combineCallbacks([lastRequest.callback, callback]);\n    return;\n  }\n  this.pendingSubscribe.push({\n    wantSubscribe: !!wantSubscribe,\n    callback: callback\n  });\n  this._flushSubscribe();\n};\n\nDoc.prototype._flushSubscribe = function() {\n  if (this.inflightSubscribe || !this.pendingSubscribe.length) return;\n\n  if (this.connection.canSend) {\n    this.inflightSubscribe = this.pendingSubscribe.shift();\n    this.wantSubscribe = this.inflightSubscribe.wantSubscribe;\n    if (this.wantSubscribe) {\n      this.connection.sendSubscribe(this);\n    } else {\n      // Be conservative about our subscription state. We'll be unsubscribed\n      // some time between sending this request, and receiving the callback,\n      // so let's just set ourselves to unsubscribed now.\n      this.subscribed = false;\n      this.connection.sendUnsubscribe(this);\n    }\n\n    return;\n  }\n\n  // If we're offline, then we're already unsubscribed. Therefore, call back\n  // the next request immediately if it's an unsubscribe request.\n  if (!this.pendingSubscribe[0].wantSubscribe) {\n    this.inflightSubscribe = this.pendingSubscribe.shift();\n    var doc = this;\n    util.nextTick(function() {\n      doc._handleSubscribe();\n    });\n  }\n};\n\nfunction combineCallbacks(callbacks) {\n  callbacks = callbacks.filter(util.truthy);\n  if (!callbacks.length) return null;\n  return function(error) {\n    util.callEach(callbacks, error);\n  };\n}\n\n\n// Operations //\n\n// Send the next pending op to the server, if we can.\n//\n// Only one operation can be in-flight at a time. If an operation is already on\n// its way, or we're not currently connected, this method does nothing.\nDoc.prototype.flush = function() {\n  // Ignore if we can't send or we are already sending an op\n  if (!this.connection.canSend || this.inflightOp) return;\n\n  // Send first pending op unless paused\n  if (!this.paused && this.pendingOps.length) {\n    this._sendOp();\n  }\n};\n\n// Helper function to set op to contain a no-op.\nfunction setNoOp(op) {\n  delete op.op;\n  delete op.create;\n  delete op.del;\n}\n\n// Transform server op data by a client op, and vice versa. Ops are edited in place.\nfunction transformX(client, server) {\n  // Order of statements in this function matters. Be especially careful if\n  // refactoring this function\n\n  // A client delete op should dominate if both the server and the client\n  // delete the document. Thus, any ops following the client delete (such as a\n  // subsequent create) will be maintained, since the server op is transformed\n  // to a no-op\n  if (client.del) return setNoOp(server);\n\n  if (server.del) {\n    return new ShareDBError(ERROR_CODE.ERR_DOC_WAS_DELETED, 'Document was deleted');\n  }\n  if (server.create) {\n    return new ShareDBError(ERROR_CODE.ERR_DOC_ALREADY_CREATED, 'Document already created');\n  }\n\n  // Ignore no-op coming from server\n  if (!('op' in server)) return;\n\n  // I believe that this should not occur, but check just in case\n  if (client.create) {\n    return new ShareDBError(ERROR_CODE.ERR_DOC_ALREADY_CREATED, 'Document already created');\n  }\n\n  // They both edited the document. This is the normal case for this function -\n  // as in, most of the time we'll end up down here.\n  //\n  // You should be wondering why I'm using client.type instead of this.type.\n  // The reason is, if we get ops at an old version of the document, this.type\n  // might be undefined or a totally different type. By pinning the type to the\n  // op data, we make sure the right type has its transform function called.\n  if (client.type.transformX) {\n    var result = client.type.transformX(client.op, server.op);\n    client.op = result[0];\n    server.op = result[1];\n  } else {\n    var clientOp = client.type.transform(client.op, server.op, 'left');\n    var serverOp = client.type.transform(server.op, client.op, 'right');\n    client.op = clientOp;\n    server.op = serverOp;\n  }\n};\n\n/**\n * Applies the operation to the snapshot\n *\n * If the operation is create or delete it emits `create` or `del`. Then the\n * operation is applied to the snapshot and `op` and `after op` are emitted.\n * If the type supports incremental updates and `this.incremental` is true we\n * fire `op` after every small operation.\n *\n * This is the only function to fire the above mentioned events.\n *\n * @private\n */\nDoc.prototype._otApply = function(op, source) {\n  if ('op' in op) {\n    if (!this.type) {\n      // Throw here, because all usage of _otApply should be wrapped with a try/catch\n      throw new ShareDBError(\n        ERROR_CODE.ERR_DOC_DOES_NOT_EXIST,\n        'Cannot apply op to uncreated document. ' + this.collection + '.' + this.id\n      );\n    }\n\n    // NB: If we need to add another argument to this event, we should consider\n    // the fact that the 'op' event has op.src as its 3rd argument\n    this.emit('before op batch', op.op, source);\n\n    // Iteratively apply multi-component remote operations and rollback ops\n    // (source === false) for the default JSON0 OT type. It could use\n    // type.shatter(), but since this code is so specific to use cases for the\n    // JSON0 type and ShareDB explicitly bundles the default type, we might as\n    // well write it this way and save needing to iterate through the op\n    // components twice.\n    //\n    // Ideally, we would not need this extra complexity. However, it is\n    // helpful for implementing bindings that update DOM nodes and other\n    // stateful objects by translating op events directly into corresponding\n    // mutations. Such bindings are most easily written as responding to\n    // individual op components one at a time in order, and it is important\n    // that the snapshot only include updates from the particular op component\n    // at the time of emission. Eliminating this would require rethinking how\n    // such external bindings are implemented.\n    if (!source && this.type === types.defaultType && op.op.length > 1) {\n      if (!this.applyStack) this.applyStack = [];\n      var stackLength = this.applyStack.length;\n      for (var i = 0; i < op.op.length; i++) {\n        var component = op.op[i];\n        var componentOp = {op: [component]};\n        // Apply the individual op component\n        this.emit('before op', componentOp.op, source, op.src);\n        // Transform componentOp against any ops that have been submitted\n        // sychronously inside of an op event handler since we began apply of\n        // our operation\n        for (var j = stackLength; j < this.applyStack.length; j++) {\n          var transformErr = transformX(this.applyStack[j], componentOp);\n          if (transformErr) return this._hardRollback(transformErr);\n        }\n        this._setData(this.type.apply(this.data, componentOp.op));\n        this.emit('op', componentOp.op, source, op.src);\n      }\n      this.emit('op batch', op.op, source);\n      // Pop whatever was submitted since we started applying this op\n      this._popApplyStack(stackLength);\n      return;\n    }\n\n    // The 'before op' event enables clients to pull any necessary data out of\n    // the snapshot before it gets changed\n    this.emit('before op', op.op, source, op.src);\n    // Apply the operation to the local data, mutating it in place\n    this._setData(this.type.apply(this.data, op.op));\n    // Emit an 'op' event once the local data includes the changes from the\n    // op. For locally submitted ops, this will be synchronously with\n    // submission and before the server or other clients have received the op.\n    // For ops from other clients, this will be after the op has been\n    // committed to the database and published\n    this.emit('op', op.op, source, op.src);\n    this.emit('op batch', op.op, source);\n    return;\n  }\n\n  if (op.create) {\n    this._setType(op.create.type);\n    if (this.type.deserialize) {\n      if (this.type.createDeserialized) {\n        this._setData(this.type.createDeserialized(op.create.data));\n      } else {\n        this._setData(this.type.deserialize(this.type.create(op.create.data)));\n      }\n    } else {\n      this._setData(this.type.create(op.create.data));\n    }\n    this.emit('create', source);\n    return;\n  }\n\n  if (op.del) {\n    var oldData = this.data;\n    this._setType(null);\n    this.emit('del', oldData, source);\n    return;\n  }\n};\n\n\n// ***** Sending operations\n\n// Actually send op to the server.\nDoc.prototype._sendOp = function() {\n  if (!this.connection.canSend) return;\n  var src = this.connection.id;\n\n  // When there is no inflightOp, send the first item in pendingOps. If\n  // there is inflightOp, try sending it again\n  if (!this.inflightOp) {\n    // Send first pending op\n    this.inflightOp = this.pendingOps.shift();\n  }\n  var op = this.inflightOp;\n  if (!op) {\n    var err = new ShareDBError(ERROR_CODE.ERR_INFLIGHT_OP_MISSING, 'No op to send on call to _sendOp');\n    return this.emit('error', err);\n  }\n\n  // Track data for retrying ops\n  op.sentAt = Date.now();\n  op.retries = (op.retries == null) ? 0 : op.retries + 1;\n\n  // The src + seq number is a unique ID representing this operation. This tuple\n  // is used on the server to detect when ops have been sent multiple times and\n  // on the client to match acknowledgement of an op back to the inflightOp.\n  // Note that the src could be different from this.connection.id after a\n  // reconnect, since an op may still be pending after the reconnection and\n  // this.connection.id will change. In case an op is sent multiple times, we\n  // also need to be careful not to override the original seq value.\n  if (op.seq == null) {\n    if (this.connection.seq >= util.MAX_SAFE_INTEGER) {\n      return this.emit('error', new ShareDBError(\n        ERROR_CODE.ERR_CONNECTION_SEQ_INTEGER_OVERFLOW,\n        'Connection seq has exceeded the max safe integer, maybe from being open for too long'\n      ));\n    }\n\n    op.seq = this.connection.seq++;\n  }\n\n  this.connection.sendOp(this, op);\n\n  // src isn't needed on the first try, since the server session will have the\n  // same id, but it must be set on the inflightOp in case it is sent again\n  // after a reconnect and the connection's id has changed by then\n  if (op.src == null) op.src = src;\n};\n\n\n// Queues the operation for submission to the server and applies it locally.\n//\n// Internal method called to do the actual work for submit(), create() and del().\n// @private\n//\n// @param op\n// @param [op.op]\n// @param [op.del]\n// @param [op.create]\n// @param [callback] called when operation is submitted\nDoc.prototype._submit = function(op, source, callback) {\n  // Locally submitted ops must always have a truthy source\n  if (!source) source = true;\n\n  // The op contains either op, create, delete, or none of the above (a no-op).\n  if ('op' in op) {\n    if (!this.type) {\n      if (this._isInHardRollback) {\n        var err = new ShareDBError(\n          ERROR_CODE.ERR_DOC_IN_HARD_ROLLBACK,\n          'Cannot submit op. Document is performing hard rollback. ' + this.collection + '.' + this.id\n        );\n      } else {\n        var err = new ShareDBError(\n          ERROR_CODE.ERR_DOC_DOES_NOT_EXIST,\n          'Cannot submit op. Document has not been created. ' + this.collection + '.' + this.id\n        );\n      }\n\n      if (callback) return callback(err);\n      return this.emit('error', err);\n    }\n    // Try to normalize the op. This removes trailing skip:0's and things like that.\n    if (this.type.normalize) op.op = this.type.normalize(op.op);\n  }\n\n  try {\n    this._pushOp(op, source, callback);\n    this._otApply(op, source);\n  } catch (error) {\n    return this._hardRollback(error);\n  }\n\n  // The call to flush is delayed so if submit() is called multiple times\n  // synchronously, all the ops are combined before being sent to the server.\n  var doc = this;\n  util.nextTick(function() {\n    doc.flush();\n  });\n};\n\nDoc.prototype._pushOp = function(op, source, callback) {\n  op.source = source;\n  if (this.applyStack) {\n    // If we are in the process of incrementally applying an operation, don't\n    // compose the op and push it onto the applyStack so it can be transformed\n    // against other components from the op or ops being applied\n    this.applyStack.push(op);\n  } else {\n    // If the type supports composes, try to compose the operation onto the\n    // end of the last pending operation.\n    var composed = this._tryCompose(op);\n    if (composed) {\n      composed.callbacks.push(callback);\n      return;\n    }\n  }\n  // Push on to the pendingOps queue of ops to submit if we didn't compose\n  op.type = this.type;\n  op.callbacks = [callback];\n  this.pendingOps.push(op);\n};\n\nDoc.prototype._popApplyStack = function(to) {\n  if (to > 0) {\n    this.applyStack.length = to;\n    return;\n  }\n  // Once we have completed the outermost apply loop, reset to null and no\n  // longer add ops to the applyStack as they are submitted\n  var op = this.applyStack[0];\n  this.applyStack = null;\n  if (!op) return;\n  // Compose the ops added since the beginning of the apply stack, since we\n  // had to skip compose when they were originally pushed\n  var i = this.pendingOps.indexOf(op);\n  if (i === -1) return;\n  var ops = this.pendingOps.splice(i);\n  for (var i = 0; i < ops.length; i++) {\n    var op = ops[i];\n    var composed = this._tryCompose(op);\n    if (composed) {\n      composed.callbacks = composed.callbacks.concat(op.callbacks);\n    } else {\n      this.pendingOps.push(op);\n    }\n  }\n};\n\n// Try to compose a submitted op into the last pending op. Returns the\n// composed op if it succeeds, undefined otherwise\nDoc.prototype._tryCompose = function(op) {\n  if (this.preventCompose) return;\n\n  // We can only compose into the last pending op. Inflight ops have already\n  // been sent to the server, so we can't modify them\n  var last = this.pendingOps[this.pendingOps.length - 1];\n  if (!last || last.sentAt) return;\n\n  // If we're submitting the op source, we can only combine ops that have\n  // a matching source\n  if (this.submitSource && !deepEqual(op.source, last.source)) return;\n\n  // Compose an op into a create by applying it. This effectively makes the op\n  // invisible, as if the document were created including the op originally\n  if (last.create && 'op' in op) {\n    last.create.data = this.type.apply(last.create.data, op.op);\n    return last;\n  }\n\n  // Compose two ops into a single op if supported by the type. Types that\n  // support compose must be able to compose any two ops together\n  if ('op' in last && 'op' in op && this.type.compose) {\n    last.op = this.type.compose(last.op, op.op);\n    return last;\n  }\n};\n\n// *** Client OT entrypoints.\n\n// Submit an operation to the document.\n//\n// @param operation handled by the OT type\n// @param options  {source: ...}\n// @param [callback] called after operation submitted\n//\n// @fires before op, op, after op\nDoc.prototype.submitOp = function(component, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n  var op = {op: component};\n  var source = options && options.source;\n  this._submit(op, source, callback);\n};\n\n// Create the document, which in ShareJS semantics means to set its type. Every\n// object implicitly exists in the database but has no data and no type. Create\n// sets the type of the object and can optionally set some initial data on the\n// object, depending on the type.\n//\n// @param data  initial\n// @param type  OT type\n// @param options  {source: ...}\n// @param callback  called when operation submitted\nDoc.prototype.create = function(data, type, options, callback) {\n  if (typeof type === 'function') {\n    callback = type;\n    options = null;\n    type = null;\n  } else if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n  if (!type) {\n    type = types.defaultType.uri;\n  }\n  if (this.type) {\n    var err = new ShareDBError(ERROR_CODE.ERR_DOC_ALREADY_CREATED, 'Document already exists');\n    if (callback) return callback(err);\n    return this.emit('error', err);\n  }\n  var op = {create: {type: type, data: data}};\n  var source = options && options.source;\n  this._submit(op, source, callback);\n};\n\n// Delete the document. This creates and submits a delete operation to the\n// server. Deleting resets the object's type to null and deletes its data. The\n// document still exists, and still has the version it used to have before you\n// deleted it (well, old version +1).\n//\n// @param options  {source: ...}\n// @param callback  called when operation submitted\nDoc.prototype.del = function(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n  if (!this.type) {\n    var err = new ShareDBError(ERROR_CODE.ERR_DOC_DOES_NOT_EXIST, 'Document does not exist');\n    if (callback) return callback(err);\n    return this.emit('error', err);\n  }\n  var op = {del: true};\n  var source = options && options.source;\n  this._submit(op, source, callback);\n};\n\n\n// Stops the document from sending any operations to the server.\nDoc.prototype.pause = function() {\n  this.paused = true;\n};\n\n// Continue sending operations to the server\nDoc.prototype.resume = function() {\n  this.paused = false;\n  this.flush();\n};\n\n// Create a snapshot that can be serialized, deserialized, and passed into `Doc.ingestSnapshot`.\nDoc.prototype.toSnapshot = function() {\n  return {\n    v: this.version,\n    data: clone(this.data),\n    type: this.type.uri\n  };\n};\n\n// *** Receiving operations\n\n// This is called when the server acknowledges an operation from the client.\nDoc.prototype._opAcknowledged = function(message) {\n  if (this.inflightOp.create) {\n    this.version = message.v;\n  } else if (message.v !== this.version) {\n    // We should already be at the same version, because the server should\n    // have sent all the ops that have happened before acknowledging our op\n    logger.warn('Invalid version from server. Expected: ' + this.version + ' Received: ' + message.v, message);\n\n    // Fetching should get us back to a working document state\n    return this.fetch();\n  }\n\n  if (message[ACTIONS.fixup]) {\n    for (var i = 0; i < message[ACTIONS.fixup].length; i++) {\n      var fixupOp = message[ACTIONS.fixup][i];\n\n      for (var j = 0; j < this.pendingOps.length; j++) {\n        var transformErr = transformX(this.pendingOps[i], fixupOp);\n        if (transformErr) return this._hardRollback(transformErr);\n      }\n\n      try {\n        this._otApply(fixupOp, false);\n      } catch (error) {\n        return this._hardRollback(error);\n      }\n    }\n  }\n\n  // The op was committed successfully. Increment the version number\n  this.version++;\n\n  this._clearInflightOp();\n};\n\nDoc.prototype._rollback = function(err) {\n  // The server has rejected submission of the current operation. Invert by\n  // just the inflight op if possible. If not possible to invert, cancel all\n  // pending ops and fetch the latest from the server to get us back into a\n  // working state, then call back\n  var op = this.inflightOp;\n\n  if (!('op' in op && op.type.invert)) {\n    return this._hardRollback(err);\n  }\n\n  try {\n    op.op = op.type.invert(op.op);\n  } catch (error) {\n    // If the op doesn't support `.invert()`, we just reload the doc\n    // instead of trying to locally revert it.\n    return this._hardRollback(err);\n  }\n\n  // Transform the undo operation by any pending ops.\n  for (var i = 0; i < this.pendingOps.length; i++) {\n    var transformErr = transformX(this.pendingOps[i], op);\n    if (transformErr) return this._hardRollback(transformErr);\n  }\n\n  // ... and apply it locally, reverting the changes.\n  //\n  // This operation is applied to look like it comes from a remote source.\n  // I'm still not 100% sure about this functionality, because its really a\n  // local op. Basically, the problem is that if the client's op is rejected\n  // by the server, the editor window should update to reflect the undo.\n  try {\n    this._otApply(op, false);\n  } catch (error) {\n    return this._hardRollback(error);\n  }\n\n  // The server has rejected submission of the current operation. If we get\n  // an \"Op submit rejected\" error, this was done intentionally\n  // and we should roll back but not return an error to the user.\n  if (err.code === ERROR_CODE.ERR_OP_SUBMIT_REJECTED) {\n    return this._clearInflightOp(null);\n  }\n\n  this._clearInflightOp(err);\n};\n\nDoc.prototype._hardRollback = function(err) {\n  this._isInHardRollback = true;\n  // Store pending ops so that we can notify their callbacks of the error.\n  // We combine the inflight op and the pending ops, because it's possible\n  // to hit a condition where we have no inflight op, but we do have pending\n  // ops. This can happen when an invalid op is submitted, which causes us\n  // to hard rollback before the pending op was flushed.\n  var pendingOps = this.pendingOps;\n  var inflightOp = this.inflightOp;\n\n  // Cancel all pending ops and reset if we can't invert\n  this._setType(null);\n  this.version = null;\n  this.inflightOp = null;\n  this.pendingOps = [];\n\n  // Fetch the latest version from the server to get us back into a working state\n  var doc = this;\n  this._fetch({force: true}, function(fetchError) {\n    doc._isInHardRollback = false;\n\n    // We want to check that no errors are swallowed, so we check that:\n    // - there are callbacks to call, and\n    // - that every single pending op called a callback\n    // If there are no ops queued, or one of them didn't handle the error,\n    // then we emit the error.\n\n    if (fetchError) {\n      // This is critical error as it means that our doc is not in usable state\n      // anymore, we should throw doc error.\n      logger.error('Hard rollback doc fetch failed.', fetchError, inflightOp);\n\n      doc.emit('error', new ShareDBError(\n        ERROR_CODE.ERR_HARD_ROLLBACK_FETCH_FAILED,\n        'Hard rollback fetch failed: ' + fetchError.message\n      ));\n    }\n\n    if (err.code === ERROR_CODE.ERR_OP_SUBMIT_REJECTED) {\n      /**\n       * Handle special case of ERR_OP_SUBMIT_REJECTED\n       * This ensures that we resolve the main op callback and reject\n       * all the pending ops. This is hard rollback so all the pending ops will be\n       * discarded. This will ensure that the user is at least informed about it.\n       * more info: https://github.com/share/sharedb/pull/626\n       */\n      if (inflightOp) {\n        util.callEach(inflightOp.callbacks);\n        inflightOp = null;\n      }\n\n      if (!pendingOps.length) return;\n      err = new ShareDBError(\n        ERROR_CODE.ERR_PENDING_OP_REMOVED_BY_OP_SUBMIT_REJECTED,\n        'Discarding pending op because of hard rollback during ERR_OP_SUBMIT_REJECTED'\n      );\n    }\n\n    if (inflightOp) pendingOps.unshift(inflightOp);\n    var allOpsHadCallbacks = !!pendingOps.length;\n    for (var i = 0; i < pendingOps.length; i++) {\n      allOpsHadCallbacks = util.callEach(pendingOps[i].callbacks, err) && allOpsHadCallbacks;\n    }\n    if (err && !allOpsHadCallbacks) doc.emit('error', err);\n  });\n};\n\nDoc.prototype._clearInflightOp = function(err) {\n  var inflightOp = this.inflightOp;\n\n  this.inflightOp = null;\n\n  var called = util.callEach(inflightOp.callbacks, err);\n\n  this.flush();\n  this._emitNothingPending();\n\n  if (err && !called) return this.emit('error', err);\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L2RvYy5qcyIsIm1hcHBpbmdzIjoiQUFBQSxjQUFjLG1CQUFPLENBQUMsK0RBQVk7QUFDbEMsYUFBYSxtQkFBTyxDQUFDLG1FQUFXO0FBQ2hDLG1CQUFtQixtQkFBTyxDQUFDLDJEQUFVO0FBQ3JDLFlBQVksbUJBQU8sQ0FBQywyREFBVTtBQUM5QixXQUFXLG1CQUFPLENBQUMseURBQVM7QUFDNUI7QUFDQSxnQkFBZ0IsbUJBQU8sQ0FBQyxzRUFBaUI7QUFDekMsY0FBYyw4R0FBcUM7O0FBRW5EOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixTQUFTLElBQUk7QUFDckM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7OztBQUdBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQkFBa0IsNEJBQTRCO0FBQzlDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixrQkFBa0I7QUFDeEM7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyw0QkFBNEI7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFNBQVM7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0JBQW9CLG1DQUFtQztBQUN2RDs7QUFFQSxzQkFBc0IsNEJBQTRCO0FBQ2xEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBa0IsNEJBQTRCO0FBQzlDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsWUFBWTtBQUMzQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLHVCQUF1QjtBQUMzQztBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL2NsaWVudC9kb2MuanM/NzExMiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZW1pdHRlciA9IHJlcXVpcmUoJy4uL2VtaXR0ZXInKTtcbnZhciBsb2dnZXIgPSByZXF1aXJlKCcuLi9sb2dnZXInKTtcbnZhciBTaGFyZURCRXJyb3IgPSByZXF1aXJlKCcuLi9lcnJvcicpO1xudmFyIHR5cGVzID0gcmVxdWlyZSgnLi4vdHlwZXMnKTtcbnZhciB1dGlsID0gcmVxdWlyZSgnLi4vdXRpbCcpO1xudmFyIGNsb25lID0gdXRpbC5jbG9uZTtcbnZhciBkZWVwRXF1YWwgPSByZXF1aXJlKCdmYXN0LWRlZXAtZXF1YWwnKTtcbnZhciBBQ1RJT05TID0gcmVxdWlyZSgnLi4vbWVzc2FnZS1hY3Rpb25zJykuQUNUSU9OUztcblxudmFyIEVSUk9SX0NPREUgPSBTaGFyZURCRXJyb3IuQ09ERVM7XG5cbi8qKlxuICogQSBEb2MgaXMgYSBjbGllbnQncyB2aWV3IG9uIGEgc2hhcmVqcyBkb2N1bWVudC5cbiAqXG4gKiBJdCBpcyBpcyB1bmlxdWVseSBpZGVudGlmaWVkIGJ5IGl0cyBgaWRgIGFuZCBgY29sbGVjdGlvbmAuICBEb2N1bWVudHNcbiAqIHNob3VsZCBub3QgYmUgY3JlYXRlZCBkaXJlY3RseS4gQ3JlYXRlIHRoZW0gd2l0aCBjb25uZWN0aW9uLmdldCgpXG4gKlxuICpcbiAqIFN1YnNjcmlwdGlvbnNcbiAqIC0tLS0tLS0tLS0tLS1cbiAqXG4gKiBXZSBjYW4gc3Vic2NyaWJlIGEgZG9jdW1lbnQgdG8gc3RheSBpbiBzeW5jIHdpdGggdGhlIHNlcnZlci5cbiAqICAgZG9jLnN1YnNjcmliZShmdW5jdGlvbihlcnJvcikge1xuICogICAgIGRvYy5zdWJzY3JpYmVkIC8vID0gdHJ1ZVxuICogICB9KVxuICogVGhlIHNlcnZlciBub3cgc2VuZHMgdXMgYWxsIGNoYW5nZXMgY29uY2VybmluZyB0aGlzIGRvY3VtZW50IGFuZCB0aGVzZSBhcmVcbiAqIGFwcGxpZWQgdG8gb3VyIGRhdGEuIElmIHRoZSBzdWJzY3JpcHRpb24gd2FzIHN1Y2Nlc3NmdWwgdGhlIGluaXRpYWxcbiAqIGRhdGEgYW5kIHZlcnNpb24gc2VudCBieSB0aGUgc2VydmVyIGFyZSBsb2FkZWQgaW50byB0aGUgZG9jdW1lbnQuXG4gKlxuICogVG8gc3RvcCBsaXN0ZW5pbmcgdG8gdGhlIGNoYW5nZXMgd2UgY2FsbCBgZG9jLnVuc3Vic2NyaWJlKClgLlxuICpcbiAqIElmIHdlIGp1c3Qgd2FudCB0byBsb2FkIHRoZSBkYXRhIGJ1dCBub3Qgc3RheSB1cC10by1kYXRlLCB3ZSBjYWxsXG4gKiAgIGRvYy5mZXRjaChmdW5jdGlvbihlcnJvcikge1xuICogICAgIGRvYy5kYXRhIC8vIHNlbnQgYnkgc2VydmVyXG4gKiAgIH0pXG4gKlxuICpcbiAqIEV2ZW50c1xuICogLS0tLS0tXG4gKlxuICogWW91IGNhbiB1c2UgZG9jLm9uKGV2ZW50TmFtZSwgY2FsbGJhY2spIHRvIHN1YnNjcmliZSB0byB0aGUgZm9sbG93aW5nIGV2ZW50czpcbiAqIC0gYGJlZm9yZSBvcCAob3AsIHNvdXJjZSlgIEZpcmVkIGJlZm9yZSBhIHBhcnRpYWwgb3BlcmF0aW9uIGlzIGFwcGxpZWQgdG8gdGhlIGRhdGEuXG4gKiAgIEl0IG1heSBiZSB1c2VkIHRvIHJlYWQgdGhlIG9sZCBkYXRhIGp1c3QgYmVmb3JlIGFwcGx5aW5nIGFuIG9wZXJhdGlvblxuICogLSBgb3AgKG9wLCBzb3VyY2UpYCBGaXJlZCBhZnRlciBldmVyeSBwYXJ0aWFsIG9wZXJhdGlvbiB3aXRoIHRoaXMgb3BlcmF0aW9uIGFzIHRoZVxuICogICBmaXJzdCBhcmd1bWVudFxuICogLSBgY3JlYXRlIChzb3VyY2UpYCBUaGUgZG9jdW1lbnQgd2FzIGNyZWF0ZWQuIFRoYXQgbWVhbnMgaXRzIHR5cGUgd2FzXG4gKiAgIHNldCBhbmQgaXQgaGFzIHNvbWUgaW5pdGlhbCBkYXRhLlxuICogLSBgZGVsIChkYXRhLCBzb3VyY2UpYCBGaXJlZCBhZnRlciB0aGUgZG9jdW1lbnQgaXMgZGVsZXRlZCwgdGhhdCBpc1xuICogICB0aGUgZGF0YSBpcyBudWxsLiBJdCBpcyBwYXNzZWQgdGhlIGRhdGEgYmVmb3JlIGRlbGV0aW9uIGFzIGFuXG4gKiAgIGFyZ3VtZW50XG4gKiAtIGBsb2FkICgpYCBGaXJlZCB3aGVuIGEgbmV3IHNuYXBzaG90IGlzIGluZ2VzdGVkIGZyb20gYSBmZXRjaCwgc3Vic2NyaWJlLCBvciBxdWVyeVxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gRG9jO1xuZnVuY3Rpb24gRG9jKGNvbm5lY3Rpb24sIGNvbGxlY3Rpb24sIGlkKSB7XG4gIGVtaXR0ZXIuRXZlbnRFbWl0dGVyLmNhbGwodGhpcyk7XG5cbiAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcblxuICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICB0aGlzLmlkID0gaWQ7XG5cbiAgdGhpcy52ZXJzaW9uID0gbnVsbDtcbiAgLy8gVGhlIE9UIHR5cGUgb2YgdGhpcyBkb2N1bWVudC4gQW4gdW5jcmVhdGVkIGRvY3VtZW50IGhhcyB0eXBlIGBudWxsYFxuICB0aGlzLnR5cGUgPSBudWxsO1xuICB0aGlzLmRhdGEgPSB1bmRlZmluZWQ7XG5cbiAgLy8gQXJyYXkgb2YgY2FsbGJhY2tzIG9yIG51bGxzIGFzIHBsYWNlaG9sZGVyc1xuICB0aGlzLmluZmxpZ2h0RmV0Y2ggPSBbXTtcbiAgdGhpcy5pbmZsaWdodFN1YnNjcmliZSA9IG51bGw7XG4gIHRoaXMucGVuZGluZ0ZldGNoID0gW107XG4gIHRoaXMucGVuZGluZ1N1YnNjcmliZSA9IFtdO1xuXG4gIHRoaXMuX2lzSW5IYXJkUm9sbGJhY2sgPSBmYWxzZTtcblxuICAvLyBXaGV0aGVyIHdlIHRoaW5rIHdlIGFyZSBzdWJzY3JpYmVkIG9uIHRoZSBzZXJ2ZXIuIFN5bmNocm9ub3VzbHkgc2V0IHRvXG4gIC8vIGZhbHNlIG9uIGNhbGxzIHRvIHVuc3Vic2NyaWJlIGFuZCBkaXNjb25uZWN0LiBTaG91bGQgbmV2ZXIgYmUgdHJ1ZSB3aGVuXG4gIC8vIHRoaXMud2FudFN1YnNjcmliZSBpcyBmYWxzZVxuICB0aGlzLnN1YnNjcmliZWQgPSBmYWxzZTtcbiAgLy8gV2hldGhlciB0byByZS1lc3RhYmxpc2ggdGhlIHN1YnNjcmlwdGlvbiBvbiByZWNvbm5lY3RcbiAgdGhpcy53YW50U3Vic2NyaWJlID0gZmFsc2U7XG5cbiAgdGhpcy5fd2FudHNEZXN0cm95ID0gZmFsc2U7XG5cbiAgLy8gVGhlIG9wIHRoYXQgaXMgY3VycmVudGx5IHJvdW5kdHJpcHBpbmcgdG8gdGhlIHNlcnZlciwgb3IgbnVsbC5cbiAgLy9cbiAgLy8gV2hlbiB0aGUgY29ubmVjdGlvbiByZWNvbm5lY3RzLCB0aGUgaW5mbGlnaHQgb3AgaXMgcmVzdWJtaXR0ZWQuXG4gIC8vXG4gIC8vIFRoaXMgaGFzIHRoZSBzYW1lIGZvcm1hdCBhcyBhbiBlbnRyeSBpbiBwZW5kaW5nT3BzXG4gIHRoaXMuaW5mbGlnaHRPcCA9IG51bGw7XG5cbiAgLy8gQWxsIG9wcyB0aGF0IGFyZSB3YWl0aW5nIGZvciB0aGUgc2VydmVyIHRvIGFja25vd2xlZGdlIHRoaXMuaW5mbGlnaHRPcFxuICAvLyBUaGlzIHVzZWQgdG8ganVzdCBiZSBhIHNpbmdsZSBvcGVyYXRpb24sIGJ1dCBjcmVhdGVzICYgZGVsZXRlcyBjYW4ndCBiZVxuICAvLyBjb21wb3NlZCB3aXRoIHJlZ3VsYXIgb3BlcmF0aW9ucy5cbiAgLy9cbiAgLy8gVGhpcyBpcyBhIGxpc3Qgb2Yge1tjcmVhdGU6ey4uLn1dLCBbZGVsOnRydWVdLCBbb3A6Li4uXSwgY2FsbGJhY2tzOlsuLi5dfVxuICB0aGlzLnBlbmRpbmdPcHMgPSBbXTtcblxuICAvLyBUaGUgYXBwbHlTdGFjayBlbmFibGVzIHVzIHRvIHRyYWNrIGFueSBvcHMgc3VibWl0dGVkIHdoaWxlIHdlIGFyZVxuICAvLyBhcHBseWluZyBhbiBvcCBpbmNyZW1lbnRhbGx5LiBUaGlzIHZhbHVlIGlzIGFuIGFycmF5IHdoZW4gd2UgYXJlXG4gIC8vIHBlcmZvcm1pbmcgYW4gaW5jcmVtZW50YWwgYXBwbHkgYW5kIG51bGwgb3RoZXJ3aXNlLiBXaGVuIGl0IGlzIGFuIGFycmF5LFxuICAvLyBhbGwgc3VibWl0dGVkIG9wcyBzaG91bGQgYmUgcHVzaGVkIG9udG8gaXQuIFRoZSBgX290QXBwbHlgIG1ldGhvZCB3aWxsXG4gIC8vIHJlc2V0IGl0IGJhY2sgdG8gbnVsbCB3aGVuIGFsbCBpbmNyZW1lbnRhbCBhcHBseSBsb29wcyBhcmUgY29tcGxldGUuXG4gIHRoaXMuYXBwbHlTdGFjayA9IG51bGw7XG5cbiAgLy8gRGlzYWJsZSB0aGUgZGVmYXVsdCBiZWhhdmlvciBvZiBjb21wb3Npbmcgc3VibWl0dGVkIG9wcy4gVGhpcyBpcyByZWFkIGF0XG4gIC8vIHRoZSB0aW1lIG9mIG9wIHN1Ym1pdCwgc28gaXQgbWF5IGJlIHRvZ2dsZWQgb24gYmVmb3JlIHN1Ym1pdHRpbmcgYVxuICAvLyBzcGVjaWZjIG9wIGFuZCB0b2dnbGVkIG9mZiBhZnRlcndhcmRcbiAgdGhpcy5wcmV2ZW50Q29tcG9zZSA9IGZhbHNlO1xuXG4gIC8vIElmIHNldCB0byB0cnVlLCB0aGUgc291cmNlIHdpbGwgYmUgc3VibWl0dGVkIG92ZXIgdGhlIGNvbm5lY3Rpb24uIFRoaXNcbiAgLy8gd2lsbCBhbHNvIGhhdmUgdGhlIHNpZGUtZWZmZWN0IG9mIG9ubHkgY29tcG9zaW5nIG9wcyB3aG9zZSBzb3VyY2VzIGFyZVxuICAvLyBlcXVhbFxuICB0aGlzLnN1Ym1pdFNvdXJjZSA9IGZhbHNlO1xuXG4gIC8vIFByZXZlbnQgb3duIG9wcyBiZWluZyBzdWJtaXR0ZWQgdG8gdGhlIHNlcnZlci4gSWYgc3Vic2NyaWJlZCwgcmVtb3RlXG4gIC8vIG9wcyBhcmUgc3RpbGwgcmVjZWl2ZWQuIFNob3VsZCBiZSB0b2dnbGVkIHRocm91Z2ggdGhlIHBhdXNlKCkgYW5kXG4gIC8vIHJlc3VtZSgpIG1ldGhvZHMgdG8gY29ycmVjdGx5IGZsdXNoIG9uIHJlc3VtZS5cbiAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcblxuICAvLyBJbnRlcm5hbCBjb3VudGVyIHRoYXQgZ2V0cyBpbmNyZW1lbnRlZCBldmVyeSB0aW1lIGRvYy5kYXRhIGlzIHVwZGF0ZWQuXG4gIC8vIFVzZWQgYXMgYSBjaGVhcCB3YXkgdG8gY2hlY2sgaWYgZG9jLmRhdGEgaGFzIGNoYW5nZWQuXG4gIHRoaXMuX2RhdGFTdGF0ZVZlcnNpb24gPSAwO1xufVxuZW1pdHRlci5taXhpbihEb2MpO1xuXG5Eb2MucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB0aGlzLl93YW50c0Rlc3Ryb3kgPSB0cnVlO1xuICB2YXIgZG9jID0gdGhpcztcbiAgZG9jLndoZW5Ob3RoaW5nUGVuZGluZyhmdW5jdGlvbigpIHtcbiAgICBpZiAoZG9jLndhbnRTdWJzY3JpYmUpIHtcbiAgICAgIGRvYy51bnN1YnNjcmliZShmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGlmIChjYWxsYmFjaykgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgcmV0dXJuIGRvYy5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgICAgIH1cbiAgICAgICAgZG9jLmNvbm5lY3Rpb24uX2Rlc3Ryb3lEb2MoZG9jKTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvYy5jb25uZWN0aW9uLl9kZXN0cm95RG9jKGRvYyk7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgfVxuICB9KTtcbn07XG5cblxuLy8gKioqKioqIE1hbmlwdWxhdGluZyB0aGUgZG9jdW1lbnQgZGF0YSwgdmVyc2lvbiBhbmQgdHlwZS5cblxuLy8gU2V0IHRoZSBkb2N1bWVudCdzIHR5cGUsIGFuZCBhc3NvY2lhdGVkIHByb3BlcnRpZXMuIE1vc3Qgb2YgdGhlIGxvZ2ljIGluXG4vLyB0aGlzIGZ1bmN0aW9uIGV4aXN0cyB0byB1cGRhdGUgdGhlIGRvY3VtZW50IGJhc2VkIG9uIGFueSBhZGRlZCAmIHJlbW92ZWQgQVBJXG4vLyBtZXRob2RzLlxuLy9cbi8vIEBwYXJhbSBuZXdUeXBlIE9UIHR5cGUgcHJvdmlkZWQgYnkgdGhlIG90dHlwZXMgbGlicmFyeSBvciBpdHMgbmFtZSBvciB1cmlcbkRvYy5wcm90b3R5cGUuX3NldFR5cGUgPSBmdW5jdGlvbihuZXdUeXBlKSB7XG4gIGlmICh0eXBlb2YgbmV3VHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICBuZXdUeXBlID0gdHlwZXMubWFwW25ld1R5cGVdO1xuICB9XG5cbiAgaWYgKG5ld1R5cGUpIHtcbiAgICB0aGlzLnR5cGUgPSBuZXdUeXBlO1xuICB9IGVsc2UgaWYgKG5ld1R5cGUgPT09IG51bGwpIHtcbiAgICB0aGlzLnR5cGUgPSBuZXdUeXBlO1xuICAgIC8vIElmIHdlIHJlbW92ZWQgdGhlIHR5cGUgZnJvbSB0aGUgb2JqZWN0LCBhbHNvIHJlbW92ZSBpdHMgZGF0YVxuICAgIHRoaXMuX3NldERhdGEodW5kZWZpbmVkKTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgZXJyID0gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfVFlQRV9OT1RfUkVDT0dOSVpFRCwgJ01pc3NpbmcgdHlwZSAnICsgbmV3VHlwZSk7XG4gICAgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICB9XG59O1xuXG5Eb2MucHJvdG90eXBlLl9zZXREYXRhID0gZnVuY3Rpb24oZGF0YSkge1xuICB0aGlzLmRhdGEgPSBkYXRhO1xuICB0aGlzLl9kYXRhU3RhdGVWZXJzaW9uKys7XG59O1xuXG4vLyBJbmdlc3Qgc25hcHNob3QgZGF0YS4gVGhpcyBkYXRhIG11c3QgaW5jbHVkZSBhIHZlcnNpb24sIHNuYXBzaG90IGFuZCB0eXBlLlxuLy8gVGhpcyBpcyB1c2VkIGJvdGggdG8gaW5nZXN0IGRhdGEgdGhhdCB3YXMgZXhwb3J0ZWQgd2l0aCBhIHdlYnBhZ2UgYW5kIGRhdGFcbi8vIHRoYXQgd2FzIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlciBkdXJpbmcgYSBmZXRjaC5cbi8vXG4vLyBAcGFyYW0gc25hcHNob3QudiAgICB2ZXJzaW9uXG4vLyBAcGFyYW0gc25hcHNob3QuZGF0YVxuLy8gQHBhcmFtIHNuYXBzaG90LnR5cGVcbi8vIEBwYXJhbSBjYWxsYmFja1xuRG9jLnByb3RvdHlwZS5pbmdlc3RTbmFwc2hvdCA9IGZ1bmN0aW9uKHNuYXBzaG90LCBjYWxsYmFjaykge1xuICBpZiAoIXNuYXBzaG90KSByZXR1cm4gY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcblxuICBpZiAodHlwZW9mIHNuYXBzaG90LnYgIT09ICdudW1iZXInKSB7XG4gICAgdmFyIGVyciA9IG5ldyBTaGFyZURCRXJyb3IoXG4gICAgICBFUlJPUl9DT0RFLkVSUl9JTkdFU1RFRF9TTkFQU0hPVF9IQVNfTk9fVkVSU0lPTixcbiAgICAgICdNaXNzaW5nIHZlcnNpb24gaW4gaW5nZXN0ZWQgc25hcHNob3QuICcgKyB0aGlzLmNvbGxlY3Rpb24gKyAnLicgKyB0aGlzLmlkXG4gICAgKTtcbiAgICBpZiAoY2FsbGJhY2spIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgfVxuXG4gIC8vIElmIHRoZSBkb2MgaXMgYWxyZWFkeSBjcmVhdGVkIG9yIHRoZXJlIGFyZSBvcHMgcGVuZGluZywgd2UgY2Fubm90IHVzZSB0aGVcbiAgLy8gaW5nZXN0ZWQgc25hcHNob3QgYW5kIG5lZWQgb3BzIGluIG9yZGVyIHRvIHVwZGF0ZSB0aGUgZG9jdW1lbnRcbiAgaWYgKHRoaXMudHlwZSB8fCB0aGlzLmhhc1dyaXRlUGVuZGluZygpKSB7XG4gICAgLy8gVGhlIHZlcnNpb24gc2hvdWxkIG9ubHkgYmUgbnVsbCBvbiBhIGNyZWF0ZWQgZG9jdW1lbnQgd2hlbiBpdCB3YXNcbiAgICAvLyBjcmVhdGVkIGxvY2FsbHkgd2l0aG91dCBmZXRjaGluZ1xuICAgIGlmICh0aGlzLnZlcnNpb24gPT0gbnVsbCkge1xuICAgICAgaWYgKHRoaXMuaGFzV3JpdGVQZW5kaW5nKCkpIHtcbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBwZW5kaW5nIG9wcyBhbmQgd2UgZ2V0IGEgc25hcHNob3QgZm9yIGEgbG9jYWxseSBjcmVhdGVkXG4gICAgICAgIC8vIGRvY3VtZW50LCB3ZSBoYXZlIHRvIHdhaXQgZm9yIHRoZSBwZW5kaW5nIG9wcyB0byBjb21wbGV0ZSwgYmVjYXVzZVxuICAgICAgICAvLyB3ZSBkb24ndCBrbm93IHdoYXQgdmVyc2lvbiB0byBmZXRjaCBvcHMgZnJvbS4gSXQgaXMgcG9zc2libGUgdGhhdFxuICAgICAgICAvLyB0aGUgc25hcHNob3QgY2FtZSBmcm9tIG91ciBsb2NhbCBvcCwgYnV0IGl0IGlzIGFsc28gcG9zc2libGUgdGhhdFxuICAgICAgICAvLyB0aGUgZG9jIHdhcyBjcmVhdGVkIHJlbW90ZWx5ICh3aGljaCB3b3VsZCBjb25mbGljdCBhbmQgYmUgYW4gZXJyb3IpXG4gICAgICAgIHJldHVybiBjYWxsYmFjayAmJiB0aGlzLm9uY2UoJ25vIHdyaXRlIHBlbmRpbmcnLCBjYWxsYmFjayk7XG4gICAgICB9XG4gICAgICAvLyBPdGhlcndpc2UsIHdlJ3ZlIGVuY291bnRlZCBhbiBlcnJvciBzdGF0ZVxuICAgICAgdmFyIGVyciA9IG5ldyBTaGFyZURCRXJyb3IoXG4gICAgICAgIEVSUk9SX0NPREUuRVJSX0RPQ19NSVNTSU5HX1ZFUlNJT04sXG4gICAgICAgICdDYW5ub3QgaW5nZXN0IHNuYXBzaG90IGluIGRvYyB3aXRoIG51bGwgdmVyc2lvbi4gJyArIHRoaXMuY29sbGVjdGlvbiArICcuJyArIHRoaXMuaWRcbiAgICAgICk7XG4gICAgICBpZiAoY2FsbGJhY2spIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgIH1cbiAgICAvLyBJZiB3ZSBnb3QgYSBzbmFwc2hvdCBmb3IgYSB2ZXJzaW9uIGZ1cnRoZXIgYWxvbmcgdGhhbiB0aGUgZG9jdW1lbnQgaXNcbiAgICAvLyBjdXJyZW50bHksIGlzc3VlIGEgZmV0Y2ggdG8gZ2V0IHRoZSBsYXRlc3Qgb3BzIGFuZCBjYXRjaCB1cyB1cFxuICAgIGlmIChzbmFwc2hvdC52ID4gdGhpcy52ZXJzaW9uKSByZXR1cm4gdGhpcy5mZXRjaChjYWxsYmFjayk7XG4gICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gIH1cblxuICAvLyBJZ25vcmUgdGhlIHNuYXBzaG90IGlmIHdlIGFyZSBhbHJlYWR5IGF0IGEgbmV3ZXIgdmVyc2lvbi4gVW5kZXIgbm9cbiAgLy8gY2lyY3Vtc3RhbmNlIHNob3VsZCB3ZSBldmVyIHNldCB0aGUgY3VycmVudCB2ZXJzaW9uIGJhY2t3YXJkXG4gIGlmICh0aGlzLnZlcnNpb24gPiBzbmFwc2hvdC52KSByZXR1cm4gY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcblxuICB0aGlzLnZlcnNpb24gPSBzbmFwc2hvdC52O1xuICB2YXIgdHlwZSA9IChzbmFwc2hvdC50eXBlID09PSB1bmRlZmluZWQpID8gdHlwZXMuZGVmYXVsdFR5cGUgOiBzbmFwc2hvdC50eXBlO1xuICB0aGlzLl9zZXRUeXBlKHR5cGUpO1xuICB0aGlzLl9zZXREYXRhKFxuICAgICh0aGlzLnR5cGUgJiYgdGhpcy50eXBlLmRlc2VyaWFsaXplKSA/XG4gICAgICB0aGlzLnR5cGUuZGVzZXJpYWxpemUoc25hcHNob3QuZGF0YSkgOlxuICAgICAgc25hcHNob3QuZGF0YVxuICApO1xuICB0aGlzLmVtaXQoJ2xvYWQnKTtcbiAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbn07XG5cbkRvYy5wcm90b3R5cGUud2hlbk5vdGhpbmdQZW5kaW5nID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgdmFyIGRvYyA9IHRoaXM7XG4gIHV0aWwubmV4dFRpY2soZnVuY3Rpb24oKSB7XG4gICAgaWYgKGRvYy5oYXNQZW5kaW5nKCkpIHtcbiAgICAgIGRvYy5vbmNlKCdub3RoaW5nIHBlbmRpbmcnLCBjYWxsYmFjayk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNhbGxiYWNrKCk7XG4gIH0pO1xufTtcblxuRG9jLnByb3RvdHlwZS5oYXNQZW5kaW5nID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAhIShcbiAgICB0aGlzLmluZmxpZ2h0T3AgfHxcbiAgICB0aGlzLnBlbmRpbmdPcHMubGVuZ3RoIHx8XG4gICAgdGhpcy5pbmZsaWdodEZldGNoLmxlbmd0aCB8fFxuICAgIHRoaXMuaW5mbGlnaHRTdWJzY3JpYmUgfHxcbiAgICB0aGlzLnBlbmRpbmdGZXRjaC5sZW5ndGggfHxcbiAgICB0aGlzLnBlbmRpbmdTdWJzY3JpYmUubGVuZ3RoXG4gICk7XG59O1xuXG5Eb2MucHJvdG90eXBlLmhhc1dyaXRlUGVuZGluZyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gISEodGhpcy5pbmZsaWdodE9wIHx8IHRoaXMucGVuZGluZ09wcy5sZW5ndGgpO1xufTtcblxuRG9jLnByb3RvdHlwZS5fZW1pdE5vdGhpbmdQZW5kaW5nID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLmhhc1dyaXRlUGVuZGluZygpKSByZXR1cm47XG4gIHRoaXMuZW1pdCgnbm8gd3JpdGUgcGVuZGluZycpO1xuICBpZiAodGhpcy5oYXNQZW5kaW5nKCkpIHJldHVybjtcbiAgdGhpcy5lbWl0KCdub3RoaW5nIHBlbmRpbmcnKTtcbn07XG5cbi8vICoqKiogSGVscGVycyBmb3IgbmV0d29yayBtZXNzYWdlc1xuXG5Eb2MucHJvdG90eXBlLl9lbWl0UmVzcG9uc2VFcnJvciA9IGZ1bmN0aW9uKGVyciwgY2FsbGJhY2spIHtcbiAgaWYgKGVyciAmJiBlcnIuY29kZSA9PT0gRVJST1JfQ09ERS5FUlJfU05BUFNIT1RfUkVBRF9TSUxFTlRfUkVKRUNUSU9OKSB7XG4gICAgdGhpcy53YW50U3Vic2NyaWJlID0gZmFsc2U7XG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgICB0aGlzLl9lbWl0Tm90aGluZ1BlbmRpbmcoKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2soZXJyKTtcbiAgICB0aGlzLl9lbWl0Tm90aGluZ1BlbmRpbmcoKTtcbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5fZW1pdE5vdGhpbmdQZW5kaW5nKCk7XG4gIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xufTtcblxuRG9jLnByb3RvdHlwZS5faGFuZGxlRmV0Y2ggPSBmdW5jdGlvbihlcnJvciwgc25hcHNob3QpIHtcbiAgdmFyIGNhbGxiYWNrcyA9IHRoaXMucGVuZGluZ0ZldGNoO1xuICB0aGlzLnBlbmRpbmdGZXRjaCA9IFtdO1xuICB2YXIgY2FsbGJhY2sgPSB0aGlzLmluZmxpZ2h0RmV0Y2guc2hpZnQoKTtcbiAgaWYgKGNhbGxiYWNrKSBjYWxsYmFja3MudW5zaGlmdChjYWxsYmFjayk7XG4gIGlmIChjYWxsYmFja3MubGVuZ3RoKSB7XG4gICAgY2FsbGJhY2sgPSBmdW5jdGlvbihlcnJvcikge1xuICAgICAgdXRpbC5jYWxsRWFjaChjYWxsYmFja3MsIGVycm9yKTtcbiAgICB9O1xuICB9XG4gIGlmIChlcnJvcikgcmV0dXJuIHRoaXMuX2VtaXRSZXNwb25zZUVycm9yKGVycm9yLCBjYWxsYmFjayk7XG4gIHRoaXMuaW5nZXN0U25hcHNob3Qoc25hcHNob3QsIGNhbGxiYWNrKTtcbiAgdGhpcy5fZW1pdE5vdGhpbmdQZW5kaW5nKCk7XG59O1xuXG5Eb2MucHJvdG90eXBlLl9oYW5kbGVTdWJzY3JpYmUgPSBmdW5jdGlvbihlcnJvciwgc25hcHNob3QpIHtcbiAgdmFyIHJlcXVlc3QgPSB0aGlzLmluZmxpZ2h0U3Vic2NyaWJlO1xuICB0aGlzLmluZmxpZ2h0U3Vic2NyaWJlID0gbnVsbDtcbiAgdmFyIGNhbGxiYWNrcyA9IHRoaXMucGVuZGluZ0ZldGNoO1xuICB0aGlzLnBlbmRpbmdGZXRjaCA9IFtdO1xuICBpZiAocmVxdWVzdC5jYWxsYmFjaykgY2FsbGJhY2tzLnB1c2gocmVxdWVzdC5jYWxsYmFjayk7XG4gIHZhciBjYWxsYmFjaztcbiAgaWYgKGNhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICB1dGlsLmNhbGxFYWNoKGNhbGxiYWNrcywgZXJyb3IpO1xuICAgIH07XG4gIH1cbiAgaWYgKGVycm9yKSByZXR1cm4gdGhpcy5fZW1pdFJlc3BvbnNlRXJyb3IoZXJyb3IsIGNhbGxiYWNrKTtcbiAgdGhpcy5zdWJzY3JpYmVkID0gcmVxdWVzdC53YW50U3Vic2NyaWJlO1xuICBpZiAodGhpcy5zdWJzY3JpYmVkKSB0aGlzLmluZ2VzdFNuYXBzaG90KHNuYXBzaG90LCBjYWxsYmFjayk7XG4gIGVsc2UgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICB0aGlzLl9lbWl0Tm90aGluZ1BlbmRpbmcoKTtcbiAgdGhpcy5fZmx1c2hTdWJzY3JpYmUoKTtcbn07XG5cbkRvYy5wcm90b3R5cGUuX2hhbmRsZU9wID0gZnVuY3Rpb24oZXJyLCBtZXNzYWdlKSB7XG4gIGlmIChlcnIpIHtcbiAgICBpZiAoZXJyLmNvZGUgPT09IEVSUk9SX0NPREUuRVJSX05PX09QICYmIG1lc3NhZ2Uuc2VxID09PSB0aGlzLmluZmxpZ2h0T3Auc2VxKSB7XG4gICAgICAvLyBPdXIgb3Agd2FzIGEgbm8tb3AsIGVpdGhlciBiZWNhdXNlIHdlIHN1Ym1pdHRlZCBhIG5vLW9wLCBvciAtIG1vcmVcbiAgICAgIC8vIGxpa2VseSAtIGJlY2F1c2Ugb3VyIG9wIHdhcyB0cmFuc2Zvcm1lZCBpbnRvIGEgbm8tb3AgYnkgdGhlIHNlcnZlclxuICAgICAgLy8gYmVjYXVzZSBvZiBhIHNpbWlsYXIgcmVtb3RlIG9wLiBJbiB0aGlzIGNhc2UsIHRoZSBzZXJ2ZXIgaGFzIGF2b2lkZWRcbiAgICAgIC8vIGNvbW1pdHRpbmcgdGhlIG9wIHRvIHRoZSBkYXRhYmFzZSwgYW5kIHdlIHNob3VsZCBqdXN0IGNsZWFyIHRoZSBpbi1mbGlnaHRcbiAgICAgIC8vIG9wIGFuZCBjYWxsIHRoZSBjYWxsYmFja3MuIEhvd2V2ZXIsIGxldCdzIGZpcnN0IGNhdGNoIG91cnNlbHZlcyB1cCB0b1xuICAgICAgLy8gdGhlIHJlbW90ZSwgc28gdGhhdCB3ZSdyZSBpbiBhIG5pY2UgY29uc2lzdGVudCBzdGF0ZVxuICAgICAgcmV0dXJuIHRoaXMuZmV0Y2godGhpcy5fY2xlYXJJbmZsaWdodE9wLmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBpZiAodGhpcy5pbmZsaWdodE9wKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcm9sbGJhY2soZXJyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICB9XG5cbiAgaWYgKHRoaXMuaW5mbGlnaHRPcCAmJlxuICAgICAgbWVzc2FnZS5zcmMgPT09IHRoaXMuaW5mbGlnaHRPcC5zcmMgJiZcbiAgICAgIG1lc3NhZ2Uuc2VxID09PSB0aGlzLmluZmxpZ2h0T3Auc2VxKSB7XG4gICAgLy8gVGhlIG9wIGhhcyBhbHJlYWR5IGJlZW4gYXBwbGllZCBsb2NhbGx5LiBKdXN0IHVwZGF0ZSB0aGUgdmVyc2lvblxuICAgIC8vIGFuZCBwZW5kaW5nIHN0YXRlIGFwcHJvcHJpYXRlbHlcbiAgICB0aGlzLl9vcEFja25vd2xlZGdlZChtZXNzYWdlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAodGhpcy52ZXJzaW9uID09IG51bGwgfHwgbWVzc2FnZS52ID4gdGhpcy52ZXJzaW9uKSB7XG4gICAgLy8gVGhpcyB3aWxsIGhhcHBlbiBpbiBub3JtYWwgb3BlcmF0aW9uIGlmIHdlIGJlY29tZSBzdWJzY3JpYmVkIHRvIGFcbiAgICAvLyBuZXcgZG9jdW1lbnQgdmlhIGEgcXVlcnkuIEl0IGNhbiBhbHNvIGhhcHBlbiBpZiB3ZSBnZXQgYW4gb3AgZm9yXG4gICAgLy8gYSBmdXR1cmUgdmVyc2lvbiBiZXlvbmQgdGhlIHZlcnNpb24gd2UgYXJlIGV4cGVjdGluZyBuZXh0LiBUaGlzXG4gICAgLy8gY291bGQgaGFwcGVuIGlmIHRoZSBzZXJ2ZXIgZG9lc24ndCBwdWJsaXNoIGFuIG9wIGZvciB3aGF0ZXZlciByZWFzb25cbiAgICAvLyBvciBiZWNhdXNlIG9mIGEgcmFjZSBjb25kaXRpb24uIEluIGFueSBjYXNlLCB3ZSBjYW4gc2VuZCBhIGZldGNoXG4gICAgLy8gY29tbWFuZCB0byBjYXRjaCBiYWNrIHVwLlxuICAgIC8vXG4gICAgLy8gRmV0Y2ggb25seSBzZW5kcyBhIG5ldyBmZXRjaCBjb21tYW5kIGlmIG5vIGZldGNoZXMgYXJlIGluZmxpZ2h0LCB3aGljaFxuICAgIC8vIHdpbGwgYWN0IGFzIGEgbmF0dXJhbCBkZWJvdW5jaW5nIHNvIHdlIGRvbid0IHNlbmQgbXVsdGlwbGUgZmV0Y2hcbiAgICAvLyByZXF1ZXN0cyBmb3IgbWFueSBvcHMgcmVjZWl2ZWQgYXQgb25jZS5cbiAgICB0aGlzLmZldGNoKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKG1lc3NhZ2UudiA8IHRoaXMudmVyc2lvbikge1xuICAgIC8vIFdlIGNhbiBzYWZlbHkgaWdub3JlIHRoZSBvbGQgKGR1cGxpY2F0ZSkgb3BlcmF0aW9uLlxuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0aGlzLmluZmxpZ2h0T3ApIHtcbiAgICB2YXIgdHJhbnNmb3JtRXJyID0gdHJhbnNmb3JtWCh0aGlzLmluZmxpZ2h0T3AsIG1lc3NhZ2UpO1xuICAgIGlmICh0cmFuc2Zvcm1FcnIpIHJldHVybiB0aGlzLl9oYXJkUm9sbGJhY2sodHJhbnNmb3JtRXJyKTtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wZW5kaW5nT3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHRyYW5zZm9ybUVyciA9IHRyYW5zZm9ybVgodGhpcy5wZW5kaW5nT3BzW2ldLCBtZXNzYWdlKTtcbiAgICBpZiAodHJhbnNmb3JtRXJyKSByZXR1cm4gdGhpcy5faGFyZFJvbGxiYWNrKHRyYW5zZm9ybUVycik7XG4gIH1cblxuICB0aGlzLnZlcnNpb24rKztcbiAgdHJ5IHtcbiAgICB0aGlzLl9vdEFwcGx5KG1lc3NhZ2UsIGZhbHNlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gdGhpcy5faGFyZFJvbGxiYWNrKGVycm9yKTtcbiAgfVxufTtcblxuLy8gQ2FsbGVkIHdoZW5ldmVyICh5b3UgZ3Vlc3NlZCBpdCEpIHRoZSBjb25uZWN0aW9uIHN0YXRlIGNoYW5nZXMuIFRoaXMgd2lsbFxuLy8gaGFwcGVuIHdoZW4gd2UgZ2V0IGRpc2Nvbm5lY3RlZCAmIHJlY29ubmVjdC5cbkRvYy5wcm90b3R5cGUuX29uQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5jb25uZWN0aW9uLmNhblNlbmQpIHtcbiAgICB0aGlzLmZsdXNoKCk7XG4gICAgdGhpcy5fcmVzdWJzY3JpYmUoKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAodGhpcy5pbmZsaWdodE9wKSB7XG4gICAgICB0aGlzLnBlbmRpbmdPcHMudW5zaGlmdCh0aGlzLmluZmxpZ2h0T3ApO1xuICAgICAgdGhpcy5pbmZsaWdodE9wID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5zdWJzY3JpYmVkID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuaW5mbGlnaHRTdWJzY3JpYmUpIHtcbiAgICAgIGlmICh0aGlzLmluZmxpZ2h0U3Vic2NyaWJlLndhbnRTdWJzY3JpYmUpIHtcbiAgICAgICAgdGhpcy5wZW5kaW5nU3Vic2NyaWJlLnVuc2hpZnQodGhpcy5pbmZsaWdodFN1YnNjcmliZSk7XG4gICAgICAgIHRoaXMuaW5mbGlnaHRTdWJzY3JpYmUgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5faGFuZGxlU3Vic2NyaWJlKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLmluZmxpZ2h0RmV0Y2gubGVuZ3RoKSB7XG4gICAgICB0aGlzLnBlbmRpbmdGZXRjaCA9IHRoaXMucGVuZGluZ0ZldGNoLmNvbmNhdCh0aGlzLmluZmxpZ2h0RmV0Y2gpO1xuICAgICAgdGhpcy5pbmZsaWdodEZldGNoLmxlbmd0aCA9IDA7XG4gICAgfVxuICB9XG59O1xuXG5Eb2MucHJvdG90eXBlLl9yZXN1YnNjcmliZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAoIXRoaXMucGVuZGluZ1N1YnNjcmliZS5sZW5ndGggJiYgdGhpcy53YW50U3Vic2NyaWJlKSB7XG4gICAgcmV0dXJuIHRoaXMuc3Vic2NyaWJlKCk7XG4gIH1cbiAgdmFyIHdpbGxGZXRjaCA9IHRoaXMucGVuZGluZ1N1YnNjcmliZS5zb21lKGZ1bmN0aW9uKHJlcXVlc3QpIHtcbiAgICByZXR1cm4gcmVxdWVzdC53YW50U3Vic2NyaWJlO1xuICB9KTtcbiAgaWYgKCF3aWxsRmV0Y2ggJiYgdGhpcy5wZW5kaW5nRmV0Y2gubGVuZ3RoKSB0aGlzLmZldGNoKCk7XG4gIHRoaXMuX2ZsdXNoU3Vic2NyaWJlKCk7XG59O1xuXG4vLyBSZXF1ZXN0IHRoZSBjdXJyZW50IGRvY3VtZW50IHNuYXBzaG90IG9yIG9wcyB0aGF0IGJyaW5nIHVzIHVwIHRvIGRhdGVcbkRvYy5wcm90b3R5cGUuZmV0Y2ggPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB0aGlzLl9mZXRjaCh7fSwgY2FsbGJhY2spO1xufTtcblxuRG9jLnByb3RvdHlwZS5fZmV0Y2ggPSBmdW5jdGlvbihvcHRpb25zLCBjYWxsYmFjaykge1xuICB0aGlzLnBlbmRpbmdGZXRjaC5wdXNoKGNhbGxiYWNrKTtcbiAgdmFyIHNob3VsZFNlbmQgPSB0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCAmJiAoXG4gICAgb3B0aW9ucy5mb3JjZSB8fCAhdGhpcy5pbmZsaWdodEZldGNoLmxlbmd0aFxuICApO1xuICBpZiAoIXNob3VsZFNlbmQpIHJldHVybjtcbiAgdGhpcy5pbmZsaWdodEZldGNoLnB1c2godGhpcy5wZW5kaW5nRmV0Y2guc2hpZnQoKSk7XG4gIHRoaXMuY29ubmVjdGlvbi5zZW5kRmV0Y2godGhpcyk7XG59O1xuXG4vLyBGZXRjaCB0aGUgaW5pdGlhbCBkb2N1bWVudCBhbmQga2VlcCByZWNlaXZpbmcgdXBkYXRlc1xuRG9jLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB2YXIgd2FudFN1YnNjcmliZSA9IHRydWU7XG4gIHRoaXMuX3F1ZXVlU3Vic2NyaWJlKHdhbnRTdWJzY3JpYmUsIGNhbGxiYWNrKTtcbn07XG5cbi8vIFVuc3Vic2NyaWJlLiBUaGUgZGF0YSB3aWxsIHN0YXkgYXJvdW5kIGluIGxvY2FsIG1lbW9yeSwgYnV0IHdlJ2xsIHN0b3Bcbi8vIHJlY2VpdmluZyB1cGRhdGVzXG5Eb2MucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgdmFyIHdhbnRTdWJzY3JpYmUgPSBmYWxzZTtcbiAgdGhpcy5fcXVldWVTdWJzY3JpYmUod2FudFN1YnNjcmliZSwgY2FsbGJhY2spO1xufTtcblxuRG9jLnByb3RvdHlwZS5fcXVldWVTdWJzY3JpYmUgPSBmdW5jdGlvbih3YW50U3Vic2NyaWJlLCBjYWxsYmFjaykge1xuICB2YXIgbGFzdFJlcXVlc3QgPSB0aGlzLnBlbmRpbmdTdWJzY3JpYmVbdGhpcy5wZW5kaW5nU3Vic2NyaWJlLmxlbmd0aCAtIDFdIHx8IHRoaXMuaW5mbGlnaHRTdWJzY3JpYmU7XG4gIHZhciBpc0R1cGxpY2F0ZVJlcXVlc3QgPSBsYXN0UmVxdWVzdCAmJiBsYXN0UmVxdWVzdC53YW50U3Vic2NyaWJlID09PSB3YW50U3Vic2NyaWJlO1xuICBpZiAoaXNEdXBsaWNhdGVSZXF1ZXN0KSB7XG4gICAgbGFzdFJlcXVlc3QuY2FsbGJhY2sgPSBjb21iaW5lQ2FsbGJhY2tzKFtsYXN0UmVxdWVzdC5jYWxsYmFjaywgY2FsbGJhY2tdKTtcbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5wZW5kaW5nU3Vic2NyaWJlLnB1c2goe1xuICAgIHdhbnRTdWJzY3JpYmU6ICEhd2FudFN1YnNjcmliZSxcbiAgICBjYWxsYmFjazogY2FsbGJhY2tcbiAgfSk7XG4gIHRoaXMuX2ZsdXNoU3Vic2NyaWJlKCk7XG59O1xuXG5Eb2MucHJvdG90eXBlLl9mbHVzaFN1YnNjcmliZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5pbmZsaWdodFN1YnNjcmliZSB8fCAhdGhpcy5wZW5kaW5nU3Vic2NyaWJlLmxlbmd0aCkgcmV0dXJuO1xuXG4gIGlmICh0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCkge1xuICAgIHRoaXMuaW5mbGlnaHRTdWJzY3JpYmUgPSB0aGlzLnBlbmRpbmdTdWJzY3JpYmUuc2hpZnQoKTtcbiAgICB0aGlzLndhbnRTdWJzY3JpYmUgPSB0aGlzLmluZmxpZ2h0U3Vic2NyaWJlLndhbnRTdWJzY3JpYmU7XG4gICAgaWYgKHRoaXMud2FudFN1YnNjcmliZSkge1xuICAgICAgdGhpcy5jb25uZWN0aW9uLnNlbmRTdWJzY3JpYmUodGhpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEJlIGNvbnNlcnZhdGl2ZSBhYm91dCBvdXIgc3Vic2NyaXB0aW9uIHN0YXRlLiBXZSdsbCBiZSB1bnN1YnNjcmliZWRcbiAgICAgIC8vIHNvbWUgdGltZSBiZXR3ZWVuIHNlbmRpbmcgdGhpcyByZXF1ZXN0LCBhbmQgcmVjZWl2aW5nIHRoZSBjYWxsYmFjayxcbiAgICAgIC8vIHNvIGxldCdzIGp1c3Qgc2V0IG91cnNlbHZlcyB0byB1bnN1YnNjcmliZWQgbm93LlxuICAgICAgdGhpcy5zdWJzY3JpYmVkID0gZmFsc2U7XG4gICAgICB0aGlzLmNvbm5lY3Rpb24uc2VuZFVuc3Vic2NyaWJlKHRoaXMpO1xuICAgIH1cblxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIElmIHdlJ3JlIG9mZmxpbmUsIHRoZW4gd2UncmUgYWxyZWFkeSB1bnN1YnNjcmliZWQuIFRoZXJlZm9yZSwgY2FsbCBiYWNrXG4gIC8vIHRoZSBuZXh0IHJlcXVlc3QgaW1tZWRpYXRlbHkgaWYgaXQncyBhbiB1bnN1YnNjcmliZSByZXF1ZXN0LlxuICBpZiAoIXRoaXMucGVuZGluZ1N1YnNjcmliZVswXS53YW50U3Vic2NyaWJlKSB7XG4gICAgdGhpcy5pbmZsaWdodFN1YnNjcmliZSA9IHRoaXMucGVuZGluZ1N1YnNjcmliZS5zaGlmdCgpO1xuICAgIHZhciBkb2MgPSB0aGlzO1xuICAgIHV0aWwubmV4dFRpY2soZnVuY3Rpb24oKSB7XG4gICAgICBkb2MuX2hhbmRsZVN1YnNjcmliZSgpO1xuICAgIH0pO1xuICB9XG59O1xuXG5mdW5jdGlvbiBjb21iaW5lQ2FsbGJhY2tzKGNhbGxiYWNrcykge1xuICBjYWxsYmFja3MgPSBjYWxsYmFja3MuZmlsdGVyKHV0aWwudHJ1dGh5KTtcbiAgaWYgKCFjYWxsYmFja3MubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgdXRpbC5jYWxsRWFjaChjYWxsYmFja3MsIGVycm9yKTtcbiAgfTtcbn1cblxuXG4vLyBPcGVyYXRpb25zIC8vXG5cbi8vIFNlbmQgdGhlIG5leHQgcGVuZGluZyBvcCB0byB0aGUgc2VydmVyLCBpZiB3ZSBjYW4uXG4vL1xuLy8gT25seSBvbmUgb3BlcmF0aW9uIGNhbiBiZSBpbi1mbGlnaHQgYXQgYSB0aW1lLiBJZiBhbiBvcGVyYXRpb24gaXMgYWxyZWFkeSBvblxuLy8gaXRzIHdheSwgb3Igd2UncmUgbm90IGN1cnJlbnRseSBjb25uZWN0ZWQsIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZy5cbkRvYy5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbigpIHtcbiAgLy8gSWdub3JlIGlmIHdlIGNhbid0IHNlbmQgb3Igd2UgYXJlIGFscmVhZHkgc2VuZGluZyBhbiBvcFxuICBpZiAoIXRoaXMuY29ubmVjdGlvbi5jYW5TZW5kIHx8IHRoaXMuaW5mbGlnaHRPcCkgcmV0dXJuO1xuXG4gIC8vIFNlbmQgZmlyc3QgcGVuZGluZyBvcCB1bmxlc3MgcGF1c2VkXG4gIGlmICghdGhpcy5wYXVzZWQgJiYgdGhpcy5wZW5kaW5nT3BzLmxlbmd0aCkge1xuICAgIHRoaXMuX3NlbmRPcCgpO1xuICB9XG59O1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gc2V0IG9wIHRvIGNvbnRhaW4gYSBuby1vcC5cbmZ1bmN0aW9uIHNldE5vT3Aob3ApIHtcbiAgZGVsZXRlIG9wLm9wO1xuICBkZWxldGUgb3AuY3JlYXRlO1xuICBkZWxldGUgb3AuZGVsO1xufVxuXG4vLyBUcmFuc2Zvcm0gc2VydmVyIG9wIGRhdGEgYnkgYSBjbGllbnQgb3AsIGFuZCB2aWNlIHZlcnNhLiBPcHMgYXJlIGVkaXRlZCBpbiBwbGFjZS5cbmZ1bmN0aW9uIHRyYW5zZm9ybVgoY2xpZW50LCBzZXJ2ZXIpIHtcbiAgLy8gT3JkZXIgb2Ygc3RhdGVtZW50cyBpbiB0aGlzIGZ1bmN0aW9uIG1hdHRlcnMuIEJlIGVzcGVjaWFsbHkgY2FyZWZ1bCBpZlxuICAvLyByZWZhY3RvcmluZyB0aGlzIGZ1bmN0aW9uXG5cbiAgLy8gQSBjbGllbnQgZGVsZXRlIG9wIHNob3VsZCBkb21pbmF0ZSBpZiBib3RoIHRoZSBzZXJ2ZXIgYW5kIHRoZSBjbGllbnRcbiAgLy8gZGVsZXRlIHRoZSBkb2N1bWVudC4gVGh1cywgYW55IG9wcyBmb2xsb3dpbmcgdGhlIGNsaWVudCBkZWxldGUgKHN1Y2ggYXMgYVxuICAvLyBzdWJzZXF1ZW50IGNyZWF0ZSkgd2lsbCBiZSBtYWludGFpbmVkLCBzaW5jZSB0aGUgc2VydmVyIG9wIGlzIHRyYW5zZm9ybWVkXG4gIC8vIHRvIGEgbm8tb3BcbiAgaWYgKGNsaWVudC5kZWwpIHJldHVybiBzZXROb09wKHNlcnZlcik7XG5cbiAgaWYgKHNlcnZlci5kZWwpIHtcbiAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfV0FTX0RFTEVURUQsICdEb2N1bWVudCB3YXMgZGVsZXRlZCcpO1xuICB9XG4gIGlmIChzZXJ2ZXIuY3JlYXRlKSB7XG4gICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfRE9DX0FMUkVBRFlfQ1JFQVRFRCwgJ0RvY3VtZW50IGFscmVhZHkgY3JlYXRlZCcpO1xuICB9XG5cbiAgLy8gSWdub3JlIG5vLW9wIGNvbWluZyBmcm9tIHNlcnZlclxuICBpZiAoISgnb3AnIGluIHNlcnZlcikpIHJldHVybjtcblxuICAvLyBJIGJlbGlldmUgdGhhdCB0aGlzIHNob3VsZCBub3Qgb2NjdXIsIGJ1dCBjaGVjayBqdXN0IGluIGNhc2VcbiAgaWYgKGNsaWVudC5jcmVhdGUpIHtcbiAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfQUxSRUFEWV9DUkVBVEVELCAnRG9jdW1lbnQgYWxyZWFkeSBjcmVhdGVkJyk7XG4gIH1cblxuICAvLyBUaGV5IGJvdGggZWRpdGVkIHRoZSBkb2N1bWVudC4gVGhpcyBpcyB0aGUgbm9ybWFsIGNhc2UgZm9yIHRoaXMgZnVuY3Rpb24gLVxuICAvLyBhcyBpbiwgbW9zdCBvZiB0aGUgdGltZSB3ZSdsbCBlbmQgdXAgZG93biBoZXJlLlxuICAvL1xuICAvLyBZb3Ugc2hvdWxkIGJlIHdvbmRlcmluZyB3aHkgSSdtIHVzaW5nIGNsaWVudC50eXBlIGluc3RlYWQgb2YgdGhpcy50eXBlLlxuICAvLyBUaGUgcmVhc29uIGlzLCBpZiB3ZSBnZXQgb3BzIGF0IGFuIG9sZCB2ZXJzaW9uIG9mIHRoZSBkb2N1bWVudCwgdGhpcy50eXBlXG4gIC8vIG1pZ2h0IGJlIHVuZGVmaW5lZCBvciBhIHRvdGFsbHkgZGlmZmVyZW50IHR5cGUuIEJ5IHBpbm5pbmcgdGhlIHR5cGUgdG8gdGhlXG4gIC8vIG9wIGRhdGEsIHdlIG1ha2Ugc3VyZSB0aGUgcmlnaHQgdHlwZSBoYXMgaXRzIHRyYW5zZm9ybSBmdW5jdGlvbiBjYWxsZWQuXG4gIGlmIChjbGllbnQudHlwZS50cmFuc2Zvcm1YKSB7XG4gICAgdmFyIHJlc3VsdCA9IGNsaWVudC50eXBlLnRyYW5zZm9ybVgoY2xpZW50Lm9wLCBzZXJ2ZXIub3ApO1xuICAgIGNsaWVudC5vcCA9IHJlc3VsdFswXTtcbiAgICBzZXJ2ZXIub3AgPSByZXN1bHRbMV07XG4gIH0gZWxzZSB7XG4gICAgdmFyIGNsaWVudE9wID0gY2xpZW50LnR5cGUudHJhbnNmb3JtKGNsaWVudC5vcCwgc2VydmVyLm9wLCAnbGVmdCcpO1xuICAgIHZhciBzZXJ2ZXJPcCA9IGNsaWVudC50eXBlLnRyYW5zZm9ybShzZXJ2ZXIub3AsIGNsaWVudC5vcCwgJ3JpZ2h0Jyk7XG4gICAgY2xpZW50Lm9wID0gY2xpZW50T3A7XG4gICAgc2VydmVyLm9wID0gc2VydmVyT3A7XG4gIH1cbn07XG5cbi8qKlxuICogQXBwbGllcyB0aGUgb3BlcmF0aW9uIHRvIHRoZSBzbmFwc2hvdFxuICpcbiAqIElmIHRoZSBvcGVyYXRpb24gaXMgY3JlYXRlIG9yIGRlbGV0ZSBpdCBlbWl0cyBgY3JlYXRlYCBvciBgZGVsYC4gVGhlbiB0aGVcbiAqIG9wZXJhdGlvbiBpcyBhcHBsaWVkIHRvIHRoZSBzbmFwc2hvdCBhbmQgYG9wYCBhbmQgYGFmdGVyIG9wYCBhcmUgZW1pdHRlZC5cbiAqIElmIHRoZSB0eXBlIHN1cHBvcnRzIGluY3JlbWVudGFsIHVwZGF0ZXMgYW5kIGB0aGlzLmluY3JlbWVudGFsYCBpcyB0cnVlIHdlXG4gKiBmaXJlIGBvcGAgYWZ0ZXIgZXZlcnkgc21hbGwgb3BlcmF0aW9uLlxuICpcbiAqIFRoaXMgaXMgdGhlIG9ubHkgZnVuY3Rpb24gdG8gZmlyZSB0aGUgYWJvdmUgbWVudGlvbmVkIGV2ZW50cy5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5Eb2MucHJvdG90eXBlLl9vdEFwcGx5ID0gZnVuY3Rpb24ob3AsIHNvdXJjZSkge1xuICBpZiAoJ29wJyBpbiBvcCkge1xuICAgIGlmICghdGhpcy50eXBlKSB7XG4gICAgICAvLyBUaHJvdyBoZXJlLCBiZWNhdXNlIGFsbCB1c2FnZSBvZiBfb3RBcHBseSBzaG91bGQgYmUgd3JhcHBlZCB3aXRoIGEgdHJ5L2NhdGNoXG4gICAgICB0aHJvdyBuZXcgU2hhcmVEQkVycm9yKFxuICAgICAgICBFUlJPUl9DT0RFLkVSUl9ET0NfRE9FU19OT1RfRVhJU1QsXG4gICAgICAgICdDYW5ub3QgYXBwbHkgb3AgdG8gdW5jcmVhdGVkIGRvY3VtZW50LiAnICsgdGhpcy5jb2xsZWN0aW9uICsgJy4nICsgdGhpcy5pZFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBOQjogSWYgd2UgbmVlZCB0byBhZGQgYW5vdGhlciBhcmd1bWVudCB0byB0aGlzIGV2ZW50LCB3ZSBzaG91bGQgY29uc2lkZXJcbiAgICAvLyB0aGUgZmFjdCB0aGF0IHRoZSAnb3AnIGV2ZW50IGhhcyBvcC5zcmMgYXMgaXRzIDNyZCBhcmd1bWVudFxuICAgIHRoaXMuZW1pdCgnYmVmb3JlIG9wIGJhdGNoJywgb3Aub3AsIHNvdXJjZSk7XG5cbiAgICAvLyBJdGVyYXRpdmVseSBhcHBseSBtdWx0aS1jb21wb25lbnQgcmVtb3RlIG9wZXJhdGlvbnMgYW5kIHJvbGxiYWNrIG9wc1xuICAgIC8vIChzb3VyY2UgPT09IGZhbHNlKSBmb3IgdGhlIGRlZmF1bHQgSlNPTjAgT1QgdHlwZS4gSXQgY291bGQgdXNlXG4gICAgLy8gdHlwZS5zaGF0dGVyKCksIGJ1dCBzaW5jZSB0aGlzIGNvZGUgaXMgc28gc3BlY2lmaWMgdG8gdXNlIGNhc2VzIGZvciB0aGVcbiAgICAvLyBKU09OMCB0eXBlIGFuZCBTaGFyZURCIGV4cGxpY2l0bHkgYnVuZGxlcyB0aGUgZGVmYXVsdCB0eXBlLCB3ZSBtaWdodCBhc1xuICAgIC8vIHdlbGwgd3JpdGUgaXQgdGhpcyB3YXkgYW5kIHNhdmUgbmVlZGluZyB0byBpdGVyYXRlIHRocm91Z2ggdGhlIG9wXG4gICAgLy8gY29tcG9uZW50cyB0d2ljZS5cbiAgICAvL1xuICAgIC8vIElkZWFsbHksIHdlIHdvdWxkIG5vdCBuZWVkIHRoaXMgZXh0cmEgY29tcGxleGl0eS4gSG93ZXZlciwgaXQgaXNcbiAgICAvLyBoZWxwZnVsIGZvciBpbXBsZW1lbnRpbmcgYmluZGluZ3MgdGhhdCB1cGRhdGUgRE9NIG5vZGVzIGFuZCBvdGhlclxuICAgIC8vIHN0YXRlZnVsIG9iamVjdHMgYnkgdHJhbnNsYXRpbmcgb3AgZXZlbnRzIGRpcmVjdGx5IGludG8gY29ycmVzcG9uZGluZ1xuICAgIC8vIG11dGF0aW9ucy4gU3VjaCBiaW5kaW5ncyBhcmUgbW9zdCBlYXNpbHkgd3JpdHRlbiBhcyByZXNwb25kaW5nIHRvXG4gICAgLy8gaW5kaXZpZHVhbCBvcCBjb21wb25lbnRzIG9uZSBhdCBhIHRpbWUgaW4gb3JkZXIsIGFuZCBpdCBpcyBpbXBvcnRhbnRcbiAgICAvLyB0aGF0IHRoZSBzbmFwc2hvdCBvbmx5IGluY2x1ZGUgdXBkYXRlcyBmcm9tIHRoZSBwYXJ0aWN1bGFyIG9wIGNvbXBvbmVudFxuICAgIC8vIGF0IHRoZSB0aW1lIG9mIGVtaXNzaW9uLiBFbGltaW5hdGluZyB0aGlzIHdvdWxkIHJlcXVpcmUgcmV0aGlua2luZyBob3dcbiAgICAvLyBzdWNoIGV4dGVybmFsIGJpbmRpbmdzIGFyZSBpbXBsZW1lbnRlZC5cbiAgICBpZiAoIXNvdXJjZSAmJiB0aGlzLnR5cGUgPT09IHR5cGVzLmRlZmF1bHRUeXBlICYmIG9wLm9wLmxlbmd0aCA+IDEpIHtcbiAgICAgIGlmICghdGhpcy5hcHBseVN0YWNrKSB0aGlzLmFwcGx5U3RhY2sgPSBbXTtcbiAgICAgIHZhciBzdGFja0xlbmd0aCA9IHRoaXMuYXBwbHlTdGFjay5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wLm9wLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBjb21wb25lbnQgPSBvcC5vcFtpXTtcbiAgICAgICAgdmFyIGNvbXBvbmVudE9wID0ge29wOiBbY29tcG9uZW50XX07XG4gICAgICAgIC8vIEFwcGx5IHRoZSBpbmRpdmlkdWFsIG9wIGNvbXBvbmVudFxuICAgICAgICB0aGlzLmVtaXQoJ2JlZm9yZSBvcCcsIGNvbXBvbmVudE9wLm9wLCBzb3VyY2UsIG9wLnNyYyk7XG4gICAgICAgIC8vIFRyYW5zZm9ybSBjb21wb25lbnRPcCBhZ2FpbnN0IGFueSBvcHMgdGhhdCBoYXZlIGJlZW4gc3VibWl0dGVkXG4gICAgICAgIC8vIHN5Y2hyb25vdXNseSBpbnNpZGUgb2YgYW4gb3AgZXZlbnQgaGFuZGxlciBzaW5jZSB3ZSBiZWdhbiBhcHBseSBvZlxuICAgICAgICAvLyBvdXIgb3BlcmF0aW9uXG4gICAgICAgIGZvciAodmFyIGogPSBzdGFja0xlbmd0aDsgaiA8IHRoaXMuYXBwbHlTdGFjay5sZW5ndGg7IGorKykge1xuICAgICAgICAgIHZhciB0cmFuc2Zvcm1FcnIgPSB0cmFuc2Zvcm1YKHRoaXMuYXBwbHlTdGFja1tqXSwgY29tcG9uZW50T3ApO1xuICAgICAgICAgIGlmICh0cmFuc2Zvcm1FcnIpIHJldHVybiB0aGlzLl9oYXJkUm9sbGJhY2sodHJhbnNmb3JtRXJyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zZXREYXRhKHRoaXMudHlwZS5hcHBseSh0aGlzLmRhdGEsIGNvbXBvbmVudE9wLm9wKSk7XG4gICAgICAgIHRoaXMuZW1pdCgnb3AnLCBjb21wb25lbnRPcC5vcCwgc291cmNlLCBvcC5zcmMpO1xuICAgICAgfVxuICAgICAgdGhpcy5lbWl0KCdvcCBiYXRjaCcsIG9wLm9wLCBzb3VyY2UpO1xuICAgICAgLy8gUG9wIHdoYXRldmVyIHdhcyBzdWJtaXR0ZWQgc2luY2Ugd2Ugc3RhcnRlZCBhcHBseWluZyB0aGlzIG9wXG4gICAgICB0aGlzLl9wb3BBcHBseVN0YWNrKHN0YWNrTGVuZ3RoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUaGUgJ2JlZm9yZSBvcCcgZXZlbnQgZW5hYmxlcyBjbGllbnRzIHRvIHB1bGwgYW55IG5lY2Vzc2FyeSBkYXRhIG91dCBvZlxuICAgIC8vIHRoZSBzbmFwc2hvdCBiZWZvcmUgaXQgZ2V0cyBjaGFuZ2VkXG4gICAgdGhpcy5lbWl0KCdiZWZvcmUgb3AnLCBvcC5vcCwgc291cmNlLCBvcC5zcmMpO1xuICAgIC8vIEFwcGx5IHRoZSBvcGVyYXRpb24gdG8gdGhlIGxvY2FsIGRhdGEsIG11dGF0aW5nIGl0IGluIHBsYWNlXG4gICAgdGhpcy5fc2V0RGF0YSh0aGlzLnR5cGUuYXBwbHkodGhpcy5kYXRhLCBvcC5vcCkpO1xuICAgIC8vIEVtaXQgYW4gJ29wJyBldmVudCBvbmNlIHRoZSBsb2NhbCBkYXRhIGluY2x1ZGVzIHRoZSBjaGFuZ2VzIGZyb20gdGhlXG4gICAgLy8gb3AuIEZvciBsb2NhbGx5IHN1Ym1pdHRlZCBvcHMsIHRoaXMgd2lsbCBiZSBzeW5jaHJvbm91c2x5IHdpdGhcbiAgICAvLyBzdWJtaXNzaW9uIGFuZCBiZWZvcmUgdGhlIHNlcnZlciBvciBvdGhlciBjbGllbnRzIGhhdmUgcmVjZWl2ZWQgdGhlIG9wLlxuICAgIC8vIEZvciBvcHMgZnJvbSBvdGhlciBjbGllbnRzLCB0aGlzIHdpbGwgYmUgYWZ0ZXIgdGhlIG9wIGhhcyBiZWVuXG4gICAgLy8gY29tbWl0dGVkIHRvIHRoZSBkYXRhYmFzZSBhbmQgcHVibGlzaGVkXG4gICAgdGhpcy5lbWl0KCdvcCcsIG9wLm9wLCBzb3VyY2UsIG9wLnNyYyk7XG4gICAgdGhpcy5lbWl0KCdvcCBiYXRjaCcsIG9wLm9wLCBzb3VyY2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChvcC5jcmVhdGUpIHtcbiAgICB0aGlzLl9zZXRUeXBlKG9wLmNyZWF0ZS50eXBlKTtcbiAgICBpZiAodGhpcy50eXBlLmRlc2VyaWFsaXplKSB7XG4gICAgICBpZiAodGhpcy50eXBlLmNyZWF0ZURlc2VyaWFsaXplZCkge1xuICAgICAgICB0aGlzLl9zZXREYXRhKHRoaXMudHlwZS5jcmVhdGVEZXNlcmlhbGl6ZWQob3AuY3JlYXRlLmRhdGEpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3NldERhdGEodGhpcy50eXBlLmRlc2VyaWFsaXplKHRoaXMudHlwZS5jcmVhdGUob3AuY3JlYXRlLmRhdGEpKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldERhdGEodGhpcy50eXBlLmNyZWF0ZShvcC5jcmVhdGUuZGF0YSkpO1xuICAgIH1cbiAgICB0aGlzLmVtaXQoJ2NyZWF0ZScsIHNvdXJjZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKG9wLmRlbCkge1xuICAgIHZhciBvbGREYXRhID0gdGhpcy5kYXRhO1xuICAgIHRoaXMuX3NldFR5cGUobnVsbCk7XG4gICAgdGhpcy5lbWl0KCdkZWwnLCBvbGREYXRhLCBzb3VyY2UpO1xuICAgIHJldHVybjtcbiAgfVxufTtcblxuXG4vLyAqKioqKiBTZW5kaW5nIG9wZXJhdGlvbnNcblxuLy8gQWN0dWFsbHkgc2VuZCBvcCB0byB0aGUgc2VydmVyLlxuRG9jLnByb3RvdHlwZS5fc2VuZE9wID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5jb25uZWN0aW9uLmNhblNlbmQpIHJldHVybjtcbiAgdmFyIHNyYyA9IHRoaXMuY29ubmVjdGlvbi5pZDtcblxuICAvLyBXaGVuIHRoZXJlIGlzIG5vIGluZmxpZ2h0T3AsIHNlbmQgdGhlIGZpcnN0IGl0ZW0gaW4gcGVuZGluZ09wcy4gSWZcbiAgLy8gdGhlcmUgaXMgaW5mbGlnaHRPcCwgdHJ5IHNlbmRpbmcgaXQgYWdhaW5cbiAgaWYgKCF0aGlzLmluZmxpZ2h0T3ApIHtcbiAgICAvLyBTZW5kIGZpcnN0IHBlbmRpbmcgb3BcbiAgICB0aGlzLmluZmxpZ2h0T3AgPSB0aGlzLnBlbmRpbmdPcHMuc2hpZnQoKTtcbiAgfVxuICB2YXIgb3AgPSB0aGlzLmluZmxpZ2h0T3A7XG4gIGlmICghb3ApIHtcbiAgICB2YXIgZXJyID0gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9JTkZMSUdIVF9PUF9NSVNTSU5HLCAnTm8gb3AgdG8gc2VuZCBvbiBjYWxsIHRvIF9zZW5kT3AnKTtcbiAgICByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsIGVycik7XG4gIH1cblxuICAvLyBUcmFjayBkYXRhIGZvciByZXRyeWluZyBvcHNcbiAgb3Auc2VudEF0ID0gRGF0ZS5ub3coKTtcbiAgb3AucmV0cmllcyA9IChvcC5yZXRyaWVzID09IG51bGwpID8gMCA6IG9wLnJldHJpZXMgKyAxO1xuXG4gIC8vIFRoZSBzcmMgKyBzZXEgbnVtYmVyIGlzIGEgdW5pcXVlIElEIHJlcHJlc2VudGluZyB0aGlzIG9wZXJhdGlvbi4gVGhpcyB0dXBsZVxuICAvLyBpcyB1c2VkIG9uIHRoZSBzZXJ2ZXIgdG8gZGV0ZWN0IHdoZW4gb3BzIGhhdmUgYmVlbiBzZW50IG11bHRpcGxlIHRpbWVzIGFuZFxuICAvLyBvbiB0aGUgY2xpZW50IHRvIG1hdGNoIGFja25vd2xlZGdlbWVudCBvZiBhbiBvcCBiYWNrIHRvIHRoZSBpbmZsaWdodE9wLlxuICAvLyBOb3RlIHRoYXQgdGhlIHNyYyBjb3VsZCBiZSBkaWZmZXJlbnQgZnJvbSB0aGlzLmNvbm5lY3Rpb24uaWQgYWZ0ZXIgYVxuICAvLyByZWNvbm5lY3QsIHNpbmNlIGFuIG9wIG1heSBzdGlsbCBiZSBwZW5kaW5nIGFmdGVyIHRoZSByZWNvbm5lY3Rpb24gYW5kXG4gIC8vIHRoaXMuY29ubmVjdGlvbi5pZCB3aWxsIGNoYW5nZS4gSW4gY2FzZSBhbiBvcCBpcyBzZW50IG11bHRpcGxlIHRpbWVzLCB3ZVxuICAvLyBhbHNvIG5lZWQgdG8gYmUgY2FyZWZ1bCBub3QgdG8gb3ZlcnJpZGUgdGhlIG9yaWdpbmFsIHNlcSB2YWx1ZS5cbiAgaWYgKG9wLnNlcSA9PSBudWxsKSB7XG4gICAgaWYgKHRoaXMuY29ubmVjdGlvbi5zZXEgPj0gdXRpbC5NQVhfU0FGRV9JTlRFR0VSKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsIG5ldyBTaGFyZURCRXJyb3IoXG4gICAgICAgIEVSUk9SX0NPREUuRVJSX0NPTk5FQ1RJT05fU0VRX0lOVEVHRVJfT1ZFUkZMT1csXG4gICAgICAgICdDb25uZWN0aW9uIHNlcSBoYXMgZXhjZWVkZWQgdGhlIG1heCBzYWZlIGludGVnZXIsIG1heWJlIGZyb20gYmVpbmcgb3BlbiBmb3IgdG9vIGxvbmcnXG4gICAgICApKTtcbiAgICB9XG5cbiAgICBvcC5zZXEgPSB0aGlzLmNvbm5lY3Rpb24uc2VxKys7XG4gIH1cblxuICB0aGlzLmNvbm5lY3Rpb24uc2VuZE9wKHRoaXMsIG9wKTtcblxuICAvLyBzcmMgaXNuJ3QgbmVlZGVkIG9uIHRoZSBmaXJzdCB0cnksIHNpbmNlIHRoZSBzZXJ2ZXIgc2Vzc2lvbiB3aWxsIGhhdmUgdGhlXG4gIC8vIHNhbWUgaWQsIGJ1dCBpdCBtdXN0IGJlIHNldCBvbiB0aGUgaW5mbGlnaHRPcCBpbiBjYXNlIGl0IGlzIHNlbnQgYWdhaW5cbiAgLy8gYWZ0ZXIgYSByZWNvbm5lY3QgYW5kIHRoZSBjb25uZWN0aW9uJ3MgaWQgaGFzIGNoYW5nZWQgYnkgdGhlblxuICBpZiAob3Auc3JjID09IG51bGwpIG9wLnNyYyA9IHNyYztcbn07XG5cblxuLy8gUXVldWVzIHRoZSBvcGVyYXRpb24gZm9yIHN1Ym1pc3Npb24gdG8gdGhlIHNlcnZlciBhbmQgYXBwbGllcyBpdCBsb2NhbGx5LlxuLy9cbi8vIEludGVybmFsIG1ldGhvZCBjYWxsZWQgdG8gZG8gdGhlIGFjdHVhbCB3b3JrIGZvciBzdWJtaXQoKSwgY3JlYXRlKCkgYW5kIGRlbCgpLlxuLy8gQHByaXZhdGVcbi8vXG4vLyBAcGFyYW0gb3Bcbi8vIEBwYXJhbSBbb3Aub3BdXG4vLyBAcGFyYW0gW29wLmRlbF1cbi8vIEBwYXJhbSBbb3AuY3JlYXRlXVxuLy8gQHBhcmFtIFtjYWxsYmFja10gY2FsbGVkIHdoZW4gb3BlcmF0aW9uIGlzIHN1Ym1pdHRlZFxuRG9jLnByb3RvdHlwZS5fc3VibWl0ID0gZnVuY3Rpb24ob3AsIHNvdXJjZSwgY2FsbGJhY2spIHtcbiAgLy8gTG9jYWxseSBzdWJtaXR0ZWQgb3BzIG11c3QgYWx3YXlzIGhhdmUgYSB0cnV0aHkgc291cmNlXG4gIGlmICghc291cmNlKSBzb3VyY2UgPSB0cnVlO1xuXG4gIC8vIFRoZSBvcCBjb250YWlucyBlaXRoZXIgb3AsIGNyZWF0ZSwgZGVsZXRlLCBvciBub25lIG9mIHRoZSBhYm92ZSAoYSBuby1vcCkuXG4gIGlmICgnb3AnIGluIG9wKSB7XG4gICAgaWYgKCF0aGlzLnR5cGUpIHtcbiAgICAgIGlmICh0aGlzLl9pc0luSGFyZFJvbGxiYWNrKSB7XG4gICAgICAgIHZhciBlcnIgPSBuZXcgU2hhcmVEQkVycm9yKFxuICAgICAgICAgIEVSUk9SX0NPREUuRVJSX0RPQ19JTl9IQVJEX1JPTExCQUNLLFxuICAgICAgICAgICdDYW5ub3Qgc3VibWl0IG9wLiBEb2N1bWVudCBpcyBwZXJmb3JtaW5nIGhhcmQgcm9sbGJhY2suICcgKyB0aGlzLmNvbGxlY3Rpb24gKyAnLicgKyB0aGlzLmlkXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZXJyID0gbmV3IFNoYXJlREJFcnJvcihcbiAgICAgICAgICBFUlJPUl9DT0RFLkVSUl9ET0NfRE9FU19OT1RfRVhJU1QsXG4gICAgICAgICAgJ0Nhbm5vdCBzdWJtaXQgb3AuIERvY3VtZW50IGhhcyBub3QgYmVlbiBjcmVhdGVkLiAnICsgdGhpcy5jb2xsZWN0aW9uICsgJy4nICsgdGhpcy5pZFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2spIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgIH1cbiAgICAvLyBUcnkgdG8gbm9ybWFsaXplIHRoZSBvcC4gVGhpcyByZW1vdmVzIHRyYWlsaW5nIHNraXA6MCdzIGFuZCB0aGluZ3MgbGlrZSB0aGF0LlxuICAgIGlmICh0aGlzLnR5cGUubm9ybWFsaXplKSBvcC5vcCA9IHRoaXMudHlwZS5ub3JtYWxpemUob3Aub3ApO1xuICB9XG5cbiAgdHJ5IHtcbiAgICB0aGlzLl9wdXNoT3Aob3AsIHNvdXJjZSwgY2FsbGJhY2spO1xuICAgIHRoaXMuX290QXBwbHkob3AsIHNvdXJjZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hhcmRSb2xsYmFjayhlcnJvcik7XG4gIH1cblxuICAvLyBUaGUgY2FsbCB0byBmbHVzaCBpcyBkZWxheWVkIHNvIGlmIHN1Ym1pdCgpIGlzIGNhbGxlZCBtdWx0aXBsZSB0aW1lc1xuICAvLyBzeW5jaHJvbm91c2x5LCBhbGwgdGhlIG9wcyBhcmUgY29tYmluZWQgYmVmb3JlIGJlaW5nIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAgdmFyIGRvYyA9IHRoaXM7XG4gIHV0aWwubmV4dFRpY2soZnVuY3Rpb24oKSB7XG4gICAgZG9jLmZsdXNoKCk7XG4gIH0pO1xufTtcblxuRG9jLnByb3RvdHlwZS5fcHVzaE9wID0gZnVuY3Rpb24ob3AsIHNvdXJjZSwgY2FsbGJhY2spIHtcbiAgb3Auc291cmNlID0gc291cmNlO1xuICBpZiAodGhpcy5hcHBseVN0YWNrKSB7XG4gICAgLy8gSWYgd2UgYXJlIGluIHRoZSBwcm9jZXNzIG9mIGluY3JlbWVudGFsbHkgYXBwbHlpbmcgYW4gb3BlcmF0aW9uLCBkb24ndFxuICAgIC8vIGNvbXBvc2UgdGhlIG9wIGFuZCBwdXNoIGl0IG9udG8gdGhlIGFwcGx5U3RhY2sgc28gaXQgY2FuIGJlIHRyYW5zZm9ybWVkXG4gICAgLy8gYWdhaW5zdCBvdGhlciBjb21wb25lbnRzIGZyb20gdGhlIG9wIG9yIG9wcyBiZWluZyBhcHBsaWVkXG4gICAgdGhpcy5hcHBseVN0YWNrLnB1c2gob3ApO1xuICB9IGVsc2Uge1xuICAgIC8vIElmIHRoZSB0eXBlIHN1cHBvcnRzIGNvbXBvc2VzLCB0cnkgdG8gY29tcG9zZSB0aGUgb3BlcmF0aW9uIG9udG8gdGhlXG4gICAgLy8gZW5kIG9mIHRoZSBsYXN0IHBlbmRpbmcgb3BlcmF0aW9uLlxuICAgIHZhciBjb21wb3NlZCA9IHRoaXMuX3RyeUNvbXBvc2Uob3ApO1xuICAgIGlmIChjb21wb3NlZCkge1xuICAgICAgY29tcG9zZWQuY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICAvLyBQdXNoIG9uIHRvIHRoZSBwZW5kaW5nT3BzIHF1ZXVlIG9mIG9wcyB0byBzdWJtaXQgaWYgd2UgZGlkbid0IGNvbXBvc2VcbiAgb3AudHlwZSA9IHRoaXMudHlwZTtcbiAgb3AuY2FsbGJhY2tzID0gW2NhbGxiYWNrXTtcbiAgdGhpcy5wZW5kaW5nT3BzLnB1c2gob3ApO1xufTtcblxuRG9jLnByb3RvdHlwZS5fcG9wQXBwbHlTdGFjayA9IGZ1bmN0aW9uKHRvKSB7XG4gIGlmICh0byA+IDApIHtcbiAgICB0aGlzLmFwcGx5U3RhY2subGVuZ3RoID0gdG87XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIE9uY2Ugd2UgaGF2ZSBjb21wbGV0ZWQgdGhlIG91dGVybW9zdCBhcHBseSBsb29wLCByZXNldCB0byBudWxsIGFuZCBub1xuICAvLyBsb25nZXIgYWRkIG9wcyB0byB0aGUgYXBwbHlTdGFjayBhcyB0aGV5IGFyZSBzdWJtaXR0ZWRcbiAgdmFyIG9wID0gdGhpcy5hcHBseVN0YWNrWzBdO1xuICB0aGlzLmFwcGx5U3RhY2sgPSBudWxsO1xuICBpZiAoIW9wKSByZXR1cm47XG4gIC8vIENvbXBvc2UgdGhlIG9wcyBhZGRlZCBzaW5jZSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBhcHBseSBzdGFjaywgc2luY2Ugd2VcbiAgLy8gaGFkIHRvIHNraXAgY29tcG9zZSB3aGVuIHRoZXkgd2VyZSBvcmlnaW5hbGx5IHB1c2hlZFxuICB2YXIgaSA9IHRoaXMucGVuZGluZ09wcy5pbmRleE9mKG9wKTtcbiAgaWYgKGkgPT09IC0xKSByZXR1cm47XG4gIHZhciBvcHMgPSB0aGlzLnBlbmRpbmdPcHMuc3BsaWNlKGkpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG9wcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBvcCA9IG9wc1tpXTtcbiAgICB2YXIgY29tcG9zZWQgPSB0aGlzLl90cnlDb21wb3NlKG9wKTtcbiAgICBpZiAoY29tcG9zZWQpIHtcbiAgICAgIGNvbXBvc2VkLmNhbGxiYWNrcyA9IGNvbXBvc2VkLmNhbGxiYWNrcy5jb25jYXQob3AuY2FsbGJhY2tzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wZW5kaW5nT3BzLnB1c2gob3ApO1xuICAgIH1cbiAgfVxufTtcblxuLy8gVHJ5IHRvIGNvbXBvc2UgYSBzdWJtaXR0ZWQgb3AgaW50byB0aGUgbGFzdCBwZW5kaW5nIG9wLiBSZXR1cm5zIHRoZVxuLy8gY29tcG9zZWQgb3AgaWYgaXQgc3VjY2VlZHMsIHVuZGVmaW5lZCBvdGhlcndpc2VcbkRvYy5wcm90b3R5cGUuX3RyeUNvbXBvc2UgPSBmdW5jdGlvbihvcCkge1xuICBpZiAodGhpcy5wcmV2ZW50Q29tcG9zZSkgcmV0dXJuO1xuXG4gIC8vIFdlIGNhbiBvbmx5IGNvbXBvc2UgaW50byB0aGUgbGFzdCBwZW5kaW5nIG9wLiBJbmZsaWdodCBvcHMgaGF2ZSBhbHJlYWR5XG4gIC8vIGJlZW4gc2VudCB0byB0aGUgc2VydmVyLCBzbyB3ZSBjYW4ndCBtb2RpZnkgdGhlbVxuICB2YXIgbGFzdCA9IHRoaXMucGVuZGluZ09wc1t0aGlzLnBlbmRpbmdPcHMubGVuZ3RoIC0gMV07XG4gIGlmICghbGFzdCB8fCBsYXN0LnNlbnRBdCkgcmV0dXJuO1xuXG4gIC8vIElmIHdlJ3JlIHN1Ym1pdHRpbmcgdGhlIG9wIHNvdXJjZSwgd2UgY2FuIG9ubHkgY29tYmluZSBvcHMgdGhhdCBoYXZlXG4gIC8vIGEgbWF0Y2hpbmcgc291cmNlXG4gIGlmICh0aGlzLnN1Ym1pdFNvdXJjZSAmJiAhZGVlcEVxdWFsKG9wLnNvdXJjZSwgbGFzdC5zb3VyY2UpKSByZXR1cm47XG5cbiAgLy8gQ29tcG9zZSBhbiBvcCBpbnRvIGEgY3JlYXRlIGJ5IGFwcGx5aW5nIGl0LiBUaGlzIGVmZmVjdGl2ZWx5IG1ha2VzIHRoZSBvcFxuICAvLyBpbnZpc2libGUsIGFzIGlmIHRoZSBkb2N1bWVudCB3ZXJlIGNyZWF0ZWQgaW5jbHVkaW5nIHRoZSBvcCBvcmlnaW5hbGx5XG4gIGlmIChsYXN0LmNyZWF0ZSAmJiAnb3AnIGluIG9wKSB7XG4gICAgbGFzdC5jcmVhdGUuZGF0YSA9IHRoaXMudHlwZS5hcHBseShsYXN0LmNyZWF0ZS5kYXRhLCBvcC5vcCk7XG4gICAgcmV0dXJuIGxhc3Q7XG4gIH1cblxuICAvLyBDb21wb3NlIHR3byBvcHMgaW50byBhIHNpbmdsZSBvcCBpZiBzdXBwb3J0ZWQgYnkgdGhlIHR5cGUuIFR5cGVzIHRoYXRcbiAgLy8gc3VwcG9ydCBjb21wb3NlIG11c3QgYmUgYWJsZSB0byBjb21wb3NlIGFueSB0d28gb3BzIHRvZ2V0aGVyXG4gIGlmICgnb3AnIGluIGxhc3QgJiYgJ29wJyBpbiBvcCAmJiB0aGlzLnR5cGUuY29tcG9zZSkge1xuICAgIGxhc3Qub3AgPSB0aGlzLnR5cGUuY29tcG9zZShsYXN0Lm9wLCBvcC5vcCk7XG4gICAgcmV0dXJuIGxhc3Q7XG4gIH1cbn07XG5cbi8vICoqKiBDbGllbnQgT1QgZW50cnlwb2ludHMuXG5cbi8vIFN1Ym1pdCBhbiBvcGVyYXRpb24gdG8gdGhlIGRvY3VtZW50LlxuLy9cbi8vIEBwYXJhbSBvcGVyYXRpb24gaGFuZGxlZCBieSB0aGUgT1QgdHlwZVxuLy8gQHBhcmFtIG9wdGlvbnMgIHtzb3VyY2U6IC4uLn1cbi8vIEBwYXJhbSBbY2FsbGJhY2tdIGNhbGxlZCBhZnRlciBvcGVyYXRpb24gc3VibWl0dGVkXG4vL1xuLy8gQGZpcmVzIGJlZm9yZSBvcCwgb3AsIGFmdGVyIG9wXG5Eb2MucHJvdG90eXBlLnN1Ym1pdE9wID0gZnVuY3Rpb24oY29tcG9uZW50LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IG51bGw7XG4gIH1cbiAgdmFyIG9wID0ge29wOiBjb21wb25lbnR9O1xuICB2YXIgc291cmNlID0gb3B0aW9ucyAmJiBvcHRpb25zLnNvdXJjZTtcbiAgdGhpcy5fc3VibWl0KG9wLCBzb3VyY2UsIGNhbGxiYWNrKTtcbn07XG5cbi8vIENyZWF0ZSB0aGUgZG9jdW1lbnQsIHdoaWNoIGluIFNoYXJlSlMgc2VtYW50aWNzIG1lYW5zIHRvIHNldCBpdHMgdHlwZS4gRXZlcnlcbi8vIG9iamVjdCBpbXBsaWNpdGx5IGV4aXN0cyBpbiB0aGUgZGF0YWJhc2UgYnV0IGhhcyBubyBkYXRhIGFuZCBubyB0eXBlLiBDcmVhdGVcbi8vIHNldHMgdGhlIHR5cGUgb2YgdGhlIG9iamVjdCBhbmQgY2FuIG9wdGlvbmFsbHkgc2V0IHNvbWUgaW5pdGlhbCBkYXRhIG9uIHRoZVxuLy8gb2JqZWN0LCBkZXBlbmRpbmcgb24gdGhlIHR5cGUuXG4vL1xuLy8gQHBhcmFtIGRhdGEgIGluaXRpYWxcbi8vIEBwYXJhbSB0eXBlICBPVCB0eXBlXG4vLyBAcGFyYW0gb3B0aW9ucyAge3NvdXJjZTogLi4ufVxuLy8gQHBhcmFtIGNhbGxiYWNrICBjYWxsZWQgd2hlbiBvcGVyYXRpb24gc3VibWl0dGVkXG5Eb2MucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmICh0eXBlb2YgdHlwZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNhbGxiYWNrID0gdHlwZTtcbiAgICBvcHRpb25zID0gbnVsbDtcbiAgICB0eXBlID0gbnVsbDtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0gbnVsbDtcbiAgfVxuICBpZiAoIXR5cGUpIHtcbiAgICB0eXBlID0gdHlwZXMuZGVmYXVsdFR5cGUudXJpO1xuICB9XG4gIGlmICh0aGlzLnR5cGUpIHtcbiAgICB2YXIgZXJyID0gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfQUxSRUFEWV9DUkVBVEVELCAnRG9jdW1lbnQgYWxyZWFkeSBleGlzdHMnKTtcbiAgICBpZiAoY2FsbGJhY2spIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgfVxuICB2YXIgb3AgPSB7Y3JlYXRlOiB7dHlwZTogdHlwZSwgZGF0YTogZGF0YX19O1xuICB2YXIgc291cmNlID0gb3B0aW9ucyAmJiBvcHRpb25zLnNvdXJjZTtcbiAgdGhpcy5fc3VibWl0KG9wLCBzb3VyY2UsIGNhbGxiYWNrKTtcbn07XG5cbi8vIERlbGV0ZSB0aGUgZG9jdW1lbnQuIFRoaXMgY3JlYXRlcyBhbmQgc3VibWl0cyBhIGRlbGV0ZSBvcGVyYXRpb24gdG8gdGhlXG4vLyBzZXJ2ZXIuIERlbGV0aW5nIHJlc2V0cyB0aGUgb2JqZWN0J3MgdHlwZSB0byBudWxsIGFuZCBkZWxldGVzIGl0cyBkYXRhLiBUaGVcbi8vIGRvY3VtZW50IHN0aWxsIGV4aXN0cywgYW5kIHN0aWxsIGhhcyB0aGUgdmVyc2lvbiBpdCB1c2VkIHRvIGhhdmUgYmVmb3JlIHlvdVxuLy8gZGVsZXRlZCBpdCAod2VsbCwgb2xkIHZlcnNpb24gKzEpLlxuLy9cbi8vIEBwYXJhbSBvcHRpb25zICB7c291cmNlOiAuLi59XG4vLyBAcGFyYW0gY2FsbGJhY2sgIGNhbGxlZCB3aGVuIG9wZXJhdGlvbiBzdWJtaXR0ZWRcbkRvYy5wcm90b3R5cGUuZGVsID0gZnVuY3Rpb24ob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgIG9wdGlvbnMgPSBudWxsO1xuICB9XG4gIGlmICghdGhpcy50eXBlKSB7XG4gICAgdmFyIGVyciA9IG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfRE9DX0RPRVNfTk9UX0VYSVNULCAnRG9jdW1lbnQgZG9lcyBub3QgZXhpc3QnKTtcbiAgICBpZiAoY2FsbGJhY2spIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgfVxuICB2YXIgb3AgPSB7ZGVsOiB0cnVlfTtcbiAgdmFyIHNvdXJjZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5zb3VyY2U7XG4gIHRoaXMuX3N1Ym1pdChvcCwgc291cmNlLCBjYWxsYmFjayk7XG59O1xuXG5cbi8vIFN0b3BzIHRoZSBkb2N1bWVudCBmcm9tIHNlbmRpbmcgYW55IG9wZXJhdGlvbnMgdG8gdGhlIHNlcnZlci5cbkRvYy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5wYXVzZWQgPSB0cnVlO1xufTtcblxuLy8gQ29udGludWUgc2VuZGluZyBvcGVyYXRpb25zIHRvIHRoZSBzZXJ2ZXJcbkRvYy5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucGF1c2VkID0gZmFsc2U7XG4gIHRoaXMuZmx1c2goKTtcbn07XG5cbi8vIENyZWF0ZSBhIHNuYXBzaG90IHRoYXQgY2FuIGJlIHNlcmlhbGl6ZWQsIGRlc2VyaWFsaXplZCwgYW5kIHBhc3NlZCBpbnRvIGBEb2MuaW5nZXN0U25hcHNob3RgLlxuRG9jLnByb3RvdHlwZS50b1NuYXBzaG90ID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB7XG4gICAgdjogdGhpcy52ZXJzaW9uLFxuICAgIGRhdGE6IGNsb25lKHRoaXMuZGF0YSksXG4gICAgdHlwZTogdGhpcy50eXBlLnVyaVxuICB9O1xufTtcblxuLy8gKioqIFJlY2VpdmluZyBvcGVyYXRpb25zXG5cbi8vIFRoaXMgaXMgY2FsbGVkIHdoZW4gdGhlIHNlcnZlciBhY2tub3dsZWRnZXMgYW4gb3BlcmF0aW9uIGZyb20gdGhlIGNsaWVudC5cbkRvYy5wcm90b3R5cGUuX29wQWNrbm93bGVkZ2VkID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICBpZiAodGhpcy5pbmZsaWdodE9wLmNyZWF0ZSkge1xuICAgIHRoaXMudmVyc2lvbiA9IG1lc3NhZ2UudjtcbiAgfSBlbHNlIGlmIChtZXNzYWdlLnYgIT09IHRoaXMudmVyc2lvbikge1xuICAgIC8vIFdlIHNob3VsZCBhbHJlYWR5IGJlIGF0IHRoZSBzYW1lIHZlcnNpb24sIGJlY2F1c2UgdGhlIHNlcnZlciBzaG91bGRcbiAgICAvLyBoYXZlIHNlbnQgYWxsIHRoZSBvcHMgdGhhdCBoYXZlIGhhcHBlbmVkIGJlZm9yZSBhY2tub3dsZWRnaW5nIG91ciBvcFxuICAgIGxvZ2dlci53YXJuKCdJbnZhbGlkIHZlcnNpb24gZnJvbSBzZXJ2ZXIuIEV4cGVjdGVkOiAnICsgdGhpcy52ZXJzaW9uICsgJyBSZWNlaXZlZDogJyArIG1lc3NhZ2UudiwgbWVzc2FnZSk7XG5cbiAgICAvLyBGZXRjaGluZyBzaG91bGQgZ2V0IHVzIGJhY2sgdG8gYSB3b3JraW5nIGRvY3VtZW50IHN0YXRlXG4gICAgcmV0dXJuIHRoaXMuZmV0Y2goKTtcbiAgfVxuXG4gIGlmIChtZXNzYWdlW0FDVElPTlMuZml4dXBdKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlW0FDVElPTlMuZml4dXBdLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgZml4dXBPcCA9IG1lc3NhZ2VbQUNUSU9OUy5maXh1cF1baV07XG5cbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5wZW5kaW5nT3BzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIHZhciB0cmFuc2Zvcm1FcnIgPSB0cmFuc2Zvcm1YKHRoaXMucGVuZGluZ09wc1tpXSwgZml4dXBPcCk7XG4gICAgICAgIGlmICh0cmFuc2Zvcm1FcnIpIHJldHVybiB0aGlzLl9oYXJkUm9sbGJhY2sodHJhbnNmb3JtRXJyKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5fb3RBcHBseShmaXh1cE9wLCBmYWxzZSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFyZFJvbGxiYWNrKGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBUaGUgb3Agd2FzIGNvbW1pdHRlZCBzdWNjZXNzZnVsbHkuIEluY3JlbWVudCB0aGUgdmVyc2lvbiBudW1iZXJcbiAgdGhpcy52ZXJzaW9uKys7XG5cbiAgdGhpcy5fY2xlYXJJbmZsaWdodE9wKCk7XG59O1xuXG5Eb2MucHJvdG90eXBlLl9yb2xsYmFjayA9IGZ1bmN0aW9uKGVycikge1xuICAvLyBUaGUgc2VydmVyIGhhcyByZWplY3RlZCBzdWJtaXNzaW9uIG9mIHRoZSBjdXJyZW50IG9wZXJhdGlvbi4gSW52ZXJ0IGJ5XG4gIC8vIGp1c3QgdGhlIGluZmxpZ2h0IG9wIGlmIHBvc3NpYmxlLiBJZiBub3QgcG9zc2libGUgdG8gaW52ZXJ0LCBjYW5jZWwgYWxsXG4gIC8vIHBlbmRpbmcgb3BzIGFuZCBmZXRjaCB0aGUgbGF0ZXN0IGZyb20gdGhlIHNlcnZlciB0byBnZXQgdXMgYmFjayBpbnRvIGFcbiAgLy8gd29ya2luZyBzdGF0ZSwgdGhlbiBjYWxsIGJhY2tcbiAgdmFyIG9wID0gdGhpcy5pbmZsaWdodE9wO1xuXG4gIGlmICghKCdvcCcgaW4gb3AgJiYgb3AudHlwZS5pbnZlcnQpKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hhcmRSb2xsYmFjayhlcnIpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBvcC5vcCA9IG9wLnR5cGUuaW52ZXJ0KG9wLm9wKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBJZiB0aGUgb3AgZG9lc24ndCBzdXBwb3J0IGAuaW52ZXJ0KClgLCB3ZSBqdXN0IHJlbG9hZCB0aGUgZG9jXG4gICAgLy8gaW5zdGVhZCBvZiB0cnlpbmcgdG8gbG9jYWxseSByZXZlcnQgaXQuXG4gICAgcmV0dXJuIHRoaXMuX2hhcmRSb2xsYmFjayhlcnIpO1xuICB9XG5cbiAgLy8gVHJhbnNmb3JtIHRoZSB1bmRvIG9wZXJhdGlvbiBieSBhbnkgcGVuZGluZyBvcHMuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wZW5kaW5nT3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHRyYW5zZm9ybUVyciA9IHRyYW5zZm9ybVgodGhpcy5wZW5kaW5nT3BzW2ldLCBvcCk7XG4gICAgaWYgKHRyYW5zZm9ybUVycikgcmV0dXJuIHRoaXMuX2hhcmRSb2xsYmFjayh0cmFuc2Zvcm1FcnIpO1xuICB9XG5cbiAgLy8gLi4uIGFuZCBhcHBseSBpdCBsb2NhbGx5LCByZXZlcnRpbmcgdGhlIGNoYW5nZXMuXG4gIC8vXG4gIC8vIFRoaXMgb3BlcmF0aW9uIGlzIGFwcGxpZWQgdG8gbG9vayBsaWtlIGl0IGNvbWVzIGZyb20gYSByZW1vdGUgc291cmNlLlxuICAvLyBJJ20gc3RpbGwgbm90IDEwMCUgc3VyZSBhYm91dCB0aGlzIGZ1bmN0aW9uYWxpdHksIGJlY2F1c2UgaXRzIHJlYWxseSBhXG4gIC8vIGxvY2FsIG9wLiBCYXNpY2FsbHksIHRoZSBwcm9ibGVtIGlzIHRoYXQgaWYgdGhlIGNsaWVudCdzIG9wIGlzIHJlamVjdGVkXG4gIC8vIGJ5IHRoZSBzZXJ2ZXIsIHRoZSBlZGl0b3Igd2luZG93IHNob3VsZCB1cGRhdGUgdG8gcmVmbGVjdCB0aGUgdW5kby5cbiAgdHJ5IHtcbiAgICB0aGlzLl9vdEFwcGx5KG9wLCBmYWxzZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hhcmRSb2xsYmFjayhlcnJvcik7XG4gIH1cblxuICAvLyBUaGUgc2VydmVyIGhhcyByZWplY3RlZCBzdWJtaXNzaW9uIG9mIHRoZSBjdXJyZW50IG9wZXJhdGlvbi4gSWYgd2UgZ2V0XG4gIC8vIGFuIFwiT3Agc3VibWl0IHJlamVjdGVkXCIgZXJyb3IsIHRoaXMgd2FzIGRvbmUgaW50ZW50aW9uYWxseVxuICAvLyBhbmQgd2Ugc2hvdWxkIHJvbGwgYmFjayBidXQgbm90IHJldHVybiBhbiBlcnJvciB0byB0aGUgdXNlci5cbiAgaWYgKGVyci5jb2RlID09PSBFUlJPUl9DT0RFLkVSUl9PUF9TVUJNSVRfUkVKRUNURUQpIHtcbiAgICByZXR1cm4gdGhpcy5fY2xlYXJJbmZsaWdodE9wKG51bGwpO1xuICB9XG5cbiAgdGhpcy5fY2xlYXJJbmZsaWdodE9wKGVycik7XG59O1xuXG5Eb2MucHJvdG90eXBlLl9oYXJkUm9sbGJhY2sgPSBmdW5jdGlvbihlcnIpIHtcbiAgdGhpcy5faXNJbkhhcmRSb2xsYmFjayA9IHRydWU7XG4gIC8vIFN0b3JlIHBlbmRpbmcgb3BzIHNvIHRoYXQgd2UgY2FuIG5vdGlmeSB0aGVpciBjYWxsYmFja3Mgb2YgdGhlIGVycm9yLlxuICAvLyBXZSBjb21iaW5lIHRoZSBpbmZsaWdodCBvcCBhbmQgdGhlIHBlbmRpbmcgb3BzLCBiZWNhdXNlIGl0J3MgcG9zc2libGVcbiAgLy8gdG8gaGl0IGEgY29uZGl0aW9uIHdoZXJlIHdlIGhhdmUgbm8gaW5mbGlnaHQgb3AsIGJ1dCB3ZSBkbyBoYXZlIHBlbmRpbmdcbiAgLy8gb3BzLiBUaGlzIGNhbiBoYXBwZW4gd2hlbiBhbiBpbnZhbGlkIG9wIGlzIHN1Ym1pdHRlZCwgd2hpY2ggY2F1c2VzIHVzXG4gIC8vIHRvIGhhcmQgcm9sbGJhY2sgYmVmb3JlIHRoZSBwZW5kaW5nIG9wIHdhcyBmbHVzaGVkLlxuICB2YXIgcGVuZGluZ09wcyA9IHRoaXMucGVuZGluZ09wcztcbiAgdmFyIGluZmxpZ2h0T3AgPSB0aGlzLmluZmxpZ2h0T3A7XG5cbiAgLy8gQ2FuY2VsIGFsbCBwZW5kaW5nIG9wcyBhbmQgcmVzZXQgaWYgd2UgY2FuJ3QgaW52ZXJ0XG4gIHRoaXMuX3NldFR5cGUobnVsbCk7XG4gIHRoaXMudmVyc2lvbiA9IG51bGw7XG4gIHRoaXMuaW5mbGlnaHRPcCA9IG51bGw7XG4gIHRoaXMucGVuZGluZ09wcyA9IFtdO1xuXG4gIC8vIEZldGNoIHRoZSBsYXRlc3QgdmVyc2lvbiBmcm9tIHRoZSBzZXJ2ZXIgdG8gZ2V0IHVzIGJhY2sgaW50byBhIHdvcmtpbmcgc3RhdGVcbiAgdmFyIGRvYyA9IHRoaXM7XG4gIHRoaXMuX2ZldGNoKHtmb3JjZTogdHJ1ZX0sIGZ1bmN0aW9uKGZldGNoRXJyb3IpIHtcbiAgICBkb2MuX2lzSW5IYXJkUm9sbGJhY2sgPSBmYWxzZTtcblxuICAgIC8vIFdlIHdhbnQgdG8gY2hlY2sgdGhhdCBubyBlcnJvcnMgYXJlIHN3YWxsb3dlZCwgc28gd2UgY2hlY2sgdGhhdDpcbiAgICAvLyAtIHRoZXJlIGFyZSBjYWxsYmFja3MgdG8gY2FsbCwgYW5kXG4gICAgLy8gLSB0aGF0IGV2ZXJ5IHNpbmdsZSBwZW5kaW5nIG9wIGNhbGxlZCBhIGNhbGxiYWNrXG4gICAgLy8gSWYgdGhlcmUgYXJlIG5vIG9wcyBxdWV1ZWQsIG9yIG9uZSBvZiB0aGVtIGRpZG4ndCBoYW5kbGUgdGhlIGVycm9yLFxuICAgIC8vIHRoZW4gd2UgZW1pdCB0aGUgZXJyb3IuXG5cbiAgICBpZiAoZmV0Y2hFcnJvcikge1xuICAgICAgLy8gVGhpcyBpcyBjcml0aWNhbCBlcnJvciBhcyBpdCBtZWFucyB0aGF0IG91ciBkb2MgaXMgbm90IGluIHVzYWJsZSBzdGF0ZVxuICAgICAgLy8gYW55bW9yZSwgd2Ugc2hvdWxkIHRocm93IGRvYyBlcnJvci5cbiAgICAgIGxvZ2dlci5lcnJvcignSGFyZCByb2xsYmFjayBkb2MgZmV0Y2ggZmFpbGVkLicsIGZldGNoRXJyb3IsIGluZmxpZ2h0T3ApO1xuXG4gICAgICBkb2MuZW1pdCgnZXJyb3InLCBuZXcgU2hhcmVEQkVycm9yKFxuICAgICAgICBFUlJPUl9DT0RFLkVSUl9IQVJEX1JPTExCQUNLX0ZFVENIX0ZBSUxFRCxcbiAgICAgICAgJ0hhcmQgcm9sbGJhY2sgZmV0Y2ggZmFpbGVkOiAnICsgZmV0Y2hFcnJvci5tZXNzYWdlXG4gICAgICApKTtcbiAgICB9XG5cbiAgICBpZiAoZXJyLmNvZGUgPT09IEVSUk9SX0NPREUuRVJSX09QX1NVQk1JVF9SRUpFQ1RFRCkge1xuICAgICAgLyoqXG4gICAgICAgKiBIYW5kbGUgc3BlY2lhbCBjYXNlIG9mIEVSUl9PUF9TVUJNSVRfUkVKRUNURURcbiAgICAgICAqIFRoaXMgZW5zdXJlcyB0aGF0IHdlIHJlc29sdmUgdGhlIG1haW4gb3AgY2FsbGJhY2sgYW5kIHJlamVjdFxuICAgICAgICogYWxsIHRoZSBwZW5kaW5nIG9wcy4gVGhpcyBpcyBoYXJkIHJvbGxiYWNrIHNvIGFsbCB0aGUgcGVuZGluZyBvcHMgd2lsbCBiZVxuICAgICAgICogZGlzY2FyZGVkLiBUaGlzIHdpbGwgZW5zdXJlIHRoYXQgdGhlIHVzZXIgaXMgYXQgbGVhc3QgaW5mb3JtZWQgYWJvdXQgaXQuXG4gICAgICAgKiBtb3JlIGluZm86IGh0dHBzOi8vZ2l0aHViLmNvbS9zaGFyZS9zaGFyZWRiL3B1bGwvNjI2XG4gICAgICAgKi9cbiAgICAgIGlmIChpbmZsaWdodE9wKSB7XG4gICAgICAgIHV0aWwuY2FsbEVhY2goaW5mbGlnaHRPcC5jYWxsYmFja3MpO1xuICAgICAgICBpbmZsaWdodE9wID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFwZW5kaW5nT3BzLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgZXJyID0gbmV3IFNoYXJlREJFcnJvcihcbiAgICAgICAgRVJST1JfQ09ERS5FUlJfUEVORElOR19PUF9SRU1PVkVEX0JZX09QX1NVQk1JVF9SRUpFQ1RFRCxcbiAgICAgICAgJ0Rpc2NhcmRpbmcgcGVuZGluZyBvcCBiZWNhdXNlIG9mIGhhcmQgcm9sbGJhY2sgZHVyaW5nIEVSUl9PUF9TVUJNSVRfUkVKRUNURUQnXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChpbmZsaWdodE9wKSBwZW5kaW5nT3BzLnVuc2hpZnQoaW5mbGlnaHRPcCk7XG4gICAgdmFyIGFsbE9wc0hhZENhbGxiYWNrcyA9ICEhcGVuZGluZ09wcy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwZW5kaW5nT3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBhbGxPcHNIYWRDYWxsYmFja3MgPSB1dGlsLmNhbGxFYWNoKHBlbmRpbmdPcHNbaV0uY2FsbGJhY2tzLCBlcnIpICYmIGFsbE9wc0hhZENhbGxiYWNrcztcbiAgICB9XG4gICAgaWYgKGVyciAmJiAhYWxsT3BzSGFkQ2FsbGJhY2tzKSBkb2MuZW1pdCgnZXJyb3InLCBlcnIpO1xuICB9KTtcbn07XG5cbkRvYy5wcm90b3R5cGUuX2NsZWFySW5mbGlnaHRPcCA9IGZ1bmN0aW9uKGVycikge1xuICB2YXIgaW5mbGlnaHRPcCA9IHRoaXMuaW5mbGlnaHRPcDtcblxuICB0aGlzLmluZmxpZ2h0T3AgPSBudWxsO1xuXG4gIHZhciBjYWxsZWQgPSB1dGlsLmNhbGxFYWNoKGluZmxpZ2h0T3AuY2FsbGJhY2tzLCBlcnIpO1xuXG4gIHRoaXMuZmx1c2goKTtcbiAgdGhpcy5fZW1pdE5vdGhpbmdQZW5kaW5nKCk7XG5cbiAgaWYgKGVyciAmJiAhY2FsbGVkKSByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsIGVycik7XG59O1xuXG5cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/doc.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/index.js":
/*!**************************************************!*\
  !*** ./node_modules/sharedb/lib/client/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("exports.Connection = __webpack_require__(/*! ./connection */ \"(ssr)/./node_modules/sharedb/lib/client/connection.js\");\nexports.Doc = __webpack_require__(/*! ./doc */ \"(ssr)/./node_modules/sharedb/lib/client/doc.js\");\nexports.Error = __webpack_require__(/*! ../error */ \"(ssr)/./node_modules/sharedb/lib/error.js\");\nexports.Query = __webpack_require__(/*! ./query */ \"(ssr)/./node_modules/sharedb/lib/client/query.js\");\nexports.types = __webpack_require__(/*! ../types */ \"(ssr)/./node_modules/sharedb/lib/types.js\");\nexports.logger = __webpack_require__(/*! ../logger */ \"(ssr)/./node_modules/sharedb/lib/logger/index.js\");\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFBLHFIQUE0QztBQUM1QyxnR0FBOEI7QUFDOUIsZ0dBQW1DO0FBQ25DLHNHQUFrQztBQUNsQyxnR0FBbUM7QUFDbkMseUdBQXFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvaW5kZXguanM/YzM0OCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnRzLkNvbm5lY3Rpb24gPSByZXF1aXJlKCcuL2Nvbm5lY3Rpb24nKTtcbmV4cG9ydHMuRG9jID0gcmVxdWlyZSgnLi9kb2MnKTtcbmV4cG9ydHMuRXJyb3IgPSByZXF1aXJlKCcuLi9lcnJvcicpO1xuZXhwb3J0cy5RdWVyeSA9IHJlcXVpcmUoJy4vcXVlcnknKTtcbmV4cG9ydHMudHlwZXMgPSByZXF1aXJlKCcuLi90eXBlcycpO1xuZXhwb3J0cy5sb2dnZXIgPSByZXF1aXJlKCcuLi9sb2dnZXInKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/doc-presence-emitter.js":
/*!**************************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/doc-presence-emitter.js ***!
  \**************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar EventEmitter = (__webpack_require__(/*! events */ \"events\").EventEmitter);\n\nvar EVENTS = [\n  'create',\n  'del',\n  'destroy',\n  'load',\n  'op'\n];\n\nmodule.exports = DocPresenceEmitter;\n\nfunction DocPresenceEmitter() {\n  this._docs = Object.create(null);\n  this._forwarders = Object.create(null);\n  this._emitters = Object.create(null);\n}\n\nDocPresenceEmitter.prototype.addEventListener = function(doc, event, listener) {\n  this._registerDoc(doc);\n  var emitter = util.dig(this._emitters, doc.collection, doc.id);\n  emitter.on(event, listener);\n};\n\nDocPresenceEmitter.prototype.removeEventListener = function(doc, event, listener) {\n  var emitter = util.dig(this._emitters, doc.collection, doc.id);\n  if (!emitter) return;\n  emitter.off(event, listener);\n  // We'll always have at least one, because of the destroy listener\n  if (emitter._eventsCount === 1) this._unregisterDoc(doc);\n};\n\nDocPresenceEmitter.prototype._registerDoc = function(doc) {\n  var alreadyRegistered = true;\n  util.digOrCreate(this._docs, doc.collection, doc.id, function() {\n    alreadyRegistered = false;\n    return doc;\n  });\n\n  if (alreadyRegistered) return;\n\n  var emitter = util.digOrCreate(this._emitters, doc.collection, doc.id, function() {\n    var e = new EventEmitter();\n    // Set a high limit to avoid unnecessary warnings, but still\n    // retain some degree of memory leak detection\n    e.setMaxListeners(1000);\n    return e;\n  });\n\n  var self = this;\n  EVENTS.forEach(function(event) {\n    var forwarder = util.digOrCreate(self._forwarders, doc.collection, doc.id, event, function() {\n      return emitter.emit.bind(emitter, event);\n    });\n\n    doc.on(event, forwarder);\n  });\n\n  this.addEventListener(doc, 'destroy', this._unregisterDoc.bind(this, doc));\n};\n\nDocPresenceEmitter.prototype._unregisterDoc = function(doc) {\n  var forwarders = util.dig(this._forwarders, doc.collection, doc.id);\n  for (var event in forwarders) {\n    doc.off(event, forwarders[event]);\n  }\n\n  var emitter = util.dig(this._emitters, doc.collection, doc.id);\n  emitter.removeAllListeners();\n\n  util.digAndRemove(this._forwarders, doc.collection, doc.id);\n  util.digAndRemove(this._emitters, doc.collection, doc.id);\n  util.digAndRemove(this._docs, doc.collection, doc.id);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL2RvYy1wcmVzZW5jZS1lbWl0dGVyLmpzIiwibWFwcGluZ3MiOiJBQUFBLFdBQVcsbUJBQU8sQ0FBQyw0REFBWTtBQUMvQixtQkFBbUIsMERBQThCOztBQUVqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvcHJlc2VuY2UvZG9jLXByZXNlbmNlLWVtaXR0ZXIuanM/MzcyOSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdXRpbCA9IHJlcXVpcmUoJy4uLy4uL3V0aWwnKTtcbnZhciBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKS5FdmVudEVtaXR0ZXI7XG5cbnZhciBFVkVOVFMgPSBbXG4gICdjcmVhdGUnLFxuICAnZGVsJyxcbiAgJ2Rlc3Ryb3knLFxuICAnbG9hZCcsXG4gICdvcCdcbl07XG5cbm1vZHVsZS5leHBvcnRzID0gRG9jUHJlc2VuY2VFbWl0dGVyO1xuXG5mdW5jdGlvbiBEb2NQcmVzZW5jZUVtaXR0ZXIoKSB7XG4gIHRoaXMuX2RvY3MgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB0aGlzLl9mb3J3YXJkZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgdGhpcy5fZW1pdHRlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xufVxuXG5Eb2NQcmVzZW5jZUVtaXR0ZXIucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihkb2MsIGV2ZW50LCBsaXN0ZW5lcikge1xuICB0aGlzLl9yZWdpc3RlckRvYyhkb2MpO1xuICB2YXIgZW1pdHRlciA9IHV0aWwuZGlnKHRoaXMuX2VtaXR0ZXJzLCBkb2MuY29sbGVjdGlvbiwgZG9jLmlkKTtcbiAgZW1pdHRlci5vbihldmVudCwgbGlzdGVuZXIpO1xufTtcblxuRG9jUHJlc2VuY2VFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZG9jLCBldmVudCwgbGlzdGVuZXIpIHtcbiAgdmFyIGVtaXR0ZXIgPSB1dGlsLmRpZyh0aGlzLl9lbWl0dGVycywgZG9jLmNvbGxlY3Rpb24sIGRvYy5pZCk7XG4gIGlmICghZW1pdHRlcikgcmV0dXJuO1xuICBlbWl0dGVyLm9mZihldmVudCwgbGlzdGVuZXIpO1xuICAvLyBXZSdsbCBhbHdheXMgaGF2ZSBhdCBsZWFzdCBvbmUsIGJlY2F1c2Ugb2YgdGhlIGRlc3Ryb3kgbGlzdGVuZXJcbiAgaWYgKGVtaXR0ZXIuX2V2ZW50c0NvdW50ID09PSAxKSB0aGlzLl91bnJlZ2lzdGVyRG9jKGRvYyk7XG59O1xuXG5Eb2NQcmVzZW5jZUVtaXR0ZXIucHJvdG90eXBlLl9yZWdpc3RlckRvYyA9IGZ1bmN0aW9uKGRvYykge1xuICB2YXIgYWxyZWFkeVJlZ2lzdGVyZWQgPSB0cnVlO1xuICB1dGlsLmRpZ09yQ3JlYXRlKHRoaXMuX2RvY3MsIGRvYy5jb2xsZWN0aW9uLCBkb2MuaWQsIGZ1bmN0aW9uKCkge1xuICAgIGFscmVhZHlSZWdpc3RlcmVkID0gZmFsc2U7XG4gICAgcmV0dXJuIGRvYztcbiAgfSk7XG5cbiAgaWYgKGFscmVhZHlSZWdpc3RlcmVkKSByZXR1cm47XG5cbiAgdmFyIGVtaXR0ZXIgPSB1dGlsLmRpZ09yQ3JlYXRlKHRoaXMuX2VtaXR0ZXJzLCBkb2MuY29sbGVjdGlvbiwgZG9jLmlkLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAvLyBTZXQgYSBoaWdoIGxpbWl0IHRvIGF2b2lkIHVubmVjZXNzYXJ5IHdhcm5pbmdzLCBidXQgc3RpbGxcbiAgICAvLyByZXRhaW4gc29tZSBkZWdyZWUgb2YgbWVtb3J5IGxlYWsgZGV0ZWN0aW9uXG4gICAgZS5zZXRNYXhMaXN0ZW5lcnMoMTAwMCk7XG4gICAgcmV0dXJuIGU7XG4gIH0pO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgRVZFTlRTLmZvckVhY2goZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgZm9yd2FyZGVyID0gdXRpbC5kaWdPckNyZWF0ZShzZWxmLl9mb3J3YXJkZXJzLCBkb2MuY29sbGVjdGlvbiwgZG9jLmlkLCBldmVudCwgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZW1pdHRlci5lbWl0LmJpbmQoZW1pdHRlciwgZXZlbnQpO1xuICAgIH0pO1xuXG4gICAgZG9jLm9uKGV2ZW50LCBmb3J3YXJkZXIpO1xuICB9KTtcblxuICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoZG9jLCAnZGVzdHJveScsIHRoaXMuX3VucmVnaXN0ZXJEb2MuYmluZCh0aGlzLCBkb2MpKTtcbn07XG5cbkRvY1ByZXNlbmNlRW1pdHRlci5wcm90b3R5cGUuX3VucmVnaXN0ZXJEb2MgPSBmdW5jdGlvbihkb2MpIHtcbiAgdmFyIGZvcndhcmRlcnMgPSB1dGlsLmRpZyh0aGlzLl9mb3J3YXJkZXJzLCBkb2MuY29sbGVjdGlvbiwgZG9jLmlkKTtcbiAgZm9yICh2YXIgZXZlbnQgaW4gZm9yd2FyZGVycykge1xuICAgIGRvYy5vZmYoZXZlbnQsIGZvcndhcmRlcnNbZXZlbnRdKTtcbiAgfVxuXG4gIHZhciBlbWl0dGVyID0gdXRpbC5kaWcodGhpcy5fZW1pdHRlcnMsIGRvYy5jb2xsZWN0aW9uLCBkb2MuaWQpO1xuICBlbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycygpO1xuXG4gIHV0aWwuZGlnQW5kUmVtb3ZlKHRoaXMuX2ZvcndhcmRlcnMsIGRvYy5jb2xsZWN0aW9uLCBkb2MuaWQpO1xuICB1dGlsLmRpZ0FuZFJlbW92ZSh0aGlzLl9lbWl0dGVycywgZG9jLmNvbGxlY3Rpb24sIGRvYy5pZCk7XG4gIHV0aWwuZGlnQW5kUmVtb3ZlKHRoaXMuX2RvY3MsIGRvYy5jb2xsZWN0aW9uLCBkb2MuaWQpO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/doc-presence-emitter.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/doc-presence.js":
/*!******************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/doc-presence.js ***!
  \******************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var Presence = __webpack_require__(/*! ./presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/presence.js\");\nvar LocalDocPresence = __webpack_require__(/*! ./local-doc-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/local-doc-presence.js\");\nvar RemoteDocPresence = __webpack_require__(/*! ./remote-doc-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/remote-doc-presence.js\");\n\nfunction DocPresence(connection, collection, id) {\n  var channel = DocPresence.channel(collection, id);\n  Presence.call(this, connection, channel);\n\n  this.collection = collection;\n  this.id = id;\n}\nmodule.exports = DocPresence;\n\nDocPresence.prototype = Object.create(Presence.prototype);\n\nDocPresence.channel = function(collection, id) {\n  return collection + '.' + id;\n};\n\nDocPresence.prototype._createLocalPresence = function(id) {\n  return new LocalDocPresence(this, id);\n};\n\nDocPresence.prototype._createRemotePresence = function(id) {\n  return new RemoteDocPresence(this, id);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL2RvYy1wcmVzZW5jZS5qcyIsIm1hcHBpbmdzIjoiQUFBQSxlQUFlLG1CQUFPLENBQUMsZ0ZBQVk7QUFDbkMsdUJBQXVCLG1CQUFPLENBQUMsb0dBQXNCO0FBQ3JELHdCQUF3QixtQkFBTyxDQUFDLHNHQUF1Qjs7QUFFdkQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvcHJlc2VuY2UvZG9jLXByZXNlbmNlLmpzP2E1NzciXSwic291cmNlc0NvbnRlbnQiOlsidmFyIFByZXNlbmNlID0gcmVxdWlyZSgnLi9wcmVzZW5jZScpO1xudmFyIExvY2FsRG9jUHJlc2VuY2UgPSByZXF1aXJlKCcuL2xvY2FsLWRvYy1wcmVzZW5jZScpO1xudmFyIFJlbW90ZURvY1ByZXNlbmNlID0gcmVxdWlyZSgnLi9yZW1vdGUtZG9jLXByZXNlbmNlJyk7XG5cbmZ1bmN0aW9uIERvY1ByZXNlbmNlKGNvbm5lY3Rpb24sIGNvbGxlY3Rpb24sIGlkKSB7XG4gIHZhciBjaGFubmVsID0gRG9jUHJlc2VuY2UuY2hhbm5lbChjb2xsZWN0aW9uLCBpZCk7XG4gIFByZXNlbmNlLmNhbGwodGhpcywgY29ubmVjdGlvbiwgY2hhbm5lbCk7XG5cbiAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgdGhpcy5pZCA9IGlkO1xufVxubW9kdWxlLmV4cG9ydHMgPSBEb2NQcmVzZW5jZTtcblxuRG9jUHJlc2VuY2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQcmVzZW5jZS5wcm90b3R5cGUpO1xuXG5Eb2NQcmVzZW5jZS5jaGFubmVsID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgaWQpIHtcbiAgcmV0dXJuIGNvbGxlY3Rpb24gKyAnLicgKyBpZDtcbn07XG5cbkRvY1ByZXNlbmNlLnByb3RvdHlwZS5fY3JlYXRlTG9jYWxQcmVzZW5jZSA9IGZ1bmN0aW9uKGlkKSB7XG4gIHJldHVybiBuZXcgTG9jYWxEb2NQcmVzZW5jZSh0aGlzLCBpZCk7XG59O1xuXG5Eb2NQcmVzZW5jZS5wcm90b3R5cGUuX2NyZWF0ZVJlbW90ZVByZXNlbmNlID0gZnVuY3Rpb24oaWQpIHtcbiAgcmV0dXJuIG5ldyBSZW1vdGVEb2NQcmVzZW5jZSh0aGlzLCBpZCk7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/doc-presence.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/local-doc-presence.js":
/*!************************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/local-doc-presence.js ***!
  \************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var LocalPresence = __webpack_require__(/*! ./local-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/local-presence.js\");\nvar ShareDBError = __webpack_require__(/*! ../../error */ \"(ssr)/./node_modules/sharedb/lib/error.js\");\nvar util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar ERROR_CODE = ShareDBError.CODES;\n\nmodule.exports = LocalDocPresence;\nfunction LocalDocPresence(presence, presenceId) {\n  LocalPresence.call(this, presence, presenceId);\n\n  this.collection = this.presence.collection;\n  this.id = this.presence.id;\n\n  this._doc = this.connection.get(this.collection, this.id);\n  this._emitter = this.connection._docPresenceEmitter;\n  this._isSending = false;\n  this._docDataVersionByPresenceVersion = Object.create(null);\n\n  this._opHandler = this._transformAgainstOp.bind(this);\n  this._createOrDelHandler = this._handleCreateOrDel.bind(this);\n  this._loadHandler = this._handleLoad.bind(this);\n  this._destroyHandler = this.destroy.bind(this);\n  this._registerWithDoc();\n}\n\nLocalDocPresence.prototype = Object.create(LocalPresence.prototype);\n\nLocalDocPresence.prototype.submit = function(value, callback) {\n  if (!this._doc.type) {\n    // If the Doc hasn't been created, we already assume all presence to\n    // be null. Let's early return, instead of error since this is a harmless\n    // no-op\n    if (value === null) return this._callbackOrEmit(null, callback);\n\n    var error = null;\n    if (this._doc._isInHardRollback) {\n      error = {\n        code: ERROR_CODE.ERR_DOC_IN_HARD_ROLLBACK,\n        message: 'Cannot submit presence. Document is processing hard rollback'\n      };\n    } else {\n      error = {\n        code: ERROR_CODE.ERR_DOC_DOES_NOT_EXIST,\n        message: 'Cannot submit presence. Document has not been created'\n      };\n    }\n\n    return this._callbackOrEmit(error, callback);\n  };\n\n  // Record the current data state version to check if we need to transform\n  // the presence later\n  this._docDataVersionByPresenceVersion[this.presenceVersion] = this._doc._dataStateVersion;\n  LocalPresence.prototype.submit.call(this, value, callback);\n};\n\nLocalDocPresence.prototype.destroy = function(callback) {\n  this._emitter.removeEventListener(this._doc, 'op', this._opHandler);\n  this._emitter.removeEventListener(this._doc, 'create', this._createOrDelHandler);\n  this._emitter.removeEventListener(this._doc, 'del', this._createOrDelHandler);\n  this._emitter.removeEventListener(this._doc, 'load', this._loadHandler);\n  this._emitter.removeEventListener(this._doc, 'destroy', this._destroyHandler);\n\n  LocalPresence.prototype.destroy.call(this, callback);\n};\n\nLocalDocPresence.prototype._sendPending = function() {\n  if (this._isSending) return;\n  this._isSending = true;\n  var presence = this;\n  this._doc.whenNothingPending(function() {\n    presence._isSending = false;\n    if (!presence.connection.canSend) return;\n\n    presence._pendingMessages.forEach(function(message) {\n      message.t = presence._doc.type.uri;\n      message.v = presence._doc.version;\n      presence.connection.send(message);\n    });\n\n    presence._pendingMessages = [];\n    presence._docDataVersionByPresenceVersion = Object.create(null);\n  });\n};\n\nLocalDocPresence.prototype._registerWithDoc = function() {\n  this._emitter.addEventListener(this._doc, 'op', this._opHandler);\n  this._emitter.addEventListener(this._doc, 'create', this._createOrDelHandler);\n  this._emitter.addEventListener(this._doc, 'del', this._createOrDelHandler);\n  this._emitter.addEventListener(this._doc, 'load', this._loadHandler);\n  this._emitter.addEventListener(this._doc, 'destroy', this._destroyHandler);\n};\n\nLocalDocPresence.prototype._transformAgainstOp = function(op, source) {\n  var presence = this;\n  var docDataVersion = this._doc._dataStateVersion;\n\n  this._pendingMessages.forEach(function(message) {\n    // Check if the presence needs transforming against the op - this is to check against\n    // edge cases where presence is submitted from an 'op' event\n    var messageDocDataVersion = presence._docDataVersionByPresenceVersion[message.pv];\n    if (messageDocDataVersion >= docDataVersion) return;\n    try {\n      message.p = presence._transformPresence(message.p, op, source);\n      // Ensure the presence's data version is kept consistent to deal with \"deep\" op\n      // submissions\n      presence._docDataVersionByPresenceVersion[message.pv] = docDataVersion;\n    } catch (error) {\n      var callback = presence._getCallback(message.pv);\n      presence._callbackOrEmit(error, callback);\n    }\n  });\n\n  try {\n    this.value = this._transformPresence(this.value, op, source);\n  } catch (error) {\n    this.emit('error', error);\n  }\n};\n\nLocalDocPresence.prototype._handleCreateOrDel = function() {\n  this._pendingMessages.forEach(function(message) {\n    message.p = null;\n  });\n\n  this.value = null;\n};\n\nLocalDocPresence.prototype._handleLoad = function() {\n  this.value = null;\n  this._pendingMessages = [];\n  this._docDataVersionByPresenceVersion = Object.create(null);\n};\n\nLocalDocPresence.prototype._message = function() {\n  var message = LocalPresence.prototype._message.call(this);\n  message.c = this.collection,\n  message.d = this.id,\n  message.v = null;\n  message.t = null;\n  return message;\n};\n\nLocalDocPresence.prototype._transformPresence = function(value, op, source) {\n  var type = this._doc.type;\n  if (!util.supportsPresence(type)) {\n    throw new ShareDBError(\n      ERROR_CODE.ERR_TYPE_DOES_NOT_SUPPORT_PRESENCE,\n      'Type does not support presence: ' + type.name\n    );\n  }\n  return type.transformPresence(value, op, source);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL2xvY2FsLWRvYy1wcmVzZW5jZS5qcyIsIm1hcHBpbmdzIjoiQUFBQSxvQkFBb0IsbUJBQU8sQ0FBQyw0RkFBa0I7QUFDOUMsbUJBQW1CLG1CQUFPLENBQUMsOERBQWE7QUFDeEMsV0FBVyxtQkFBTyxDQUFDLDREQUFZO0FBQy9COztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL2NsaWVudC9wcmVzZW5jZS9sb2NhbC1kb2MtcHJlc2VuY2UuanM/MTQzZSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgTG9jYWxQcmVzZW5jZSA9IHJlcXVpcmUoJy4vbG9jYWwtcHJlc2VuY2UnKTtcbnZhciBTaGFyZURCRXJyb3IgPSByZXF1aXJlKCcuLi8uLi9lcnJvcicpO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuLi8uLi91dGlsJyk7XG52YXIgRVJST1JfQ09ERSA9IFNoYXJlREJFcnJvci5DT0RFUztcblxubW9kdWxlLmV4cG9ydHMgPSBMb2NhbERvY1ByZXNlbmNlO1xuZnVuY3Rpb24gTG9jYWxEb2NQcmVzZW5jZShwcmVzZW5jZSwgcHJlc2VuY2VJZCkge1xuICBMb2NhbFByZXNlbmNlLmNhbGwodGhpcywgcHJlc2VuY2UsIHByZXNlbmNlSWQpO1xuXG4gIHRoaXMuY29sbGVjdGlvbiA9IHRoaXMucHJlc2VuY2UuY29sbGVjdGlvbjtcbiAgdGhpcy5pZCA9IHRoaXMucHJlc2VuY2UuaWQ7XG5cbiAgdGhpcy5fZG9jID0gdGhpcy5jb25uZWN0aW9uLmdldCh0aGlzLmNvbGxlY3Rpb24sIHRoaXMuaWQpO1xuICB0aGlzLl9lbWl0dGVyID0gdGhpcy5jb25uZWN0aW9uLl9kb2NQcmVzZW5jZUVtaXR0ZXI7XG4gIHRoaXMuX2lzU2VuZGluZyA9IGZhbHNlO1xuICB0aGlzLl9kb2NEYXRhVmVyc2lvbkJ5UHJlc2VuY2VWZXJzaW9uID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICB0aGlzLl9vcEhhbmRsZXIgPSB0aGlzLl90cmFuc2Zvcm1BZ2FpbnN0T3AuYmluZCh0aGlzKTtcbiAgdGhpcy5fY3JlYXRlT3JEZWxIYW5kbGVyID0gdGhpcy5faGFuZGxlQ3JlYXRlT3JEZWwuYmluZCh0aGlzKTtcbiAgdGhpcy5fbG9hZEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVMb2FkLmJpbmQodGhpcyk7XG4gIHRoaXMuX2Rlc3Ryb3lIYW5kbGVyID0gdGhpcy5kZXN0cm95LmJpbmQodGhpcyk7XG4gIHRoaXMuX3JlZ2lzdGVyV2l0aERvYygpO1xufVxuXG5Mb2NhbERvY1ByZXNlbmNlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoTG9jYWxQcmVzZW5jZS5wcm90b3R5cGUpO1xuXG5Mb2NhbERvY1ByZXNlbmNlLnByb3RvdHlwZS5zdWJtaXQgPSBmdW5jdGlvbih2YWx1ZSwgY2FsbGJhY2spIHtcbiAgaWYgKCF0aGlzLl9kb2MudHlwZSkge1xuICAgIC8vIElmIHRoZSBEb2MgaGFzbid0IGJlZW4gY3JlYXRlZCwgd2UgYWxyZWFkeSBhc3N1bWUgYWxsIHByZXNlbmNlIHRvXG4gICAgLy8gYmUgbnVsbC4gTGV0J3MgZWFybHkgcmV0dXJuLCBpbnN0ZWFkIG9mIGVycm9yIHNpbmNlIHRoaXMgaXMgYSBoYXJtbGVzc1xuICAgIC8vIG5vLW9wXG4gICAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gdGhpcy5fY2FsbGJhY2tPckVtaXQobnVsbCwgY2FsbGJhY2spO1xuXG4gICAgdmFyIGVycm9yID0gbnVsbDtcbiAgICBpZiAodGhpcy5fZG9jLl9pc0luSGFyZFJvbGxiYWNrKSB7XG4gICAgICBlcnJvciA9IHtcbiAgICAgICAgY29kZTogRVJST1JfQ09ERS5FUlJfRE9DX0lOX0hBUkRfUk9MTEJBQ0ssXG4gICAgICAgIG1lc3NhZ2U6ICdDYW5ub3Qgc3VibWl0IHByZXNlbmNlLiBEb2N1bWVudCBpcyBwcm9jZXNzaW5nIGhhcmQgcm9sbGJhY2snXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBlcnJvciA9IHtcbiAgICAgICAgY29kZTogRVJST1JfQ09ERS5FUlJfRE9DX0RPRVNfTk9UX0VYSVNULFxuICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IHN1Ym1pdCBwcmVzZW5jZS4gRG9jdW1lbnQgaGFzIG5vdCBiZWVuIGNyZWF0ZWQnXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9jYWxsYmFja09yRW1pdChlcnJvciwgY2FsbGJhY2spO1xuICB9O1xuXG4gIC8vIFJlY29yZCB0aGUgY3VycmVudCBkYXRhIHN0YXRlIHZlcnNpb24gdG8gY2hlY2sgaWYgd2UgbmVlZCB0byB0cmFuc2Zvcm1cbiAgLy8gdGhlIHByZXNlbmNlIGxhdGVyXG4gIHRoaXMuX2RvY0RhdGFWZXJzaW9uQnlQcmVzZW5jZVZlcnNpb25bdGhpcy5wcmVzZW5jZVZlcnNpb25dID0gdGhpcy5fZG9jLl9kYXRhU3RhdGVWZXJzaW9uO1xuICBMb2NhbFByZXNlbmNlLnByb3RvdHlwZS5zdWJtaXQuY2FsbCh0aGlzLCB2YWx1ZSwgY2FsbGJhY2spO1xufTtcblxuTG9jYWxEb2NQcmVzZW5jZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gIHRoaXMuX2VtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLl9kb2MsICdvcCcsIHRoaXMuX29wSGFuZGxlcik7XG4gIHRoaXMuX2VtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLl9kb2MsICdjcmVhdGUnLCB0aGlzLl9jcmVhdGVPckRlbEhhbmRsZXIpO1xuICB0aGlzLl9lbWl0dGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fZG9jLCAnZGVsJywgdGhpcy5fY3JlYXRlT3JEZWxIYW5kbGVyKTtcbiAgdGhpcy5fZW1pdHRlci5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX2RvYywgJ2xvYWQnLCB0aGlzLl9sb2FkSGFuZGxlcik7XG4gIHRoaXMuX2VtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLl9kb2MsICdkZXN0cm95JywgdGhpcy5fZGVzdHJveUhhbmRsZXIpO1xuXG4gIExvY2FsUHJlc2VuY2UucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzLCBjYWxsYmFjayk7XG59O1xuXG5Mb2NhbERvY1ByZXNlbmNlLnByb3RvdHlwZS5fc2VuZFBlbmRpbmcgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuX2lzU2VuZGluZykgcmV0dXJuO1xuICB0aGlzLl9pc1NlbmRpbmcgPSB0cnVlO1xuICB2YXIgcHJlc2VuY2UgPSB0aGlzO1xuICB0aGlzLl9kb2Mud2hlbk5vdGhpbmdQZW5kaW5nKGZ1bmN0aW9uKCkge1xuICAgIHByZXNlbmNlLl9pc1NlbmRpbmcgPSBmYWxzZTtcbiAgICBpZiAoIXByZXNlbmNlLmNvbm5lY3Rpb24uY2FuU2VuZCkgcmV0dXJuO1xuXG4gICAgcHJlc2VuY2UuX3BlbmRpbmdNZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgIG1lc3NhZ2UudCA9IHByZXNlbmNlLl9kb2MudHlwZS51cmk7XG4gICAgICBtZXNzYWdlLnYgPSBwcmVzZW5jZS5fZG9jLnZlcnNpb247XG4gICAgICBwcmVzZW5jZS5jb25uZWN0aW9uLnNlbmQobWVzc2FnZSk7XG4gICAgfSk7XG5cbiAgICBwcmVzZW5jZS5fcGVuZGluZ01lc3NhZ2VzID0gW107XG4gICAgcHJlc2VuY2UuX2RvY0RhdGFWZXJzaW9uQnlQcmVzZW5jZVZlcnNpb24gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB9KTtcbn07XG5cbkxvY2FsRG9jUHJlc2VuY2UucHJvdG90eXBlLl9yZWdpc3RlcldpdGhEb2MgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fZW1pdHRlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuX2RvYywgJ29wJywgdGhpcy5fb3BIYW5kbGVyKTtcbiAgdGhpcy5fZW1pdHRlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuX2RvYywgJ2NyZWF0ZScsIHRoaXMuX2NyZWF0ZU9yRGVsSGFuZGxlcik7XG4gIHRoaXMuX2VtaXR0ZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLl9kb2MsICdkZWwnLCB0aGlzLl9jcmVhdGVPckRlbEhhbmRsZXIpO1xuICB0aGlzLl9lbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5fZG9jLCAnbG9hZCcsIHRoaXMuX2xvYWRIYW5kbGVyKTtcbiAgdGhpcy5fZW1pdHRlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuX2RvYywgJ2Rlc3Ryb3knLCB0aGlzLl9kZXN0cm95SGFuZGxlcik7XG59O1xuXG5Mb2NhbERvY1ByZXNlbmNlLnByb3RvdHlwZS5fdHJhbnNmb3JtQWdhaW5zdE9wID0gZnVuY3Rpb24ob3AsIHNvdXJjZSkge1xuICB2YXIgcHJlc2VuY2UgPSB0aGlzO1xuICB2YXIgZG9jRGF0YVZlcnNpb24gPSB0aGlzLl9kb2MuX2RhdGFTdGF0ZVZlcnNpb247XG5cbiAgdGhpcy5fcGVuZGluZ01lc3NhZ2VzLmZvckVhY2goZnVuY3Rpb24obWVzc2FnZSkge1xuICAgIC8vIENoZWNrIGlmIHRoZSBwcmVzZW5jZSBuZWVkcyB0cmFuc2Zvcm1pbmcgYWdhaW5zdCB0aGUgb3AgLSB0aGlzIGlzIHRvIGNoZWNrIGFnYWluc3RcbiAgICAvLyBlZGdlIGNhc2VzIHdoZXJlIHByZXNlbmNlIGlzIHN1Ym1pdHRlZCBmcm9tIGFuICdvcCcgZXZlbnRcbiAgICB2YXIgbWVzc2FnZURvY0RhdGFWZXJzaW9uID0gcHJlc2VuY2UuX2RvY0RhdGFWZXJzaW9uQnlQcmVzZW5jZVZlcnNpb25bbWVzc2FnZS5wdl07XG4gICAgaWYgKG1lc3NhZ2VEb2NEYXRhVmVyc2lvbiA+PSBkb2NEYXRhVmVyc2lvbikgcmV0dXJuO1xuICAgIHRyeSB7XG4gICAgICBtZXNzYWdlLnAgPSBwcmVzZW5jZS5fdHJhbnNmb3JtUHJlc2VuY2UobWVzc2FnZS5wLCBvcCwgc291cmNlKTtcbiAgICAgIC8vIEVuc3VyZSB0aGUgcHJlc2VuY2UncyBkYXRhIHZlcnNpb24gaXMga2VwdCBjb25zaXN0ZW50IHRvIGRlYWwgd2l0aCBcImRlZXBcIiBvcFxuICAgICAgLy8gc3VibWlzc2lvbnNcbiAgICAgIHByZXNlbmNlLl9kb2NEYXRhVmVyc2lvbkJ5UHJlc2VuY2VWZXJzaW9uW21lc3NhZ2UucHZdID0gZG9jRGF0YVZlcnNpb247XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHZhciBjYWxsYmFjayA9IHByZXNlbmNlLl9nZXRDYWxsYmFjayhtZXNzYWdlLnB2KTtcbiAgICAgIHByZXNlbmNlLl9jYWxsYmFja09yRW1pdChlcnJvciwgY2FsbGJhY2spO1xuICAgIH1cbiAgfSk7XG5cbiAgdHJ5IHtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy5fdHJhbnNmb3JtUHJlc2VuY2UodGhpcy52YWx1ZSwgb3AsIHNvdXJjZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhpcy5lbWl0KCdlcnJvcicsIGVycm9yKTtcbiAgfVxufTtcblxuTG9jYWxEb2NQcmVzZW5jZS5wcm90b3R5cGUuX2hhbmRsZUNyZWF0ZU9yRGVsID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuX3BlbmRpbmdNZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICBtZXNzYWdlLnAgPSBudWxsO1xuICB9KTtcblxuICB0aGlzLnZhbHVlID0gbnVsbDtcbn07XG5cbkxvY2FsRG9jUHJlc2VuY2UucHJvdG90eXBlLl9oYW5kbGVMb2FkID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMudmFsdWUgPSBudWxsO1xuICB0aGlzLl9wZW5kaW5nTWVzc2FnZXMgPSBbXTtcbiAgdGhpcy5fZG9jRGF0YVZlcnNpb25CeVByZXNlbmNlVmVyc2lvbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG59O1xuXG5Mb2NhbERvY1ByZXNlbmNlLnByb3RvdHlwZS5fbWVzc2FnZSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgbWVzc2FnZSA9IExvY2FsUHJlc2VuY2UucHJvdG90eXBlLl9tZXNzYWdlLmNhbGwodGhpcyk7XG4gIG1lc3NhZ2UuYyA9IHRoaXMuY29sbGVjdGlvbixcbiAgbWVzc2FnZS5kID0gdGhpcy5pZCxcbiAgbWVzc2FnZS52ID0gbnVsbDtcbiAgbWVzc2FnZS50ID0gbnVsbDtcbiAgcmV0dXJuIG1lc3NhZ2U7XG59O1xuXG5Mb2NhbERvY1ByZXNlbmNlLnByb3RvdHlwZS5fdHJhbnNmb3JtUHJlc2VuY2UgPSBmdW5jdGlvbih2YWx1ZSwgb3AsIHNvdXJjZSkge1xuICB2YXIgdHlwZSA9IHRoaXMuX2RvYy50eXBlO1xuICBpZiAoIXV0aWwuc3VwcG9ydHNQcmVzZW5jZSh0eXBlKSkge1xuICAgIHRocm93IG5ldyBTaGFyZURCRXJyb3IoXG4gICAgICBFUlJPUl9DT0RFLkVSUl9UWVBFX0RPRVNfTk9UX1NVUFBPUlRfUFJFU0VOQ0UsXG4gICAgICAnVHlwZSBkb2VzIG5vdCBzdXBwb3J0IHByZXNlbmNlOiAnICsgdHlwZS5uYW1lXG4gICAgKTtcbiAgfVxuICByZXR1cm4gdHlwZS50cmFuc2Zvcm1QcmVzZW5jZSh2YWx1ZSwgb3AsIHNvdXJjZSk7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/local-doc-presence.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/local-presence.js":
/*!********************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/local-presence.js ***!
  \********************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var emitter = __webpack_require__(/*! ../../emitter */ \"(ssr)/./node_modules/sharedb/lib/emitter.js\");\nvar ACTIONS = (__webpack_require__(/*! ../../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\nvar util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\n\nmodule.exports = LocalPresence;\nfunction LocalPresence(presence, presenceId) {\n  emitter.EventEmitter.call(this);\n\n  if (!presenceId || typeof presenceId !== 'string') {\n    throw new Error('LocalPresence presenceId must be a string');\n  }\n\n  this.presence = presence;\n  this.presenceId = presenceId;\n  this.connection = presence.connection;\n  this.presenceVersion = 0;\n\n  this.value = null;\n\n  this._pendingMessages = [];\n  this._callbacksByPresenceVersion = Object.create(null);\n}\nemitter.mixin(LocalPresence);\n\nLocalPresence.prototype.submit = function(value, callback) {\n  this.value = value;\n  this.send(callback);\n};\n\nLocalPresence.prototype.send = function(callback) {\n  var message = this._message();\n  this._pendingMessages.push(message);\n  this._callbacksByPresenceVersion[message.pv] = callback;\n  this._sendPending();\n};\n\nLocalPresence.prototype.destroy = function(callback) {\n  var presence = this;\n  this.submit(null, function(error) {\n    if (error) return presence._callbackOrEmit(error, callback);\n    delete presence.presence.localPresences[presence.presenceId];\n    if (callback) callback();\n  });\n};\n\nLocalPresence.prototype._sendPending = function() {\n  if (!this.connection.canSend) return;\n  var presence = this;\n  this._pendingMessages.forEach(function(message) {\n    presence.connection.send(message);\n  });\n\n  this._pendingMessages = [];\n};\n\nLocalPresence.prototype._ack = function(error, presenceVersion) {\n  var callback = this._getCallback(presenceVersion);\n  this._callbackOrEmit(error, callback);\n};\n\nLocalPresence.prototype._message = function() {\n  return {\n    a: ACTIONS.presence,\n    ch: this.presence.channel,\n    id: this.presenceId,\n    p: this.value,\n    pv: this.presenceVersion++\n  };\n};\n\nLocalPresence.prototype._getCallback = function(presenceVersion) {\n  var callback = this._callbacksByPresenceVersion[presenceVersion];\n  delete this._callbacksByPresenceVersion[presenceVersion];\n  return callback;\n};\n\nLocalPresence.prototype._callbackOrEmit = function(error, callback) {\n  if (callback) return util.nextTick(callback, error);\n  if (error) this.emit('error', error);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL2xvY2FsLXByZXNlbmNlLmpzIiwibWFwcGluZ3MiOiJBQUFBLGNBQWMsbUJBQU8sQ0FBQyxrRUFBZTtBQUNyQyxjQUFjLGlIQUF3QztBQUN0RCxXQUFXLG1CQUFPLENBQUMsNERBQVk7O0FBRS9CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvcHJlc2VuY2UvbG9jYWwtcHJlc2VuY2UuanM/Njg2YyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZW1pdHRlciA9IHJlcXVpcmUoJy4uLy4uL2VtaXR0ZXInKTtcbnZhciBBQ1RJT05TID0gcmVxdWlyZSgnLi4vLi4vbWVzc2FnZS1hY3Rpb25zJykuQUNUSU9OUztcbnZhciB1dGlsID0gcmVxdWlyZSgnLi4vLi4vdXRpbCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IExvY2FsUHJlc2VuY2U7XG5mdW5jdGlvbiBMb2NhbFByZXNlbmNlKHByZXNlbmNlLCBwcmVzZW5jZUlkKSB7XG4gIGVtaXR0ZXIuRXZlbnRFbWl0dGVyLmNhbGwodGhpcyk7XG5cbiAgaWYgKCFwcmVzZW5jZUlkIHx8IHR5cGVvZiBwcmVzZW5jZUlkICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxQcmVzZW5jZSBwcmVzZW5jZUlkIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgfVxuXG4gIHRoaXMucHJlc2VuY2UgPSBwcmVzZW5jZTtcbiAgdGhpcy5wcmVzZW5jZUlkID0gcHJlc2VuY2VJZDtcbiAgdGhpcy5jb25uZWN0aW9uID0gcHJlc2VuY2UuY29ubmVjdGlvbjtcbiAgdGhpcy5wcmVzZW5jZVZlcnNpb24gPSAwO1xuXG4gIHRoaXMudmFsdWUgPSBudWxsO1xuXG4gIHRoaXMuX3BlbmRpbmdNZXNzYWdlcyA9IFtdO1xuICB0aGlzLl9jYWxsYmFja3NCeVByZXNlbmNlVmVyc2lvbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG59XG5lbWl0dGVyLm1peGluKExvY2FsUHJlc2VuY2UpO1xuXG5Mb2NhbFByZXNlbmNlLnByb3RvdHlwZS5zdWJtaXQgPSBmdW5jdGlvbih2YWx1ZSwgY2FsbGJhY2spIHtcbiAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICB0aGlzLnNlbmQoY2FsbGJhY2spO1xufTtcblxuTG9jYWxQcmVzZW5jZS5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gIHZhciBtZXNzYWdlID0gdGhpcy5fbWVzc2FnZSgpO1xuICB0aGlzLl9wZW5kaW5nTWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgdGhpcy5fY2FsbGJhY2tzQnlQcmVzZW5jZVZlcnNpb25bbWVzc2FnZS5wdl0gPSBjYWxsYmFjaztcbiAgdGhpcy5fc2VuZFBlbmRpbmcoKTtcbn07XG5cbkxvY2FsUHJlc2VuY2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB2YXIgcHJlc2VuY2UgPSB0aGlzO1xuICB0aGlzLnN1Ym1pdChudWxsLCBmdW5jdGlvbihlcnJvcikge1xuICAgIGlmIChlcnJvcikgcmV0dXJuIHByZXNlbmNlLl9jYWxsYmFja09yRW1pdChlcnJvciwgY2FsbGJhY2spO1xuICAgIGRlbGV0ZSBwcmVzZW5jZS5wcmVzZW5jZS5sb2NhbFByZXNlbmNlc1twcmVzZW5jZS5wcmVzZW5jZUlkXTtcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gIH0pO1xufTtcblxuTG9jYWxQcmVzZW5jZS5wcm90b3R5cGUuX3NlbmRQZW5kaW5nID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5jb25uZWN0aW9uLmNhblNlbmQpIHJldHVybjtcbiAgdmFyIHByZXNlbmNlID0gdGhpcztcbiAgdGhpcy5fcGVuZGluZ01lc3NhZ2VzLmZvckVhY2goZnVuY3Rpb24obWVzc2FnZSkge1xuICAgIHByZXNlbmNlLmNvbm5lY3Rpb24uc2VuZChtZXNzYWdlKTtcbiAgfSk7XG5cbiAgdGhpcy5fcGVuZGluZ01lc3NhZ2VzID0gW107XG59O1xuXG5Mb2NhbFByZXNlbmNlLnByb3RvdHlwZS5fYWNrID0gZnVuY3Rpb24oZXJyb3IsIHByZXNlbmNlVmVyc2lvbikge1xuICB2YXIgY2FsbGJhY2sgPSB0aGlzLl9nZXRDYWxsYmFjayhwcmVzZW5jZVZlcnNpb24pO1xuICB0aGlzLl9jYWxsYmFja09yRW1pdChlcnJvciwgY2FsbGJhY2spO1xufTtcblxuTG9jYWxQcmVzZW5jZS5wcm90b3R5cGUuX21lc3NhZ2UgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHtcbiAgICBhOiBBQ1RJT05TLnByZXNlbmNlLFxuICAgIGNoOiB0aGlzLnByZXNlbmNlLmNoYW5uZWwsXG4gICAgaWQ6IHRoaXMucHJlc2VuY2VJZCxcbiAgICBwOiB0aGlzLnZhbHVlLFxuICAgIHB2OiB0aGlzLnByZXNlbmNlVmVyc2lvbisrXG4gIH07XG59O1xuXG5Mb2NhbFByZXNlbmNlLnByb3RvdHlwZS5fZ2V0Q2FsbGJhY2sgPSBmdW5jdGlvbihwcmVzZW5jZVZlcnNpb24pIHtcbiAgdmFyIGNhbGxiYWNrID0gdGhpcy5fY2FsbGJhY2tzQnlQcmVzZW5jZVZlcnNpb25bcHJlc2VuY2VWZXJzaW9uXTtcbiAgZGVsZXRlIHRoaXMuX2NhbGxiYWNrc0J5UHJlc2VuY2VWZXJzaW9uW3ByZXNlbmNlVmVyc2lvbl07XG4gIHJldHVybiBjYWxsYmFjaztcbn07XG5cbkxvY2FsUHJlc2VuY2UucHJvdG90eXBlLl9jYWxsYmFja09yRW1pdCA9IGZ1bmN0aW9uKGVycm9yLCBjYWxsYmFjaykge1xuICBpZiAoY2FsbGJhY2spIHJldHVybiB1dGlsLm5leHRUaWNrKGNhbGxiYWNrLCBlcnJvcik7XG4gIGlmIChlcnJvcikgdGhpcy5lbWl0KCdlcnJvcicsIGVycm9yKTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/local-presence.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/presence.js":
/*!**************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/presence.js ***!
  \**************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var emitter = __webpack_require__(/*! ../../emitter */ \"(ssr)/./node_modules/sharedb/lib/emitter.js\");\nvar LocalPresence = __webpack_require__(/*! ./local-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/local-presence.js\");\nvar RemotePresence = __webpack_require__(/*! ./remote-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/remote-presence.js\");\nvar util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar async = __webpack_require__(/*! async */ \"(ssr)/./node_modules/async/dist/async.mjs\");\nvar hat = __webpack_require__(/*! hat */ \"(ssr)/./node_modules/hat/index.js\");\nvar ACTIONS = (__webpack_require__(/*! ../../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\n\nmodule.exports = Presence;\nfunction Presence(connection, channel) {\n  emitter.EventEmitter.call(this);\n\n  if (!channel || typeof channel !== 'string') {\n    throw new Error('Presence channel must be provided');\n  }\n\n  this.connection = connection;\n  this.channel = channel;\n\n  this.wantSubscribe = false;\n  this.subscribed = false;\n  this.remotePresences = Object.create(null);\n  this.localPresences = Object.create(null);\n\n  this._remotePresenceInstances = Object.create(null);\n  this._subscriptionCallbacksBySeq = Object.create(null);\n  this._wantsDestroy = false;\n}\nemitter.mixin(Presence);\n\nPresence.prototype.subscribe = function(callback) {\n  this._sendSubscriptionAction(true, callback);\n};\n\nPresence.prototype.unsubscribe = function(callback) {\n  this._sendSubscriptionAction(false, callback);\n};\n\nPresence.prototype.create = function(id) {\n  if (this._wantsDestroy) {\n    throw new Error('Presence is being destroyed');\n  }\n  id = id || hat();\n  var localPresence = this._createLocalPresence(id);\n  this.localPresences[id] = localPresence;\n  return localPresence;\n};\n\nPresence.prototype.destroy = function(callback) {\n  this._wantsDestroy = true;\n  var presence = this;\n  // Store these at the time of destruction: any LocalPresence on this\n  // instance at this time will be destroyed, but if the destroy is\n  // cancelled, any future LocalPresence objects will be kept.\n  // See: https://github.com/share/sharedb/pull/579\n  var localIds = Object.keys(presence.localPresences);\n  this.unsubscribe(function(error) {\n    if (error) return presence._callbackOrEmit(error, callback);\n    var remoteIds = Object.keys(presence._remotePresenceInstances);\n    async.parallel(\n      [\n        function(next) {\n          async.each(localIds, function(presenceId, next) {\n            var localPresence = presence.localPresences[presenceId];\n            if (!localPresence) return next();\n            localPresence.destroy(next);\n          }, next);\n        },\n        function(next) {\n          // We don't bother stashing the RemotePresence instances because\n          // they're not really bound to our local state: if we want to\n          // destroy, we destroy them all, but if we cancel the destroy,\n          // we'll want to keep them all\n          if (!presence._wantsDestroy) return next();\n          async.each(remoteIds, function(presenceId, next) {\n            presence._remotePresenceInstances[presenceId].destroy(next);\n          }, next);\n        }\n      ],\n      function(error) {\n        if (presence._wantsDestroy) delete presence.connection._presences[presence.channel];\n        presence._callbackOrEmit(error, callback);\n      }\n    );\n  });\n};\n\nPresence.prototype._sendSubscriptionAction = function(wantSubscribe, callback) {\n  wantSubscribe = !!wantSubscribe;\n  if (wantSubscribe === this.wantSubscribe) {\n    if (!callback) return;\n    if (wantSubscribe === this.subscribed) return util.nextTick(callback);\n    if (Object.keys(this._subscriptionCallbacksBySeq).length) {\n      return this._combineSubscribeCallbackWithLastAdded(callback);\n    }\n  }\n  this.wantSubscribe = wantSubscribe;\n  var action = this.wantSubscribe ? ACTIONS.presenceSubscribe : ACTIONS.presenceUnsubscribe;\n  var seq = this.connection._presenceSeq++;\n  this._subscriptionCallbacksBySeq[seq] = callback;\n  if (this.connection.canSend) {\n    this.connection._sendPresenceAction(action, seq, this);\n  }\n};\n\nPresence.prototype._requestRemotePresence = function() {\n  this.connection._requestRemotePresence(this.channel);\n};\n\nPresence.prototype._handleSubscribe = function(error, seq) {\n  if (this.wantSubscribe) this.subscribed = true;\n  var callback = this._subscriptionCallback(seq);\n  this._callbackOrEmit(error, callback);\n};\n\nPresence.prototype._handleUnsubscribe = function(error, seq) {\n  this.subscribed = false;\n  var callback = this._subscriptionCallback(seq);\n  this._callbackOrEmit(error, callback);\n};\n\nPresence.prototype._receiveUpdate = function(error, message) {\n  var localPresence = util.dig(this.localPresences, message.id);\n  if (localPresence) return localPresence._ack(error, message.pv);\n\n  if (error) return this.emit('error', error);\n  var presence = this;\n  var remotePresence = util.digOrCreate(this._remotePresenceInstances, message.id, function() {\n    return presence._createRemotePresence(message.id);\n  });\n\n  remotePresence.receiveUpdate(message);\n};\n\nPresence.prototype._updateRemotePresence = function(remotePresence) {\n  this.remotePresences[remotePresence.presenceId] = remotePresence.value;\n  if (remotePresence.value === null) this._removeRemotePresence(remotePresence.presenceId);\n  this.emit('receive', remotePresence.presenceId, remotePresence.value);\n};\n\nPresence.prototype._broadcastAllLocalPresence = function(error) {\n  if (error) return this.emit('error', error);\n  for (var id in this.localPresences) {\n    var localPresence = this.localPresences[id];\n    if (localPresence.value !== null) localPresence.send();\n  }\n};\n\nPresence.prototype._removeRemotePresence = function(id) {\n  this._remotePresenceInstances[id].destroy();\n  delete this._remotePresenceInstances[id];\n  delete this.remotePresences[id];\n};\n\nPresence.prototype._onConnectionStateChanged = function() {\n  if (!this.connection.canSend) {\n    this.subscribed = false;\n    return;\n  }\n  this._resubscribe();\n  for (var id in this.localPresences) {\n    this.localPresences[id]._sendPending();\n  }\n};\n\nPresence.prototype._resubscribe = function() {\n  var callbacks = [];\n  for (var seq in this._subscriptionCallbacksBySeq) {\n    var callback = this._subscriptionCallback(seq);\n    callbacks.push(callback);\n  }\n\n  if (!this.wantSubscribe) return this._callEachOrEmit(callbacks);\n\n  var presence = this;\n  this.subscribe(function(error) {\n    presence._callEachOrEmit(callbacks, error);\n  });\n};\n\nPresence.prototype._subscriptionCallback = function(seq) {\n  var callback = this._subscriptionCallbacksBySeq[seq];\n  delete this._subscriptionCallbacksBySeq[seq];\n  return callback;\n};\n\nPresence.prototype._callbackOrEmit = function(error, callback) {\n  if (callback) return util.nextTick(callback, error);\n  if (error) this.emit('error', error);\n};\n\nPresence.prototype._createLocalPresence = function(id) {\n  return new LocalPresence(this, id);\n};\n\nPresence.prototype._createRemotePresence = function(id) {\n  return new RemotePresence(this, id);\n};\n\nPresence.prototype._callEachOrEmit = function(callbacks, error) {\n  var called = util.callEach(callbacks, error);\n  if (!called && error) this.emit('error', error);\n};\n\nPresence.prototype._combineSubscribeCallbackWithLastAdded = function(callback) {\n  var seqs = Object.keys(this._subscriptionCallbacksBySeq);\n  var lastSeq = seqs[seqs.length - 1];\n  var originalCallback = this._subscriptionCallbacksBySeq[lastSeq];\n  if (!originalCallback) return this._subscriptionCallbacksBySeq[lastSeq] = callback;\n  this._subscriptionCallbacksBySeq[lastSeq] = function(error) {\n    originalCallback(error);\n    callback(error);\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL3ByZXNlbmNlLmpzIiwibWFwcGluZ3MiOiJBQUFBLGNBQWMsbUJBQU8sQ0FBQyxrRUFBZTtBQUNyQyxvQkFBb0IsbUJBQU8sQ0FBQyw0RkFBa0I7QUFDOUMscUJBQXFCLG1CQUFPLENBQUMsOEZBQW1CO0FBQ2hELFdBQVcsbUJBQU8sQ0FBQyw0REFBWTtBQUMvQixZQUFZLG1CQUFPLENBQUMsd0RBQU87QUFDM0IsVUFBVSxtQkFBTyxDQUFDLDhDQUFLO0FBQ3ZCLGNBQWMsaUhBQXdDOztBQUV0RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL2NsaWVudC9wcmVzZW5jZS9wcmVzZW5jZS5qcz8xOGYzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBlbWl0dGVyID0gcmVxdWlyZSgnLi4vLi4vZW1pdHRlcicpO1xudmFyIExvY2FsUHJlc2VuY2UgPSByZXF1aXJlKCcuL2xvY2FsLXByZXNlbmNlJyk7XG52YXIgUmVtb3RlUHJlc2VuY2UgPSByZXF1aXJlKCcuL3JlbW90ZS1wcmVzZW5jZScpO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuLi8uLi91dGlsJyk7XG52YXIgYXN5bmMgPSByZXF1aXJlKCdhc3luYycpO1xudmFyIGhhdCA9IHJlcXVpcmUoJ2hhdCcpO1xudmFyIEFDVElPTlMgPSByZXF1aXJlKCcuLi8uLi9tZXNzYWdlLWFjdGlvbnMnKS5BQ1RJT05TO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZXNlbmNlO1xuZnVuY3Rpb24gUHJlc2VuY2UoY29ubmVjdGlvbiwgY2hhbm5lbCkge1xuICBlbWl0dGVyLkV2ZW50RW1pdHRlci5jYWxsKHRoaXMpO1xuXG4gIGlmICghY2hhbm5lbCB8fCB0eXBlb2YgY2hhbm5lbCAhPT0gJ3N0cmluZycpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByZXNlbmNlIGNoYW5uZWwgbXVzdCBiZSBwcm92aWRlZCcpO1xuICB9XG5cbiAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgdGhpcy5jaGFubmVsID0gY2hhbm5lbDtcblxuICB0aGlzLndhbnRTdWJzY3JpYmUgPSBmYWxzZTtcbiAgdGhpcy5zdWJzY3JpYmVkID0gZmFsc2U7XG4gIHRoaXMucmVtb3RlUHJlc2VuY2VzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgdGhpcy5sb2NhbFByZXNlbmNlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgdGhpcy5fcmVtb3RlUHJlc2VuY2VJbnN0YW5jZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFja3NCeVNlcSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIHRoaXMuX3dhbnRzRGVzdHJveSA9IGZhbHNlO1xufVxuZW1pdHRlci5taXhpbihQcmVzZW5jZSk7XG5cblByZXNlbmNlLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB0aGlzLl9zZW5kU3Vic2NyaXB0aW9uQWN0aW9uKHRydWUsIGNhbGxiYWNrKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gIHRoaXMuX3NlbmRTdWJzY3JpcHRpb25BY3Rpb24oZmFsc2UsIGNhbGxiYWNrKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbihpZCkge1xuICBpZiAodGhpcy5fd2FudHNEZXN0cm95KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQcmVzZW5jZSBpcyBiZWluZyBkZXN0cm95ZWQnKTtcbiAgfVxuICBpZCA9IGlkIHx8IGhhdCgpO1xuICB2YXIgbG9jYWxQcmVzZW5jZSA9IHRoaXMuX2NyZWF0ZUxvY2FsUHJlc2VuY2UoaWQpO1xuICB0aGlzLmxvY2FsUHJlc2VuY2VzW2lkXSA9IGxvY2FsUHJlc2VuY2U7XG4gIHJldHVybiBsb2NhbFByZXNlbmNlO1xufTtcblxuUHJlc2VuY2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB0aGlzLl93YW50c0Rlc3Ryb3kgPSB0cnVlO1xuICB2YXIgcHJlc2VuY2UgPSB0aGlzO1xuICAvLyBTdG9yZSB0aGVzZSBhdCB0aGUgdGltZSBvZiBkZXN0cnVjdGlvbjogYW55IExvY2FsUHJlc2VuY2Ugb24gdGhpc1xuICAvLyBpbnN0YW5jZSBhdCB0aGlzIHRpbWUgd2lsbCBiZSBkZXN0cm95ZWQsIGJ1dCBpZiB0aGUgZGVzdHJveSBpc1xuICAvLyBjYW5jZWxsZWQsIGFueSBmdXR1cmUgTG9jYWxQcmVzZW5jZSBvYmplY3RzIHdpbGwgYmUga2VwdC5cbiAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vc2hhcmUvc2hhcmVkYi9wdWxsLzU3OVxuICB2YXIgbG9jYWxJZHMgPSBPYmplY3Qua2V5cyhwcmVzZW5jZS5sb2NhbFByZXNlbmNlcyk7XG4gIHRoaXMudW5zdWJzY3JpYmUoZnVuY3Rpb24oZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IpIHJldHVybiBwcmVzZW5jZS5fY2FsbGJhY2tPckVtaXQoZXJyb3IsIGNhbGxiYWNrKTtcbiAgICB2YXIgcmVtb3RlSWRzID0gT2JqZWN0LmtleXMocHJlc2VuY2UuX3JlbW90ZVByZXNlbmNlSW5zdGFuY2VzKTtcbiAgICBhc3luYy5wYXJhbGxlbChcbiAgICAgIFtcbiAgICAgICAgZnVuY3Rpb24obmV4dCkge1xuICAgICAgICAgIGFzeW5jLmVhY2gobG9jYWxJZHMsIGZ1bmN0aW9uKHByZXNlbmNlSWQsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBsb2NhbFByZXNlbmNlID0gcHJlc2VuY2UubG9jYWxQcmVzZW5jZXNbcHJlc2VuY2VJZF07XG4gICAgICAgICAgICBpZiAoIWxvY2FsUHJlc2VuY2UpIHJldHVybiBuZXh0KCk7XG4gICAgICAgICAgICBsb2NhbFByZXNlbmNlLmRlc3Ryb3kobmV4dCk7XG4gICAgICAgICAgfSwgbmV4dCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKG5leHQpIHtcbiAgICAgICAgICAvLyBXZSBkb24ndCBib3RoZXIgc3Rhc2hpbmcgdGhlIFJlbW90ZVByZXNlbmNlIGluc3RhbmNlcyBiZWNhdXNlXG4gICAgICAgICAgLy8gdGhleSdyZSBub3QgcmVhbGx5IGJvdW5kIHRvIG91ciBsb2NhbCBzdGF0ZTogaWYgd2Ugd2FudCB0b1xuICAgICAgICAgIC8vIGRlc3Ryb3ksIHdlIGRlc3Ryb3kgdGhlbSBhbGwsIGJ1dCBpZiB3ZSBjYW5jZWwgdGhlIGRlc3Ryb3ksXG4gICAgICAgICAgLy8gd2UnbGwgd2FudCB0byBrZWVwIHRoZW0gYWxsXG4gICAgICAgICAgaWYgKCFwcmVzZW5jZS5fd2FudHNEZXN0cm95KSByZXR1cm4gbmV4dCgpO1xuICAgICAgICAgIGFzeW5jLmVhY2gocmVtb3RlSWRzLCBmdW5jdGlvbihwcmVzZW5jZUlkLCBuZXh0KSB7XG4gICAgICAgICAgICBwcmVzZW5jZS5fcmVtb3RlUHJlc2VuY2VJbnN0YW5jZXNbcHJlc2VuY2VJZF0uZGVzdHJveShuZXh0KTtcbiAgICAgICAgICB9LCBuZXh0KTtcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIGlmIChwcmVzZW5jZS5fd2FudHNEZXN0cm95KSBkZWxldGUgcHJlc2VuY2UuY29ubmVjdGlvbi5fcHJlc2VuY2VzW3ByZXNlbmNlLmNoYW5uZWxdO1xuICAgICAgICBwcmVzZW5jZS5fY2FsbGJhY2tPckVtaXQoZXJyb3IsIGNhbGxiYWNrKTtcbiAgICAgIH1cbiAgICApO1xuICB9KTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fc2VuZFN1YnNjcmlwdGlvbkFjdGlvbiA9IGZ1bmN0aW9uKHdhbnRTdWJzY3JpYmUsIGNhbGxiYWNrKSB7XG4gIHdhbnRTdWJzY3JpYmUgPSAhIXdhbnRTdWJzY3JpYmU7XG4gIGlmICh3YW50U3Vic2NyaWJlID09PSB0aGlzLndhbnRTdWJzY3JpYmUpIHtcbiAgICBpZiAoIWNhbGxiYWNrKSByZXR1cm47XG4gICAgaWYgKHdhbnRTdWJzY3JpYmUgPT09IHRoaXMuc3Vic2NyaWJlZCkgcmV0dXJuIHV0aWwubmV4dFRpY2soY2FsbGJhY2spO1xuICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFja3NCeVNlcSkubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY29tYmluZVN1YnNjcmliZUNhbGxiYWNrV2l0aExhc3RBZGRlZChjYWxsYmFjayk7XG4gICAgfVxuICB9XG4gIHRoaXMud2FudFN1YnNjcmliZSA9IHdhbnRTdWJzY3JpYmU7XG4gIHZhciBhY3Rpb24gPSB0aGlzLndhbnRTdWJzY3JpYmUgPyBBQ1RJT05TLnByZXNlbmNlU3Vic2NyaWJlIDogQUNUSU9OUy5wcmVzZW5jZVVuc3Vic2NyaWJlO1xuICB2YXIgc2VxID0gdGhpcy5jb25uZWN0aW9uLl9wcmVzZW5jZVNlcSsrO1xuICB0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFja3NCeVNlcVtzZXFdID0gY2FsbGJhY2s7XG4gIGlmICh0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCkge1xuICAgIHRoaXMuY29ubmVjdGlvbi5fc2VuZFByZXNlbmNlQWN0aW9uKGFjdGlvbiwgc2VxLCB0aGlzKTtcbiAgfVxufTtcblxuUHJlc2VuY2UucHJvdG90eXBlLl9yZXF1ZXN0UmVtb3RlUHJlc2VuY2UgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jb25uZWN0aW9uLl9yZXF1ZXN0UmVtb3RlUHJlc2VuY2UodGhpcy5jaGFubmVsKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5faGFuZGxlU3Vic2NyaWJlID0gZnVuY3Rpb24oZXJyb3IsIHNlcSkge1xuICBpZiAodGhpcy53YW50U3Vic2NyaWJlKSB0aGlzLnN1YnNjcmliZWQgPSB0cnVlO1xuICB2YXIgY2FsbGJhY2sgPSB0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFjayhzZXEpO1xuICB0aGlzLl9jYWxsYmFja09yRW1pdChlcnJvciwgY2FsbGJhY2spO1xufTtcblxuUHJlc2VuY2UucHJvdG90eXBlLl9oYW5kbGVVbnN1YnNjcmliZSA9IGZ1bmN0aW9uKGVycm9yLCBzZXEpIHtcbiAgdGhpcy5zdWJzY3JpYmVkID0gZmFsc2U7XG4gIHZhciBjYWxsYmFjayA9IHRoaXMuX3N1YnNjcmlwdGlvbkNhbGxiYWNrKHNlcSk7XG4gIHRoaXMuX2NhbGxiYWNrT3JFbWl0KGVycm9yLCBjYWxsYmFjayk7XG59O1xuXG5QcmVzZW5jZS5wcm90b3R5cGUuX3JlY2VpdmVVcGRhdGUgPSBmdW5jdGlvbihlcnJvciwgbWVzc2FnZSkge1xuICB2YXIgbG9jYWxQcmVzZW5jZSA9IHV0aWwuZGlnKHRoaXMubG9jYWxQcmVzZW5jZXMsIG1lc3NhZ2UuaWQpO1xuICBpZiAobG9jYWxQcmVzZW5jZSkgcmV0dXJuIGxvY2FsUHJlc2VuY2UuX2FjayhlcnJvciwgbWVzc2FnZS5wdik7XG5cbiAgaWYgKGVycm9yKSByZXR1cm4gdGhpcy5lbWl0KCdlcnJvcicsIGVycm9yKTtcbiAgdmFyIHByZXNlbmNlID0gdGhpcztcbiAgdmFyIHJlbW90ZVByZXNlbmNlID0gdXRpbC5kaWdPckNyZWF0ZSh0aGlzLl9yZW1vdGVQcmVzZW5jZUluc3RhbmNlcywgbWVzc2FnZS5pZCwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHByZXNlbmNlLl9jcmVhdGVSZW1vdGVQcmVzZW5jZShtZXNzYWdlLmlkKTtcbiAgfSk7XG5cbiAgcmVtb3RlUHJlc2VuY2UucmVjZWl2ZVVwZGF0ZShtZXNzYWdlKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fdXBkYXRlUmVtb3RlUHJlc2VuY2UgPSBmdW5jdGlvbihyZW1vdGVQcmVzZW5jZSkge1xuICB0aGlzLnJlbW90ZVByZXNlbmNlc1tyZW1vdGVQcmVzZW5jZS5wcmVzZW5jZUlkXSA9IHJlbW90ZVByZXNlbmNlLnZhbHVlO1xuICBpZiAocmVtb3RlUHJlc2VuY2UudmFsdWUgPT09IG51bGwpIHRoaXMuX3JlbW92ZVJlbW90ZVByZXNlbmNlKHJlbW90ZVByZXNlbmNlLnByZXNlbmNlSWQpO1xuICB0aGlzLmVtaXQoJ3JlY2VpdmUnLCByZW1vdGVQcmVzZW5jZS5wcmVzZW5jZUlkLCByZW1vdGVQcmVzZW5jZS52YWx1ZSk7XG59O1xuXG5QcmVzZW5jZS5wcm90b3R5cGUuX2Jyb2FkY2FzdEFsbExvY2FsUHJlc2VuY2UgPSBmdW5jdGlvbihlcnJvcikge1xuICBpZiAoZXJyb3IpIHJldHVybiB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyb3IpO1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLmxvY2FsUHJlc2VuY2VzKSB7XG4gICAgdmFyIGxvY2FsUHJlc2VuY2UgPSB0aGlzLmxvY2FsUHJlc2VuY2VzW2lkXTtcbiAgICBpZiAobG9jYWxQcmVzZW5jZS52YWx1ZSAhPT0gbnVsbCkgbG9jYWxQcmVzZW5jZS5zZW5kKCk7XG4gIH1cbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fcmVtb3ZlUmVtb3RlUHJlc2VuY2UgPSBmdW5jdGlvbihpZCkge1xuICB0aGlzLl9yZW1vdGVQcmVzZW5jZUluc3RhbmNlc1tpZF0uZGVzdHJveSgpO1xuICBkZWxldGUgdGhpcy5fcmVtb3RlUHJlc2VuY2VJbnN0YW5jZXNbaWRdO1xuICBkZWxldGUgdGhpcy5yZW1vdGVQcmVzZW5jZXNbaWRdO1xufTtcblxuUHJlc2VuY2UucHJvdG90eXBlLl9vbkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCkge1xuICAgIHRoaXMuc3Vic2NyaWJlZCA9IGZhbHNlO1xuICAgIHJldHVybjtcbiAgfVxuICB0aGlzLl9yZXN1YnNjcmliZSgpO1xuICBmb3IgKHZhciBpZCBpbiB0aGlzLmxvY2FsUHJlc2VuY2VzKSB7XG4gICAgdGhpcy5sb2NhbFByZXNlbmNlc1tpZF0uX3NlbmRQZW5kaW5nKCk7XG4gIH1cbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fcmVzdWJzY3JpYmUgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGNhbGxiYWNrcyA9IFtdO1xuICBmb3IgKHZhciBzZXEgaW4gdGhpcy5fc3Vic2NyaXB0aW9uQ2FsbGJhY2tzQnlTZXEpIHtcbiAgICB2YXIgY2FsbGJhY2sgPSB0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFjayhzZXEpO1xuICAgIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIGlmICghdGhpcy53YW50U3Vic2NyaWJlKSByZXR1cm4gdGhpcy5fY2FsbEVhY2hPckVtaXQoY2FsbGJhY2tzKTtcblxuICB2YXIgcHJlc2VuY2UgPSB0aGlzO1xuICB0aGlzLnN1YnNjcmliZShmdW5jdGlvbihlcnJvcikge1xuICAgIHByZXNlbmNlLl9jYWxsRWFjaE9yRW1pdChjYWxsYmFja3MsIGVycm9yKTtcbiAgfSk7XG59O1xuXG5QcmVzZW5jZS5wcm90b3R5cGUuX3N1YnNjcmlwdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24oc2VxKSB7XG4gIHZhciBjYWxsYmFjayA9IHRoaXMuX3N1YnNjcmlwdGlvbkNhbGxiYWNrc0J5U2VxW3NlcV07XG4gIGRlbGV0ZSB0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFja3NCeVNlcVtzZXFdO1xuICByZXR1cm4gY2FsbGJhY2s7XG59O1xuXG5QcmVzZW5jZS5wcm90b3R5cGUuX2NhbGxiYWNrT3JFbWl0ID0gZnVuY3Rpb24oZXJyb3IsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjaykgcmV0dXJuIHV0aWwubmV4dFRpY2soY2FsbGJhY2ssIGVycm9yKTtcbiAgaWYgKGVycm9yKSB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyb3IpO1xufTtcblxuUHJlc2VuY2UucHJvdG90eXBlLl9jcmVhdGVMb2NhbFByZXNlbmNlID0gZnVuY3Rpb24oaWQpIHtcbiAgcmV0dXJuIG5ldyBMb2NhbFByZXNlbmNlKHRoaXMsIGlkKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fY3JlYXRlUmVtb3RlUHJlc2VuY2UgPSBmdW5jdGlvbihpZCkge1xuICByZXR1cm4gbmV3IFJlbW90ZVByZXNlbmNlKHRoaXMsIGlkKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fY2FsbEVhY2hPckVtaXQgPSBmdW5jdGlvbihjYWxsYmFja3MsIGVycm9yKSB7XG4gIHZhciBjYWxsZWQgPSB1dGlsLmNhbGxFYWNoKGNhbGxiYWNrcywgZXJyb3IpO1xuICBpZiAoIWNhbGxlZCAmJiBlcnJvcikgdGhpcy5lbWl0KCdlcnJvcicsIGVycm9yKTtcbn07XG5cblByZXNlbmNlLnByb3RvdHlwZS5fY29tYmluZVN1YnNjcmliZUNhbGxiYWNrV2l0aExhc3RBZGRlZCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gIHZhciBzZXFzID0gT2JqZWN0LmtleXModGhpcy5fc3Vic2NyaXB0aW9uQ2FsbGJhY2tzQnlTZXEpO1xuICB2YXIgbGFzdFNlcSA9IHNlcXNbc2Vxcy5sZW5ndGggLSAxXTtcbiAgdmFyIG9yaWdpbmFsQ2FsbGJhY2sgPSB0aGlzLl9zdWJzY3JpcHRpb25DYWxsYmFja3NCeVNlcVtsYXN0U2VxXTtcbiAgaWYgKCFvcmlnaW5hbENhbGxiYWNrKSByZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uQ2FsbGJhY2tzQnlTZXFbbGFzdFNlcV0gPSBjYWxsYmFjaztcbiAgdGhpcy5fc3Vic2NyaXB0aW9uQ2FsbGJhY2tzQnlTZXFbbGFzdFNlcV0gPSBmdW5jdGlvbihlcnJvcikge1xuICAgIG9yaWdpbmFsQ2FsbGJhY2soZXJyb3IpO1xuICAgIGNhbGxiYWNrKGVycm9yKTtcbiAgfTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/presence.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/remote-doc-presence.js":
/*!*************************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/remote-doc-presence.js ***!
  \*************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var RemotePresence = __webpack_require__(/*! ./remote-presence */ \"(ssr)/./node_modules/sharedb/lib/client/presence/remote-presence.js\");\nvar ot = __webpack_require__(/*! ../../ot */ \"(ssr)/./node_modules/sharedb/lib/ot.js\");\n\nmodule.exports = RemoteDocPresence;\nfunction RemoteDocPresence(presence, presenceId) {\n  RemotePresence.call(this, presence, presenceId);\n\n  this.collection = this.presence.collection;\n  this.id = this.presence.id;\n  this.src = null;\n  this.presenceVersion = null;\n\n  this._doc = this.connection.get(this.collection, this.id);\n  this._emitter = this.connection._docPresenceEmitter;\n  this._pending = null;\n  this._opCache = null;\n  this._pendingSetPending = false;\n\n  this._opHandler = this._handleOp.bind(this);\n  this._createDelHandler = this._handleCreateDel.bind(this);\n  this._loadHandler = this._handleLoad.bind(this);\n  this._registerWithDoc();\n}\n\nRemoteDocPresence.prototype = Object.create(RemotePresence.prototype);\n\nRemoteDocPresence.prototype.receiveUpdate = function(message) {\n  if (this._pending && message.pv < this._pending.pv) return;\n  this.src = message.src;\n  this._pending = message;\n  this._setPendingPresence();\n};\n\nRemoteDocPresence.prototype.destroy = function(callback) {\n  this._emitter.removeEventListener(this._doc, 'op', this._opHandler);\n  this._emitter.removeEventListener(this._doc, 'create', this._createDelHandler);\n  this._emitter.removeEventListener(this._doc, 'del', this._createDelHandler);\n  this._emitter.removeEventListener(this._doc, 'load', this._loadHandler);\n\n  RemotePresence.prototype.destroy.call(this, callback);\n};\n\nRemoteDocPresence.prototype._registerWithDoc = function() {\n  this._emitter.addEventListener(this._doc, 'op', this._opHandler);\n  this._emitter.addEventListener(this._doc, 'create', this._createDelHandler);\n  this._emitter.addEventListener(this._doc, 'del', this._createDelHandler);\n  this._emitter.addEventListener(this._doc, 'load', this._loadHandler);\n};\n\nRemoteDocPresence.prototype._setPendingPresence = function() {\n  if (this._pendingSetPending) return;\n  this._pendingSetPending = true;\n  var presence = this;\n  this._doc.whenNothingPending(function() {\n    presence._pendingSetPending = false;\n    if (!presence._pending) return;\n    if (presence._pending.pv < presence.presenceVersion) return presence._pending = null;\n\n    if (presence._pending.v > presence._doc.version) {\n      return presence._doc.fetch();\n    }\n\n    if (!presence._catchUpStalePresence()) return;\n\n    presence.value = presence._pending.p;\n    presence.presenceVersion = presence._pending.pv;\n    presence._pending = null;\n    presence.presence._updateRemotePresence(presence);\n  });\n};\n\nRemoteDocPresence.prototype._handleOp = function(op, source, connectionId) {\n  var isOwnOp = connectionId === this.src;\n  this._transformAgainstOp(op, isOwnOp);\n  this._cacheOp(op, isOwnOp);\n  this._setPendingPresence();\n};\n\nRemotePresence.prototype._handleCreateDel = function() {\n  this._cacheOp(null);\n  this._setPendingPresence();\n};\n\nRemotePresence.prototype._handleLoad = function() {\n  this.value = null;\n  this._pending = null;\n  this._opCache = null;\n  this.presence._updateRemotePresence(this);\n};\n\nRemoteDocPresence.prototype._transformAgainstOp = function(op, isOwnOp) {\n  if (!this.value) return;\n\n  try {\n    this.value = this._doc.type.transformPresence(this.value, op, isOwnOp);\n  } catch (error) {\n    return this.presence.emit('error', error);\n  }\n  this.presence._updateRemotePresence(this);\n};\n\nRemoteDocPresence.prototype._catchUpStalePresence = function() {\n  if (this._pending.v >= this._doc.version) return true;\n\n  if (!this._opCache) {\n    this._startCachingOps();\n    this._doc.fetch();\n    this.presence._requestRemotePresence();\n    return false;\n  }\n\n  while (this._opCache[this._pending.v]) {\n    var item = this._opCache[this._pending.v];\n    var op = item.op;\n    var isOwnOp = item.isOwnOp;\n    // We use a null op to signify a create or a delete operation. In both\n    // cases we just want to reset the presence (which doesn't make sense\n    // in a new document), so just set the presence to null.\n    if (op === null) {\n      this._pending.p = null;\n      this._pending.v++;\n    } else {\n      ot.transformPresence(this._pending, op, isOwnOp);\n    }\n  }\n\n  var hasCaughtUp = this._pending.v >= this._doc.version;\n  if (hasCaughtUp) {\n    this._stopCachingOps();\n  }\n\n  return hasCaughtUp;\n};\n\nRemoteDocPresence.prototype._startCachingOps = function() {\n  this._opCache = [];\n};\n\nRemoteDocPresence.prototype._stopCachingOps = function() {\n  this._opCache = null;\n};\n\nRemoteDocPresence.prototype._cacheOp = function(op, isOwnOp) {\n  if (this._opCache) {\n    op = op ? {op: op} : null;\n    // Subtract 1 from the current doc version, because an op with v3\n    // should be read as the op that takes a doc from v3 -> v4\n    this._opCache[this._doc.version - 1] = {op: op, isOwnOp: isOwnOp};\n  }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL3JlbW90ZS1kb2MtcHJlc2VuY2UuanMiLCJtYXBwaW5ncyI6IkFBQUEscUJBQXFCLG1CQUFPLENBQUMsOEZBQW1CO0FBQ2hELFNBQVMsbUJBQU8sQ0FBQyx3REFBVTs7QUFFM0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvcHJlc2VuY2UvcmVtb3RlLWRvYy1wcmVzZW5jZS5qcz9kNTNkIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBSZW1vdGVQcmVzZW5jZSA9IHJlcXVpcmUoJy4vcmVtb3RlLXByZXNlbmNlJyk7XG52YXIgb3QgPSByZXF1aXJlKCcuLi8uLi9vdCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlbW90ZURvY1ByZXNlbmNlO1xuZnVuY3Rpb24gUmVtb3RlRG9jUHJlc2VuY2UocHJlc2VuY2UsIHByZXNlbmNlSWQpIHtcbiAgUmVtb3RlUHJlc2VuY2UuY2FsbCh0aGlzLCBwcmVzZW5jZSwgcHJlc2VuY2VJZCk7XG5cbiAgdGhpcy5jb2xsZWN0aW9uID0gdGhpcy5wcmVzZW5jZS5jb2xsZWN0aW9uO1xuICB0aGlzLmlkID0gdGhpcy5wcmVzZW5jZS5pZDtcbiAgdGhpcy5zcmMgPSBudWxsO1xuICB0aGlzLnByZXNlbmNlVmVyc2lvbiA9IG51bGw7XG5cbiAgdGhpcy5fZG9jID0gdGhpcy5jb25uZWN0aW9uLmdldCh0aGlzLmNvbGxlY3Rpb24sIHRoaXMuaWQpO1xuICB0aGlzLl9lbWl0dGVyID0gdGhpcy5jb25uZWN0aW9uLl9kb2NQcmVzZW5jZUVtaXR0ZXI7XG4gIHRoaXMuX3BlbmRpbmcgPSBudWxsO1xuICB0aGlzLl9vcENhY2hlID0gbnVsbDtcbiAgdGhpcy5fcGVuZGluZ1NldFBlbmRpbmcgPSBmYWxzZTtcblxuICB0aGlzLl9vcEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVPcC5iaW5kKHRoaXMpO1xuICB0aGlzLl9jcmVhdGVEZWxIYW5kbGVyID0gdGhpcy5faGFuZGxlQ3JlYXRlRGVsLmJpbmQodGhpcyk7XG4gIHRoaXMuX2xvYWRIYW5kbGVyID0gdGhpcy5faGFuZGxlTG9hZC5iaW5kKHRoaXMpO1xuICB0aGlzLl9yZWdpc3RlcldpdGhEb2MoKTtcbn1cblxuUmVtb3RlRG9jUHJlc2VuY2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShSZW1vdGVQcmVzZW5jZS5wcm90b3R5cGUpO1xuXG5SZW1vdGVEb2NQcmVzZW5jZS5wcm90b3R5cGUucmVjZWl2ZVVwZGF0ZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgaWYgKHRoaXMuX3BlbmRpbmcgJiYgbWVzc2FnZS5wdiA8IHRoaXMuX3BlbmRpbmcucHYpIHJldHVybjtcbiAgdGhpcy5zcmMgPSBtZXNzYWdlLnNyYztcbiAgdGhpcy5fcGVuZGluZyA9IG1lc3NhZ2U7XG4gIHRoaXMuX3NldFBlbmRpbmdQcmVzZW5jZSgpO1xufTtcblxuUmVtb3RlRG9jUHJlc2VuY2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICB0aGlzLl9lbWl0dGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fZG9jLCAnb3AnLCB0aGlzLl9vcEhhbmRsZXIpO1xuICB0aGlzLl9lbWl0dGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fZG9jLCAnY3JlYXRlJywgdGhpcy5fY3JlYXRlRGVsSGFuZGxlcik7XG4gIHRoaXMuX2VtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLl9kb2MsICdkZWwnLCB0aGlzLl9jcmVhdGVEZWxIYW5kbGVyKTtcbiAgdGhpcy5fZW1pdHRlci5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX2RvYywgJ2xvYWQnLCB0aGlzLl9sb2FkSGFuZGxlcik7XG5cbiAgUmVtb3RlUHJlc2VuY2UucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzLCBjYWxsYmFjayk7XG59O1xuXG5SZW1vdGVEb2NQcmVzZW5jZS5wcm90b3R5cGUuX3JlZ2lzdGVyV2l0aERvYyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLl9lbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5fZG9jLCAnb3AnLCB0aGlzLl9vcEhhbmRsZXIpO1xuICB0aGlzLl9lbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5fZG9jLCAnY3JlYXRlJywgdGhpcy5fY3JlYXRlRGVsSGFuZGxlcik7XG4gIHRoaXMuX2VtaXR0ZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLl9kb2MsICdkZWwnLCB0aGlzLl9jcmVhdGVEZWxIYW5kbGVyKTtcbiAgdGhpcy5fZW1pdHRlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuX2RvYywgJ2xvYWQnLCB0aGlzLl9sb2FkSGFuZGxlcik7XG59O1xuXG5SZW1vdGVEb2NQcmVzZW5jZS5wcm90b3R5cGUuX3NldFBlbmRpbmdQcmVzZW5jZSA9IGZ1bmN0aW9uKCkge1xuICBpZiAodGhpcy5fcGVuZGluZ1NldFBlbmRpbmcpIHJldHVybjtcbiAgdGhpcy5fcGVuZGluZ1NldFBlbmRpbmcgPSB0cnVlO1xuICB2YXIgcHJlc2VuY2UgPSB0aGlzO1xuICB0aGlzLl9kb2Mud2hlbk5vdGhpbmdQZW5kaW5nKGZ1bmN0aW9uKCkge1xuICAgIHByZXNlbmNlLl9wZW5kaW5nU2V0UGVuZGluZyA9IGZhbHNlO1xuICAgIGlmICghcHJlc2VuY2UuX3BlbmRpbmcpIHJldHVybjtcbiAgICBpZiAocHJlc2VuY2UuX3BlbmRpbmcucHYgPCBwcmVzZW5jZS5wcmVzZW5jZVZlcnNpb24pIHJldHVybiBwcmVzZW5jZS5fcGVuZGluZyA9IG51bGw7XG5cbiAgICBpZiAocHJlc2VuY2UuX3BlbmRpbmcudiA+IHByZXNlbmNlLl9kb2MudmVyc2lvbikge1xuICAgICAgcmV0dXJuIHByZXNlbmNlLl9kb2MuZmV0Y2goKTtcbiAgICB9XG5cbiAgICBpZiAoIXByZXNlbmNlLl9jYXRjaFVwU3RhbGVQcmVzZW5jZSgpKSByZXR1cm47XG5cbiAgICBwcmVzZW5jZS52YWx1ZSA9IHByZXNlbmNlLl9wZW5kaW5nLnA7XG4gICAgcHJlc2VuY2UucHJlc2VuY2VWZXJzaW9uID0gcHJlc2VuY2UuX3BlbmRpbmcucHY7XG4gICAgcHJlc2VuY2UuX3BlbmRpbmcgPSBudWxsO1xuICAgIHByZXNlbmNlLnByZXNlbmNlLl91cGRhdGVSZW1vdGVQcmVzZW5jZShwcmVzZW5jZSk7XG4gIH0pO1xufTtcblxuUmVtb3RlRG9jUHJlc2VuY2UucHJvdG90eXBlLl9oYW5kbGVPcCA9IGZ1bmN0aW9uKG9wLCBzb3VyY2UsIGNvbm5lY3Rpb25JZCkge1xuICB2YXIgaXNPd25PcCA9IGNvbm5lY3Rpb25JZCA9PT0gdGhpcy5zcmM7XG4gIHRoaXMuX3RyYW5zZm9ybUFnYWluc3RPcChvcCwgaXNPd25PcCk7XG4gIHRoaXMuX2NhY2hlT3Aob3AsIGlzT3duT3ApO1xuICB0aGlzLl9zZXRQZW5kaW5nUHJlc2VuY2UoKTtcbn07XG5cblJlbW90ZVByZXNlbmNlLnByb3RvdHlwZS5faGFuZGxlQ3JlYXRlRGVsID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuX2NhY2hlT3AobnVsbCk7XG4gIHRoaXMuX3NldFBlbmRpbmdQcmVzZW5jZSgpO1xufTtcblxuUmVtb3RlUHJlc2VuY2UucHJvdG90eXBlLl9oYW5kbGVMb2FkID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMudmFsdWUgPSBudWxsO1xuICB0aGlzLl9wZW5kaW5nID0gbnVsbDtcbiAgdGhpcy5fb3BDYWNoZSA9IG51bGw7XG4gIHRoaXMucHJlc2VuY2UuX3VwZGF0ZVJlbW90ZVByZXNlbmNlKHRoaXMpO1xufTtcblxuUmVtb3RlRG9jUHJlc2VuY2UucHJvdG90eXBlLl90cmFuc2Zvcm1BZ2FpbnN0T3AgPSBmdW5jdGlvbihvcCwgaXNPd25PcCkge1xuICBpZiAoIXRoaXMudmFsdWUpIHJldHVybjtcblxuICB0cnkge1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLl9kb2MudHlwZS50cmFuc2Zvcm1QcmVzZW5jZSh0aGlzLnZhbHVlLCBvcCwgaXNPd25PcCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHRoaXMucHJlc2VuY2UuZW1pdCgnZXJyb3InLCBlcnJvcik7XG4gIH1cbiAgdGhpcy5wcmVzZW5jZS5fdXBkYXRlUmVtb3RlUHJlc2VuY2UodGhpcyk7XG59O1xuXG5SZW1vdGVEb2NQcmVzZW5jZS5wcm90b3R5cGUuX2NhdGNoVXBTdGFsZVByZXNlbmNlID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLl9wZW5kaW5nLnYgPj0gdGhpcy5fZG9jLnZlcnNpb24pIHJldHVybiB0cnVlO1xuXG4gIGlmICghdGhpcy5fb3BDYWNoZSkge1xuICAgIHRoaXMuX3N0YXJ0Q2FjaGluZ09wcygpO1xuICAgIHRoaXMuX2RvYy5mZXRjaCgpO1xuICAgIHRoaXMucHJlc2VuY2UuX3JlcXVlc3RSZW1vdGVQcmVzZW5jZSgpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHdoaWxlICh0aGlzLl9vcENhY2hlW3RoaXMuX3BlbmRpbmcudl0pIHtcbiAgICB2YXIgaXRlbSA9IHRoaXMuX29wQ2FjaGVbdGhpcy5fcGVuZGluZy52XTtcbiAgICB2YXIgb3AgPSBpdGVtLm9wO1xuICAgIHZhciBpc093bk9wID0gaXRlbS5pc093bk9wO1xuICAgIC8vIFdlIHVzZSBhIG51bGwgb3AgdG8gc2lnbmlmeSBhIGNyZWF0ZSBvciBhIGRlbGV0ZSBvcGVyYXRpb24uIEluIGJvdGhcbiAgICAvLyBjYXNlcyB3ZSBqdXN0IHdhbnQgdG8gcmVzZXQgdGhlIHByZXNlbmNlICh3aGljaCBkb2Vzbid0IG1ha2Ugc2Vuc2VcbiAgICAvLyBpbiBhIG5ldyBkb2N1bWVudCksIHNvIGp1c3Qgc2V0IHRoZSBwcmVzZW5jZSB0byBudWxsLlxuICAgIGlmIChvcCA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5fcGVuZGluZy5wID0gbnVsbDtcbiAgICAgIHRoaXMuX3BlbmRpbmcudisrO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdC50cmFuc2Zvcm1QcmVzZW5jZSh0aGlzLl9wZW5kaW5nLCBvcCwgaXNPd25PcCk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGhhc0NhdWdodFVwID0gdGhpcy5fcGVuZGluZy52ID49IHRoaXMuX2RvYy52ZXJzaW9uO1xuICBpZiAoaGFzQ2F1Z2h0VXApIHtcbiAgICB0aGlzLl9zdG9wQ2FjaGluZ09wcygpO1xuICB9XG5cbiAgcmV0dXJuIGhhc0NhdWdodFVwO1xufTtcblxuUmVtb3RlRG9jUHJlc2VuY2UucHJvdG90eXBlLl9zdGFydENhY2hpbmdPcHMgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5fb3BDYWNoZSA9IFtdO1xufTtcblxuUmVtb3RlRG9jUHJlc2VuY2UucHJvdG90eXBlLl9zdG9wQ2FjaGluZ09wcyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLl9vcENhY2hlID0gbnVsbDtcbn07XG5cblJlbW90ZURvY1ByZXNlbmNlLnByb3RvdHlwZS5fY2FjaGVPcCA9IGZ1bmN0aW9uKG9wLCBpc093bk9wKSB7XG4gIGlmICh0aGlzLl9vcENhY2hlKSB7XG4gICAgb3AgPSBvcCA/IHtvcDogb3B9IDogbnVsbDtcbiAgICAvLyBTdWJ0cmFjdCAxIGZyb20gdGhlIGN1cnJlbnQgZG9jIHZlcnNpb24sIGJlY2F1c2UgYW4gb3Agd2l0aCB2M1xuICAgIC8vIHNob3VsZCBiZSByZWFkIGFzIHRoZSBvcCB0aGF0IHRha2VzIGEgZG9jIGZyb20gdjMgLT4gdjRcbiAgICB0aGlzLl9vcENhY2hlW3RoaXMuX2RvYy52ZXJzaW9uIC0gMV0gPSB7b3A6IG9wLCBpc093bk9wOiBpc093bk9wfTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/remote-doc-presence.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/presence/remote-presence.js":
/*!*********************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/presence/remote-presence.js ***!
  \*********************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\n\nmodule.exports = RemotePresence;\nfunction RemotePresence(presence, presenceId) {\n  this.presence = presence;\n  this.presenceId = presenceId;\n  this.connection = this.presence.connection;\n\n  this.value = null;\n  this.presenceVersion = 0;\n}\n\nRemotePresence.prototype.receiveUpdate = function(message) {\n  if (message.pv < this.presenceVersion) return;\n  this.value = message.p;\n  this.presenceVersion = message.pv;\n  this.presence._updateRemotePresence(this);\n};\n\nRemotePresence.prototype.destroy = function(callback) {\n  delete this.presence._remotePresenceInstances[this.presenceId];\n  delete this.presence.remotePresences[this.presenceId];\n  if (callback) util.nextTick(callback);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3ByZXNlbmNlL3JlbW90ZS1wcmVzZW5jZS5qcyIsIm1hcHBpbmdzIjoiQUFBQSxXQUFXLG1CQUFPLENBQUMsNERBQVk7O0FBRS9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvcHJlc2VuY2UvcmVtb3RlLXByZXNlbmNlLmpzPzcyNDYiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHV0aWwgPSByZXF1aXJlKCcuLi8uLi91dGlsJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVtb3RlUHJlc2VuY2U7XG5mdW5jdGlvbiBSZW1vdGVQcmVzZW5jZShwcmVzZW5jZSwgcHJlc2VuY2VJZCkge1xuICB0aGlzLnByZXNlbmNlID0gcHJlc2VuY2U7XG4gIHRoaXMucHJlc2VuY2VJZCA9IHByZXNlbmNlSWQ7XG4gIHRoaXMuY29ubmVjdGlvbiA9IHRoaXMucHJlc2VuY2UuY29ubmVjdGlvbjtcblxuICB0aGlzLnZhbHVlID0gbnVsbDtcbiAgdGhpcy5wcmVzZW5jZVZlcnNpb24gPSAwO1xufVxuXG5SZW1vdGVQcmVzZW5jZS5wcm90b3R5cGUucmVjZWl2ZVVwZGF0ZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgaWYgKG1lc3NhZ2UucHYgPCB0aGlzLnByZXNlbmNlVmVyc2lvbikgcmV0dXJuO1xuICB0aGlzLnZhbHVlID0gbWVzc2FnZS5wO1xuICB0aGlzLnByZXNlbmNlVmVyc2lvbiA9IG1lc3NhZ2UucHY7XG4gIHRoaXMucHJlc2VuY2UuX3VwZGF0ZVJlbW90ZVByZXNlbmNlKHRoaXMpO1xufTtcblxuUmVtb3RlUHJlc2VuY2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICBkZWxldGUgdGhpcy5wcmVzZW5jZS5fcmVtb3RlUHJlc2VuY2VJbnN0YW5jZXNbdGhpcy5wcmVzZW5jZUlkXTtcbiAgZGVsZXRlIHRoaXMucHJlc2VuY2UucmVtb3RlUHJlc2VuY2VzW3RoaXMucHJlc2VuY2VJZF07XG4gIGlmIChjYWxsYmFjaykgdXRpbC5uZXh0VGljayhjYWxsYmFjayk7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/presence/remote-presence.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/query.js":
/*!**************************************************!*\
  !*** ./node_modules/sharedb/lib/client/query.js ***!
  \**************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var emitter = __webpack_require__(/*! ../emitter */ \"(ssr)/./node_modules/sharedb/lib/emitter.js\");\nvar ACTIONS = (__webpack_require__(/*! ../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\nvar util = __webpack_require__(/*! ../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\n\n// Queries are live requests to the database for particular sets of fields.\n//\n// The server actively tells the client when there's new data that matches\n// a set of conditions.\nmodule.exports = Query;\nfunction Query(action, connection, id, collection, query, options, callback) {\n  emitter.EventEmitter.call(this);\n\n  // 'qf' or 'qs'\n  this.action = action;\n\n  this.connection = connection;\n  this.id = id;\n  this.collection = collection;\n\n  // The query itself. For mongo, this should look something like {\"data.x\":5}\n  this.query = query;\n\n  // A list of resulting documents. These are actual documents, complete with\n  // data and all the rest. It is possible to pass in an initial results set,\n  // so that a query can be serialized and then re-established\n  this.results = null;\n  if (options && options.results) {\n    this.results = options.results;\n    delete options.results;\n  }\n  this.extra = undefined;\n\n  // Options to pass through with the query\n  this.options = options;\n\n  this.callback = callback;\n  this.ready = false;\n  this.sent = false;\n}\nemitter.mixin(Query);\n\nQuery.prototype.hasPending = function() {\n  return !this.ready;\n};\n\n// Helper for subscribe & fetch, since they share the same message format.\n//\n// This function actually issues the query.\nQuery.prototype.send = function() {\n  if (!this.connection.canSend) return;\n\n  var message = {\n    a: this.action,\n    id: this.id,\n    c: this.collection,\n    q: this.query\n  };\n  if (this.options) {\n    message.o = this.options;\n  }\n  if (this.results) {\n    // Collect the version of all the documents in the current result set so we\n    // don't need to be sent their snapshots again.\n    var results = [];\n    for (var i = 0; i < this.results.length; i++) {\n      var doc = this.results[i];\n      results.push([doc.id, doc.version]);\n    }\n    message.r = results;\n  }\n\n  this.connection.send(message);\n  this.sent = true;\n};\n\n// Destroy the query object. Any subsequent messages for the query will be\n// ignored by the connection.\nQuery.prototype.destroy = function(callback) {\n  if (this.connection.canSend && this.action === ACTIONS.querySubscribe) {\n    this.connection.send({a: ACTIONS.queryUnsubscribe, id: this.id});\n  }\n  this.connection._destroyQuery(this);\n  // There is a callback for consistency, but we don't actually wait for the\n  // server's unsubscribe message currently\n  if (callback) util.nextTick(callback);\n};\n\nQuery.prototype._onConnectionStateChanged = function() {\n  if (this.connection.canSend && !this.sent) {\n    this.send();\n  } else {\n    this.sent = false;\n  }\n};\n\nQuery.prototype._handleFetch = function(err, data, extra) {\n  // Once a fetch query gets its data, it is destroyed.\n  this.connection._destroyQuery(this);\n  this._handleResponse(err, data, extra);\n};\n\nQuery.prototype._handleSubscribe = function(err, data, extra) {\n  this._handleResponse(err, data, extra);\n};\n\nQuery.prototype._handleResponse = function(err, data, extra) {\n  var callback = this.callback;\n  this.callback = null;\n  if (err) return this._finishResponse(err, callback);\n  if (!data) return this._finishResponse(null, callback);\n\n  var query = this;\n  var wait = 1;\n  var finish = function(err) {\n    if (err) return query._finishResponse(err, callback);\n    if (--wait) return;\n    query._finishResponse(null, callback);\n  };\n\n  if (Array.isArray(data)) {\n    wait += data.length;\n    this.results = this._ingestSnapshots(data, finish);\n    this.extra = extra;\n  } else {\n    for (var id in data) {\n      wait++;\n      var snapshot = data[id];\n      var doc = this.connection.get(snapshot.c || this.collection, id);\n      doc.ingestSnapshot(snapshot, finish);\n    }\n  }\n\n  finish();\n};\n\nQuery.prototype._ingestSnapshots = function(snapshots, finish) {\n  var results = [];\n  for (var i = 0; i < snapshots.length; i++) {\n    var snapshot = snapshots[i];\n    var doc = this.connection.get(snapshot.c || this.collection, snapshot.d);\n    doc.ingestSnapshot(snapshot, finish);\n    results.push(doc);\n  }\n  return results;\n};\n\nQuery.prototype._finishResponse = function(err, callback) {\n  this.emit('ready');\n  this.ready = true;\n  if (err) {\n    this.connection._destroyQuery(this);\n    if (callback) return callback(err);\n    return this.emit('error', err);\n  }\n  if (callback) callback(null, this.results, this.extra);\n};\n\nQuery.prototype._handleError = function(err) {\n  this.emit('error', err);\n};\n\nQuery.prototype._handleDiff = function(diff) {\n  // We need to go through the list twice. First, we'll ingest all the new\n  // documents. After that we'll emit events and actually update our list.\n  // This avoids race conditions around setting documents to be subscribed &\n  // unsubscribing documents in event callbacks.\n  for (var i = 0; i < diff.length; i++) {\n    var d = diff[i];\n    if (d.type === 'insert') d.values = this._ingestSnapshots(d.values);\n  }\n\n  for (var i = 0; i < diff.length; i++) {\n    var d = diff[i];\n    switch (d.type) {\n      case 'insert':\n        var newDocs = d.values;\n        Array.prototype.splice.apply(this.results, [d.index, 0].concat(newDocs));\n        this.emit('insert', newDocs, d.index);\n        break;\n      case 'remove':\n        var howMany = d.howMany || 1;\n        var removed = this.results.splice(d.index, howMany);\n        this.emit('remove', removed, d.index);\n        break;\n      case 'move':\n        var howMany = d.howMany || 1;\n        var docs = this.results.splice(d.from, howMany);\n        Array.prototype.splice.apply(this.results, [d.to, 0].concat(docs));\n        this.emit('move', docs, d.from, d.to);\n        break;\n    }\n  }\n\n  this.emit('changed', this.results);\n};\n\nQuery.prototype._handleExtra = function(extra) {\n  this.extra = extra;\n  this.emit('extra', extra);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3F1ZXJ5LmpzIiwibWFwcGluZ3MiOiJBQUFBLGNBQWMsbUJBQU8sQ0FBQywrREFBWTtBQUNsQyxjQUFjLDhHQUFxQztBQUNuRCxXQUFXLG1CQUFPLENBQUMseURBQVM7O0FBRTVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLG1FQUFtRTtBQUNuRTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHlCQUF5QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix5Q0FBeUM7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0Isc0JBQXNCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlCQUFpQjtBQUNuQztBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLGlCQUFpQjtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL2NsaWVudC9xdWVyeS5qcz8wMjZmIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBlbWl0dGVyID0gcmVxdWlyZSgnLi4vZW1pdHRlcicpO1xudmFyIEFDVElPTlMgPSByZXF1aXJlKCcuLi9tZXNzYWdlLWFjdGlvbnMnKS5BQ1RJT05TO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuLi91dGlsJyk7XG5cbi8vIFF1ZXJpZXMgYXJlIGxpdmUgcmVxdWVzdHMgdG8gdGhlIGRhdGFiYXNlIGZvciBwYXJ0aWN1bGFyIHNldHMgb2YgZmllbGRzLlxuLy9cbi8vIFRoZSBzZXJ2ZXIgYWN0aXZlbHkgdGVsbHMgdGhlIGNsaWVudCB3aGVuIHRoZXJlJ3MgbmV3IGRhdGEgdGhhdCBtYXRjaGVzXG4vLyBhIHNldCBvZiBjb25kaXRpb25zLlxubW9kdWxlLmV4cG9ydHMgPSBRdWVyeTtcbmZ1bmN0aW9uIFF1ZXJ5KGFjdGlvbiwgY29ubmVjdGlvbiwgaWQsIGNvbGxlY3Rpb24sIHF1ZXJ5LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBlbWl0dGVyLkV2ZW50RW1pdHRlci5jYWxsKHRoaXMpO1xuXG4gIC8vICdxZicgb3IgJ3FzJ1xuICB0aGlzLmFjdGlvbiA9IGFjdGlvbjtcblxuICB0aGlzLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICB0aGlzLmlkID0gaWQ7XG4gIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG5cbiAgLy8gVGhlIHF1ZXJ5IGl0c2VsZi4gRm9yIG1vbmdvLCB0aGlzIHNob3VsZCBsb29rIHNvbWV0aGluZyBsaWtlIHtcImRhdGEueFwiOjV9XG4gIHRoaXMucXVlcnkgPSBxdWVyeTtcblxuICAvLyBBIGxpc3Qgb2YgcmVzdWx0aW5nIGRvY3VtZW50cy4gVGhlc2UgYXJlIGFjdHVhbCBkb2N1bWVudHMsIGNvbXBsZXRlIHdpdGhcbiAgLy8gZGF0YSBhbmQgYWxsIHRoZSByZXN0LiBJdCBpcyBwb3NzaWJsZSB0byBwYXNzIGluIGFuIGluaXRpYWwgcmVzdWx0cyBzZXQsXG4gIC8vIHNvIHRoYXQgYSBxdWVyeSBjYW4gYmUgc2VyaWFsaXplZCBhbmQgdGhlbiByZS1lc3RhYmxpc2hlZFxuICB0aGlzLnJlc3VsdHMgPSBudWxsO1xuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnJlc3VsdHMpIHtcbiAgICB0aGlzLnJlc3VsdHMgPSBvcHRpb25zLnJlc3VsdHM7XG4gICAgZGVsZXRlIG9wdGlvbnMucmVzdWx0cztcbiAgfVxuICB0aGlzLmV4dHJhID0gdW5kZWZpbmVkO1xuXG4gIC8vIE9wdGlvbnMgdG8gcGFzcyB0aHJvdWdoIHdpdGggdGhlIHF1ZXJ5XG4gIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG4gIHRoaXMuc2VudCA9IGZhbHNlO1xufVxuZW1pdHRlci5taXhpbihRdWVyeSk7XG5cblF1ZXJ5LnByb3RvdHlwZS5oYXNQZW5kaW5nID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAhdGhpcy5yZWFkeTtcbn07XG5cbi8vIEhlbHBlciBmb3Igc3Vic2NyaWJlICYgZmV0Y2gsIHNpbmNlIHRoZXkgc2hhcmUgdGhlIHNhbWUgbWVzc2FnZSBmb3JtYXQuXG4vL1xuLy8gVGhpcyBmdW5jdGlvbiBhY3R1YWxseSBpc3N1ZXMgdGhlIHF1ZXJ5LlxuUXVlcnkucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCkgcmV0dXJuO1xuXG4gIHZhciBtZXNzYWdlID0ge1xuICAgIGE6IHRoaXMuYWN0aW9uLFxuICAgIGlkOiB0aGlzLmlkLFxuICAgIGM6IHRoaXMuY29sbGVjdGlvbixcbiAgICBxOiB0aGlzLnF1ZXJ5XG4gIH07XG4gIGlmICh0aGlzLm9wdGlvbnMpIHtcbiAgICBtZXNzYWdlLm8gPSB0aGlzLm9wdGlvbnM7XG4gIH1cbiAgaWYgKHRoaXMucmVzdWx0cykge1xuICAgIC8vIENvbGxlY3QgdGhlIHZlcnNpb24gb2YgYWxsIHRoZSBkb2N1bWVudHMgaW4gdGhlIGN1cnJlbnQgcmVzdWx0IHNldCBzbyB3ZVxuICAgIC8vIGRvbid0IG5lZWQgdG8gYmUgc2VudCB0aGVpciBzbmFwc2hvdHMgYWdhaW4uXG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGRvYyA9IHRoaXMucmVzdWx0c1tpXTtcbiAgICAgIHJlc3VsdHMucHVzaChbZG9jLmlkLCBkb2MudmVyc2lvbl0pO1xuICAgIH1cbiAgICBtZXNzYWdlLnIgPSByZXN1bHRzO1xuICB9XG5cbiAgdGhpcy5jb25uZWN0aW9uLnNlbmQobWVzc2FnZSk7XG4gIHRoaXMuc2VudCA9IHRydWU7XG59O1xuXG4vLyBEZXN0cm95IHRoZSBxdWVyeSBvYmplY3QuIEFueSBzdWJzZXF1ZW50IG1lc3NhZ2VzIGZvciB0aGUgcXVlcnkgd2lsbCBiZVxuLy8gaWdub3JlZCBieSB0aGUgY29ubmVjdGlvbi5cblF1ZXJ5LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgaWYgKHRoaXMuY29ubmVjdGlvbi5jYW5TZW5kICYmIHRoaXMuYWN0aW9uID09PSBBQ1RJT05TLnF1ZXJ5U3Vic2NyaWJlKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLnNlbmQoe2E6IEFDVElPTlMucXVlcnlVbnN1YnNjcmliZSwgaWQ6IHRoaXMuaWR9KTtcbiAgfVxuICB0aGlzLmNvbm5lY3Rpb24uX2Rlc3Ryb3lRdWVyeSh0aGlzKTtcbiAgLy8gVGhlcmUgaXMgYSBjYWxsYmFjayBmb3IgY29uc2lzdGVuY3ksIGJ1dCB3ZSBkb24ndCBhY3R1YWxseSB3YWl0IGZvciB0aGVcbiAgLy8gc2VydmVyJ3MgdW5zdWJzY3JpYmUgbWVzc2FnZSBjdXJyZW50bHlcbiAgaWYgKGNhbGxiYWNrKSB1dGlsLm5leHRUaWNrKGNhbGxiYWNrKTtcbn07XG5cblF1ZXJ5LnByb3RvdHlwZS5fb25Db25uZWN0aW9uU3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCAmJiAhdGhpcy5zZW50KSB7XG4gICAgdGhpcy5zZW5kKCk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5zZW50ID0gZmFsc2U7XG4gIH1cbn07XG5cblF1ZXJ5LnByb3RvdHlwZS5faGFuZGxlRmV0Y2ggPSBmdW5jdGlvbihlcnIsIGRhdGEsIGV4dHJhKSB7XG4gIC8vIE9uY2UgYSBmZXRjaCBxdWVyeSBnZXRzIGl0cyBkYXRhLCBpdCBpcyBkZXN0cm95ZWQuXG4gIHRoaXMuY29ubmVjdGlvbi5fZGVzdHJveVF1ZXJ5KHRoaXMpO1xuICB0aGlzLl9oYW5kbGVSZXNwb25zZShlcnIsIGRhdGEsIGV4dHJhKTtcbn07XG5cblF1ZXJ5LnByb3RvdHlwZS5faGFuZGxlU3Vic2NyaWJlID0gZnVuY3Rpb24oZXJyLCBkYXRhLCBleHRyYSkge1xuICB0aGlzLl9oYW5kbGVSZXNwb25zZShlcnIsIGRhdGEsIGV4dHJhKTtcbn07XG5cblF1ZXJ5LnByb3RvdHlwZS5faGFuZGxlUmVzcG9uc2UgPSBmdW5jdGlvbihlcnIsIGRhdGEsIGV4dHJhKSB7XG4gIHZhciBjYWxsYmFjayA9IHRoaXMuY2FsbGJhY2s7XG4gIHRoaXMuY2FsbGJhY2sgPSBudWxsO1xuICBpZiAoZXJyKSByZXR1cm4gdGhpcy5fZmluaXNoUmVzcG9uc2UoZXJyLCBjYWxsYmFjayk7XG4gIGlmICghZGF0YSkgcmV0dXJuIHRoaXMuX2ZpbmlzaFJlc3BvbnNlKG51bGwsIGNhbGxiYWNrKTtcblxuICB2YXIgcXVlcnkgPSB0aGlzO1xuICB2YXIgd2FpdCA9IDE7XG4gIHZhciBmaW5pc2ggPSBmdW5jdGlvbihlcnIpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gcXVlcnkuX2ZpbmlzaFJlc3BvbnNlKGVyciwgY2FsbGJhY2spO1xuICAgIGlmICgtLXdhaXQpIHJldHVybjtcbiAgICBxdWVyeS5fZmluaXNoUmVzcG9uc2UobnVsbCwgY2FsbGJhY2spO1xuICB9O1xuXG4gIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgd2FpdCArPSBkYXRhLmxlbmd0aDtcbiAgICB0aGlzLnJlc3VsdHMgPSB0aGlzLl9pbmdlc3RTbmFwc2hvdHMoZGF0YSwgZmluaXNoKTtcbiAgICB0aGlzLmV4dHJhID0gZXh0cmE7XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaWQgaW4gZGF0YSkge1xuICAgICAgd2FpdCsrO1xuICAgICAgdmFyIHNuYXBzaG90ID0gZGF0YVtpZF07XG4gICAgICB2YXIgZG9jID0gdGhpcy5jb25uZWN0aW9uLmdldChzbmFwc2hvdC5jIHx8IHRoaXMuY29sbGVjdGlvbiwgaWQpO1xuICAgICAgZG9jLmluZ2VzdFNuYXBzaG90KHNuYXBzaG90LCBmaW5pc2gpO1xuICAgIH1cbiAgfVxuXG4gIGZpbmlzaCgpO1xufTtcblxuUXVlcnkucHJvdG90eXBlLl9pbmdlc3RTbmFwc2hvdHMgPSBmdW5jdGlvbihzbmFwc2hvdHMsIGZpbmlzaCkge1xuICB2YXIgcmVzdWx0cyA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNuYXBzaG90cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzbmFwc2hvdCA9IHNuYXBzaG90c1tpXTtcbiAgICB2YXIgZG9jID0gdGhpcy5jb25uZWN0aW9uLmdldChzbmFwc2hvdC5jIHx8IHRoaXMuY29sbGVjdGlvbiwgc25hcHNob3QuZCk7XG4gICAgZG9jLmluZ2VzdFNuYXBzaG90KHNuYXBzaG90LCBmaW5pc2gpO1xuICAgIHJlc3VsdHMucHVzaChkb2MpO1xuICB9XG4gIHJldHVybiByZXN1bHRzO1xufTtcblxuUXVlcnkucHJvdG90eXBlLl9maW5pc2hSZXNwb25zZSA9IGZ1bmN0aW9uKGVyciwgY2FsbGJhY2spIHtcbiAgdGhpcy5lbWl0KCdyZWFkeScpO1xuICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgaWYgKGVycikge1xuICAgIHRoaXMuY29ubmVjdGlvbi5fZGVzdHJveVF1ZXJ5KHRoaXMpO1xuICAgIGlmIChjYWxsYmFjaykgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgcmV0dXJuIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICB9XG4gIGlmIChjYWxsYmFjaykgY2FsbGJhY2sobnVsbCwgdGhpcy5yZXN1bHRzLCB0aGlzLmV4dHJhKTtcbn07XG5cblF1ZXJ5LnByb3RvdHlwZS5faGFuZGxlRXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgdGhpcy5lbWl0KCdlcnJvcicsIGVycik7XG59O1xuXG5RdWVyeS5wcm90b3R5cGUuX2hhbmRsZURpZmYgPSBmdW5jdGlvbihkaWZmKSB7XG4gIC8vIFdlIG5lZWQgdG8gZ28gdGhyb3VnaCB0aGUgbGlzdCB0d2ljZS4gRmlyc3QsIHdlJ2xsIGluZ2VzdCBhbGwgdGhlIG5ld1xuICAvLyBkb2N1bWVudHMuIEFmdGVyIHRoYXQgd2UnbGwgZW1pdCBldmVudHMgYW5kIGFjdHVhbGx5IHVwZGF0ZSBvdXIgbGlzdC5cbiAgLy8gVGhpcyBhdm9pZHMgcmFjZSBjb25kaXRpb25zIGFyb3VuZCBzZXR0aW5nIGRvY3VtZW50cyB0byBiZSBzdWJzY3JpYmVkICZcbiAgLy8gdW5zdWJzY3JpYmluZyBkb2N1bWVudHMgaW4gZXZlbnQgY2FsbGJhY2tzLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IGRpZmYubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZCA9IGRpZmZbaV07XG4gICAgaWYgKGQudHlwZSA9PT0gJ2luc2VydCcpIGQudmFsdWVzID0gdGhpcy5faW5nZXN0U25hcHNob3RzKGQudmFsdWVzKTtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGlmZi5sZW5ndGg7IGkrKykge1xuICAgIHZhciBkID0gZGlmZltpXTtcbiAgICBzd2l0Y2ggKGQudHlwZSkge1xuICAgICAgY2FzZSAnaW5zZXJ0JzpcbiAgICAgICAgdmFyIG5ld0RvY3MgPSBkLnZhbHVlcztcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseSh0aGlzLnJlc3VsdHMsIFtkLmluZGV4LCAwXS5jb25jYXQobmV3RG9jcykpO1xuICAgICAgICB0aGlzLmVtaXQoJ2luc2VydCcsIG5ld0RvY3MsIGQuaW5kZXgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3JlbW92ZSc6XG4gICAgICAgIHZhciBob3dNYW55ID0gZC5ob3dNYW55IHx8IDE7XG4gICAgICAgIHZhciByZW1vdmVkID0gdGhpcy5yZXN1bHRzLnNwbGljZShkLmluZGV4LCBob3dNYW55KTtcbiAgICAgICAgdGhpcy5lbWl0KCdyZW1vdmUnLCByZW1vdmVkLCBkLmluZGV4KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdtb3ZlJzpcbiAgICAgICAgdmFyIGhvd01hbnkgPSBkLmhvd01hbnkgfHwgMTtcbiAgICAgICAgdmFyIGRvY3MgPSB0aGlzLnJlc3VsdHMuc3BsaWNlKGQuZnJvbSwgaG93TWFueSk7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkodGhpcy5yZXN1bHRzLCBbZC50bywgMF0uY29uY2F0KGRvY3MpKTtcbiAgICAgICAgdGhpcy5lbWl0KCdtb3ZlJywgZG9jcywgZC5mcm9tLCBkLnRvKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgdGhpcy5lbWl0KCdjaGFuZ2VkJywgdGhpcy5yZXN1bHRzKTtcbn07XG5cblF1ZXJ5LnByb3RvdHlwZS5faGFuZGxlRXh0cmEgPSBmdW5jdGlvbihleHRyYSkge1xuICB0aGlzLmV4dHJhID0gZXh0cmE7XG4gIHRoaXMuZW1pdCgnZXh0cmEnLCBleHRyYSk7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/query.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-request.js":
/*!******************************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/snapshot-request/snapshot-request.js ***!
  \******************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var Snapshot = __webpack_require__(/*! ../../snapshot */ \"(ssr)/./node_modules/sharedb/lib/snapshot.js\");\nvar emitter = __webpack_require__(/*! ../../emitter */ \"(ssr)/./node_modules/sharedb/lib/emitter.js\");\n\nmodule.exports = SnapshotRequest;\n\nfunction SnapshotRequest(connection, requestId, collection, id, callback) {\n  emitter.EventEmitter.call(this);\n\n  if (typeof callback !== 'function') {\n    throw new Error('Callback is required for SnapshotRequest');\n  }\n\n  this.requestId = requestId;\n  this.connection = connection;\n  this.id = id;\n  this.collection = collection;\n  this.callback = callback;\n\n  this.sent = false;\n}\nemitter.mixin(SnapshotRequest);\n\nSnapshotRequest.prototype.send = function() {\n  if (!this.connection.canSend) {\n    return;\n  }\n\n  this.connection.send(this._message());\n  this.sent = true;\n};\n\nSnapshotRequest.prototype._onConnectionStateChanged = function() {\n  if (this.connection.canSend) {\n    if (!this.sent) this.send();\n  } else {\n    // If the connection can't send, then we've had a disconnection, and even if we've already sent\n    // the request previously, we need to re-send it over this reconnected client, so reset the\n    // sent flag to false.\n    this.sent = false;\n  }\n};\n\nSnapshotRequest.prototype._handleResponse = function(error, message) {\n  this.emit('ready');\n\n  if (error) {\n    return this.callback(error);\n  }\n\n  var metadata = message.meta ? message.meta : null;\n  var snapshot = new Snapshot(this.id, message.v, message.type, message.data, metadata);\n\n  this.callback(null, snapshot);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3NuYXBzaG90LXJlcXVlc3Qvc25hcHNob3QtcmVxdWVzdC5qcyIsIm1hcHBpbmdzIjoiQUFBQSxlQUFlLG1CQUFPLENBQUMsb0VBQWdCO0FBQ3ZDLGNBQWMsbUJBQU8sQ0FBQyxrRUFBZTs7QUFFckM7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvc25hcHNob3QtcmVxdWVzdC9zbmFwc2hvdC1yZXF1ZXN0LmpzP2YwY2QiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIFNuYXBzaG90ID0gcmVxdWlyZSgnLi4vLi4vc25hcHNob3QnKTtcbnZhciBlbWl0dGVyID0gcmVxdWlyZSgnLi4vLi4vZW1pdHRlcicpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNuYXBzaG90UmVxdWVzdDtcblxuZnVuY3Rpb24gU25hcHNob3RSZXF1ZXN0KGNvbm5lY3Rpb24sIHJlcXVlc3RJZCwgY29sbGVjdGlvbiwgaWQsIGNhbGxiYWNrKSB7XG4gIGVtaXR0ZXIuRXZlbnRFbWl0dGVyLmNhbGwodGhpcyk7XG5cbiAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgaXMgcmVxdWlyZWQgZm9yIFNuYXBzaG90UmVxdWVzdCcpO1xuICB9XG5cbiAgdGhpcy5yZXF1ZXN0SWQgPSByZXF1ZXN0SWQ7XG4gIHRoaXMuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4gIHRoaXMuaWQgPSBpZDtcbiAgdGhpcy5jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuXG4gIHRoaXMuc2VudCA9IGZhbHNlO1xufVxuZW1pdHRlci5taXhpbihTbmFwc2hvdFJlcXVlc3QpO1xuXG5TbmFwc2hvdFJlcXVlc3QucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLmNvbm5lY3Rpb24uY2FuU2VuZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuY29ubmVjdGlvbi5zZW5kKHRoaXMuX21lc3NhZ2UoKSk7XG4gIHRoaXMuc2VudCA9IHRydWU7XG59O1xuXG5TbmFwc2hvdFJlcXVlc3QucHJvdG90eXBlLl9vbkNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuY29ubmVjdGlvbi5jYW5TZW5kKSB7XG4gICAgaWYgKCF0aGlzLnNlbnQpIHRoaXMuc2VuZCgpO1xuICB9IGVsc2Uge1xuICAgIC8vIElmIHRoZSBjb25uZWN0aW9uIGNhbid0IHNlbmQsIHRoZW4gd2UndmUgaGFkIGEgZGlzY29ubmVjdGlvbiwgYW5kIGV2ZW4gaWYgd2UndmUgYWxyZWFkeSBzZW50XG4gICAgLy8gdGhlIHJlcXVlc3QgcHJldmlvdXNseSwgd2UgbmVlZCB0byByZS1zZW5kIGl0IG92ZXIgdGhpcyByZWNvbm5lY3RlZCBjbGllbnQsIHNvIHJlc2V0IHRoZVxuICAgIC8vIHNlbnQgZmxhZyB0byBmYWxzZS5cbiAgICB0aGlzLnNlbnQgPSBmYWxzZTtcbiAgfVxufTtcblxuU25hcHNob3RSZXF1ZXN0LnByb3RvdHlwZS5faGFuZGxlUmVzcG9uc2UgPSBmdW5jdGlvbihlcnJvciwgbWVzc2FnZSkge1xuICB0aGlzLmVtaXQoJ3JlYWR5Jyk7XG5cbiAgaWYgKGVycm9yKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FsbGJhY2soZXJyb3IpO1xuICB9XG5cbiAgdmFyIG1ldGFkYXRhID0gbWVzc2FnZS5tZXRhID8gbWVzc2FnZS5tZXRhIDogbnVsbDtcbiAgdmFyIHNuYXBzaG90ID0gbmV3IFNuYXBzaG90KHRoaXMuaWQsIG1lc3NhZ2UudiwgbWVzc2FnZS50eXBlLCBtZXNzYWdlLmRhdGEsIG1ldGFkYXRhKTtcblxuICB0aGlzLmNhbGxiYWNrKG51bGwsIHNuYXBzaG90KTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-request.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-timestamp-request.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/snapshot-request/snapshot-timestamp-request.js ***!
  \****************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var SnapshotRequest = __webpack_require__(/*! ./snapshot-request */ \"(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-request.js\");\nvar util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar ACTIONS = (__webpack_require__(/*! ../../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\n\nmodule.exports = SnapshotTimestampRequest;\n\nfunction SnapshotTimestampRequest(connection, requestId, collection, id, timestamp, callback) {\n  SnapshotRequest.call(this, connection, requestId, collection, id, callback);\n\n  if (!util.isValidTimestamp(timestamp)) {\n    throw new Error('Snapshot timestamp must be a positive integer or null');\n  }\n\n  this.timestamp = timestamp;\n}\n\nSnapshotTimestampRequest.prototype = Object.create(SnapshotRequest.prototype);\n\nSnapshotTimestampRequest.prototype._message = function() {\n  return {\n    a: ACTIONS.snapshotFetchByTimestamp,\n    id: this.requestId,\n    c: this.collection,\n    d: this.id,\n    ts: this.timestamp\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3NuYXBzaG90LXJlcXVlc3Qvc25hcHNob3QtdGltZXN0YW1wLXJlcXVlc3QuanMiLCJtYXBwaW5ncyI6IkFBQUEsc0JBQXNCLG1CQUFPLENBQUMsd0dBQW9CO0FBQ2xELFdBQVcsbUJBQU8sQ0FBQyw0REFBWTtBQUMvQixjQUFjLGlIQUF3Qzs7QUFFdEQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL2NsaWVudC9zbmFwc2hvdC1yZXF1ZXN0L3NuYXBzaG90LXRpbWVzdGFtcC1yZXF1ZXN0LmpzPzkwYTUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIFNuYXBzaG90UmVxdWVzdCA9IHJlcXVpcmUoJy4vc25hcHNob3QtcmVxdWVzdCcpO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuLi8uLi91dGlsJyk7XG52YXIgQUNUSU9OUyA9IHJlcXVpcmUoJy4uLy4uL21lc3NhZ2UtYWN0aW9ucycpLkFDVElPTlM7XG5cbm1vZHVsZS5leHBvcnRzID0gU25hcHNob3RUaW1lc3RhbXBSZXF1ZXN0O1xuXG5mdW5jdGlvbiBTbmFwc2hvdFRpbWVzdGFtcFJlcXVlc3QoY29ubmVjdGlvbiwgcmVxdWVzdElkLCBjb2xsZWN0aW9uLCBpZCwgdGltZXN0YW1wLCBjYWxsYmFjaykge1xuICBTbmFwc2hvdFJlcXVlc3QuY2FsbCh0aGlzLCBjb25uZWN0aW9uLCByZXF1ZXN0SWQsIGNvbGxlY3Rpb24sIGlkLCBjYWxsYmFjayk7XG5cbiAgaWYgKCF1dGlsLmlzVmFsaWRUaW1lc3RhbXAodGltZXN0YW1wKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignU25hcHNob3QgdGltZXN0YW1wIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIG9yIG51bGwnKTtcbiAgfVxuXG4gIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wO1xufVxuXG5TbmFwc2hvdFRpbWVzdGFtcFJlcXVlc3QucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTbmFwc2hvdFJlcXVlc3QucHJvdG90eXBlKTtcblxuU25hcHNob3RUaW1lc3RhbXBSZXF1ZXN0LnByb3RvdHlwZS5fbWVzc2FnZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4ge1xuICAgIGE6IEFDVElPTlMuc25hcHNob3RGZXRjaEJ5VGltZXN0YW1wLFxuICAgIGlkOiB0aGlzLnJlcXVlc3RJZCxcbiAgICBjOiB0aGlzLmNvbGxlY3Rpb24sXG4gICAgZDogdGhpcy5pZCxcbiAgICB0czogdGhpcy50aW1lc3RhbXBcbiAgfTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-timestamp-request.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-version-request.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/sharedb/lib/client/snapshot-request/snapshot-version-request.js ***!
  \**************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var SnapshotRequest = __webpack_require__(/*! ./snapshot-request */ \"(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-request.js\");\nvar util = __webpack_require__(/*! ../../util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\nvar ACTIONS = (__webpack_require__(/*! ../../message-actions */ \"(ssr)/./node_modules/sharedb/lib/message-actions.js\").ACTIONS);\n\nmodule.exports = SnapshotVersionRequest;\n\nfunction SnapshotVersionRequest(connection, requestId, collection, id, version, callback) {\n  SnapshotRequest.call(this, connection, requestId, collection, id, callback);\n\n  if (!util.isValidVersion(version)) {\n    throw new Error('Snapshot version must be a positive integer or null');\n  }\n\n  this.version = version;\n}\n\nSnapshotVersionRequest.prototype = Object.create(SnapshotRequest.prototype);\n\nSnapshotVersionRequest.prototype._message = function() {\n  return {\n    a: ACTIONS.snapshotFetch,\n    id: this.requestId,\n    c: this.collection,\n    d: this.id,\n    v: this.version\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvY2xpZW50L3NuYXBzaG90LXJlcXVlc3Qvc25hcHNob3QtdmVyc2lvbi1yZXF1ZXN0LmpzIiwibWFwcGluZ3MiOiJBQUFBLHNCQUFzQixtQkFBTyxDQUFDLHdHQUFvQjtBQUNsRCxXQUFXLG1CQUFPLENBQUMsNERBQVk7QUFDL0IsY0FBYyxpSEFBd0M7O0FBRXREOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9jbGllbnQvc25hcHNob3QtcmVxdWVzdC9zbmFwc2hvdC12ZXJzaW9uLXJlcXVlc3QuanM/NWViZCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgU25hcHNob3RSZXF1ZXN0ID0gcmVxdWlyZSgnLi9zbmFwc2hvdC1yZXF1ZXN0Jyk7XG52YXIgdXRpbCA9IHJlcXVpcmUoJy4uLy4uL3V0aWwnKTtcbnZhciBBQ1RJT05TID0gcmVxdWlyZSgnLi4vLi4vbWVzc2FnZS1hY3Rpb25zJykuQUNUSU9OUztcblxubW9kdWxlLmV4cG9ydHMgPSBTbmFwc2hvdFZlcnNpb25SZXF1ZXN0O1xuXG5mdW5jdGlvbiBTbmFwc2hvdFZlcnNpb25SZXF1ZXN0KGNvbm5lY3Rpb24sIHJlcXVlc3RJZCwgY29sbGVjdGlvbiwgaWQsIHZlcnNpb24sIGNhbGxiYWNrKSB7XG4gIFNuYXBzaG90UmVxdWVzdC5jYWxsKHRoaXMsIGNvbm5lY3Rpb24sIHJlcXVlc3RJZCwgY29sbGVjdGlvbiwgaWQsIGNhbGxiYWNrKTtcblxuICBpZiAoIXV0aWwuaXNWYWxpZFZlcnNpb24odmVyc2lvbikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1NuYXBzaG90IHZlcnNpb24gbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgb3IgbnVsbCcpO1xuICB9XG5cbiAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbn1cblxuU25hcHNob3RWZXJzaW9uUmVxdWVzdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNuYXBzaG90UmVxdWVzdC5wcm90b3R5cGUpO1xuXG5TbmFwc2hvdFZlcnNpb25SZXF1ZXN0LnByb3RvdHlwZS5fbWVzc2FnZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4ge1xuICAgIGE6IEFDVElPTlMuc25hcHNob3RGZXRjaCxcbiAgICBpZDogdGhpcy5yZXF1ZXN0SWQsXG4gICAgYzogdGhpcy5jb2xsZWN0aW9uLFxuICAgIGQ6IHRoaXMuaWQsXG4gICAgdjogdGhpcy52ZXJzaW9uXG4gIH07XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/client/snapshot-request/snapshot-version-request.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/emitter.js":
/*!*********************************************!*\
  !*** ./node_modules/sharedb/lib/emitter.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("var EventEmitter = (__webpack_require__(/*! events */ \"events\").EventEmitter);\n\nexports.EventEmitter = EventEmitter;\nexports.mixin = mixin;\n\nfunction mixin(Constructor) {\n  for (var key in EventEmitter.prototype) {\n    Constructor.prototype[key] = EventEmitter.prototype[key];\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvZW1pdHRlci5qcyIsIm1hcHBpbmdzIjoiQUFBQSxtQkFBbUIsMERBQThCOztBQUVqRCxvQkFBb0I7QUFDcEIsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9lbWl0dGVyLmpzP2UzMTciXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpLkV2ZW50RW1pdHRlcjtcblxuZXhwb3J0cy5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5leHBvcnRzLm1peGluID0gbWl4aW47XG5cbmZ1bmN0aW9uIG1peGluKENvbnN0cnVjdG9yKSB7XG4gIGZvciAodmFyIGtleSBpbiBFdmVudEVtaXR0ZXIucHJvdG90eXBlKSB7XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2tleV0gPSBFdmVudEVtaXR0ZXIucHJvdG90eXBlW2tleV07XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/emitter.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/error.js":
/*!*******************************************!*\
  !*** ./node_modules/sharedb/lib/error.js ***!
  \*******************************************/
/***/ ((module) => {

eval("function ShareDBError(code, message) {\n  this.code = code;\n  this.message = message || '';\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, ShareDBError);\n  } else {\n    this.stack = new Error().stack;\n  }\n}\n\nShareDBError.prototype = Object.create(Error.prototype);\nShareDBError.prototype.constructor = ShareDBError;\nShareDBError.prototype.name = 'ShareDBError';\n\nShareDBError.CODES = {\n  ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT: 'ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT',\n  ERR_APPLY_SNAPSHOT_NOT_PROVIDED: 'ERR_APPLY_SNAPSHOT_NOT_PROVIDED',\n  ERR_FIXUP_IS_ONLY_VALID_ON_APPLY: 'ERR_FIXUP_IS_ONLY_VALID_ON_APPLY',\n  ERR_CANNOT_FIXUP_DELETION: 'ERR_CANNOT_FIXUP_DELETION',\n  ERR_CLIENT_ID_BADLY_FORMED: 'ERR_CLIENT_ID_BADLY_FORMED',\n  ERR_CANNOT_PING_OFFLINE: 'ERR_CANNOT_PING_OFFLINE',\n  ERR_CONNECTION_SEQ_INTEGER_OVERFLOW: 'ERR_CONNECTION_SEQ_INTEGER_OVERFLOW',\n  ERR_CONNECTION_STATE_TRANSITION_INVALID: 'ERR_CONNECTION_STATE_TRANSITION_INVALID',\n  ERR_DATABASE_ADAPTER_NOT_FOUND: 'ERR_DATABASE_ADAPTER_NOT_FOUND',\n  ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE: 'ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE',\n  ERR_DATABASE_METHOD_NOT_IMPLEMENTED: 'ERR_DATABASE_METHOD_NOT_IMPLEMENTED',\n  ERR_DEFAULT_TYPE_MISMATCH: 'ERR_DEFAULT_TYPE_MISMATCH',\n  ERR_DOC_MISSING_VERSION: 'ERR_DOC_MISSING_VERSION',\n  ERR_DOC_ALREADY_CREATED: 'ERR_DOC_ALREADY_CREATED',\n  ERR_DOC_DOES_NOT_EXIST: 'ERR_DOC_DOES_NOT_EXIST',\n  ERR_DOC_TYPE_NOT_RECOGNIZED: 'ERR_DOC_TYPE_NOT_RECOGNIZED',\n  ERR_DOC_WAS_DELETED: 'ERR_DOC_WAS_DELETED',\n  ERR_DOC_IN_HARD_ROLLBACK: 'ERR_DOC_IN_HARD_ROLLBACK',\n  ERR_INFLIGHT_OP_MISSING: 'ERR_INFLIGHT_OP_MISSING',\n  ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION: 'ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION',\n  ERR_MAX_SUBMIT_RETRIES_EXCEEDED: 'ERR_MAX_SUBMIT_RETRIES_EXCEEDED',\n  ERR_MESSAGE_BADLY_FORMED: 'ERR_MESSAGE_BADLY_FORMED',\n  ERR_MILESTONE_ARGUMENT_INVALID: 'ERR_MILESTONE_ARGUMENT_INVALID',\n  ERR_NO_OP: 'ERR_NO_OP',\n  ERR_OP_ALREADY_SUBMITTED: 'ERR_OP_ALREADY_SUBMITTED',\n  ERR_OP_NOT_ALLOWED_IN_PROJECTION: 'ERR_OP_NOT_ALLOWED_IN_PROJECTION',\n  ERR_OP_SUBMIT_REJECTED: 'ERR_OP_SUBMIT_REJECTED',\n  ERR_PENDING_OP_REMOVED_BY_OP_SUBMIT_REJECTED: 'ERR_PENDING_OP_REMOVED_BY_OP_SUBMIT_REJECTED',\n  ERR_HARD_ROLLBACK_FETCH_FAILED: 'ERR_HARD_ROLLBACK_FETCH_FAILED',\n  ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM: 'ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM',\n  ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM: 'ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM',\n  ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT: 'ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT',\n  ERR_OT_LEGACY_JSON0_OP_CANNOT_BE_NORMALIZED: 'ERR_OT_LEGACY_JSON0_OP_CANNOT_BE_NORMALIZED',\n  ERR_OT_OP_BADLY_FORMED: 'ERR_OT_OP_BADLY_FORMED',\n  ERR_OT_OP_NOT_APPLIED: 'ERR_OT_OP_NOT_APPLIED',\n  ERR_OT_OP_NOT_PROVIDED: 'ERR_OT_OP_NOT_PROVIDED',\n  ERR_PRESENCE_TRANSFORM_FAILED: 'ERR_PRESENCE_TRANSFORM_FAILED',\n  ERR_PROTOCOL_VERSION_NOT_SUPPORTED: 'ERR_PROTOCOL_VERSION_NOT_SUPPORTED',\n  ERR_QUERY_CHANNEL_MISSING: 'ERR_QUERY_CHANNEL_MISSING',\n  ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED: 'ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED',\n  /**\n   * A special error that a \"readSnapshots\" middleware implementation can use to indicate that it\n   * wishes for the ShareDB client to treat it as a silent rejection, not passing the error back to\n   * user code.\n   *\n   * For subscribes, the ShareDB client will still cancel the document subscription.\n   */\n  ERR_SNAPSHOT_READ_SILENT_REJECTION: 'ERR_SNAPSHOT_READ_SILENT_REJECTION',\n  /**\n   * A \"readSnapshots\" middleware rejected the reads of specific snapshots.\n   *\n   * This error code is mostly for server use and generally will not be encountered on the client.\n   * Instead, each specific doc that encountered an error will receive its specific error.\n   *\n   * The one exception is for queries, where a \"readSnapshots\" rejection of specific snapshots will\n   * cause the client to receive this error for the whole query, since queries don't support\n   * doc-specific errors.\n   */\n  ERR_SNAPSHOT_READS_REJECTED: 'ERR_SNAPSHOT_READS_REJECTED',\n  ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND: 'ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND',\n  ERR_TYPE_CANNOT_BE_PROJECTED: 'ERR_TYPE_CANNOT_BE_PROJECTED',\n  ERR_TYPE_DOES_NOT_SUPPORT_COMPOSE: 'ERR_TYPE_DOES_NOT_SUPPORT_COMPOSE',\n  ERR_TYPE_DOES_NOT_SUPPORT_PRESENCE: 'ERR_TYPE_DOES_NOT_SUPPORT_PRESENCE',\n  ERR_UNKNOWN_ERROR: 'ERR_UNKNOWN_ERROR'\n};\n\nmodule.exports = ShareDBError;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvZXJyb3IuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsid2VicGFjazovL2RheTlfY29sbGFib3JhdGl2ZV9lZGl0b3IvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvZXJyb3IuanM/NTdhMSJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBTaGFyZURCRXJyb3IoY29kZSwgbWVzc2FnZSkge1xuICB0aGlzLmNvZGUgPSBjb2RlO1xuICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlIHx8ICcnO1xuICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBTaGFyZURCRXJyb3IpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuc3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjaztcbiAgfVxufVxuXG5TaGFyZURCRXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuU2hhcmVEQkVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNoYXJlREJFcnJvcjtcblNoYXJlREJFcnJvci5wcm90b3R5cGUubmFtZSA9ICdTaGFyZURCRXJyb3InO1xuXG5TaGFyZURCRXJyb3IuQ09ERVMgPSB7XG4gIEVSUl9BUFBMWV9PUF9WRVJTSU9OX0RPRVNfTk9UX01BVENIX1NOQVBTSE9UOiAnRVJSX0FQUExZX09QX1ZFUlNJT05fRE9FU19OT1RfTUFUQ0hfU05BUFNIT1QnLFxuICBFUlJfQVBQTFlfU05BUFNIT1RfTk9UX1BST1ZJREVEOiAnRVJSX0FQUExZX1NOQVBTSE9UX05PVF9QUk9WSURFRCcsXG4gIEVSUl9GSVhVUF9JU19PTkxZX1ZBTElEX09OX0FQUExZOiAnRVJSX0ZJWFVQX0lTX09OTFlfVkFMSURfT05fQVBQTFknLFxuICBFUlJfQ0FOTk9UX0ZJWFVQX0RFTEVUSU9OOiAnRVJSX0NBTk5PVF9GSVhVUF9ERUxFVElPTicsXG4gIEVSUl9DTElFTlRfSURfQkFETFlfRk9STUVEOiAnRVJSX0NMSUVOVF9JRF9CQURMWV9GT1JNRUQnLFxuICBFUlJfQ0FOTk9UX1BJTkdfT0ZGTElORTogJ0VSUl9DQU5OT1RfUElOR19PRkZMSU5FJyxcbiAgRVJSX0NPTk5FQ1RJT05fU0VRX0lOVEVHRVJfT1ZFUkZMT1c6ICdFUlJfQ09OTkVDVElPTl9TRVFfSU5URUdFUl9PVkVSRkxPVycsXG4gIEVSUl9DT05ORUNUSU9OX1NUQVRFX1RSQU5TSVRJT05fSU5WQUxJRDogJ0VSUl9DT05ORUNUSU9OX1NUQVRFX1RSQU5TSVRJT05fSU5WQUxJRCcsXG4gIEVSUl9EQVRBQkFTRV9BREFQVEVSX05PVF9GT1VORDogJ0VSUl9EQVRBQkFTRV9BREFQVEVSX05PVF9GT1VORCcsXG4gIEVSUl9EQVRBQkFTRV9ET0VTX05PVF9TVVBQT1JUX1NVQlNDUklCRTogJ0VSUl9EQVRBQkFTRV9ET0VTX05PVF9TVVBQT1JUX1NVQlNDUklCRScsXG4gIEVSUl9EQVRBQkFTRV9NRVRIT0RfTk9UX0lNUExFTUVOVEVEOiAnRVJSX0RBVEFCQVNFX01FVEhPRF9OT1RfSU1QTEVNRU5URUQnLFxuICBFUlJfREVGQVVMVF9UWVBFX01JU01BVENIOiAnRVJSX0RFRkFVTFRfVFlQRV9NSVNNQVRDSCcsXG4gIEVSUl9ET0NfTUlTU0lOR19WRVJTSU9OOiAnRVJSX0RPQ19NSVNTSU5HX1ZFUlNJT04nLFxuICBFUlJfRE9DX0FMUkVBRFlfQ1JFQVRFRDogJ0VSUl9ET0NfQUxSRUFEWV9DUkVBVEVEJyxcbiAgRVJSX0RPQ19ET0VTX05PVF9FWElTVDogJ0VSUl9ET0NfRE9FU19OT1RfRVhJU1QnLFxuICBFUlJfRE9DX1RZUEVfTk9UX1JFQ09HTklaRUQ6ICdFUlJfRE9DX1RZUEVfTk9UX1JFQ09HTklaRUQnLFxuICBFUlJfRE9DX1dBU19ERUxFVEVEOiAnRVJSX0RPQ19XQVNfREVMRVRFRCcsXG4gIEVSUl9ET0NfSU5fSEFSRF9ST0xMQkFDSzogJ0VSUl9ET0NfSU5fSEFSRF9ST0xMQkFDSycsXG4gIEVSUl9JTkZMSUdIVF9PUF9NSVNTSU5HOiAnRVJSX0lORkxJR0hUX09QX01JU1NJTkcnLFxuICBFUlJfSU5HRVNURURfU05BUFNIT1RfSEFTX05PX1ZFUlNJT046ICdFUlJfSU5HRVNURURfU05BUFNIT1RfSEFTX05PX1ZFUlNJT04nLFxuICBFUlJfTUFYX1NVQk1JVF9SRVRSSUVTX0VYQ0VFREVEOiAnRVJSX01BWF9TVUJNSVRfUkVUUklFU19FWENFRURFRCcsXG4gIEVSUl9NRVNTQUdFX0JBRExZX0ZPUk1FRDogJ0VSUl9NRVNTQUdFX0JBRExZX0ZPUk1FRCcsXG4gIEVSUl9NSUxFU1RPTkVfQVJHVU1FTlRfSU5WQUxJRDogJ0VSUl9NSUxFU1RPTkVfQVJHVU1FTlRfSU5WQUxJRCcsXG4gIEVSUl9OT19PUDogJ0VSUl9OT19PUCcsXG4gIEVSUl9PUF9BTFJFQURZX1NVQk1JVFRFRDogJ0VSUl9PUF9BTFJFQURZX1NVQk1JVFRFRCcsXG4gIEVSUl9PUF9OT1RfQUxMT1dFRF9JTl9QUk9KRUNUSU9OOiAnRVJSX09QX05PVF9BTExPV0VEX0lOX1BST0pFQ1RJT04nLFxuICBFUlJfT1BfU1VCTUlUX1JFSkVDVEVEOiAnRVJSX09QX1NVQk1JVF9SRUpFQ1RFRCcsXG4gIEVSUl9QRU5ESU5HX09QX1JFTU9WRURfQllfT1BfU1VCTUlUX1JFSkVDVEVEOiAnRVJSX1BFTkRJTkdfT1BfUkVNT1ZFRF9CWV9PUF9TVUJNSVRfUkVKRUNURUQnLFxuICBFUlJfSEFSRF9ST0xMQkFDS19GRVRDSF9GQUlMRUQ6ICdFUlJfSEFSRF9ST0xMQkFDS19GRVRDSF9GQUlMRUQnLFxuICBFUlJfT1BfVkVSU0lPTl9NSVNNQVRDSF9BRlRFUl9UUkFOU0ZPUk06ICdFUlJfT1BfVkVSU0lPTl9NSVNNQVRDSF9BRlRFUl9UUkFOU0ZPUk0nLFxuICBFUlJfT1BfVkVSU0lPTl9NSVNNQVRDSF9EVVJJTkdfVFJBTlNGT1JNOiAnRVJSX09QX1ZFUlNJT05fTUlTTUFUQ0hfRFVSSU5HX1RSQU5TRk9STScsXG4gIEVSUl9PUF9WRVJTSU9OX05FV0VSX1RIQU5fQ1VSUkVOVF9TTkFQU0hPVDogJ0VSUl9PUF9WRVJTSU9OX05FV0VSX1RIQU5fQ1VSUkVOVF9TTkFQU0hPVCcsXG4gIEVSUl9PVF9MRUdBQ1lfSlNPTjBfT1BfQ0FOTk9UX0JFX05PUk1BTElaRUQ6ICdFUlJfT1RfTEVHQUNZX0pTT04wX09QX0NBTk5PVF9CRV9OT1JNQUxJWkVEJyxcbiAgRVJSX09UX09QX0JBRExZX0ZPUk1FRDogJ0VSUl9PVF9PUF9CQURMWV9GT1JNRUQnLFxuICBFUlJfT1RfT1BfTk9UX0FQUExJRUQ6ICdFUlJfT1RfT1BfTk9UX0FQUExJRUQnLFxuICBFUlJfT1RfT1BfTk9UX1BST1ZJREVEOiAnRVJSX09UX09QX05PVF9QUk9WSURFRCcsXG4gIEVSUl9QUkVTRU5DRV9UUkFOU0ZPUk1fRkFJTEVEOiAnRVJSX1BSRVNFTkNFX1RSQU5TRk9STV9GQUlMRUQnLFxuICBFUlJfUFJPVE9DT0xfVkVSU0lPTl9OT1RfU1VQUE9SVEVEOiAnRVJSX1BST1RPQ09MX1ZFUlNJT05fTk9UX1NVUFBPUlRFRCcsXG4gIEVSUl9RVUVSWV9DSEFOTkVMX01JU1NJTkc6ICdFUlJfUVVFUllfQ0hBTk5FTF9NSVNTSU5HJyxcbiAgRVJSX1FVRVJZX0VNSVRURVJfTElTVEVORVJfTk9UX0FTU0lHTkVEOiAnRVJSX1FVRVJZX0VNSVRURVJfTElTVEVORVJfTk9UX0FTU0lHTkVEJyxcbiAgLyoqXG4gICAqIEEgc3BlY2lhbCBlcnJvciB0aGF0IGEgXCJyZWFkU25hcHNob3RzXCIgbWlkZGxld2FyZSBpbXBsZW1lbnRhdGlvbiBjYW4gdXNlIHRvIGluZGljYXRlIHRoYXQgaXRcbiAgICogd2lzaGVzIGZvciB0aGUgU2hhcmVEQiBjbGllbnQgdG8gdHJlYXQgaXQgYXMgYSBzaWxlbnQgcmVqZWN0aW9uLCBub3QgcGFzc2luZyB0aGUgZXJyb3IgYmFjayB0b1xuICAgKiB1c2VyIGNvZGUuXG4gICAqXG4gICAqIEZvciBzdWJzY3JpYmVzLCB0aGUgU2hhcmVEQiBjbGllbnQgd2lsbCBzdGlsbCBjYW5jZWwgdGhlIGRvY3VtZW50IHN1YnNjcmlwdGlvbi5cbiAgICovXG4gIEVSUl9TTkFQU0hPVF9SRUFEX1NJTEVOVF9SRUpFQ1RJT046ICdFUlJfU05BUFNIT1RfUkVBRF9TSUxFTlRfUkVKRUNUSU9OJyxcbiAgLyoqXG4gICAqIEEgXCJyZWFkU25hcHNob3RzXCIgbWlkZGxld2FyZSByZWplY3RlZCB0aGUgcmVhZHMgb2Ygc3BlY2lmaWMgc25hcHNob3RzLlxuICAgKlxuICAgKiBUaGlzIGVycm9yIGNvZGUgaXMgbW9zdGx5IGZvciBzZXJ2ZXIgdXNlIGFuZCBnZW5lcmFsbHkgd2lsbCBub3QgYmUgZW5jb3VudGVyZWQgb24gdGhlIGNsaWVudC5cbiAgICogSW5zdGVhZCwgZWFjaCBzcGVjaWZpYyBkb2MgdGhhdCBlbmNvdW50ZXJlZCBhbiBlcnJvciB3aWxsIHJlY2VpdmUgaXRzIHNwZWNpZmljIGVycm9yLlxuICAgKlxuICAgKiBUaGUgb25lIGV4Y2VwdGlvbiBpcyBmb3IgcXVlcmllcywgd2hlcmUgYSBcInJlYWRTbmFwc2hvdHNcIiByZWplY3Rpb24gb2Ygc3BlY2lmaWMgc25hcHNob3RzIHdpbGxcbiAgICogY2F1c2UgdGhlIGNsaWVudCB0byByZWNlaXZlIHRoaXMgZXJyb3IgZm9yIHRoZSB3aG9sZSBxdWVyeSwgc2luY2UgcXVlcmllcyBkb24ndCBzdXBwb3J0XG4gICAqIGRvYy1zcGVjaWZpYyBlcnJvcnMuXG4gICAqL1xuICBFUlJfU05BUFNIT1RfUkVBRFNfUkVKRUNURUQ6ICdFUlJfU05BUFNIT1RfUkVBRFNfUkVKRUNURUQnLFxuICBFUlJfU1VCTUlUX1RSQU5TRk9STV9PUFNfTk9UX0ZPVU5EOiAnRVJSX1NVQk1JVF9UUkFOU0ZPUk1fT1BTX05PVF9GT1VORCcsXG4gIEVSUl9UWVBFX0NBTk5PVF9CRV9QUk9KRUNURUQ6ICdFUlJfVFlQRV9DQU5OT1RfQkVfUFJPSkVDVEVEJyxcbiAgRVJSX1RZUEVfRE9FU19OT1RfU1VQUE9SVF9DT01QT1NFOiAnRVJSX1RZUEVfRE9FU19OT1RfU1VQUE9SVF9DT01QT1NFJyxcbiAgRVJSX1RZUEVfRE9FU19OT1RfU1VQUE9SVF9QUkVTRU5DRTogJ0VSUl9UWVBFX0RPRVNfTk9UX1NVUFBPUlRfUFJFU0VOQ0UnLFxuICBFUlJfVU5LTk9XTl9FUlJPUjogJ0VSUl9VTktOT1dOX0VSUk9SJ1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTaGFyZURCRXJyb3I7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/error.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/logger/index.js":
/*!**************************************************!*\
  !*** ./node_modules/sharedb/lib/logger/index.js ***!
  \**************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var Logger = __webpack_require__(/*! ./logger */ \"(ssr)/./node_modules/sharedb/lib/logger/logger.js\");\nvar logger = new Logger();\nmodule.exports = logger;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvbG9nZ2VyL2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFBLGFBQWEsbUJBQU8sQ0FBQyxtRUFBVTtBQUMvQjtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9sb2dnZXIvaW5kZXguanM/ZmViYiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgTG9nZ2VyID0gcmVxdWlyZSgnLi9sb2dnZXInKTtcbnZhciBsb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG5tb2R1bGUuZXhwb3J0cyA9IGxvZ2dlcjtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/logger/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/logger/logger.js":
/*!***************************************************!*\
  !*** ./node_modules/sharedb/lib/logger/logger.js ***!
  \***************************************************/
/***/ ((module) => {

eval("var SUPPORTED_METHODS = [\n  'info',\n  'warn',\n  'error'\n];\n\nfunction Logger() {\n  var defaultMethods = Object.create(null);\n  SUPPORTED_METHODS.forEach(function(method) {\n    // Deal with Chrome issue: https://bugs.chromium.org/p/chromium/issues/detail?id=179628\n    defaultMethods[method] = console[method].bind(console);\n  });\n  this.setMethods(defaultMethods);\n}\nmodule.exports = Logger;\n\nLogger.prototype.setMethods = function(overrides) {\n  overrides = overrides || {};\n  var logger = this;\n\n  SUPPORTED_METHODS.forEach(function(method) {\n    if (typeof overrides[method] === 'function') {\n      logger[method] = overrides[method];\n    }\n  });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvbG9nZ2VyL2xvZ2dlci5qcyIsIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCIsInNvdXJjZXMiOlsid2VicGFjazovL2RheTlfY29sbGFib3JhdGl2ZV9lZGl0b3IvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvbG9nZ2VyL2xvZ2dlci5qcz83NDdhIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBTVVBQT1JURURfTUVUSE9EUyA9IFtcbiAgJ2luZm8nLFxuICAnd2FybicsXG4gICdlcnJvcidcbl07XG5cbmZ1bmN0aW9uIExvZ2dlcigpIHtcbiAgdmFyIGRlZmF1bHRNZXRob2RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgU1VQUE9SVEVEX01FVEhPRFMuZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAvLyBEZWFsIHdpdGggQ2hyb21lIGlzc3VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0xNzk2MjhcbiAgICBkZWZhdWx0TWV0aG9kc1ttZXRob2RdID0gY29uc29sZVttZXRob2RdLmJpbmQoY29uc29sZSk7XG4gIH0pO1xuICB0aGlzLnNldE1ldGhvZHMoZGVmYXVsdE1ldGhvZHMpO1xufVxubW9kdWxlLmV4cG9ydHMgPSBMb2dnZXI7XG5cbkxvZ2dlci5wcm90b3R5cGUuc2V0TWV0aG9kcyA9IGZ1bmN0aW9uKG92ZXJyaWRlcykge1xuICBvdmVycmlkZXMgPSBvdmVycmlkZXMgfHwge307XG4gIHZhciBsb2dnZXIgPSB0aGlzO1xuXG4gIFNVUFBPUlRFRF9NRVRIT0RTLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgaWYgKHR5cGVvZiBvdmVycmlkZXNbbWV0aG9kXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbG9nZ2VyW21ldGhvZF0gPSBvdmVycmlkZXNbbWV0aG9kXTtcbiAgICB9XG4gIH0pO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/logger/logger.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/message-actions.js":
/*!*****************************************************!*\
  !*** ./node_modules/sharedb/lib/message-actions.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("exports.ACTIONS = {\n  initLegacy: 'init',\n  handshake: 'hs',\n  queryFetch: 'qf',\n  querySubscribe: 'qs',\n  queryUnsubscribe: 'qu',\n  queryUpdate: 'q',\n  bulkFetch: 'bf',\n  bulkSubscribe: 'bs',\n  bulkUnsubscribe: 'bu',\n  fetch: 'f',\n  fixup: 'fixup',\n  subscribe: 's',\n  unsubscribe: 'u',\n  op: 'op',\n  snapshotFetch: 'nf',\n  snapshotFetchByTimestamp: 'nt',\n  pingPong: 'pp',\n  presence: 'p',\n  presenceSubscribe: 'ps',\n  presenceUnsubscribe: 'pu',\n  presenceRequest: 'pr'\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvbWVzc2FnZS1hY3Rpb25zLmpzIiwibWFwcGluZ3MiOiJBQUFBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2RheTlfY29sbGFib3JhdGl2ZV9lZGl0b3IvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvbWVzc2FnZS1hY3Rpb25zLmpzP2RkMmUiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0cy5BQ1RJT05TID0ge1xuICBpbml0TGVnYWN5OiAnaW5pdCcsXG4gIGhhbmRzaGFrZTogJ2hzJyxcbiAgcXVlcnlGZXRjaDogJ3FmJyxcbiAgcXVlcnlTdWJzY3JpYmU6ICdxcycsXG4gIHF1ZXJ5VW5zdWJzY3JpYmU6ICdxdScsXG4gIHF1ZXJ5VXBkYXRlOiAncScsXG4gIGJ1bGtGZXRjaDogJ2JmJyxcbiAgYnVsa1N1YnNjcmliZTogJ2JzJyxcbiAgYnVsa1Vuc3Vic2NyaWJlOiAnYnUnLFxuICBmZXRjaDogJ2YnLFxuICBmaXh1cDogJ2ZpeHVwJyxcbiAgc3Vic2NyaWJlOiAncycsXG4gIHVuc3Vic2NyaWJlOiAndScsXG4gIG9wOiAnb3AnLFxuICBzbmFwc2hvdEZldGNoOiAnbmYnLFxuICBzbmFwc2hvdEZldGNoQnlUaW1lc3RhbXA6ICdudCcsXG4gIHBpbmdQb25nOiAncHAnLFxuICBwcmVzZW5jZTogJ3AnLFxuICBwcmVzZW5jZVN1YnNjcmliZTogJ3BzJyxcbiAgcHJlc2VuY2VVbnN1YnNjcmliZTogJ3B1JyxcbiAgcHJlc2VuY2VSZXF1ZXN0OiAncHInXG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/message-actions.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/next-tick.js":
/*!***********************************************!*\
  !*** ./node_modules/sharedb/lib/next-tick.js ***!
  \***********************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("exports.messageChannel = function() {\n  var triggerCallback = createNextTickTrigger(arguments);\n  var channel = new MessageChannel();\n  channel.port1.onmessage = function() {\n    triggerCallback();\n    channel.port1.close();\n  };\n  channel.port2.postMessage('');\n};\n\nexports.setTimeout = function() {\n  var triggerCallback = createNextTickTrigger(arguments);\n  setTimeout(triggerCallback);\n};\n\nfunction createNextTickTrigger(args) {\n  var callback = args[0];\n  var _args = [];\n  for (var i = 1; i < args.length; i++) {\n    _args[i - 1] = args[i];\n  }\n\n  return function triggerCallback() {\n    callback.apply(null, _args);\n  };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvbmV4dC10aWNrLmpzIiwibWFwcGluZ3MiOiJBQUFBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGlCQUFpQjtBQUNuQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi9uZXh0LXRpY2suanM/YzNmOCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnRzLm1lc3NhZ2VDaGFubmVsID0gZnVuY3Rpb24oKSB7XG4gIHZhciB0cmlnZ2VyQ2FsbGJhY2sgPSBjcmVhdGVOZXh0VGlja1RyaWdnZXIoYXJndW1lbnRzKTtcbiAgdmFyIGNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcbiAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICB0cmlnZ2VyQ2FsbGJhY2soKTtcbiAgICBjaGFubmVsLnBvcnQxLmNsb3NlKCk7XG4gIH07XG4gIGNoYW5uZWwucG9ydDIucG9zdE1lc3NhZ2UoJycpO1xufTtcblxuZXhwb3J0cy5zZXRUaW1lb3V0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciB0cmlnZ2VyQ2FsbGJhY2sgPSBjcmVhdGVOZXh0VGlja1RyaWdnZXIoYXJndW1lbnRzKTtcbiAgc2V0VGltZW91dCh0cmlnZ2VyQ2FsbGJhY2spO1xufTtcblxuZnVuY3Rpb24gY3JlYXRlTmV4dFRpY2tUcmlnZ2VyKGFyZ3MpIHtcbiAgdmFyIGNhbGxiYWNrID0gYXJnc1swXTtcbiAgdmFyIF9hcmdzID0gW107XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgIF9hcmdzW2kgLSAxXSA9IGFyZ3NbaV07XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gdHJpZ2dlckNhbGxiYWNrKCkge1xuICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIF9hcmdzKTtcbiAgfTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/next-tick.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/ot.js":
/*!****************************************!*\
  !*** ./node_modules/sharedb/lib/ot.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("// This contains the master OT functions for the database. They look like\n// ot-types style operational transform functions, but they're a bit different.\n// These functions understand versions and can deal with out of bound create &\n// delete operations.\n\nvar types = __webpack_require__(/*! ./types */ \"(ssr)/./node_modules/sharedb/lib/types.js\");\nvar ShareDBError = __webpack_require__(/*! ./error */ \"(ssr)/./node_modules/sharedb/lib/error.js\");\nvar util = __webpack_require__(/*! ./util */ \"(ssr)/./node_modules/sharedb/lib/util.js\");\n\nvar ERROR_CODE = ShareDBError.CODES;\n\n// Returns an error string on failure. Rockin' it C style.\nexports.checkOp = function(op) {\n  if (op == null || typeof op !== 'object') {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'Op must be an object');\n  }\n\n  if (op.create != null) {\n    if (typeof op.create !== 'object') {\n      return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'Create data must be an object');\n    }\n    var typeName = op.create.type;\n    if (typeof typeName !== 'string') {\n      return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'Missing create type');\n    }\n    var type = types.map[typeName];\n    if (type == null || typeof type !== 'object') {\n      return new ShareDBError(ERROR_CODE.ERR_DOC_TYPE_NOT_RECOGNIZED, 'Unknown type');\n    }\n  } else if (op.del != null) {\n    if (op.del !== true) return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'del value must be true');\n  } else if (!('op' in op)) {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'Missing op, create, or del');\n  }\n\n  if (op.src != null && typeof op.src !== 'string') {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'src must be a string');\n  }\n  if (op.seq != null && typeof op.seq !== 'number') {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'seq must be a number');\n  }\n  if (\n    (op.src == null && op.seq != null) ||\n    (op.src != null && op.seq == null)\n  ) {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'Both src and seq must be set together');\n  }\n\n  if (op.m != null && typeof op.m !== 'object') {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_BADLY_FORMED, 'op.m must be an object or null');\n  }\n};\n\n// Takes in a string (type name or URI) and returns the normalized name (uri)\nexports.normalizeType = function(typeName) {\n  return types.map[typeName] && types.map[typeName].uri;\n};\n\n// This is the super apply function that takes in snapshot data (including the\n// type) and edits it in-place. Returns an error or null for success.\nexports.apply = function(snapshot, op) {\n  if (typeof snapshot !== 'object') {\n    return new ShareDBError(ERROR_CODE.ERR_APPLY_SNAPSHOT_NOT_PROVIDED, 'Missing snapshot');\n  }\n  if (snapshot.v != null && op.v != null && snapshot.v !== op.v) {\n    return new ShareDBError(ERROR_CODE.ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT, 'Version mismatch');\n  }\n\n  // Create operation\n  if (op.create) {\n    if (snapshot.type) return new ShareDBError(ERROR_CODE.ERR_DOC_ALREADY_CREATED, 'Document already exists');\n\n    // The document doesn't exist, although it might have once existed\n    var create = op.create;\n    var type = types.map[create.type];\n    if (!type) return new ShareDBError(ERROR_CODE.ERR_DOC_TYPE_NOT_RECOGNIZED, 'Unknown type');\n\n    try {\n      snapshot.data = type.create(create.data);\n      snapshot.type = type.uri;\n      snapshot.v++;\n    } catch (err) {\n      return err;\n    }\n\n  // Delete operation\n  } else if (op.del) {\n    snapshot.data = undefined;\n    snapshot.type = null;\n    snapshot.v++;\n\n  // Edit operation\n  } else if ('op' in op) {\n    var err = applyOpEdit(snapshot, op.op);\n    if (err) return err;\n    snapshot.v++;\n\n  // No-op, and we don't have to do anything\n  } else {\n    snapshot.v++;\n  }\n};\n\nfunction applyOpEdit(snapshot, edit) {\n  if (!snapshot.type) return new ShareDBError(ERROR_CODE.ERR_DOC_DOES_NOT_EXIST, 'Document does not exist');\n\n  if (edit === undefined) return new ShareDBError(ERROR_CODE.ERR_OT_OP_NOT_PROVIDED, 'Missing op');\n  var type = types.map[snapshot.type];\n  if (!type) return new ShareDBError(ERROR_CODE.ERR_DOC_TYPE_NOT_RECOGNIZED, 'Unknown type');\n\n  if (type.name === 'json0' && Array.isArray(edit)) {\n    for (var i = 0; i < edit.length; i++) {\n      var opComponent = edit[i];\n      if (Array.isArray(opComponent.p)) {\n        for (var j = 0; j < opComponent.p.length; j++) {\n          var pathSegment = opComponent.p[j];\n          if (util.isDangerousProperty(pathSegment)) {\n            return new ShareDBError(ERROR_CODE.ERR_OT_OP_NOT_APPLIED, 'Invalid path segment');\n          }\n        }\n      }\n    }\n  }\n\n  try {\n    snapshot.data = type.apply(snapshot.data, edit);\n  } catch (err) {\n    return new ShareDBError(ERROR_CODE.ERR_OT_OP_NOT_APPLIED, err.message);\n  }\n}\n\nexports.transform = function(type, op, appliedOp) {\n  // There are 16 cases this function needs to deal with - which are all the\n  // combinations of create/delete/op/noop from both op and appliedOp\n  if (op.v != null && op.v !== appliedOp.v) {\n    return new ShareDBError(ERROR_CODE.ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM, 'Version mismatch');\n  }\n\n  if (appliedOp.del) {\n    if (op.create || 'op' in op) {\n      return new ShareDBError(ERROR_CODE.ERR_DOC_WAS_DELETED, 'Document was deleted');\n    }\n  } else if (\n    (appliedOp.create && ('op' in op || op.create || op.del)) ||\n    ('op' in appliedOp && op.create)\n  ) {\n    // If appliedOp.create is not true, appliedOp contains an op - which\n    // also means the document exists remotely.\n    return new ShareDBError(ERROR_CODE.ERR_DOC_ALREADY_CREATED, 'Document was created remotely');\n  } else if ('op' in appliedOp && 'op' in op) {\n    // If we reach here, they both have a .op property.\n    if (!type) return new ShareDBError(ERROR_CODE.ERR_DOC_DOES_NOT_EXIST, 'Document does not exist');\n\n    if (typeof type === 'string') {\n      type = types.map[type];\n      if (!type) return new ShareDBError(ERROR_CODE.ERR_DOC_TYPE_NOT_RECOGNIZED, 'Unknown type');\n    }\n\n    try {\n      op.op = type.transform(op.op, appliedOp.op, 'left');\n    } catch (err) {\n      return err;\n    }\n  }\n\n  if (op.v != null) op.v++;\n};\n\n/**\n * Apply an array of ops to the provided snapshot.\n *\n * @param snapshot - a Snapshot object which will be mutated by the provided ops\n * @param ops - an array of ops to apply to the snapshot\n * @param options - options (currently for internal use only)\n * @return an error object if applicable\n */\nexports.applyOps = function(snapshot, ops, options) {\n  options = options || {};\n  for (var index = 0; index < ops.length; index++) {\n    var op = ops[index];\n    if (options._normalizeLegacyJson0Ops) {\n      try {\n        normalizeLegacyJson0Ops(snapshot, op);\n      } catch (error) {\n        return new ShareDBError(\n          ERROR_CODE.ERR_OT_LEGACY_JSON0_OP_CANNOT_BE_NORMALIZED,\n          'Cannot normalize legacy json0 op'\n        );\n      }\n    }\n    snapshot.v = op.v;\n    var error = exports.apply(snapshot, op);\n    if (error) return error;\n  }\n};\n\nexports.transformPresence = function(presence, op, isOwnOp) {\n  var opError = this.checkOp(op);\n  if (opError) return opError;\n\n  var type = presence.t;\n  if (typeof type === 'string') {\n    type = types.map[type];\n  }\n  if (!type) return {code: ERROR_CODE.ERR_DOC_TYPE_NOT_RECOGNIZED, message: 'Unknown type'};\n  if (!util.supportsPresence(type)) {\n    return {code: ERROR_CODE.ERR_TYPE_DOES_NOT_SUPPORT_PRESENCE, message: 'Type does not support presence'};\n  }\n\n  if (op.create || op.del) {\n    presence.p = null;\n    presence.v++;\n    return;\n  }\n\n  try {\n    presence.p = presence.p === null ?\n      null :\n      type.transformPresence(presence.p, op.op, isOwnOp);\n  } catch (error) {\n    return {code: ERROR_CODE.ERR_PRESENCE_TRANSFORM_FAILED, message: error.message || error};\n  }\n\n  presence.v++;\n};\n\n/**\n * json0 had a breaking change in https://github.com/ottypes/json0/pull/40\n * The change added stricter type checking, which breaks fetchSnapshot()\n * when trying to rebuild a snapshot from old, committed ops that didn't\n * have this stricter validation. This method fixes up legacy ops to\n * pass the stricter validation\n */\nfunction normalizeLegacyJson0Ops(snapshot, json0Op) {\n  if (snapshot.type !== types.defaultType.uri) return;\n  var components = json0Op.op;\n  if (!components) return;\n  var data = snapshot.data;\n\n  // type.apply() makes no guarantees about mutating the original data, so\n  // we need to clone. However, we only need to apply() if we have multiple\n  // components, so avoid cloning if we don't have to.\n  if (components.length > 1) data = util.clone(data);\n\n  for (var i = 0; i < components.length; i++) {\n    var component = components[i];\n    if (typeof component.lm === 'string') component.lm = +component.lm;\n    var path = component.p;\n    var element = data;\n    for (var j = 0; j < path.length; j++) {\n      var key = path[j];\n      // https://github.com/ottypes/json0/blob/73db17e86adc5d801951d1a69453b01382e66c7d/lib/json0.js#L21\n      if (Object.prototype.toString.call(element) == '[object Array]') path[j] = +key;\n      // https://github.com/ottypes/json0/blob/73db17e86adc5d801951d1a69453b01382e66c7d/lib/json0.js#L32\n      else if (element.constructor === Object) path[j] = key.toString();\n      element = element[key];\n    }\n\n    // Apply to update the snapshot, so we can correctly check the path for\n    // the next component. We don't need to do this on the final iteration,\n    // since there's no more ops.\n    if (i < components.length - 1) data = types.defaultType.apply(data, [component]);\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvb3QuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBWSxtQkFBTyxDQUFDLDBEQUFTO0FBQzdCLG1CQUFtQixtQkFBTyxDQUFDLDBEQUFTO0FBQ3BDLFdBQVcsbUJBQU8sQ0FBQyx3REFBUTs7QUFFM0I7O0FBRUE7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQztBQUNBO0FBQ0Esd0JBQXdCLDBCQUEwQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBLHNCQUFzQixvQkFBb0I7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLFlBQVk7QUFDWjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLFlBQVk7QUFDWjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQkFBa0IsdUJBQXVCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL290LmpzPzcyYjYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBjb250YWlucyB0aGUgbWFzdGVyIE9UIGZ1bmN0aW9ucyBmb3IgdGhlIGRhdGFiYXNlLiBUaGV5IGxvb2sgbGlrZVxuLy8gb3QtdHlwZXMgc3R5bGUgb3BlcmF0aW9uYWwgdHJhbnNmb3JtIGZ1bmN0aW9ucywgYnV0IHRoZXkncmUgYSBiaXQgZGlmZmVyZW50LlxuLy8gVGhlc2UgZnVuY3Rpb25zIHVuZGVyc3RhbmQgdmVyc2lvbnMgYW5kIGNhbiBkZWFsIHdpdGggb3V0IG9mIGJvdW5kIGNyZWF0ZSAmXG4vLyBkZWxldGUgb3BlcmF0aW9ucy5cblxudmFyIHR5cGVzID0gcmVxdWlyZSgnLi90eXBlcycpO1xudmFyIFNoYXJlREJFcnJvciA9IHJlcXVpcmUoJy4vZXJyb3InKTtcbnZhciB1dGlsID0gcmVxdWlyZSgnLi91dGlsJyk7XG5cbnZhciBFUlJPUl9DT0RFID0gU2hhcmVEQkVycm9yLkNPREVTO1xuXG4vLyBSZXR1cm5zIGFuIGVycm9yIHN0cmluZyBvbiBmYWlsdXJlLiBSb2NraW4nIGl0IEMgc3R5bGUuXG5leHBvcnRzLmNoZWNrT3AgPSBmdW5jdGlvbihvcCkge1xuICBpZiAob3AgPT0gbnVsbCB8fCB0eXBlb2Ygb3AgIT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfT1RfT1BfQkFETFlfRk9STUVELCAnT3AgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgfVxuXG4gIGlmIChvcC5jcmVhdGUgIT0gbnVsbCkge1xuICAgIGlmICh0eXBlb2Ygb3AuY3JlYXRlICE9PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfT1RfT1BfQkFETFlfRk9STUVELCAnQ3JlYXRlIGRhdGEgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgICB9XG4gICAgdmFyIHR5cGVOYW1lID0gb3AuY3JlYXRlLnR5cGU7XG4gICAgaWYgKHR5cGVvZiB0eXBlTmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX09UX09QX0JBRExZX0ZPUk1FRCwgJ01pc3NpbmcgY3JlYXRlIHR5cGUnKTtcbiAgICB9XG4gICAgdmFyIHR5cGUgPSB0eXBlcy5tYXBbdHlwZU5hbWVdO1xuICAgIGlmICh0eXBlID09IG51bGwgfHwgdHlwZW9mIHR5cGUgIT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfVFlQRV9OT1RfUkVDT0dOSVpFRCwgJ1Vua25vd24gdHlwZScpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChvcC5kZWwgIT0gbnVsbCkge1xuICAgIGlmIChvcC5kZWwgIT09IHRydWUpIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX09UX09QX0JBRExZX0ZPUk1FRCwgJ2RlbCB2YWx1ZSBtdXN0IGJlIHRydWUnKTtcbiAgfSBlbHNlIGlmICghKCdvcCcgaW4gb3ApKSB7XG4gICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfT1RfT1BfQkFETFlfRk9STUVELCAnTWlzc2luZyBvcCwgY3JlYXRlLCBvciBkZWwnKTtcbiAgfVxuXG4gIGlmIChvcC5zcmMgIT0gbnVsbCAmJiB0eXBlb2Ygb3Auc3JjICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX09UX09QX0JBRExZX0ZPUk1FRCwgJ3NyYyBtdXN0IGJlIGEgc3RyaW5nJyk7XG4gIH1cbiAgaWYgKG9wLnNlcSAhPSBudWxsICYmIHR5cGVvZiBvcC5zZXEgIT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfT1RfT1BfQkFETFlfRk9STUVELCAnc2VxIG11c3QgYmUgYSBudW1iZXInKTtcbiAgfVxuICBpZiAoXG4gICAgKG9wLnNyYyA9PSBudWxsICYmIG9wLnNlcSAhPSBudWxsKSB8fFxuICAgIChvcC5zcmMgIT0gbnVsbCAmJiBvcC5zZXEgPT0gbnVsbClcbiAgKSB7XG4gICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfT1RfT1BfQkFETFlfRk9STUVELCAnQm90aCBzcmMgYW5kIHNlcSBtdXN0IGJlIHNldCB0b2dldGhlcicpO1xuICB9XG5cbiAgaWYgKG9wLm0gIT0gbnVsbCAmJiB0eXBlb2Ygb3AubSAhPT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9PVF9PUF9CQURMWV9GT1JNRUQsICdvcC5tIG11c3QgYmUgYW4gb2JqZWN0IG9yIG51bGwnKTtcbiAgfVxufTtcblxuLy8gVGFrZXMgaW4gYSBzdHJpbmcgKHR5cGUgbmFtZSBvciBVUkkpIGFuZCByZXR1cm5zIHRoZSBub3JtYWxpemVkIG5hbWUgKHVyaSlcbmV4cG9ydHMubm9ybWFsaXplVHlwZSA9IGZ1bmN0aW9uKHR5cGVOYW1lKSB7XG4gIHJldHVybiB0eXBlcy5tYXBbdHlwZU5hbWVdICYmIHR5cGVzLm1hcFt0eXBlTmFtZV0udXJpO1xufTtcblxuLy8gVGhpcyBpcyB0aGUgc3VwZXIgYXBwbHkgZnVuY3Rpb24gdGhhdCB0YWtlcyBpbiBzbmFwc2hvdCBkYXRhIChpbmNsdWRpbmcgdGhlXG4vLyB0eXBlKSBhbmQgZWRpdHMgaXQgaW4tcGxhY2UuIFJldHVybnMgYW4gZXJyb3Igb3IgbnVsbCBmb3Igc3VjY2Vzcy5cbmV4cG9ydHMuYXBwbHkgPSBmdW5jdGlvbihzbmFwc2hvdCwgb3ApIHtcbiAgaWYgKHR5cGVvZiBzbmFwc2hvdCAhPT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9BUFBMWV9TTkFQU0hPVF9OT1RfUFJPVklERUQsICdNaXNzaW5nIHNuYXBzaG90Jyk7XG4gIH1cbiAgaWYgKHNuYXBzaG90LnYgIT0gbnVsbCAmJiBvcC52ICE9IG51bGwgJiYgc25hcHNob3QudiAhPT0gb3Audikge1xuICAgIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX0FQUExZX09QX1ZFUlNJT05fRE9FU19OT1RfTUFUQ0hfU05BUFNIT1QsICdWZXJzaW9uIG1pc21hdGNoJyk7XG4gIH1cblxuICAvLyBDcmVhdGUgb3BlcmF0aW9uXG4gIGlmIChvcC5jcmVhdGUpIHtcbiAgICBpZiAoc25hcHNob3QudHlwZSkgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfRE9DX0FMUkVBRFlfQ1JFQVRFRCwgJ0RvY3VtZW50IGFscmVhZHkgZXhpc3RzJyk7XG5cbiAgICAvLyBUaGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdCwgYWx0aG91Z2ggaXQgbWlnaHQgaGF2ZSBvbmNlIGV4aXN0ZWRcbiAgICB2YXIgY3JlYXRlID0gb3AuY3JlYXRlO1xuICAgIHZhciB0eXBlID0gdHlwZXMubWFwW2NyZWF0ZS50eXBlXTtcbiAgICBpZiAoIXR5cGUpIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX0RPQ19UWVBFX05PVF9SRUNPR05JWkVELCAnVW5rbm93biB0eXBlJyk7XG5cbiAgICB0cnkge1xuICAgICAgc25hcHNob3QuZGF0YSA9IHR5cGUuY3JlYXRlKGNyZWF0ZS5kYXRhKTtcbiAgICAgIHNuYXBzaG90LnR5cGUgPSB0eXBlLnVyaTtcbiAgICAgIHNuYXBzaG90LnYrKztcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiBlcnI7XG4gICAgfVxuXG4gIC8vIERlbGV0ZSBvcGVyYXRpb25cbiAgfSBlbHNlIGlmIChvcC5kZWwpIHtcbiAgICBzbmFwc2hvdC5kYXRhID0gdW5kZWZpbmVkO1xuICAgIHNuYXBzaG90LnR5cGUgPSBudWxsO1xuICAgIHNuYXBzaG90LnYrKztcblxuICAvLyBFZGl0IG9wZXJhdGlvblxuICB9IGVsc2UgaWYgKCdvcCcgaW4gb3ApIHtcbiAgICB2YXIgZXJyID0gYXBwbHlPcEVkaXQoc25hcHNob3QsIG9wLm9wKTtcbiAgICBpZiAoZXJyKSByZXR1cm4gZXJyO1xuICAgIHNuYXBzaG90LnYrKztcblxuICAvLyBOby1vcCwgYW5kIHdlIGRvbid0IGhhdmUgdG8gZG8gYW55dGhpbmdcbiAgfSBlbHNlIHtcbiAgICBzbmFwc2hvdC52Kys7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGFwcGx5T3BFZGl0KHNuYXBzaG90LCBlZGl0KSB7XG4gIGlmICghc25hcHNob3QudHlwZSkgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfRE9DX0RPRVNfTk9UX0VYSVNULCAnRG9jdW1lbnQgZG9lcyBub3QgZXhpc3QnKTtcblxuICBpZiAoZWRpdCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9PVF9PUF9OT1RfUFJPVklERUQsICdNaXNzaW5nIG9wJyk7XG4gIHZhciB0eXBlID0gdHlwZXMubWFwW3NuYXBzaG90LnR5cGVdO1xuICBpZiAoIXR5cGUpIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX0RPQ19UWVBFX05PVF9SRUNPR05JWkVELCAnVW5rbm93biB0eXBlJyk7XG5cbiAgaWYgKHR5cGUubmFtZSA9PT0gJ2pzb24wJyAmJiBBcnJheS5pc0FycmF5KGVkaXQpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlZGl0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgb3BDb21wb25lbnQgPSBlZGl0W2ldO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3BDb21wb25lbnQucCkpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvcENvbXBvbmVudC5wLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgdmFyIHBhdGhTZWdtZW50ID0gb3BDb21wb25lbnQucFtqXTtcbiAgICAgICAgICBpZiAodXRpbC5pc0Rhbmdlcm91c1Byb3BlcnR5KHBhdGhTZWdtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfT1RfT1BfTk9UX0FQUExJRUQsICdJbnZhbGlkIHBhdGggc2VnbWVudCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRyeSB7XG4gICAgc25hcHNob3QuZGF0YSA9IHR5cGUuYXBwbHkoc25hcHNob3QuZGF0YSwgZWRpdCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX09UX09QX05PVF9BUFBMSUVELCBlcnIubWVzc2FnZSk7XG4gIH1cbn1cblxuZXhwb3J0cy50cmFuc2Zvcm0gPSBmdW5jdGlvbih0eXBlLCBvcCwgYXBwbGllZE9wKSB7XG4gIC8vIFRoZXJlIGFyZSAxNiBjYXNlcyB0aGlzIGZ1bmN0aW9uIG5lZWRzIHRvIGRlYWwgd2l0aCAtIHdoaWNoIGFyZSBhbGwgdGhlXG4gIC8vIGNvbWJpbmF0aW9ucyBvZiBjcmVhdGUvZGVsZXRlL29wL25vb3AgZnJvbSBib3RoIG9wIGFuZCBhcHBsaWVkT3BcbiAgaWYgKG9wLnYgIT0gbnVsbCAmJiBvcC52ICE9PSBhcHBsaWVkT3Audikge1xuICAgIHJldHVybiBuZXcgU2hhcmVEQkVycm9yKEVSUk9SX0NPREUuRVJSX09QX1ZFUlNJT05fTUlTTUFUQ0hfRFVSSU5HX1RSQU5TRk9STSwgJ1ZlcnNpb24gbWlzbWF0Y2gnKTtcbiAgfVxuXG4gIGlmIChhcHBsaWVkT3AuZGVsKSB7XG4gICAgaWYgKG9wLmNyZWF0ZSB8fCAnb3AnIGluIG9wKSB7XG4gICAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfV0FTX0RFTEVURUQsICdEb2N1bWVudCB3YXMgZGVsZXRlZCcpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChcbiAgICAoYXBwbGllZE9wLmNyZWF0ZSAmJiAoJ29wJyBpbiBvcCB8fCBvcC5jcmVhdGUgfHwgb3AuZGVsKSkgfHxcbiAgICAoJ29wJyBpbiBhcHBsaWVkT3AgJiYgb3AuY3JlYXRlKVxuICApIHtcbiAgICAvLyBJZiBhcHBsaWVkT3AuY3JlYXRlIGlzIG5vdCB0cnVlLCBhcHBsaWVkT3AgY29udGFpbnMgYW4gb3AgLSB3aGljaFxuICAgIC8vIGFsc28gbWVhbnMgdGhlIGRvY3VtZW50IGV4aXN0cyByZW1vdGVseS5cbiAgICByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfQUxSRUFEWV9DUkVBVEVELCAnRG9jdW1lbnQgd2FzIGNyZWF0ZWQgcmVtb3RlbHknKTtcbiAgfSBlbHNlIGlmICgnb3AnIGluIGFwcGxpZWRPcCAmJiAnb3AnIGluIG9wKSB7XG4gICAgLy8gSWYgd2UgcmVhY2ggaGVyZSwgdGhleSBib3RoIGhhdmUgYSAub3AgcHJvcGVydHkuXG4gICAgaWYgKCF0eXBlKSByZXR1cm4gbmV3IFNoYXJlREJFcnJvcihFUlJPUl9DT0RFLkVSUl9ET0NfRE9FU19OT1RfRVhJU1QsICdEb2N1bWVudCBkb2VzIG5vdCBleGlzdCcpO1xuXG4gICAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykge1xuICAgICAgdHlwZSA9IHR5cGVzLm1hcFt0eXBlXTtcbiAgICAgIGlmICghdHlwZSkgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoRVJST1JfQ09ERS5FUlJfRE9DX1RZUEVfTk9UX1JFQ09HTklaRUQsICdVbmtub3duIHR5cGUnKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgb3Aub3AgPSB0eXBlLnRyYW5zZm9ybShvcC5vcCwgYXBwbGllZE9wLm9wLCAnbGVmdCcpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIGVycjtcbiAgICB9XG4gIH1cblxuICBpZiAob3AudiAhPSBudWxsKSBvcC52Kys7XG59O1xuXG4vKipcbiAqIEFwcGx5IGFuIGFycmF5IG9mIG9wcyB0byB0aGUgcHJvdmlkZWQgc25hcHNob3QuXG4gKlxuICogQHBhcmFtIHNuYXBzaG90IC0gYSBTbmFwc2hvdCBvYmplY3Qgd2hpY2ggd2lsbCBiZSBtdXRhdGVkIGJ5IHRoZSBwcm92aWRlZCBvcHNcbiAqIEBwYXJhbSBvcHMgLSBhbiBhcnJheSBvZiBvcHMgdG8gYXBwbHkgdG8gdGhlIHNuYXBzaG90XG4gKiBAcGFyYW0gb3B0aW9ucyAtIG9wdGlvbnMgKGN1cnJlbnRseSBmb3IgaW50ZXJuYWwgdXNlIG9ubHkpXG4gKiBAcmV0dXJuIGFuIGVycm9yIG9iamVjdCBpZiBhcHBsaWNhYmxlXG4gKi9cbmV4cG9ydHMuYXBwbHlPcHMgPSBmdW5jdGlvbihzbmFwc2hvdCwgb3BzLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgb3BzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIHZhciBvcCA9IG9wc1tpbmRleF07XG4gICAgaWYgKG9wdGlvbnMuX25vcm1hbGl6ZUxlZ2FjeUpzb24wT3BzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBub3JtYWxpemVMZWdhY3lKc29uME9wcyhzbmFwc2hvdCwgb3ApO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTaGFyZURCRXJyb3IoXG4gICAgICAgICAgRVJST1JfQ09ERS5FUlJfT1RfTEVHQUNZX0pTT04wX09QX0NBTk5PVF9CRV9OT1JNQUxJWkVELFxuICAgICAgICAgICdDYW5ub3Qgbm9ybWFsaXplIGxlZ2FjeSBqc29uMCBvcCdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc25hcHNob3QudiA9IG9wLnY7XG4gICAgdmFyIGVycm9yID0gZXhwb3J0cy5hcHBseShzbmFwc2hvdCwgb3ApO1xuICAgIGlmIChlcnJvcikgcmV0dXJuIGVycm9yO1xuICB9XG59O1xuXG5leHBvcnRzLnRyYW5zZm9ybVByZXNlbmNlID0gZnVuY3Rpb24ocHJlc2VuY2UsIG9wLCBpc093bk9wKSB7XG4gIHZhciBvcEVycm9yID0gdGhpcy5jaGVja09wKG9wKTtcbiAgaWYgKG9wRXJyb3IpIHJldHVybiBvcEVycm9yO1xuXG4gIHZhciB0eXBlID0gcHJlc2VuY2UudDtcbiAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykge1xuICAgIHR5cGUgPSB0eXBlcy5tYXBbdHlwZV07XG4gIH1cbiAgaWYgKCF0eXBlKSByZXR1cm4ge2NvZGU6IEVSUk9SX0NPREUuRVJSX0RPQ19UWVBFX05PVF9SRUNPR05JWkVELCBtZXNzYWdlOiAnVW5rbm93biB0eXBlJ307XG4gIGlmICghdXRpbC5zdXBwb3J0c1ByZXNlbmNlKHR5cGUpKSB7XG4gICAgcmV0dXJuIHtjb2RlOiBFUlJPUl9DT0RFLkVSUl9UWVBFX0RPRVNfTk9UX1NVUFBPUlRfUFJFU0VOQ0UsIG1lc3NhZ2U6ICdUeXBlIGRvZXMgbm90IHN1cHBvcnQgcHJlc2VuY2UnfTtcbiAgfVxuXG4gIGlmIChvcC5jcmVhdGUgfHwgb3AuZGVsKSB7XG4gICAgcHJlc2VuY2UucCA9IG51bGw7XG4gICAgcHJlc2VuY2UudisrO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRyeSB7XG4gICAgcHJlc2VuY2UucCA9IHByZXNlbmNlLnAgPT09IG51bGwgP1xuICAgICAgbnVsbCA6XG4gICAgICB0eXBlLnRyYW5zZm9ybVByZXNlbmNlKHByZXNlbmNlLnAsIG9wLm9wLCBpc093bk9wKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge2NvZGU6IEVSUk9SX0NPREUuRVJSX1BSRVNFTkNFX1RSQU5TRk9STV9GQUlMRUQsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgZXJyb3J9O1xuICB9XG5cbiAgcHJlc2VuY2UudisrO1xufTtcblxuLyoqXG4gKiBqc29uMCBoYWQgYSBicmVha2luZyBjaGFuZ2UgaW4gaHR0cHM6Ly9naXRodWIuY29tL290dHlwZXMvanNvbjAvcHVsbC80MFxuICogVGhlIGNoYW5nZSBhZGRlZCBzdHJpY3RlciB0eXBlIGNoZWNraW5nLCB3aGljaCBicmVha3MgZmV0Y2hTbmFwc2hvdCgpXG4gKiB3aGVuIHRyeWluZyB0byByZWJ1aWxkIGEgc25hcHNob3QgZnJvbSBvbGQsIGNvbW1pdHRlZCBvcHMgdGhhdCBkaWRuJ3RcbiAqIGhhdmUgdGhpcyBzdHJpY3RlciB2YWxpZGF0aW9uLiBUaGlzIG1ldGhvZCBmaXhlcyB1cCBsZWdhY3kgb3BzIHRvXG4gKiBwYXNzIHRoZSBzdHJpY3RlciB2YWxpZGF0aW9uXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZUxlZ2FjeUpzb24wT3BzKHNuYXBzaG90LCBqc29uME9wKSB7XG4gIGlmIChzbmFwc2hvdC50eXBlICE9PSB0eXBlcy5kZWZhdWx0VHlwZS51cmkpIHJldHVybjtcbiAgdmFyIGNvbXBvbmVudHMgPSBqc29uME9wLm9wO1xuICBpZiAoIWNvbXBvbmVudHMpIHJldHVybjtcbiAgdmFyIGRhdGEgPSBzbmFwc2hvdC5kYXRhO1xuXG4gIC8vIHR5cGUuYXBwbHkoKSBtYWtlcyBubyBndWFyYW50ZWVzIGFib3V0IG11dGF0aW5nIHRoZSBvcmlnaW5hbCBkYXRhLCBzb1xuICAvLyB3ZSBuZWVkIHRvIGNsb25lLiBIb3dldmVyLCB3ZSBvbmx5IG5lZWQgdG8gYXBwbHkoKSBpZiB3ZSBoYXZlIG11bHRpcGxlXG4gIC8vIGNvbXBvbmVudHMsIHNvIGF2b2lkIGNsb25pbmcgaWYgd2UgZG9uJ3QgaGF2ZSB0by5cbiAgaWYgKGNvbXBvbmVudHMubGVuZ3RoID4gMSkgZGF0YSA9IHV0aWwuY2xvbmUoZGF0YSk7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb21wb25lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07XG4gICAgaWYgKHR5cGVvZiBjb21wb25lbnQubG0gPT09ICdzdHJpbmcnKSBjb21wb25lbnQubG0gPSArY29tcG9uZW50LmxtO1xuICAgIHZhciBwYXRoID0gY29tcG9uZW50LnA7XG4gICAgdmFyIGVsZW1lbnQgPSBkYXRhO1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGF0aC5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIGtleSA9IHBhdGhbal07XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vb3R0eXBlcy9qc29uMC9ibG9iLzczZGIxN2U4NmFkYzVkODAxOTUxZDFhNjk0NTNiMDEzODJlNjZjN2QvbGliL2pzb24wLmpzI0wyMVxuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlbGVtZW50KSA9PSAnW29iamVjdCBBcnJheV0nKSBwYXRoW2pdID0gK2tleTtcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9vdHR5cGVzL2pzb24wL2Jsb2IvNzNkYjE3ZTg2YWRjNWQ4MDE5NTFkMWE2OTQ1M2IwMTM4MmU2NmM3ZC9saWIvanNvbjAuanMjTDMyXG4gICAgICBlbHNlIGlmIChlbGVtZW50LmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHBhdGhbal0gPSBrZXkudG9TdHJpbmcoKTtcbiAgICAgIGVsZW1lbnQgPSBlbGVtZW50W2tleV07XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgdG8gdXBkYXRlIHRoZSBzbmFwc2hvdCwgc28gd2UgY2FuIGNvcnJlY3RseSBjaGVjayB0aGUgcGF0aCBmb3JcbiAgICAvLyB0aGUgbmV4dCBjb21wb25lbnQuIFdlIGRvbid0IG5lZWQgdG8gZG8gdGhpcyBvbiB0aGUgZmluYWwgaXRlcmF0aW9uLFxuICAgIC8vIHNpbmNlIHRoZXJlJ3Mgbm8gbW9yZSBvcHMuXG4gICAgaWYgKGkgPCBjb21wb25lbnRzLmxlbmd0aCAtIDEpIGRhdGEgPSB0eXBlcy5kZWZhdWx0VHlwZS5hcHBseShkYXRhLCBbY29tcG9uZW50XSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/ot.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/protocol.js":
/*!**********************************************!*\
  !*** ./node_modules/sharedb/lib/protocol.js ***!
  \**********************************************/
/***/ ((module) => {

eval("module.exports = {\n  major: 1,\n  minor: 2,\n  checkAtLeast: checkAtLeast\n};\n\nfunction checkAtLeast(toCheck, checkAgainst) {\n  toCheck = normalizedProtocol(toCheck);\n  checkAgainst = normalizedProtocol(checkAgainst);\n  if (toCheck.major > checkAgainst.major) return true;\n  return toCheck.major === checkAgainst.major &&\n    toCheck.minor >= checkAgainst.minor;\n}\n\nfunction normalizedProtocol(protocol) {\n  if (typeof protocol === 'string') {\n    var segments = protocol.split('.');\n    protocol = {\n      major: segments[0],\n      minor: segments[1]\n    };\n  }\n\n  return {\n    major: +(protocol.protocol || protocol.major || 0),\n    minor: +(protocol.protocolMinor || protocol.minor || 0)\n  };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvcHJvdG9jb2wuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXk5X2NvbGxhYm9yYXRpdmVfZWRpdG9yLy4vbm9kZV9tb2R1bGVzL3NoYXJlZGIvbGliL3Byb3RvY29sLmpzPzhkOTAiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSB7XG4gIG1ham9yOiAxLFxuICBtaW5vcjogMixcbiAgY2hlY2tBdExlYXN0OiBjaGVja0F0TGVhc3Rcbn07XG5cbmZ1bmN0aW9uIGNoZWNrQXRMZWFzdCh0b0NoZWNrLCBjaGVja0FnYWluc3QpIHtcbiAgdG9DaGVjayA9IG5vcm1hbGl6ZWRQcm90b2NvbCh0b0NoZWNrKTtcbiAgY2hlY2tBZ2FpbnN0ID0gbm9ybWFsaXplZFByb3RvY29sKGNoZWNrQWdhaW5zdCk7XG4gIGlmICh0b0NoZWNrLm1ham9yID4gY2hlY2tBZ2FpbnN0Lm1ham9yKSByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIHRvQ2hlY2subWFqb3IgPT09IGNoZWNrQWdhaW5zdC5tYWpvciAmJlxuICAgIHRvQ2hlY2subWlub3IgPj0gY2hlY2tBZ2FpbnN0Lm1pbm9yO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVkUHJvdG9jb2wocHJvdG9jb2wpIHtcbiAgaWYgKHR5cGVvZiBwcm90b2NvbCA9PT0gJ3N0cmluZycpIHtcbiAgICB2YXIgc2VnbWVudHMgPSBwcm90b2NvbC5zcGxpdCgnLicpO1xuICAgIHByb3RvY29sID0ge1xuICAgICAgbWFqb3I6IHNlZ21lbnRzWzBdLFxuICAgICAgbWlub3I6IHNlZ21lbnRzWzFdXG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgbWFqb3I6ICsocHJvdG9jb2wucHJvdG9jb2wgfHwgcHJvdG9jb2wubWFqb3IgfHwgMCksXG4gICAgbWlub3I6ICsocHJvdG9jb2wucHJvdG9jb2xNaW5vciB8fCBwcm90b2NvbC5taW5vciB8fCAwKVxuICB9O1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/protocol.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/snapshot.js":
/*!**********************************************!*\
  !*** ./node_modules/sharedb/lib/snapshot.js ***!
  \**********************************************/
/***/ ((module) => {

eval("module.exports = Snapshot;\nfunction Snapshot(id, version, type, data, meta) {\n  this.id = id;\n  this.v = version;\n  this.type = type;\n  this.data = data;\n  this.m = meta;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvc25hcHNob3QuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2RheTlfY29sbGFib3JhdGl2ZV9lZGl0b3IvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvc25hcHNob3QuanM/ZDQwMiJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFNuYXBzaG90O1xuZnVuY3Rpb24gU25hcHNob3QoaWQsIHZlcnNpb24sIHR5cGUsIGRhdGEsIG1ldGEpIHtcbiAgdGhpcy5pZCA9IGlkO1xuICB0aGlzLnYgPSB2ZXJzaW9uO1xuICB0aGlzLnR5cGUgPSB0eXBlO1xuICB0aGlzLmRhdGEgPSBkYXRhO1xuICB0aGlzLm0gPSBtZXRhO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/snapshot.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/types.js":
/*!*******************************************!*\
  !*** ./node_modules/sharedb/lib/types.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nexports.defaultType = __webpack_require__(/*! ot-json0 */ \"(ssr)/./node_modules/ot-json0/lib/index.js\").type;\n\nexports.map = Object.create(null);\n\nexports.register = function(type) {\n  if (type.name) exports.map[type.name] = type;\n  if (type.uri) exports.map[type.uri] = type;\n};\n\nexports.register(exports.defaultType);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvdHlwZXMuanMiLCJtYXBwaW5ncyI6IjtBQUNBLDRHQUE4Qzs7QUFFOUMsV0FBVzs7QUFFWCxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF5OV9jb2xsYWJvcmF0aXZlX2VkaXRvci8uL25vZGVfbW9kdWxlcy9zaGFyZWRiL2xpYi90eXBlcy5qcz9hYjNiIl0sInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0cy5kZWZhdWx0VHlwZSA9IHJlcXVpcmUoJ290LWpzb24wJykudHlwZTtcblxuZXhwb3J0cy5tYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG5leHBvcnRzLnJlZ2lzdGVyID0gZnVuY3Rpb24odHlwZSkge1xuICBpZiAodHlwZS5uYW1lKSBleHBvcnRzLm1hcFt0eXBlLm5hbWVdID0gdHlwZTtcbiAgaWYgKHR5cGUudXJpKSBleHBvcnRzLm1hcFt0eXBlLnVyaV0gPSB0eXBlO1xufTtcblxuZXhwb3J0cy5yZWdpc3RlcihleHBvcnRzLmRlZmF1bHRUeXBlKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/types.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/sharedb/lib/util.js":
/*!******************************************!*\
  !*** ./node_modules/sharedb/lib/util.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("var nextTickImpl = __webpack_require__(/*! ./next-tick */ \"(ssr)/./node_modules/sharedb/lib/next-tick.js\");\n\nexports.doNothing = doNothing;\nfunction doNothing() {}\n\nexports.hasKeys = function(object) {\n  for (var key in object) return true;\n  return false;\n};\n\nvar hasOwn;\nexports.hasOwn = hasOwn = Object.hasOwn || Object.prototype.hasOwnProperty.call;\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger#Polyfill\nexports.isInteger = Number.isInteger || function(value) {\n  return typeof value === 'number' &&\n    isFinite(value) &&\n    Math.floor(value) === value;\n};\n\nexports.isValidVersion = function(version) {\n  if (version === null) return true;\n  return exports.isInteger(version) && version >= 0;\n};\n\nexports.isValidTimestamp = function(timestamp) {\n  return exports.isValidVersion(timestamp);\n};\n\nexports.MAX_SAFE_INTEGER = 9007199254740991;\n\nexports.dig = function() {\n  var obj = arguments[0];\n  for (var i = 1; i < arguments.length; i++) {\n    var key = arguments[i];\n    obj = hasOwn(obj, key) ? obj[key] : (i === arguments.length - 1 ? undefined : Object.create(null));\n  }\n  return obj;\n};\n\nexports.digOrCreate = function() {\n  var obj = arguments[0];\n  var createCallback = arguments[arguments.length - 1];\n  for (var i = 1; i < arguments.length - 1; i++) {\n    var key = arguments[i];\n    obj = hasOwn(obj, key) ? obj[key] :\n      (obj[key] = i === arguments.length - 2 ? createCallback() : Object.create(null));\n  }\n  return obj;\n};\n\nexports.digAndRemove = function() {\n  var obj = arguments[0];\n  var objects = [obj];\n  for (var i = 1; i < arguments.length - 1; i++) {\n    var key = arguments[i];\n    if (!hasOwn(obj, key)) break;\n    obj = obj[key];\n    objects.push(obj);\n  };\n\n  for (var i = objects.length - 1; i >= 0; i--) {\n    var parent = objects[i];\n    var key = arguments[i + 1];\n    var child = parent[key];\n    if (i === objects.length - 1 || !exports.hasKeys(child)) delete parent[key];\n  }\n};\n\nexports.supportsPresence = function(type) {\n  return type && typeof type.transformPresence === 'function';\n};\n\nexports.callEach = function(callbacks, error) {\n  var called = false;\n  callbacks.forEach(function(callback) {\n    if (callback) {\n      callback(error);\n      called = true;\n    }\n  });\n  return called;\n};\n\nexports.truthy = function(arg) {\n  return !!arg;\n};\n\nif (typeof process !== 'undefined' && typeof process.nextTick === 'function') {\n  exports.nextTick = process.nextTick;\n} else if (typeof MessageChannel !== 'undefined') {\n  exports.nextTick = nextTickImpl.messageChannel;\n} else {\n  exports.nextTick = nextTickImpl.setTimeout;\n}\n\nexports.clone = function(obj) {\n  return (obj === undefined) ? undefined : JSON.parse(JSON.stringify(obj));\n};\n\nvar objectProtoPropNames = Object.create(null);\nObject.getOwnPropertyNames(Object.prototype).forEach(function(prop) {\n  if (prop !== '__proto__') {\n    objectProtoPropNames[prop] = true;\n  }\n});\nexports.isDangerousProperty = function(propName) {\n  return propName === '__proto__' || objectProtoPropNames[propName];\n};\n\ntry {\n  var util = __webpack_require__(/*! util */ \"util\");\n  if (typeof util.inherits !== 'function') throw new Error('Could not find util.inherits()');\n  exports.inherits = util.inherits;\n} catch (e) {\n  try {\n    exports.inherits = __webpack_require__(/*! inherits */ \"(ssr)/./node_modules/inherits/inherits.js\");\n  } catch (e) {\n    throw new Error('If running sharedb in a browser, please install the \"inherits\" or \"util\" package');\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvdXRpbC5qcyIsIm1hcHBpbmdzIjoiQUFBQSxtQkFBbUIsbUJBQU8sQ0FBQyxrRUFBYTs7QUFFeEMsaUJBQWlCO0FBQ2pCOztBQUVBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxjQUFjOztBQUVkO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7O0FBRUEsd0JBQXdCO0FBQ3hCO0FBQ0E7O0FBRUEsd0JBQXdCOztBQUV4QixXQUFXO0FBQ1g7QUFDQSxrQkFBa0Isc0JBQXNCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQSxrQkFBa0IsMEJBQTBCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBLGtCQUFrQiwwQkFBMEI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQ0FBbUMsUUFBUTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsd0JBQXdCO0FBQ3hCO0FBQ0E7O0FBRUEsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0EsRUFBRSxnQkFBZ0I7QUFDbEIsRUFBRTtBQUNGLEVBQUUsZ0JBQWdCO0FBQ2xCLEVBQUU7QUFDRixFQUFFLGdCQUFnQjtBQUNsQjs7QUFFQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELDJCQUEyQjtBQUMzQjtBQUNBOztBQUVBO0FBQ0EsYUFBYSxtQkFBTyxDQUFDLGtCQUFNO0FBQzNCO0FBQ0EsRUFBRSxnQkFBZ0I7QUFDbEIsRUFBRTtBQUNGO0FBQ0EsSUFBSSxtR0FBc0M7QUFDMUMsSUFBSTtBQUNKO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2RheTlfY29sbGFib3JhdGl2ZV9lZGl0b3IvLi9ub2RlX21vZHVsZXMvc2hhcmVkYi9saWIvdXRpbC5qcz82NTE5Il0sInNvdXJjZXNDb250ZW50IjpbInZhciBuZXh0VGlja0ltcGwgPSByZXF1aXJlKCcuL25leHQtdGljaycpO1xuXG5leHBvcnRzLmRvTm90aGluZyA9IGRvTm90aGluZztcbmZ1bmN0aW9uIGRvTm90aGluZygpIHt9XG5cbmV4cG9ydHMuaGFzS2V5cyA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxudmFyIGhhc093bjtcbmV4cG9ydHMuaGFzT3duID0gaGFzT3duID0gT2JqZWN0Lmhhc093biB8fCBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGw7XG5cbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL051bWJlci9pc0ludGVnZXIjUG9seWZpbGxcbmV4cG9ydHMuaXNJbnRlZ2VyID0gTnVtYmVyLmlzSW50ZWdlciB8fCBmdW5jdGlvbih2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJlxuICAgIGlzRmluaXRlKHZhbHVlKSAmJlxuICAgIE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZTtcbn07XG5cbmV4cG9ydHMuaXNWYWxpZFZlcnNpb24gPSBmdW5jdGlvbih2ZXJzaW9uKSB7XG4gIGlmICh2ZXJzaW9uID09PSBudWxsKSByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGV4cG9ydHMuaXNJbnRlZ2VyKHZlcnNpb24pICYmIHZlcnNpb24gPj0gMDtcbn07XG5cbmV4cG9ydHMuaXNWYWxpZFRpbWVzdGFtcCA9IGZ1bmN0aW9uKHRpbWVzdGFtcCkge1xuICByZXR1cm4gZXhwb3J0cy5pc1ZhbGlkVmVyc2lvbih0aW1lc3RhbXApO1xufTtcblxuZXhwb3J0cy5NQVhfU0FGRV9JTlRFR0VSID0gOTAwNzE5OTI1NDc0MDk5MTtcblxuZXhwb3J0cy5kaWcgPSBmdW5jdGlvbigpIHtcbiAgdmFyIG9iaiA9IGFyZ3VtZW50c1swXTtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gYXJndW1lbnRzW2ldO1xuICAgIG9iaiA9IGhhc093bihvYmosIGtleSkgPyBvYmpba2V5XSA6IChpID09PSBhcmd1bWVudHMubGVuZ3RoIC0gMSA/IHVuZGVmaW5lZCA6IE9iamVjdC5jcmVhdGUobnVsbCkpO1xuICB9XG4gIHJldHVybiBvYmo7XG59O1xuXG5leHBvcnRzLmRpZ09yQ3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gIHZhciBvYmogPSBhcmd1bWVudHNbMF07XG4gIHZhciBjcmVhdGVDYWxsYmFjayA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIHZhciBrZXkgPSBhcmd1bWVudHNbaV07XG4gICAgb2JqID0gaGFzT3duKG9iaiwga2V5KSA/IG9ialtrZXldIDpcbiAgICAgIChvYmpba2V5XSA9IGkgPT09IGFyZ3VtZW50cy5sZW5ndGggLSAyID8gY3JlYXRlQ2FsbGJhY2soKSA6IE9iamVjdC5jcmVhdGUobnVsbCkpO1xuICB9XG4gIHJldHVybiBvYmo7XG59O1xuXG5leHBvcnRzLmRpZ0FuZFJlbW92ZSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgb2JqID0gYXJndW1lbnRzWzBdO1xuICB2YXIgb2JqZWN0cyA9IFtvYmpdO1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICB2YXIga2V5ID0gYXJndW1lbnRzW2ldO1xuICAgIGlmICghaGFzT3duKG9iaiwga2V5KSkgYnJlYWs7XG4gICAgb2JqID0gb2JqW2tleV07XG4gICAgb2JqZWN0cy5wdXNoKG9iaik7XG4gIH07XG5cbiAgZm9yICh2YXIgaSA9IG9iamVjdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgcGFyZW50ID0gb2JqZWN0c1tpXTtcbiAgICB2YXIga2V5ID0gYXJndW1lbnRzW2kgKyAxXTtcbiAgICB2YXIgY2hpbGQgPSBwYXJlbnRba2V5XTtcbiAgICBpZiAoaSA9PT0gb2JqZWN0cy5sZW5ndGggLSAxIHx8ICFleHBvcnRzLmhhc0tleXMoY2hpbGQpKSBkZWxldGUgcGFyZW50W2tleV07XG4gIH1cbn07XG5cbmV4cG9ydHMuc3VwcG9ydHNQcmVzZW5jZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgcmV0dXJuIHR5cGUgJiYgdHlwZW9mIHR5cGUudHJhbnNmb3JtUHJlc2VuY2UgPT09ICdmdW5jdGlvbic7XG59O1xuXG5leHBvcnRzLmNhbGxFYWNoID0gZnVuY3Rpb24oY2FsbGJhY2tzLCBlcnJvcikge1xuICB2YXIgY2FsbGVkID0gZmFsc2U7XG4gIGNhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICBjYWxsYmFjayhlcnJvcik7XG4gICAgICBjYWxsZWQgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjYWxsZWQ7XG59O1xuXG5leHBvcnRzLnRydXRoeSA9IGZ1bmN0aW9uKGFyZykge1xuICByZXR1cm4gISFhcmc7XG59O1xuXG5pZiAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwcm9jZXNzLm5leHRUaWNrID09PSAnZnVuY3Rpb24nKSB7XG4gIGV4cG9ydHMubmV4dFRpY2sgPSBwcm9jZXNzLm5leHRUaWNrO1xufSBlbHNlIGlmICh0eXBlb2YgTWVzc2FnZUNoYW5uZWwgIT09ICd1bmRlZmluZWQnKSB7XG4gIGV4cG9ydHMubmV4dFRpY2sgPSBuZXh0VGlja0ltcGwubWVzc2FnZUNoYW5uZWw7XG59IGVsc2Uge1xuICBleHBvcnRzLm5leHRUaWNrID0gbmV4dFRpY2tJbXBsLnNldFRpbWVvdXQ7XG59XG5cbmV4cG9ydHMuY2xvbmUgPSBmdW5jdGlvbihvYmopIHtcbiAgcmV0dXJuIChvYmogPT09IHVuZGVmaW5lZCkgPyB1bmRlZmluZWQgOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpO1xufTtcblxudmFyIG9iamVjdFByb3RvUHJvcE5hbWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKE9iamVjdC5wcm90b3R5cGUpLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICBpZiAocHJvcCAhPT0gJ19fcHJvdG9fXycpIHtcbiAgICBvYmplY3RQcm90b1Byb3BOYW1lc1twcm9wXSA9IHRydWU7XG4gIH1cbn0pO1xuZXhwb3J0cy5pc0Rhbmdlcm91c1Byb3BlcnR5ID0gZnVuY3Rpb24ocHJvcE5hbWUpIHtcbiAgcmV0dXJuIHByb3BOYW1lID09PSAnX19wcm90b19fJyB8fCBvYmplY3RQcm90b1Byb3BOYW1lc1twcm9wTmFtZV07XG59O1xuXG50cnkge1xuICB2YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbiAgaWYgKHR5cGVvZiB1dGlsLmluaGVyaXRzICE9PSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIHV0aWwuaW5oZXJpdHMoKScpO1xuICBleHBvcnRzLmluaGVyaXRzID0gdXRpbC5pbmhlcml0cztcbn0gY2F0Y2ggKGUpIHtcbiAgdHJ5IHtcbiAgICBleHBvcnRzLmluaGVyaXRzID0gcmVxdWlyZSgnaW5oZXJpdHMnKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignSWYgcnVubmluZyBzaGFyZWRiIGluIGEgYnJvd3NlciwgcGxlYXNlIGluc3RhbGwgdGhlIFwiaW5oZXJpdHNcIiBvciBcInV0aWxcIiBwYWNrYWdlJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/sharedb/lib/util.js\n");

/***/ })

};
;