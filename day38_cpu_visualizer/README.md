# Day38 - CPU ビジュアライザー

## 概要

JavaScriptコードがアセンブリ風コード、マシンコード風コードに変換され、CPU内部でステップ実行される様子を視覚化するシミュレーターです。
レジスタ、メモリ、フラグの状態変化を追跡しながら、プログラムがどのように実行されるかを理解する助けとなります。
バックエンドは使用せず、フロントエンドのみで実装されています。

https://github.com/user-attachments/assets/3a0270f3-348d-44b8-89bd-c5d8c89dee37

[100日チャレンジ day38](https://zenn.dev/gin_nazo/scraps/4ca1014e82ea2e)

## 主な機能

-   **JavaScriptコード入力:**
    -   `let` による変数宣言（数値代入、変数代入、簡単な加算）をサポート。
    -   `if (変数 比較演算子 数値) { 単純な代入文 or HALT }` 形式の条件分岐をサポート。
    -   `HALT` 命令によるプログラム停止。
-   **コード変換:**
    -   入力されたJSコードをカスタム定義のアセンブリ風命令セットに変換して表示。
    -   アセンブリ命令を簡略化されたマシンコード（16進数）に変換して表示。
-   **ステップ実行:**
    -   ボタンまたはキーボード (Space/Enter) でアセンブリ命令を1ステップずつ実行。
    -   実行中のアセンブリ行と、対応する元のJavaScript行をハイライト表示。
-   **状態表示:**
    -   プログラムカウンタ(PC)、汎用レジスタ(R0-R2)、フラグレジスタ(Zero, Carry, Negative)の状態をリアルタイム表示。
    -   変数が格納されるメモリ領域の内容を表示（簡易版）。
    -   CPUの実行/停止ステータス表示。
-   **制御:**
    -   コンパイル＆ロード、ステップ実行、CPU状態リセット、全リセットの操作ボタン。

## デザイン

-   **テーマ:** ターミナル風（黒背景、緑/シアン基調、等幅フォント、角張ったパネル）。
-   **レジスタ表示:** 物理的なCPUパッケージとダイ表面を模したグラフィカルな表示。
-   **スタイリング:** Tailwind CSS を使用。

## 技術スタック

-   **フレームワーク:** Next.js (App Router)
-   **言語:** TypeScript
-   **スタイリング:** Tailwind CSS
-   **状態管理:** React Hooks (`useState`, `useEffect`, `useCallback`)
-   **コアロジック:** `app/_lib/cpuEngine.ts` にCPUシミュレーションエンジン (`useCpuSimulator` フック) と簡易JSパーサー (`parseJsToAssembly`) を実装。

## 実行方法

```bash
# day38_cpu_visualizer ディレクトリに移動
npm install
npm run dev --port 3001
```

ブラウザで `http://localhost:3001/cpu` にアクセスしてください。

## 今後の拡張案 (未実装)

-   メモリハイライトの表示 (`z-index` 問題の解決)
-   フラグ変化の強調表示
-   条件ジャンプとフラグの関係表示
-   より複雑なJS構文（`else`, 複数行ブロック, 算術演算, `while`ループなど）のサポート
-   関数呼び出し (`CALL`/`RET`) とスタックの実装
-   マシンコード生成におけるラベル解決
-   ALUのアニメーション表現
-   実行履歴と巻き戻し機能
