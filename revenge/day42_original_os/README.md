# Day 42: オリジナルOS開発プロジェクト

このプロジェクトは、`STRATEGY.md` に基づいて独自のオペレーティングシステムを段階的に開発することを目標としています。

## プロジェクト概要

`STRATEGY.md` に記載された以下のフェーズを経て、最終的にはミニシェル (`echo`, `ls` コマンド実装) が動作するOSを構築します。

1.  **Phase 1:** "Hello, kernel!" が QEMU で起動
2.  **Phase 2:** VGA/Framebuffer 文字表示 & 例外ハンドラ
3.  **Phase 3:** 物理メモリ管理 & ページング開始
4.  **Phase 4:** タイマ割り込み & ラウンドロビン・スケジューラ
5.  **Phase 5:** ELF 形式のユーザプロセス起動
6.  **Phase 6:** ミニシェル + `echo` / `ls`

## 主な技術要素

-   **ターゲットアーキテクチャ:** x86_64
-   **ブートローダー:** UEFI (MikanLoaderPkg または Limine)
-   **カーネル言語:** C (一部アセンブリ)
-   **ビルド環境:** LLVM (Clang + lld), NASM/GNU Assembler
-   **仮想化環境:** QEMU
-   **デバッグ:** GDB, LLDB

詳細な計画は `STRATEGY.md` を参照してください。

## 自作OS用語集

| カテゴリー           | 用語                    | 説明                                                                                                                                                                                                                                                                                                                                                                                               |
| :------------------- | :---------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **OSの基本概念** | OS (Operating System)   | コンピュータのハードウェアを管理し、ソフトウェアが動作するための基本的な機能を提供するシステムソフトウェアです。                                                                                                                                                                                                                                                                               |
|                      | カーネル (Kernel)       | OSの最も中心となる部分で、ハードウェアとソフトウェアの間の橋渡しをします。メモリ管理、プロセスのスケジュール、デバイスとの通信などを担当します。                                                                                                                                                                                                                                           |
|                      | MikanOS                 | 内田公太氏が公開している、UEFIベースの教育用OSの名称です。このロードマップでは、MikanOSの考え方や構成をベースにしています。                                                                                                                                                                                                                                                              |
|                      | ユーザープロセス        | カーネル空間とは分離された「ユーザー空間」で実行されるプログラムです。アプリケーションなどがこれにあたります。                                                                                                                                                                                                                                                                                  |
|                      | システムコール (Syscall) | ユーザープログラムが、OSのカーネルが提供する機能（ファイル読み書き、メモリ確保など）を利用するための窓口です。                                                                                                                                                                                                                                                                                    |
|                      | ユーザー空間 (User Space) | プログラムが動作するために確保されるメモリ領域の一つで、アプリケーションプログラムが実行される領域です。カーネル空間とはセキュリティ上分離されています。                                                                                                                                                                                                                                          |
|                      | init プロセス           | OS起動時にカーネルによって最初に起動されるプロセスです。他のすべてのプロセスはこのinitプロセスの子孫として起動されます。                                                                                                                                                                                                                                                                        |
|                      | ミニシェル              | 簡易的なコマンドラインインタープリター（シェル）です。ユーザーがコマンドを入力し、それをOSに実行させる役割を果たします。                                                                                                                                                                                                                                                                           |
| **開発環境とツール** | QEMU                    | オープンソースのエミュレータ兼仮想化ソフトウェアです。異なるアーキテクチャのCPUをエミュレートしたり、OSを仮想マシン上で動作させたりするために使われます。                                                                                                                                                                                                                                      |
|                      | M1 Mac                  | Apple社が開発した独自プロセッサ「Apple Silicon（M1チップ）」を搭載したMacintoshコンピュータです。                                                                                                                                                                                                                                                                                       |
|                      | クロスツールチェーン    | ある種類のCPU上で動作する実行ファイルを、別の種類のCPU用に生成するための開発ツールのセット（コンパイラ、アセンブラ、リンカなど）です。今回の場合はM1 Mac (ARM) 上で、x86_64アーキテクチャのOS用のコードを生成します。                                                                                                                                                                   |
|                      | x86_64-elf              | 「x86_64」はIntelおよびAMDの64ビットCPUアーキテクチャを指します。「-elf」はELF形式という実行ファイル形式をターゲットとすることを示します。                                                                                                                                                                                                                                               |
|                      | Homebrew                | macOS用のパッケージマネージャーです。コマンド一つでソフトウェアのインストールや管理ができます。                                                                                                                                                                                                                                                                                        |
|                      | LLVM / Clang            | LLVMはコンパイラ技術の基盤プロジェクトです。ClangはLLVMをバックエンドとするC/C++/Objective-Cコンパイラです。                                                                                                                                                                                                                                                                                   |
|                      | nasm / gnu as           | アセンブラです。アセンブラは人間が書いたアセンブリ言語のコードを、コンピュータが理解できる機械語に変換するプログラムです。                                                                                                                                                                                                                                                            |
|                      | lld                     | LLVMプロジェクトの一部であるリンカです。リンカはコンパイルされた複数のオブジェクトファイルやライブラリを結合し、実行可能なプログラムを生成します。                                                                                                                                                                                                                                         |
|                      | xorriso / mtools / objcopy | ディスクイメージを作成したり、ファイルシステムを操作したり、オブジェクトファイルを変換したりするためのユーティリティツールです。                                                                                                                                                                                                                                                         |
|                      | GitHub Actions          | GitHubが提供するCI/CD（継続的インテグレーション/継続的デリバリー）プラットフォームです。コードのテストやビルドを自動化できます。                                                                                                                                                                                                                                                        |
|                      | mkdocs / mdBook         | Markdown形式で書かれたドキュメントから、Webサイト形式のドキュメントを生成するためのツールです。                                                                                                                                                                                                                                                                                          |
| **ハードウェアと制御** | UEFI                    | 従来のBIOSに代わる、新しいファームウェアの規格です。大容量ストレージへの対応や、より高度なグラフィカルインターフェース、ネットワーク機能などを持ちます。                                                                                                                                                                                                                                  |
|                      | OVMF.fd                 | QEMUでUEFIをエミュレートするためのファームウェアイメージファイルです。                                                                                                                                                                                                                                                                                                                    |
|                      | VGA / Framebuffer       | **VGA**は、IBM PCの標準的なグラフィックスカードおよびその表示モードを指します。**Framebuffer**は、ディスプレイに表示される画像情報をピクセル単位で保持するメモリ領域です。                                                                                                                                                                                                             |
|                      | コンソール              | コンピュータとユーザーが対話するための基本的なテキストベースのインターフェースです。通常はキーボードからの入力と画面へのテキスト出力が行われます。                                                                                                                                                                                                                                              |
|                      | IDT (Interrupt Descriptor Table) | CPUが割り込みや例外を受け取った際に、どの処理（割り込みハンドラ）を実行すべきかを定義するテーブルです。                                                                                                                                                                                                                                                                           |
|                      | 例外ハンドラ (Exception Handler) | CPUが不正な操作（例：ゼロ除算、無効なメモリアクセス）を検出した際に、その例外を処理するための特別なプログラムです。                                                                                                                                                                                                                                                                   |
|                      | PIC / IO-APIC           | いずれもハードウェアからの割り込み要求（キーボード入力、タイマ割り込みなど）をCPUに伝える役割を持つチップです。IO-APICは、複数のCPUやより多くの割り込みを効率的に処理できます。                                                                                                                                                                                                             |
|                      | タイマ割り込み          | 一定時間ごとにCPUに発生させる割り込みです。OSのスケジューラでタスクを切り替える際などに利用されます。                                                                                                                                                                                                                                                                                  |
|                      | PIT / APIC              | いずれもハードウェアタイマーです。**PIT**は比較的シンプルなタイマーで、**APIC**はより高度でマルチコアCPU環境に適したタイマーです。                                                                                                                                                                                                                                                          |
|                      | GDT (Global Descriptor Table) | x86アーキテクチャにおいて、メモリセグメントの属性（開始アドレス、サイズ、アクセス権など）を定義するテーブルです。                                                                                                                                                                                                                                                                    |
|                      | Long Mode               | x86-64プロセッサの64ビット動作モードです。より広いアドレス空間と新しい命令セットが利用可能になります。                                                                                                                                                                                                                                                                               |
|                      | CR3                     | x86プロセッサの制御レジスタの一つで、現在のページテーブルのベースアドレス（物理アドレス）を保持しています。仮想メモリ有効化の際に設定されます。                                                                                                                                                                                                                                           |
|                      | x2APIC                  | APICの拡張バージョンで、より多くのプロセッサや割り込みを効率的に管理できる機能を提供します。                                                                                                                                                                                                                                                                                              |
| **ブートプロセス** | ブートローダ (Bootloader) | OSの起動時に最初に実行される小さなプログラムです。OSのカーネルをメモリに読み込み、実行を開始する役割を担います。                                                                                                                                                                                                                                                                     |
|                      | Limine                  | 最新のUEFI/BIOS両方に対応した汎用的なオープンソースのブートローダです。                                                                                                                                                                                                                                                                                                                 |
|                      | EFIAPI efi_main         | UEFIアプリケーションのエントリーポイント（プログラムの開始点）となる関数です。                                                                                                                                                                                                                                                                                                       |
|                      | UEFI Memory Map         | UEFIファームウェアが起動時に提供する、メモリ領域の物理アドレス、サイズ、タイプ（使用中、空き、予約済みなど）を記述したリストです。OSはこの情報を使ってメモリ管理を行います。                                                                                                                                                                                                              |
| **メモリ管理** | 物理メモリ管理 (PMM)    | コンピュータの物理的なRAM（メインメモリ）を管理する機能です。空きメモリの検出、確保、解放などを行います。                                                                                                                                                                                                                                                                            |
|                      | 仮想メモリ管理 (VMM)    | 物理メモリとは別に、OSがプログラムに「仮想的なアドレス空間」を提供する機能です。これにより、各プログラムは独立した広大なメモリを使っているように見え、メモリの保護も可能になります。                                                                                                                                                                                                  |
|                      | ページング (Paging)     | 仮想メモリを実現するための主要な技術です。メモリを「ページ」と呼ばれる固定サイズのブロックに分割し、仮想アドレスを物理アドレスに変換することで、メモリ保護や効率的なメモリ利用を可能にします。                                                                                                                                                                                          |
|                      | PML4 (Page Map Level 4) | x86-64アーキテクチャのページングにおいて使用される、ページテーブル構造の最上位レベルのテーブルです。仮想アドレスから物理アドレスへの変換経路の一部を構成します。                                                                                                                                                                                                                         |
|                      | Higher Half Kernel      | カーネルが仮想アドレス空間の上半分に配置される設計パターンです。ユーザープログラムが下半分に配置されることで、カーネルとユーザープログラム間のアドレス衝突を防ぎ、アドレス空間の分離を容易にします。                                                                                                                                                                                       |
| **CPUとタスク管理** | ラウンドロビン・スケジューラ | 複数のタスク（プロセスやスレッド）にCPU時間を順番に均等に割り当てるスケジューリングアルゴリズムです。各タスクは決められた短い時間（タイムスライス）だけ実行され、次のタスクに切り替わります。                                                                                                                                                                                             |
|                      | TSS (Task State Segment) | x86アーキテクチャにおいて、タスク（プロセス）の状態を保存するための構造体です。タスク切り替えの際に利用されますが、現代のOSではソフトウェアによるコンテキストスイッチが主流です。                                                                                                                                                                                                   |
|                      | コンテキストスイッチ (Context Switch) | CPUが現在実行中のタスク（プロセスやスレッド）の実行状態（レジスタの値、スタックの状態など）を保存し、別のタスクの実行状態を復元して実行を切り替える処理です。                                                                                                                                                                                                                             |
|                      | `fork`/`exec`           | プロセスを生成・実行するための代表的なシステムコールです。`fork`は現在実行中のプロセスを複製し、`exec`は指定されたプログラムを現在のプロセス空間で実行します。                                                                                                                                                                                                                         |
| **ファイルシステムとI/O** | ELF (Executable and Linkable Format) | UNIX系OSや組み込みシステムで広く用いられる、実行ファイル、オブジェクトファイル、共有ライブラリなどの標準的なファイル形式です。                                                                                                                                                                                                                                               |
|                      | ELF64 loader            | 64ビット版のELFファイルをメモリに読み込み、プログラムとして実行可能な状態にするプログラムです。                                                                                                                                                                                                                                                                                            |
|                      | `.text`/`.data`         | ELF実行ファイルに含まれるセクション（領域）です。`.text`はプログラムの実行可能コードが格納され、`.data`は初期値を持つデータ（グローバル変数など）が格納されます。                                                                                                                                                                                                                           |
|                      | 仮想ファイルシステム (VFS) | 異なる種類のファイルシステム（例えば、FAT32、Ext4、RAMFSなど）を、アプリケーションからは共通のインターフェースで扱えるようにするための抽象化レイヤーです。                                                                                                                                                                                                                            |
|                      | デバイス層              | OSにおいて、特定のハードウェアデバイス（コンソール、ディスク、ネットワークなど）との通信を抽象化し、アプリケーションから統一的にアクセスできるようにするソフトウェアの層です。                                                                                                                                                                                                         |
|                      | RAMFS                   | 物理メモリ（RAM）上に構築されるファイルシステムです。高速ですが、電源を切るとデータが失われます。                                                                                                                                                                                                                                                                                        |
| **デバッグとユーティリティ** | GDB (GNU Debugger) / LLDB | プログラムのデバッグ（バグの特定・修正）に用いられるツールです。プログラムの実行を一時停止したり、メモリやレジスタの内容を調べたりできます。                                                                                                                                                                                                                                           |
|                      | `target remote`         | GDBなどのデバッガで、別のコンピュータやエミュレータ上で動作しているプログラムにネットワーク経由で接続するためのコマンドです。                                                                                                                                                                                                                                                           |
|                      | `set architecture`      | GDBなどのデバッガで、デバッグ対象のCPUアーキテクチャを設定するコマンドです。例えば、ホストがARMでもゲストがx86_64の場合にx86_64に設定します。                                                                                                                                                                                                                                              |
|                      | HVF (Hypervisor.framework) | Apple社がmacOS向けに提供している、仮想化を高速化するためのフレームワークです。QEMUと組み合わせることで、仮想マシンの実行性能を向上させることができます。                                                                                                                                                                                                                             |
|                      | JIT (Just-In-Time) Compilation | 実行時にコードを機械語に変換する技術です。エミュレータなどで、エミュレート対象のCPUの命令をホストCPUの命令にリアルタイムで変換することで、実行速度を向上させます。                                                                                                                                                                                                                         |

---
