# Day 35: ワークフロー自動化ツール

## 概要

このプロジェクトは、Next.js, TypeScript, Tailwind CSS（グラスモーフィズムデザイン採用）, Zustand, better-sqlite3 を使用したワークフロー自動化ツールです。ユーザーはワークフローを定義し、その中のタスクを管理し、タスク間の依存関係を設定し、カンバンボードで進捗を視覚化することができます。

https://github.com/user-attachments/assets/0b771504-5ae0-40b0-ba4b-12dbd2efd6b6

[100日チャレンジ day35](https://zenn.dev/gin_nazo/scraps/1ef0285d9a2dab)

## 機能

-   **ユーザー切り替え:** ヘッダーのドロップダウンによるシンプルなユーザー切り替え機能 (状態管理には Zustand を使用)。
-   **ワークフロー管理:**
    -   タスク統計（合計/完了数）付きのワークフロー一覧表示。
    -   モーダルによる新規ワークフロー作成。
    -   ワークフロー詳細（名前、説明、作成者、日付）の表示。
    -   (ワークフローの編集/削除UIはスタブのみで未実装)。
-   **タスク管理 (ワークフロー内):**
    -   ステータス（未着手, 進行中, 完了, 保留）で分割されたカンバンボードによるタスクの視覚化。
    -   タスクカードのドロップダウンメニューによるタスクステータス変更（ライブラリの問題によりドラッグ＆ドロップから変更）。
    -   モーダルによる新規タスク作成。
    -   モーダルによる既存タスク（名前、説明、担当者、期日）の編集。
    -   タスクの削除（確認付き）。
-   **タスク依存関係:**
    -   タスクに対する前提タスクの定義。
    -   タスクカードのモーダルによる依存関係の追加。
    -   タスクカードにリスト表示される依存関係の表示。
    -   依存関係の削除。
    -   前提条件が満たされていない場合のステータス変更を防ぐバックエンドバリデーション。
    -   循環依存関係の作成を防ぐバックエンドバリデーション。
-   **データベース:**
    -   SQLite (`db/dev.db`) と `better-sqlite3` を使用。
    -   スキーマには `users`, `workflows`, `tasks`, `task_dependencies` が含まれる。
    -   トリガーによる `updated_at` タイムスタンプの自動更新。
-   **API:**
    -   ワークフロー、タスク、依存関係に対するCRUD操作のためのNext.js Route Handlers。
    -   統計情報付きのワークフローリスト、およびタスク/依存関係付きのワークフロー詳細を取得するエンドポイントを含む。
-   **スタイリング:**
    -   グラスモーフィズムテーマ（ぼかした背景、繊細な境界線）のTailwind CSS。
    -   レスポンシブデザイン。
-   **状態管理:**
    -   現在のユーザー選択とユーザーリストの管理のためのZustand。
    -   コンポーネントレベルの状態とハンドラのためのReact `useState` と `useCallback`。
-   **UIコンポーネント:**
    -   ユーザー切り替え付きヘッダー。
    -   カード表示のワークフロー一覧ページ。
    -   カンバンボード付きのワークフロー詳細ページ。
    -   詳細、ステータスドロップダウン、依存関係管理機能付きのタスクカード。
    -   再利用可能なモーダルコンポーネント。
    -   ワークフローとタスクの作成/編集、依存関係追加のためのフォーム。
    -   `react-toastify` を使用した通知。

## 既知の問題 / 制限事項

-   ワークフローの編集・削除UIは未実装です。
-   ステータス変更のためのドラッグ＆ドロップは、`@hello-pangea/dnd` と React 18/StrictMode との間に継続的な問題があったため、ドロップダウンに置き換えられました。
-   エラーハンドリングは基本的なものです。
-   実際の認証機能はありません。

## セットアップと実行

1.  **依存関係のインストール:**
    ```bash
    npm install
    ```
2.  **開発サーバーの実行:**
    ```bash
    npm run dev -- -p 3001
    ```
3.  ブラウザで [http://localhost:3001](http://localhost:3001) を開きます。

## データベーススキーマ (`lib/db.ts`)

-   **`users`**: `id`, `name`, `email`, `created_at`, `updated_at`
-   **`workflows`**: `id`, `name`, `description`, `created_by_user_id`, `created_at`, `updated_at`
-   **`tasks`**: `id`, `workflow_id`, `name`, `description`, `assigned_user_id`, `created_by_user_id`, `due_date`, `status`, `order_index`, `created_at`, `updated_at`
-   **`task_dependencies`**: `task_id`, `depends_on_task_id` (複合主キー, ON DELETE CASCADE)
