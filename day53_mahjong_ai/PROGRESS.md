## Day53: CPU対戦付き二人麻雀 (最強AI) - 進捗

- [x] **Step 1/8: プロジェクト初期化**
    - [x] `template` をコピーして `day53_mahjong_ai` を作成。
    - [x] `package.json` の `name` を `day53_mahjong_ai` に変更。
    - [x] `README.md` の内容を更新。
    - [x] `PROGRESS.md` を作成し、作業ステップを記述。
    - [x] 基本レイアウト `app/layout.tsx` と `app/page.tsx` の雛形作成。
    - [x] `globals.css` にTailwindCSSの基本的な設定。
    - [x] *テスト*: `npm run dev` で起動確認。
    - [x] *コミット*: `day53: step 1/8 プロジェクト初期化と基本設定`
- [ ] **Step 2/8: 麻雀コアロジック: 牌と山の準備**
    - [ ] `lib/mahjong/tiles.ts`: 牌の種類 (萬子、索子、筒子、字牌) と各牌の定義。牌の比較関数などユーティリティ。
    - [ ] `lib/mahjong/yama.ts`: 山の生成 (136枚)、シャッフル、配牌、ツモ、嶺上牌、ドラ表示などのロジック。
    - [ ] *テスト*: 山が正しく生成され、シャッフルされること。配牌が各プレイヤーに正しく配られること。ツモができること。
    - [ ] *コミット*: `day53: step 2/8 麻雀コアロジック - 牌と山の準備`
- [ ] **Step 3/8: 麻雀コアロジック: 手牌管理と向聴数計算**
    - [ ] `lib/mahjong/hand.ts`: 手牌の表現 (ソートされた牌の配列)。牌の追加・削除。
    - [ ] 向聴数計算ロジック: 面子・塔子の判定、国士無双・七対子の判定を含め、手牌が和了まであと何枚必要かを計算。
    - [ ] 和了判定の基礎: 与えられた手牌が和了形（4面子1雀頭）になっているか判定する (役はまだ考慮しない)。
    - [ ] *テスト*: 様々な手牌パターンでの向聴数計算の正確性。和了形の判定。
    - [ ] *コミット*: `day53: step 3/8 麻雀コアロジック - 手牌管理と向聴数計算`
- [ ] **Step 4/8: API実装: ゲーム開始と基本アクション**
    - [ ] `lib/mahjong/game_state.ts`: ゲーム全体の進行状態 (局、本場、供託、プレイヤー/CPUの手牌・河・点数、現在のターン、山、ドラなど) を管理するクラス/オブジェクト。
    - [ ] `app/api/game/new/route.ts (GET)`: 新しいゲームセッションを開始し、初期盤面情報 (配牌、親、ドラなど) を返す。
    - [ ] `app/api/game/action/route.ts (POST)`: プレイヤーの打牌アクションを受け付け、ゲーム状態を更新。CPUのツモと打牌まで自動で行い、盤面情報を返す (CPUの思考はまだ単純なもの: 例 ランダム打牌 or シャンテン数のみ考慮)。
    - [ ] *テスト*: `curl` や Postman でAPIを叩き、ゲームが開始できること、プレイヤーが打牌できること、CPUが自動で打牌することを確認。
    - [ ] *コミット*: `day53: step 4/8 API実装 - ゲーム開始と基本アクション`
- [ ] **Step 5/8: UI実装: 基本的なゲーム画面**
    - [ ] `app/(pages)/page.tsx`: APIを呼び出し、ゲーム盤面を表示するメインコンポーネント。
    - [ ] `components/Tile.tsx`: 牌をクレイモーフィズムスタイルで表示。
    - [ ] `components/PlayerHand.tsx`: プレイヤーの手牌を表示し、クリックで打牌選択可能にする。
    - [ ] `components/CpuHand.tsx`: CPUの手牌 (裏向き or 開発中は表向き)。
    - [ ] `components/River.tsx`: プレイヤーとCPUの捨て牌を表示。
    - [ ] `components/MahjongTable.tsx`: 全体をまとめる卓コンポーネント。
    - [ ] `components/ScoreBoard.tsx`: 仮の点数表示。
    - [ ] クレイモーフィズムを意識したCSSを `globals.css` および各コンポーネントに適用。
    - [ ] *テスト*: ブラウザで画面が表示され、手牌から牌を捨てられることを確認。CPUの捨て牌が反映されることを確認。
    - [ ] *コミット*: `day53: step 5/8 UI実装 - 基本的なゲーム画面 (クレイモーフィズム適用)`
- [ ] **Step 6/8: 麻雀コアロジック: 役判定と点数計算**
    - [ ] `lib/mahjong/yaku.ts`: 主要な役 (立直、断幺九、役牌、平和、一盃口、混全帯幺九、七対子、混一色、清一色、国士無双など) の判定ロジック。ドラ、裏ドラ、赤ドラ(今回はなし)の扱い。
    - [ ] `lib/mahjong/score.ts`: 和了形と役に基づいて符計算と点数計算を行う。親/子の点数、満貫・跳満・倍満・三倍満・役満の扱い。
    - [ ] `lib/mahjong/hand.ts` の和了判定を拡張し、役と点数も返すようにする。
    - [ ] *テスト*: 様々な和了形と手牌で役判定と点数計算が正しく行われることを確認する単体テスト。
    - [ ] *コミット*: `day53: step 6/8 麻雀コアロジック - 役判定と点数計算`
- [ ] **Step 7/8: CPU AI とゲームフローの高度化**
    - [ ] `lib/mahjong/cpu_ai.ts`:
        - [ ] 打牌選択ロジックの強化: 向聴数に加え、手役の可能性、待ちの良さ、危険牌評価（相手のリーチや副露に対するベタオリ判断など）を組み込む。
        - [ ] 副露判断 (ポン・チー・カン): するかしないかの判断基準を実装。
        - [ ] リーチ判断: リーチするかダマにするかの判断基準を実装。
    - [ ] `app/api/game/action/route.ts`:
        - [ ] ポン、チー、カン、リーチ、ツモ和了、ロン和了のアクションを処理できるように拡張。
        - [ ] 流局 (山切れ) の処理、テンパイ判定、ノーテン罰符の処理。
        - [ ] 連荘・親流れの処理。ゲーム終了判定 (東風戦終了など)。
    - [ ] `components/ActionButtons.tsx`: ポン、チー、カン、リーチ、ロン、ツモなどのアクションボタンを状況に応じて表示・制御。
    - [ ] *テスト*: CPUが状況に応じて賢い選択をするか（ある程度）。副露、リーチ、和了が正しく処理されるか。ゲームが最後まで進行し、点数移動が正しく行われるか。Playwrightで数パターンのゲームフローをテスト。
    - [ ] *コミット*: `day53: step 7/8 CPU AIとゲームフローの高度化、アクション実装`
- [ ] **Step 8/8: 仕上げとドキュメント**
    - [ ] UIの微調整、デザインの最終仕上げ。
    - [ ] エラーハンドリングの強化。
    - [ ] `README.md` に遊び方、実装した役一覧、CPUの強さについてなどを追記。
    - [ ] `.cursor/rules/knowledge.mdc` を更新。
    - [ ] *テスト*: 全体的な動作確認。
    - [ ] *コミット*: `day53: step 8/8 最終調整とドキュメント更新`

以下に進捗を記載してください。


- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
