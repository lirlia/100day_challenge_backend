# Day53: CPU対戦付き二人麻雀 (最強AI)

## 1. アプリケーション概要

二人打ちの麻雀ゲームです。プレイヤーは最強設定のCPUと対戦します。
UIはクレイモーフィズムを採用し、柔らかく立体感のあるデザインを目指します。

*   **基本ルール**:
    *   二人麻雀（東風戦または半荘戦を選択できるようにする予定ですが、まずは東風戦から）
    *   34種136牌を使用 (花牌なし)
    *   食いタンあり、後付けあり
    *   赤ドラなし (実装簡略化のため、最初はなし。余裕があれば追加)
    *   途中流局なし (九種九牌、四風連打など。簡略化のため)
    *   ダブロン、トリプルロンなし (二人麻雀なのでダブロンのみ考慮)
*   **CPU思考ロジック (最強設定)**:
    *   **手役指向**: 高得点の手役を積極的に狙う。
    *   **向聴数 (シャンテンすう) 計算**: 常に最小シャンテン数となるような打牌を選択。
    *   **危険牌予測**: 相手（プレイヤー）のリーチや副露から危険牌を予測し、放銃回避を試みる。
    *   **待ちの評価**: より有利な待ち（多面待ち、残り枚数が多い待ち）を目指す。
    *   **確率・期待値**: 各選択肢の和了確率や期待値を考慮した打牌 (可能な範囲で)。
    *   **状況判断**: 点数状況、局、残り巡目などを考慮した戦略。
*   **デザイン**: クレイモーフィズム

## 2. ディレクトリ構成と主要ファイル

標準的なNext.js (App Router) の構成に従います。

```
day53_mahjong_ai/
├── app/
│   ├── api/
│   │   └── game/
│   │       ├── new/
│   │       │   └── route.ts      # 新規ゲーム開始API
│   │       └── action/
│   │           └── route.ts      # ゲームアクションAPI
│   ├── (pages)/
│   │   └── page.tsx              # メインゲーム画面
│   ├── layout.tsx
│   └── globals.css
├── components/
│   ├── MahjongTable.tsx          # 麻雀卓全体
│   ├── PlayerHand.tsx            # プレイヤー手牌
│   ├── CpuHand.tsx               # CPU手牌
│   ├── River.tsx                 # 捨て牌
│   ├── ScoreBoard.tsx            # 点数表示など
│   ├── Tile.tsx                  # 牌コンポーネント
│   └── ActionButtons.tsx         # アクションボタン群
├── lib/
│   ├── db.ts                     # (今回は原則DB未使用、戦績保存用として将来的に検討)
│   ├── mahjong/                  # 麻雀コアロジック
│   │   ├── tiles.ts              # 牌の定義・操作
│   │   ├── yama.ts               # 山の生成・操作
│   │   ├── hand.ts               # 手牌の操作、向聴数計算、和了判定など
│   │   ├── yaku.ts               # 役判定
│   │   ├── score.ts              # 点数計算
│   │   ├── game_state.ts         # ゲーム状態管理
│   │   └── cpu_ai.ts             # CPU思考ロジック
│   └── utils.ts
├── public/
├── db/                           # (今回は原則DB未使用)
│   └── dev.db
├── package.json
├── README.md
└── PROGRESS.md
```

## 3. 技術スタック

*   Next.js (App Router)
*   TypeScript
*   Tailwind CSS (クレイモーフィズム)
*   better-sqlite3 (今回は原則DB未使用)

## 4. 遊び方 (予定)

1.  ゲーム開始画面で「東風戦開始」ボタンを押します。
2.  プレイヤーに配牌が配られます。
3.  自分のターンになったら、手牌から1牌選択して捨てます。
4.  CPUも自動でツモと打牌を行います。
5.  ポン、チー、カン、リーチ、ロン、ツモ和了などのアクションは、可能な場合にボタンが表示されます。
6.  東風戦が終了すると、最終結果が表示されます。

## 5. 実装する役 (主要なものから順次)

*   立直 (リーチ)
*   断幺九 (タンヤオチュウ)
*   役牌 (ヤクハイ) - 自風牌、場風牌、三元牌
*   平和 (ピンフ)
*   一盃口 (イーペーコー)
*   混全帯幺九 (チャンタ)
*   七対子 (チートイツ)
*   混一色 (ホンイツ)
*   清一色 (チンイツ)
*   国士無双 (コクシムソウ)
*   その他、基本的な役 (三暗刻、小三元、対々和など)
*   ドラ

## 6. CPUの強さについて (目標)

「最強」を目指しますが、実装の複雑さから段階的に賢くしていきます。
初期は向聴数ベースの打牌、徐々に手役進行、危険牌読み、確率計算などを導入予定です。

## 7. 今後の拡張案

*   半荘戦モード
*   赤ドラ
*   詳細な戦績保存・表示
*   UI/UXの更なる向上
*   CPUの思考パターンの追加 (守備型、攻撃型など)
