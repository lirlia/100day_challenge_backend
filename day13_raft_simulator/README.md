# Day 13: Raft 分散合意シミュレータ

## 目的
- Raft アルゴリズムの基本動作（リーダー選出、ログ複製、コミットメント）を視覚的に理解する。
- クラスター構成の動的な変更（ノードの停止、再開、追加、削除）が Raft の動作に与える影響を観察する。

## プラットフォーム
- クライアントサイド完結 (Web ブラウザ上)。バックエンド API やデータベースは使用しない。

## 初期状態
- 3つの Raft ノードが配置された状態でシミュレーションを開始する。

## 主要機能と UI
- **盤面**: ノードを配置するメインの表示領域。
- **ノード表示**:
    - 円または四角形で表現。
    - 状態（Follower, Candidate, Leader, Stopped）に応じて色分けする。
    - 各ノードの現在の Term 番号と、保持しているログ（コミット済みかも区別）を表示する。ログエントリは `{ term: number, command: string, index: number }` (例: `{ term: 1, command: "CMD 1", index: 1 }`) とする。
- **ノード操作 (カーソル主体)**:
    - **移動**: ノードを盤面上でドラッグ＆ドロップして自由に配置できる。
    - **停止/再開**: ノードをクリックするとコンテキストメニュー（またはトグルボタン）が表示され、「停止」「再開」を切り替えられる。停止中のノードは視覚的に区別する（例: 灰色表示）。
    - **追加**: 盤面の空きスペースを右クリックするか、「ノード追加」ボタンをクリックすると、新しいノードが盤面に追加される。(構成変更プロトコルは未実装)
    - **削除**: ノードをクリックした際のコンテキストメニューに「削除」を追加する。(構成変更プロトコルは未実装)
    - **コマンド送信**: リーダーノードをクリックした際のコンテキストメニューに「コマンド送信」を追加。選択すると、新しい一意のコマンド（例: "CMD 2", "CMD 3"）が生成され、リーダーのログに追加されて複製プロセスが開始される。
- **シミュレーション制御**:
    - 「開始/一時停止」「リセット」「1ステップ進む」ボタンを配置する。
- **イベントログ**:
    - 画面の一部（例: 下部やサイドバー）に、シミュレーション中に発生した主要なイベント（リーダー選出開始、投票、リーダー決定、ログ複製要求/応答、コミット、ノードの追加/削除/停止/再開）の履歴を表示する。
- **RPC 可視化**:
    - ノード間で RequestVote や AppendEntries の RPC が送受信される際に、ノード間に矢印を表示して視覚的に表現する。
- **(オプション) ネットワークシミュレーション**:
    - 将来的には、ノード間のメッセージ遅延やロスをシミュレートする機能を追加することも検討する（初期実装では必須ではない）。

## 技術スタック
- フレームワーク: Next.js (App Router)
- 言語: TypeScript
- スタイリング: Tailwind CSS (template に設定済み)
- 状態管理: React (useState, useEffect, useCallback 等)
- ドラッグ＆ドロップ: (未定、`react-dnd` 等を検討)
- Raft ロジック: `lib/raft/` ディレクトリなどに TypeScript で実装する。
